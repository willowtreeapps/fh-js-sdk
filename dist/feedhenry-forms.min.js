!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.feedhenry=e()}}(function(){var e;return function f(e,n,o){function d(t,l){if(!n[t]){if(!e[t]){var u="function"==typeof require&&require;if(!l&&u)return u(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var p=n[t]={exports:{}};e[t][0].call(p.exports,function(f){var n=e[t][1][f];return d(n?n:f)},p,p.exports,f,e,n,o)}return n[t].exports}for(var i="function"==typeof require&&require,t=0;t<o.length;t++)d(o[t]);return d}({1:[function(e,f,n){(function(n){__browserify_shim_require__=e,function(e,f,n,o,d){var i=i||function(e,f){var n={},o=n.lib={},d=o.Base=function(){function e(){}return{extend:function(f){e.prototype=this;var n=new e;return f&&n.mixIn(f),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var f in e)e.hasOwnProperty(f)&&(this[f]=e[f]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=o.WordArray=d.extend({init:function(e,n){e=this.words=e||[],n!=f?this.sigBytes=n:this.sigBytes=4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var f=this.words,n=e.words,o=this.sigBytes,d=e.sigBytes;if(this.clamp(),o%4)for(var i=0;d>i;i++){var t=n[i>>>2]>>>24-i%4*8&255;f[o+i>>>2]|=t<<24-(o+i)%4*8}else if(n.length>65535)for(var i=0;d>i;i+=4)f[o+i>>>2]=n[i>>>2];else f.push.apply(f,n);return this.sigBytes+=d,this},clamp:function(){var f=this.words,n=this.sigBytes;f[n>>>2]&=4294967295<<32-n%4*8,f.length=e.ceil(n/4)},clone:function(){var e=d.clone.call(this);return e.words=this.words.slice(0),e},random:function(f){for(var n=[],o=0;f>o;o+=4)n.push(4294967296*e.random()|0);return new i.init(n,f)}}),t=n.enc={},l=t.Hex={stringify:function(e){for(var f=e.words,n=e.sigBytes,o=[],d=0;n>d;d++){var i=f[d>>>2]>>>24-d%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var f=e.length,n=[],o=0;f>o;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new i.init(n,f/2)}},u=t.Latin1={stringify:function(e){for(var f=e.words,n=e.sigBytes,o=[],d=0;n>d;d++){var i=f[d>>>2]>>>24-d%4*8&255;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var f=e.length,n=[],o=0;f>o;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new i.init(n,f)}},p=t.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(f){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},s=o.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(f){var n=this._data,o=n.words,d=n.sigBytes,t=this.blockSize,l=4*t,u=d/l;u=f?e.ceil(u):e.max((0|u)-this._minBufferSize,0);var p=u*t,s=e.min(4*p,d);if(p){for(var y=0;p>y;y+=t)this._doProcessBlock(o,y);var c=o.splice(0,p);n.sigBytes-=s}return new i.init(c,s)},clone:function(){var e=d.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),y=(o.Hasher=s.extend({cfg:d.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){s.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var f=this._doFinalize();return f},blockSize:16,_createHelper:function(e){return function(f,n){return new e.init(n).finalize(f)}},_createHmacHelper:function(e){return function(f,n){return new y.HMAC.init(e,n).finalize(f)}}}),n.algo={});return n}(Math);!function(){var e=i,f=e.lib,n=f.WordArray,o=e.enc;o.Base64={stringify:function(e){var f=e.words,n=e.sigBytes,o=this._map;e.clamp();for(var d=[],i=0;n>i;i+=3)for(var t=f[i>>>2]>>>24-i%4*8&255,l=f[i+1>>>2]>>>24-(i+1)%4*8&255,u=f[i+2>>>2]>>>24-(i+2)%4*8&255,p=t<<16|l<<8|u,s=0;4>s&&n>i+.75*s;s++)d.push(o.charAt(p>>>6*(3-s)&63));var y=o.charAt(64);if(y)for(;d.length%4;)d.push(y);return d.join("")},parse:function(e){var f=e.length,o=this._map,d=o.charAt(64);if(d){var i=e.indexOf(d);-1!=i&&(f=i)}for(var t=[],l=0,u=0;f>u;u++)if(u%4){var p=o.indexOf(e.charAt(u-1))<<u%4*2,s=o.indexOf(e.charAt(u))>>>6-u%4*2;t[l>>>2]|=(p|s)<<24-l%4*8,l++}return n.create(t,l)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),i.lib.Cipher||function(e){var f=i,n=f.lib,o=n.Base,d=n.WordArray,t=n.BufferedBlockAlgorithm,l=f.enc,u=(l.Utf8,l.Base64),p=f.algo,s=p.EvpKDF,y=n.Cipher=t.extend({cfg:o.extend(),createEncryptor:function(e,f){return this.create(this._ENC_XFORM_MODE,e,f)},createDecryptor:function(e,f){return this.create(this._DEC_XFORM_MODE,e,f)},init:function(e,f,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=f,this.reset()},reset:function(){t.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var f=this._doFinalize();return f},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?k:h}return function(f){return{encrypt:function(n,o,d){return e(o).encrypt(f,n,o,d)},decrypt:function(n,o,d){return e(o).decrypt(f,n,o,d)}}}}()}),c=(n.StreamCipher=y.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),f.mode={}),r=n.BlockCipherMode=o.extend({createEncryptor:function(e,f){return this.Encryptor.create(e,f)},createDecryptor:function(e,f){return this.Decryptor.create(e,f)},init:function(e,f){this._cipher=e,this._iv=f}}),a=c.CBC=function(){function f(f,n,o){var d=this._iv;if(d){var i=d;this._iv=e}else var i=this._prevBlock;for(var t=0;o>t;t++)f[n+t]^=i[t]}var n=r.extend();return n.Encryptor=n.extend({processBlock:function(e,n){var o=this._cipher,d=o.blockSize;f.call(this,e,n,d),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+d)}}),n.Decryptor=n.extend({processBlock:function(e,n){var o=this._cipher,d=o.blockSize,i=e.slice(n,n+d);o.decryptBlock(e,n),f.call(this,e,n,d),this._prevBlock=i}}),n}(),w=f.pad={},b=w.Pkcs7={pad:function(e,f){for(var n=4*f,o=n-e.sigBytes%n,i=o<<24|o<<16|o<<8|o,t=[],l=0;o>l;l+=4)t.push(i);var u=d.create(t,o);e.concat(u)},unpad:function(e){var f=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=f}},g=(n.BlockCipher=y.extend({cfg:y.cfg.extend({mode:a,padding:b}),reset:function(){y.reset.call(this);var e=this.cfg,f=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var o=n.createEncryptor;else{var o=n.createDecryptor;this._minBufferSize=1}this._mode=o.call(n,this,f&&f.words)},_doProcessBlock:function(e,f){this._mode.processBlock(e,f)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var f=this._process(!0)}else{var f=this._process(!0);e.unpad(f)}return f},blockSize:4}),n.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),m=f.format={},x=m.OpenSSL={stringify:function(e){var f=e.ciphertext,n=e.salt;if(n)var o=d.create([1398893684,1701076831]).concat(n).concat(f);else var o=f;return o.toString(u)},parse:function(e){var f=u.parse(e),n=f.words;if(1398893684==n[0]&&1701076831==n[1]){var o=d.create(n.slice(2,4));n.splice(0,4),f.sigBytes-=16}return g.create({ciphertext:f,salt:o})}},h=n.SerializableCipher=o.extend({cfg:o.extend({format:x}),encrypt:function(e,f,n,o){o=this.cfg.extend(o);var d=e.createEncryptor(n,o),i=d.finalize(f),t=d.cfg;return g.create({ciphertext:i,key:n,iv:t.iv,algorithm:e,mode:t.mode,padding:t.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,f,n,o){o=this.cfg.extend(o),f=this._parse(f,o.format);var d=e.createDecryptor(n,o).finalize(f.ciphertext);return d},_parse:function(e,f){return"string"==typeof e?f.parse(e,this):e}}),j=f.kdf={},v=j.OpenSSL={execute:function(e,f,n,o){o||(o=d.random(8));var i=s.create({keySize:f+n}).compute(e,o),t=d.create(i.words.slice(f),4*n);return i.sigBytes=4*f,g.create({key:i,iv:t,salt:o})}},k=n.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:v}),encrypt:function(e,f,n,o){o=this.cfg.extend(o);var d=o.kdf.execute(n,e.keySize,e.ivSize);o.iv=d.iv;var i=h.encrypt.call(this,e,f,d.key,o);return i.mixIn(d),i},decrypt:function(e,f,n,o){o=this.cfg.extend(o),f=this._parse(f,o.format);var d=o.kdf.execute(n,e.keySize,e.ivSize,f.salt);o.iv=d.iv;var i=h.decrypt.call(this,e,f,d.key,o);return i}})}(),function(){var e=i,f=e.lib,n=f.BlockCipher,o=e.algo,d=[],t=[],l=[],u=[],p=[],s=[],y=[],c=[],r=[],a=[];!function(){for(var e=[],f=0;256>f;f++)128>f?e[f]=f<<1:e[f]=f<<1^283;for(var n=0,o=0,f=0;256>f;f++){var i=o^o<<1^o<<2^o<<3^o<<4;i=i>>>8^255&i^99,d[n]=i,t[i]=n;var w=e[n],b=e[w],g=e[b],m=257*e[i]^16843008*i;l[n]=m<<24|m>>>8,u[n]=m<<16|m>>>16,p[n]=m<<8|m>>>24,s[n]=m;var m=16843009*g^65537*b^257*w^16843008*n;y[i]=m<<24|m>>>8,c[i]=m<<16|m>>>16,r[i]=m<<8|m>>>24,a[i]=m,n?(n=w^e[e[e[g^w]]],o^=e[e[o]]):n=o=1}}();var w=[0,1,2,4,8,16,32,64,128,27,54],b=o.AES=n.extend({_doReset:function(){for(var e=this._key,f=e.words,n=e.sigBytes/4,o=this._nRounds=n+6,i=4*(o+1),t=this._keySchedule=[],l=0;i>l;l++)if(n>l)t[l]=f[l];else{var u=t[l-1];l%n?n>6&&l%n==4&&(u=d[u>>>24]<<24|d[u>>>16&255]<<16|d[u>>>8&255]<<8|d[255&u]):(u=u<<8|u>>>24,u=d[u>>>24]<<24|d[u>>>16&255]<<16|d[u>>>8&255]<<8|d[255&u],u^=w[l/n|0]<<24),t[l]=t[l-n]^u}for(var p=this._invKeySchedule=[],s=0;i>s;s++){var l=i-s;if(s%4)var u=t[l];else var u=t[l-4];4>s||4>=l?p[s]=u:p[s]=y[d[u>>>24]]^c[d[u>>>16&255]]^r[d[u>>>8&255]]^a[d[255&u]]}},encryptBlock:function(e,f){this._doCryptBlock(e,f,this._keySchedule,l,u,p,s,d)},decryptBlock:function(e,f){var n=e[f+1];e[f+1]=e[f+3],e[f+3]=n,this._doCryptBlock(e,f,this._invKeySchedule,y,c,r,a,t);var n=e[f+1];e[f+1]=e[f+3],e[f+3]=n},_doCryptBlock:function(e,f,n,o,d,i,t,l){for(var u=this._nRounds,p=e[f]^n[0],s=e[f+1]^n[1],y=e[f+2]^n[2],c=e[f+3]^n[3],r=4,a=1;u>a;a++){var w=o[p>>>24]^d[s>>>16&255]^i[y>>>8&255]^t[255&c]^n[r++],b=o[s>>>24]^d[y>>>16&255]^i[c>>>8&255]^t[255&p]^n[r++],g=o[y>>>24]^d[c>>>16&255]^i[p>>>8&255]^t[255&s]^n[r++],m=o[c>>>24]^d[p>>>16&255]^i[s>>>8&255]^t[255&y]^n[r++];p=w,s=b,y=g,c=m}var w=(l[p>>>24]<<24|l[s>>>16&255]<<16|l[y>>>8&255]<<8|l[255&c])^n[r++],b=(l[s>>>24]<<24|l[y>>>16&255]<<16|l[c>>>8&255]<<8|l[255&p])^n[r++],g=(l[y>>>24]<<24|l[c>>>16&255]<<16|l[p>>>8&255]<<8|l[255&s])^n[r++],m=(l[c>>>24]<<24|l[p>>>16&255]<<16|l[s>>>8&255]<<8|l[255&y])^n[r++];e[f]=w,e[f+1]=b,e[f+2]=g,e[f+3]=m},keySize:8});e.AES=n._createHelper(b)}(),function(e){function f(e,f,n,o,d,i,t){var l=e+(f&n|~f&o)+d+t;return(l<<i|l>>>32-i)+f}function n(e,f,n,o,d,i,t){var l=e+(f&o|n&~o)+d+t;return(l<<i|l>>>32-i)+f}function o(e,f,n,o,d,i,t){var l=e+(f^n^o)+d+t;return(l<<i|l>>>32-i)+f}function d(e,f,n,o,d,i,t){var l=e+(n^(f|~o))+d+t;return(l<<i|l>>>32-i)+f}var t=i,l=t.lib,u=l.WordArray,p=l.Hasher,s=t.algo,y=[];!function(){for(var f=0;64>f;f++)y[f]=4294967296*e.abs(e.sin(f+1))|0}();var c=s.MD5=p.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var t=0;16>t;t++){var l=i+t,u=e[l];e[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var p=this._hash.words,s=e[i+0],c=e[i+1],r=e[i+2],a=e[i+3],w=e[i+4],b=e[i+5],g=e[i+6],m=e[i+7],x=e[i+8],h=e[i+9],j=e[i+10],v=e[i+11],k=e[i+12],q=e[i+13],z=e[i+14],A=e[i+15],B=p[0],C=p[1],D=p[2],E=p[3];B=f(B,C,D,E,s,7,y[0]),E=f(E,B,C,D,c,12,y[1]),D=f(D,E,B,C,r,17,y[2]),C=f(C,D,E,B,a,22,y[3]),B=f(B,C,D,E,w,7,y[4]),E=f(E,B,C,D,b,12,y[5]),D=f(D,E,B,C,g,17,y[6]),C=f(C,D,E,B,m,22,y[7]),B=f(B,C,D,E,x,7,y[8]),E=f(E,B,C,D,h,12,y[9]),D=f(D,E,B,C,j,17,y[10]),C=f(C,D,E,B,v,22,y[11]),B=f(B,C,D,E,k,7,y[12]),E=f(E,B,C,D,q,12,y[13]),D=f(D,E,B,C,z,17,y[14]),C=f(C,D,E,B,A,22,y[15]),B=n(B,C,D,E,c,5,y[16]),E=n(E,B,C,D,g,9,y[17]),D=n(D,E,B,C,v,14,y[18]),C=n(C,D,E,B,s,20,y[19]),B=n(B,C,D,E,b,5,y[20]),E=n(E,B,C,D,j,9,y[21]),D=n(D,E,B,C,A,14,y[22]),C=n(C,D,E,B,w,20,y[23]),B=n(B,C,D,E,h,5,y[24]),E=n(E,B,C,D,z,9,y[25]),D=n(D,E,B,C,a,14,y[26]),C=n(C,D,E,B,x,20,y[27]),B=n(B,C,D,E,q,5,y[28]),E=n(E,B,C,D,r,9,y[29]),D=n(D,E,B,C,m,14,y[30]),C=n(C,D,E,B,k,20,y[31]),B=o(B,C,D,E,b,4,y[32]),E=o(E,B,C,D,x,11,y[33]),D=o(D,E,B,C,v,16,y[34]),C=o(C,D,E,B,z,23,y[35]),B=o(B,C,D,E,c,4,y[36]),E=o(E,B,C,D,w,11,y[37]),D=o(D,E,B,C,m,16,y[38]),C=o(C,D,E,B,j,23,y[39]),B=o(B,C,D,E,q,4,y[40]),E=o(E,B,C,D,s,11,y[41]),D=o(D,E,B,C,a,16,y[42]),C=o(C,D,E,B,g,23,y[43]),B=o(B,C,D,E,h,4,y[44]),E=o(E,B,C,D,k,11,y[45]),D=o(D,E,B,C,A,16,y[46]),C=o(C,D,E,B,r,23,y[47]),B=d(B,C,D,E,s,6,y[48]),E=d(E,B,C,D,m,10,y[49]),D=d(D,E,B,C,z,15,y[50]),C=d(C,D,E,B,b,21,y[51]),B=d(B,C,D,E,k,6,y[52]),E=d(E,B,C,D,a,10,y[53]),D=d(D,E,B,C,j,15,y[54]),C=d(C,D,E,B,c,21,y[55]),B=d(B,C,D,E,x,6,y[56]),E=d(E,B,C,D,A,10,y[57]),D=d(D,E,B,C,g,15,y[58]),C=d(C,D,E,B,q,21,y[59]),B=d(B,C,D,E,w,6,y[60]),E=d(E,B,C,D,v,10,y[61]),D=d(D,E,B,C,r,15,y[62]),C=d(C,D,E,B,h,21,y[63]),p[0]=p[0]+B|0,p[1]=p[1]+C|0,p[2]=p[2]+D|0,p[3]=p[3]+E|0},_doFinalize:function(){var f=this._data,n=f.words,o=8*this._nDataBytes,d=8*f.sigBytes;n[d>>>5]|=128<<24-d%32;var i=e.floor(o/4294967296),t=o;n[(d+64>>>9<<4)+15]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[(d+64>>>9<<4)+14]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8),f.sigBytes=4*(n.length+1),this._process();for(var l=this._hash,u=l.words,p=0;4>p;p++){var s=u[p];u[p]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return l},clone:function(){var e=p.clone.call(this);return e._hash=this._hash.clone(),e}});t.MD5=p._createHelper(c),t.HmacMD5=p._createHmacHelper(c)}(Math),function(){var e=i,f=e.lib,n=f.WordArray,o=f.Hasher,d=e.algo,t=[],l=d.SHA1=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,f){for(var n=this._hash.words,o=n[0],d=n[1],i=n[2],l=n[3],u=n[4],p=0;80>p;p++){if(16>p)t[p]=0|e[f+p];else{var s=t[p-3]^t[p-8]^t[p-14]^t[p-16];t[p]=s<<1|s>>>31}var y=(o<<5|o>>>27)+u+t[p];y+=20>p?(d&i|~d&l)+1518500249:40>p?(d^i^l)+1859775393:60>p?(d&i|d&l|i&l)-1894007588:(d^i^l)-899497514,u=l,l=i,i=d<<30|d>>>2,d=o,o=y}n[0]=n[0]+o|0,n[1]=n[1]+d|0,n[2]=n[2]+i|0,n[3]=n[3]+l|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,f=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return f[o>>>5]|=128<<24-o%32,f[(o+64>>>9<<4)+14]=Math.floor(n/4294967296),f[(o+64>>>9<<4)+15]=n,e.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=o._createHelper(l),e.HmacSHA1=o._createHmacHelper(l)}(),function(e){var f=i,n=f.lib,o=n.Base,d=n.WordArray,t=f.x64={};t.Word=o.extend({init:function(e,f){this.high=e,this.low=f}}),t.WordArray=o.extend({init:function(f,n){f=this.words=f||[],n!=e?this.sigBytes=n:this.sigBytes=8*f.length},toX32:function(){for(var e=this.words,f=e.length,n=[],o=0;f>o;o++){var i=e[o];n.push(i.high),n.push(i.low)}return d.create(n,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),f=e.words=this.words.slice(0),n=f.length,d=0;n>d;d++)f[d]=f[d].clone();return e}})}(),function(e){var f=i,n=f.lib,o=n.WordArray,d=n.Hasher,t=f.algo,l=[],u=[];!function(){function f(f){for(var n=e.sqrt(f),o=2;n>=o;o++)if(!(f%o))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var o=2,d=0;64>d;)f(o)&&(8>d&&(l[d]=n(e.pow(o,.5))),u[d]=n(e.pow(o,1/3)),d++),o++}();var p=[],s=t.SHA256=d.extend({_doReset:function(){this._hash=new o.init(l.slice(0))},_doProcessBlock:function(e,f){for(var n=this._hash.words,o=n[0],d=n[1],i=n[2],t=n[3],l=n[4],s=n[5],y=n[6],c=n[7],r=0;64>r;r++){if(16>r)p[r]=0|e[f+r];else{var a=p[r-15],w=(a<<25|a>>>7)^(a<<14|a>>>18)^a>>>3,b=p[r-2],g=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;p[r]=w+p[r-7]+g+p[r-16]}var m=l&s^~l&y,x=o&d^o&i^d&i,h=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),j=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),v=c+j+m+u[r]+p[r],k=h+x;c=y,y=s,s=l,l=t+v|0,t=i,i=d,d=o,o=v+k|0}n[0]=n[0]+o|0,n[1]=n[1]+d|0,n[2]=n[2]+i|0,n[3]=n[3]+t|0,n[4]=n[4]+l|0,n[5]=n[5]+s|0,n[6]=n[6]+y|0,n[7]=n[7]+c|0},_doFinalize:function(){var f=this._data,n=f.words,o=8*this._nDataBytes,d=8*f.sigBytes;return n[d>>>5]|=128<<24-d%32,n[(d+64>>>9<<4)+14]=e.floor(o/4294967296),n[(d+64>>>9<<4)+15]=o,f.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=d.clone.call(this);return e._hash=this._hash.clone(),e}});f.SHA256=d._createHelper(s),f.HmacSHA256=d._createHmacHelper(s)}(Math),function(){function e(){return t.create.apply(t,arguments)}var f=i,n=f.lib,o=n.Hasher,d=f.x64,t=d.Word,l=d.WordArray,u=f.algo,p=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],s=[];!function(){for(var f=0;80>f;f++)s[f]=e()}();var y=u.SHA512=o.extend({_doReset:function(){this._hash=new l.init([new t.init(1779033703,4089235720),new t.init(3144134277,2227873595),new t.init(1013904242,4271175723),new t.init(2773480762,1595750129),new t.init(1359893119,2917565137),new t.init(2600822924,725511199),new t.init(528734635,4215389547),new t.init(1541459225,327033209)])},_doProcessBlock:function(e,f){for(var n=this._hash.words,o=n[0],d=n[1],i=n[2],t=n[3],l=n[4],u=n[5],y=n[6],c=n[7],r=o.high,a=o.low,w=d.high,b=d.low,g=i.high,m=i.low,x=t.high,h=t.low,j=l.high,v=l.low,k=u.high,q=u.low,z=y.high,A=y.low,B=c.high,C=c.low,D=r,E=a,F=w,G=b,H=g,I=m,J=x,K=h,L=j,M=v,N=k,O=q,P=z,Q=A,R=B,S=C,T=0;80>T;T++){var U=s[T];if(16>T)var V=U.high=0|e[f+2*T],W=U.low=0|e[f+2*T+1];else{var X=s[T-15],Y=X.high,Z=X.low,$=(Y>>>1|Z<<31)^(Y>>>8|Z<<24)^Y>>>7,_=(Z>>>1|Y<<31)^(Z>>>8|Y<<24)^(Z>>>7|Y<<25),ee=s[T-2],fe=ee.high,ne=ee.low,oe=(fe>>>19|ne<<13)^(fe<<3|ne>>>29)^fe>>>6,de=(ne>>>19|fe<<13)^(ne<<3|fe>>>29)^(ne>>>6|fe<<26),ie=s[T-7],te=ie.high,le=ie.low,ue=s[T-16],pe=ue.high,se=ue.low,W=_+le,V=$+te+(_>>>0>W>>>0?1:0),W=W+de,V=V+oe+(de>>>0>W>>>0?1:0),W=W+se,V=V+pe+(se>>>0>W>>>0?1:0);U.high=V,U.low=W}var ye=L&N^~L&P,ce=M&O^~M&Q,re=D&F^D&H^F&H,ae=E&G^E&I^G&I,we=(D>>>28|E<<4)^(D<<30|E>>>2)^(D<<25|E>>>7),be=(E>>>28|D<<4)^(E<<30|D>>>2)^(E<<25|D>>>7),ge=(L>>>14|M<<18)^(L>>>18|M<<14)^(L<<23|M>>>9),me=(M>>>14|L<<18)^(M>>>18|L<<14)^(M<<23|L>>>9),xe=p[T],he=xe.high,je=xe.low,ve=S+me,ke=R+ge+(S>>>0>ve>>>0?1:0),ve=ve+ce,ke=ke+ye+(ce>>>0>ve>>>0?1:0),ve=ve+je,ke=ke+he+(je>>>0>ve>>>0?1:0),ve=ve+W,ke=ke+V+(W>>>0>ve>>>0?1:0),qe=be+ae,ze=we+re+(be>>>0>qe>>>0?1:0);R=P,S=Q,P=N,Q=O,N=L,O=M,M=K+ve|0,L=J+ke+(K>>>0>M>>>0?1:0)|0,J=H,K=I,H=F,I=G,F=D,G=E,E=ve+qe|0,D=ke+ze+(ve>>>0>E>>>0?1:0)|0}a=o.low=a+E,o.high=r+D+(E>>>0>a>>>0?1:0),b=d.low=b+G,d.high=w+F+(G>>>0>b>>>0?1:0),m=i.low=m+I,i.high=g+H+(I>>>0>m>>>0?1:0),h=t.low=h+K,t.high=x+J+(K>>>0>h>>>0?1:0),v=l.low=v+M,l.high=j+L+(M>>>0>v>>>0?1:0),q=u.low=q+O,u.high=k+N+(O>>>0>q>>>0?1:0),A=y.low=A+Q,y.high=z+P+(Q>>>0>A>>>0?1:0),C=c.low=C+S,c.high=B+R+(S>>>0>C>>>0?1:0)},_doFinalize:function(){var e=this._data,f=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;f[o>>>5]|=128<<24-o%32,f[(o+128>>>10<<5)+30]=Math.floor(n/4294967296),f[(o+128>>>10<<5)+31]=n,e.sigBytes=4*f.length,this._process();var d=this._hash.toX32();return d},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});f.SHA512=o._createHelper(y),f.HmacSHA512=o._createHmacHelper(y)}(),function(e){var f=i,n=f.lib,o=n.WordArray,d=n.Hasher,t=f.x64,l=t.Word,u=f.algo,p=[],s=[],y=[];!function(){for(var e=1,f=0,n=0;24>n;n++){p[e+5*f]=(n+1)*(n+2)/2%64;var o=f%5,d=(2*e+3*f)%5;e=o,f=d}for(var e=0;5>e;e++)for(var f=0;5>f;f++)s[e+5*f]=f+(2*e+3*f)%5*5;for(var i=1,t=0;24>t;t++){for(var u=0,c=0,r=0;7>r;r++){if(1&i){var a=(1<<r)-1;32>a?c^=1<<a:u^=1<<a-32}128&i?i=i<<1^113:i<<=1}y[t]=l.create(u,c)}}();var c=[];!function(){for(var e=0;25>e;e++)c[e]=l.create()}();var r=u.SHA3=d.extend({cfg:d.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],f=0;25>f;f++)e[f]=new l.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,f){for(var n=this._state,o=this.blockSize/2,d=0;o>d;d++){var i=e[f+2*d],t=e[f+2*d+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8);var l=n[d];l.high^=t,l.low^=i}for(var u=0;24>u;u++){for(var r=0;5>r;r++){for(var a=0,w=0,b=0;5>b;b++){var l=n[r+5*b];a^=l.high,w^=l.low}var g=c[r];g.high=a,g.low=w}for(var r=0;5>r;r++)for(var m=c[(r+4)%5],x=c[(r+1)%5],h=x.high,j=x.low,a=m.high^(h<<1|j>>>31),w=m.low^(j<<1|h>>>31),b=0;5>b;b++){var l=n[r+5*b];l.high^=a,l.low^=w}for(var v=1;25>v;v++){var l=n[v],k=l.high,q=l.low,z=p[v];if(32>z)var a=k<<z|q>>>32-z,w=q<<z|k>>>32-z;else var a=q<<z-32|k>>>64-z,w=k<<z-32|q>>>64-z;var A=c[s[v]];A.high=a,A.low=w}var B=c[0],C=n[0];B.high=C.high,B.low=C.low;for(var r=0;5>r;r++)for(var b=0;5>b;b++){var v=r+5*b,l=n[v],D=c[v],E=c[(r+1)%5+5*b],F=c[(r+2)%5+5*b];l.high=D.high^~E.high&F.high,l.low=D.low^~E.low&F.low}var l=n[0],G=y[u];l.high^=G.high,l.low^=G.low}},_doFinalize:function(){var f=this._data,n=f.words,d=(8*this._nDataBytes,8*f.sigBytes),i=32*this.blockSize;n[d>>>5]|=1<<24-d%32,n[(e.ceil((d+1)/i)*i>>>5)-1]|=128,f.sigBytes=4*n.length,this._process();for(var t=this._state,l=this.cfg.outputLength/8,u=l/8,p=[],s=0;u>s;s++){var y=t[s],c=y.high,r=y.low;c=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),r=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),p.push(r),p.push(c)}return new o.init(p,l)},clone:function(){for(var e=d.clone.call(this),f=e._state=this._state.slice(0),n=0;25>n;n++)f[n]=f[n].clone();return e}});f.SHA3=d._createHelper(r),f.HmacSHA3=d._createHmacHelper(r)}(Math),d("undefined"!=typeof i?i:window.CryptoJS)}.call(n,void 0,void 0,void 0,void 0,function(e){f.exports=e})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,f,n){(function(n){__browserify_shim_require__=e,function(e,f,n,o,d){var i=function(e,f){if(!(this instanceof i))return new i(e,f);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(!(arguments.length<=2&&arguments.length>0))throw"Incorrect # of ctor args!";if(f="function"==typeof arguments[0]?arguments[0]:arguments[1],e="function"==typeof arguments[0]?{}:arguments[0],"function"!=typeof f)throw"No callback was provided";this.record=e.record||"record",this.name=e.name||"records";var n;if(e.adapter){"string"==typeof e.adapter&&(e.adapter=[e.adapter]);for(var o=0,d=e.adapter.length;d>o;o++){for(var t=i.adapters.length-1;t>=0&&(i.adapters[t].adapter!==e.adapter[o]||!(n=i.adapters[t].valid()?i.adapters[t]:void 0));t--);if(n)break}}else for(var t=0,l=i.adapters.length;l>t&&!(n=i.adapters[t].valid()?i.adapters[t]:void 0);t++);if(!n)throw"No valid adapter.";for(var o in n)this[o]=n[o];for(var t=0,l=i.plugins.length;l>t;t++)i.plugins[t].call(this);this.init(e,f)};i.adapters=[],i.adapter=function(e,f){f.adapter=e;var n="adapter valid init keys save batch get exists all remove nuke".split(" "),o=this.prototype.indexOf;for(var d in f)if(-1===o(n,d))throw"Invalid adapter! Nonstandard method: "+d;i.adapters.splice(0,0,f)},i.plugins=[],i.plugin=function(e){for(var f in e)"init"===f?i.plugins.push(e[f]):this.prototype[f]=e[f]},i.prototype={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},indexOf:function(e,f,n,o){if(e.indexOf)return e.indexOf(f);for(n=0,o=e.length;o>n;n++)if(e[n]===f)return n;return-1},lambda:function(e){return this.fn(this.record,e)},fn:function(e,f){return"string"==typeof f?new Function(e,f):f},uuid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},each:function(e){var f=this.lambda(e);if(this.__results)for(var n=0,o=this.__results.length;o>n;n++)f.call(this,this.__results[n],n);else this.all(function(e){for(var n=0,o=e.length;o>n;n++)f.call(this,e[n],n)});return this}},i.adapter("window-name",function(){"undefined"==typeof window&&(window={top:{}});var e={};try{e=JSON.parse(window.top.name)}catch(f){}return{valid:function(){return"undefined"!=typeof window.top.name},init:function(f,n){return e[this.name]=e[this.name]||{index:[],store:{}},this.index=e[this.name].index,this.store=e[this.name].store,this.fn(this.name,n).call(this,this),this},keys:function(e){return this.fn("keys",e).call(this,this.index),this},save:function(f,n){var o=f.key||this.uuid();return this.exists(o,function(d){d||(f.key&&delete f.key,this.index.push(o)),this.store[o]=f;try{window.top.name=JSON.stringify(e)}catch(i){throw d||(this.index.pop(),delete this.store[o]),i}n&&(f.key=o,this.lambda(n).call(this,f))}),this},batch:function(e,f){for(var n=[],o=0,d=e.length;d>o;o++)this.save(e[o],function(e){n.push(e)});return f&&this.lambda(f).call(this,n),this},get:function(e,f){var n;if(this.isArray(e)){n=[];for(var o=0,d=e.length;d>o;o++)n.push(this.store[e[o]])}else n=this.store[e],n&&(n.key=e);return f&&this.lambda(f).call(this,n),this},exists:function(e,f){return this.lambda(f).call(this,!!this.store[e]),this},all:function(e){for(var f=[],n=0,o=this.index.length;o>n;n++){var d=this.store[this.index[n]];d.key=this.index[n],f.push(d)}return this.fn(this.name,e).call(this,f),this},remove:function(f,n){for(var o=this.isArray(f)?f:[f],d=0,i=o.length;i>d;d++){var t=o[d].key?o[d].key:o[d],l=this.indexOf(this.index,t);0>l||(delete this.store[t],this.index.splice(l,1))}return window.top.name=JSON.stringify(e),n&&this.lambda(n).call(this),this},nuke:function(f){return this.store=e[this.name].store={},this.index=e[this.name].index=[],window.top.name=JSON.stringify(e),f&&this.lambda(f).call(this),this}}}()),i.adapter("dom",function(){var e=null;try{e=window.localStorage}catch(f){}var n=function(f){return{key:f+"._index_",all:function(){var f=e.getItem(this.key);return f&&(f=JSON.parse(f)),null===f&&e.setItem(this.key,JSON.stringify([])),JSON.parse(e.getItem(this.key))},add:function(f){var n=this.all();n.push(f),e.setItem(this.key,JSON.stringify(n))},del:function(f){for(var n=this.all(),o=[],d=0,i=n.length;i>d;d++)n[d]!=f&&o.push(n[d]);e.setItem(this.key,JSON.stringify(o))},find:function(e){for(var f=this.all(),n=0,o=f.length;o>n;n++)if(e===f[n])return n;return!1}}};return{valid:function(){return!!e&&function(){var f=!0,n=Math.random();try{e.setItem(n,n)}catch(o){f=!1}return e.removeItem(n),f}()},init:function(e,f){this.indexer=n(this.name),f&&this.fn(this.name,f).call(this,this)},save:function(f,n){var o=f.key?this.name+"."+f.key:this.name+"."+this.uuid();return delete f.key,e.setItem(o,JSON.stringify(f)),this.indexer.find(o)===!1&&this.indexer.add(o),f.key=o.slice(this.name.length+1),n&&this.lambda(n).call(this,f),this},batch:function(e,f){for(var n=[],o=0,d=e.length;d>o;o++)this.save(e[o],function(e){n.push(e)});return f&&this.lambda(f).call(this,n),this},keys:function(e){if(e){var f=this.name,n=this.indexer.all(),o=[];if(Array.prototype.map)o=n.map(function(e){return e.replace(f+".","")});else for(var d in n)o.push(d.replace(f+".",""));this.fn("keys",e).call(this,o)}return this},get:function(f,n){if(this.isArray(f)){for(var o=[],d=0,i=f.length;i>d;d++){var t=this.name+"."+f[d],l=e.getItem(t);l&&(l=JSON.parse(l),l.key=f[d]),o.push(l)}n&&this.lambda(n).call(this,o)}else{var t=this.name+"."+f,l=e.getItem(t);l&&(l=JSON.parse(l),l.key=f),n&&this.lambda(n).call(this,l)}return this},exists:function(e,f){var n=this.indexer.find(this.name+"."+e)===!1?!1:!0;return this.lambda(f).call(this,n),this},all:function(f){for(var n,o,d=this.indexer.all(),i=[],t=0,l=d.length;l>t;t++)o=d[t],n=JSON.parse(e.getItem(o)),n.key=o.replace(this.name+".",""),i.push(n);return f&&this.fn(this.name,f).call(this,i),this},remove:function(f,n){var o=this;if(this.isArray(f)){var d,i=f.length,t=function(e){o.remove(f[e],function(){--i>0||n&&o.lambda(n).call(o)})};for(d=0;d<f.length;d++)t(d);return this}var l=this.name+"."+(f.key?f.key:f);return this.indexer.del(l),e.removeItem(l),n&&this.lambda(n).call(this),this},nuke:function(e){return this.all(function(f){for(var n=0,o=f.length;o>n;n++)this.remove(f[n]);e&&this.lambda(e).call(this)}),this}}}()),i.adapter("webkit-sqlite",function(){var e=function(e,f){console&&console.log("error in sqlite adaptor!",e,f)},f=function(){return new Date};return{valid:function(){return!!window.openDatabase},init:function(f,n){var o=this,d=o.fn(o.name,n),i="CREATE TABLE IF NOT EXISTS "+this.record+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",t=function(){return d.call(o,o)};f&&"function"==typeof f.fail&&(e=f.fail),this.db=openDatabase(this.name,"1.0.0",this.name,65536),this.db.transaction(function(f){f.executeSql(i,[],t,e)})},keys:function(f){var n=this.lambda(f),o=this,d="SELECT id FROM "+this.record+" ORDER BY timestamp DESC";return this.db.readTransaction(function(f){var i=function(e,f){if(0==f.rows.length)n.call(o,[]);else{for(var d=[],i=0,t=f.rows.length;t>i;i++)d.push(f.rows.item(i).id);n.call(o,d)}};f.executeSql(d,[],i,e)}),this},save:function(n,o,d){var i=this;objs=(this.isArray(n)?n:[n]).map(function(e){return e.key||(e.key=i.uuid()),e}),ins="INSERT OR REPLACE INTO "+this.record+" (value, timestamp, id) VALUES (?,?,?)",win=function(){o&&i.lambda(o).call(i,i.isArray(n)?objs:objs[0])},d=d||function(){},insvals=[],ts=f();try{for(var t=0,l=objs.length;l>t;t++)insvals[t]=[JSON.stringify(objs[t]),ts,objs[t].key]}catch(u){throw e(u),u}return i.db.transaction(function(e){for(var f=0,n=objs.length;n>f;f++)e.executeSql(ins,insvals[f])},function(f,n){e(f,n)},win),this},batch:function(e,f){return this.save(e,f)},get:function(f,n){var o=this,d="",i=this.isArray(f)?f:[f];d="SELECT id, value FROM "+this.record+" WHERE id IN ("+i.map(function(){return"?"}).join(",")+")";var t=function(e,d){for(var t,l,u={},p=0,s=d.rows.length;s>p;p++)t=JSON.parse(d.rows.item(p).value),t.key=d.rows.item(p).id,u[t.key]=t;l=i.map(function(e){return u[e]}),o.isArray(f)||(l=l.length?l[0]:null),n&&o.lambda(n).call(o,l)};return this.db.readTransaction(function(f){f.executeSql(d,i,t,e)}),this},exists:function(f,n){var o="SELECT * FROM "+this.record+" WHERE id = ?",d=this,i=function(e,f){n&&d.fn("exists",n).call(d,f.rows.length>0)};return this.db.readTransaction(function(n){n.executeSql(o,[f],i,e);
}),this},all:function(f){var n=this,o="SELECT * FROM "+this.record,d=[],i=this.fn(this.name,f)||void 0,t=function(e,f){if(0!=f.rows.length)for(var o=0,t=f.rows.length;t>o;o++){var l=JSON.parse(f.rows.item(o).value);l.key=f.rows.item(o).id,d.push(l)}i&&i.call(n,d)};return this.db.readTransaction(function(f){f.executeSql(o,[],t,e)}),this},remove:function(f,n){var o,d=this,i="DELETE FROM "+this.record+" WHERE id ",t=function(){n&&d.lambda(n).call(d)};return this.isArray(f)?(o=f,i+="IN ("+o.map(function(){return"?"}).join(",")+")"):(i+="= ?",o=[f]),o=o.map(function(e){return e.key?e.key:e}),this.db.transaction(function(f){f.executeSql(i,o,t,e)}),this},nuke:function(f){var n="DELETE FROM "+this.record,o=this,d=f?function(){o.lambda(f).call(o)}:function(){};return this.db.transaction(function(f){f.executeSql(n,[],d,e)}),this}}}()),i.adapter("indexed-db",function(){function e(e,f){console&&console.log("error in indexed-db adapter!"+e.message,e,f)}function f(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB}return{valid:function(){return!!f()},init:function(n,o){this.idb=f(),this.waiting=[];var d=this.idb.open(this.name,2),i=this,t=i.fn(i.name,o),l=function(){return t.call(i,i)};n&&"function"==typeof n.fail&&(e=n.fail),d.onupgradeneeded=function(e){i.store=d.result.createObjectStore("teststore",{autoIncrement:!0});for(var f=0;f<i.waiting.length;f++)i.waiting[f].call(i);i.waiting=[],l()},d.onsuccess=function(f){if(i.db=d.result,"2.0"!=i.db.version){if("function"==typeof i.db.setVersion){var n=i.db.setVersion("2.0");n.onsuccess=function(e){i.store=i.db.createObjectStore("teststore",{autoIncrement:!0});for(var f=0;f<i.waiting.length;f++)i.waiting[f].call(i);i.waiting=[],l()},n.onerror=function(f){e(f)}}}else{i.store={};for(var o=0;o<i.waiting.length;o++)i.waiting[o].call(i);i.waiting=[],l()}},d.onerror=e},save:function(f,n){if(!this.store)return void this.waiting.push(function(){this.save(f,n)});var o=this,d=function(e){n&&(f.key=e.target.result,o.lambda(n).call(o,f))},i="readwrite",t=this.db.transaction(["teststore"],i),l=t.objectStore("teststore"),u=f.key?l.put(f,f.key):l.put(f);return u.onsuccess=d,u.onerror=e,this},batch:function(e,f){for(var n=[],o=!1,d=this,i=function(f){n.push(f),o=n.length===e.length},t=setInterval(function(){o&&(f&&d.lambda(f).call(d,n),clearInterval(t))},200),l=0,u=e.length;u>l;l++)this.save(e[l],i);return this},get:function(f,n){if(!this.store||!this.db)return void this.waiting.push(function(){this.get(f,n)});var o=this,d=function(e){n&&o.lambda(n).call(o,e.target.result)};if(this.isArray(f))for(var i=[],t=!1,l=f,u=function(e){i.push(e),t=i.length===l.length},p=setInterval(function(){t&&(n&&o.lambda(n).call(o,i),clearInterval(p))},200),s=0,y=l.length;y>s;s++)this.get(l[s],u);else{var c=this.db.transaction("teststore").objectStore("teststore").get(f);c.onsuccess=d,c.onerror=function(f){e(f)}}return this},all:function(e){if(!this.store)return void this.waiting.push(function(){this.all(e)});var f=this.fn(this.name,e)||void 0,n=this,o=this.db.transaction("teststore").objectStore("teststore"),d=[];return o.openCursor().onsuccess=function(e){var o=e.target.result;o?(d.push(o.value),o["continue"]()):f&&f.call(n,d)},this},remove:function(f,n){if(!this.store)return void this.waiting.push(function(){this.remove(f,n)});"object"==typeof f&&(f=f.key);var o=this,d=function(){n&&o.lambda(n).call(o)},i=this.db.transaction(["teststore"],"readwrite").objectStore("teststore")["delete"](f);return i.onsuccess=d,i.onerror=e,this},nuke:function(f){if(!this.store)return void this.waiting.push(function(){this.nuke(f)});var n=this,o=f?function(){n.lambda(f).call(n)}:function(){};try{this.db.transaction(["teststore"],"readwrite").objectStore("teststore").clear().onsuccess=o}catch(d){e()}return this}}}()),i.adapter("html5-filesystem",function(e){var f=function(e){console&&console.error(e,e.name)},n=function(e,o,d){var i=d||[];e.readEntries(function(f){f.length?n(e,o,i.concat(Array.prototype.slice.call(f))):o&&o(i.map(function(e){return e.name}))},f)},o={},d=function(e,f){var n=o[e.name];n?f(n):setTimeout(function(){d(e,f)},10)},i=function(){var e=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://");return e?!0:!1},t=function(e){var f;if(i())f=e;else{var n="application/json";try{f=new Blob([e],{type:n})}catch(o){var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"==o.name&&d){var t=new d;t.append([e.buffer]),f=t.getBlob(n)}else f=e}}return f};return{valid:function(){var f=e.requestFileSystem||e.webkitRequestFileSystem||e.moz_requestFileSystem;return!!f},init:function(n,d){function i(f){var n=e.requestFileSystem||e.webkitRequestFileSystem||e.moz_requestFileSystem,i=window.PERSISTENT;"undefined"!=typeof LocalFileSystem&&"undefined"!=typeof LocalFileSystem.PERSISTENT&&(i=LocalFileSystem.PERSISTENT),n(i,f,function(e){e.root.getDirectory(p,{create:!0},function(e){o[p]=e,d&&t.fn(t.name,d).call(t,t)},function(e){l(e)})},function(e){l(e)})}var t=this,l=function(e){f(e),d&&t.fn(t.name,d).call(t,t)},u=n.size||104857600,p=this.name;t.backup=!1,"undefined"!=typeof n.backup&&(t.backup=n.backup),"undefined"!=typeof navigator.webkitPersistentStorage?navigator.webkitPersistentStorage.requestQuota(u,i,function(){logger.warn("User declined file storage"),l("User declined file storage")}):i(0)},keys:function(e){var f=this;return d(this,function(o){n(o.createReader(),function(n){e&&f.fn("keys",e).call(f,n)})}),this},save:function(e,n){var o=this,i=e.key||this.uuid();e.key=i;var l=function(e){f(e),n&&o.lambda(n).call(o)};return d(this,function(f){var d=function(f,d){f.createWriter(function(f){f.onerror=d,f.onwriteend=function(){this.onwriteend=null,this.truncate(this.position),n&&o.lambda(n).call(o,e)};var i=JSON.stringify(e),l=t(i);f.write(l)},d)};f.getFile(i,{create:!0},function(e){"function"!=typeof e.setMetadata||o.backup!==!1&&"false"!==o.backup?d(e,l):e.setMetadata(function(){d(e,l)},function(){d(e,l)},{"com.apple.MobileBackup":1})},l)}),this},batch:function(e,f){for(var n=this,o=[],d=0,i=e.length;i>d;d++)n.save(e[d],function(e){o.push(e),o.length===i&&f&&n.lambda(f).call(n,o)});return this},get:function(e,n){var o=this;if(this.isArray(e))for(var i=[],t=0,l=e.length;l>t;t++)o.get(e[t],function(e){e&&i.push(e),i.length===l&&n&&o.lambda(n).call(o,i)});else{var u=function(e){f(e),n&&o.lambda(n).call(o)};d(this,function(f){f.getFile(e,{create:!1},function(f){f.file(function(f){var d=new FileReader;d.onerror=u,d.onload=function(f){var d={};try{d=JSON.parse(f.target.result),d.key=e}catch(f){d={key:e}}n&&o.lambda(n).call(o,d)},d.readAsText(f)},u)},u)})}return this},exists:function(e,f){var n=this;return d(this,function(o){o.getFile(e,{create:!1},function(){f&&n.lambda(f).call(n,!0)},function(){f&&n.lambda(f).call(n,!1)})}),this},all:function(e){var f=this;return e&&this.keys(function(n){n.length?f.get(n,function(n){f.fn(f.name,e).call(f,n)}):f.fn(f.name,e).call(f,[])}),this},remove:function(e,n){var o=this,i=function(e){f(e),n&&o.lambda(n).call(o)};return d(this,function(f){f.getFile("string"==typeof e?e:e.key,{create:!1},function(e){e.remove(function(){n&&o.lambda(n).call(o)},i)},i)}),this},nuke:function(e){var f=this,n=0;return this.keys(function(o){if(o.length)for(var d=0,i=o.length;i>d;d++)f.remove(o[d],function(){n++,n===i&&e&&f.lambda(e).call(f)});else e&&f.lambda(e).call(f)}),this}}}(this)),i.adapter("memory",function(){var e={};return{valid:function(){return!0},init:function(f,n){e[this.name]=e[this.name]||{index:[],store:{}},this.index=e[this.name].index,this.store=e[this.name].store;var o=this.fn(this.name,n);return o&&o.call(this,this),this},keys:function(e){return this.fn("keys",e).call(this,this.index),this},save:function(e,f){var n=e.key||this.uuid();return this.exists(n,function(o){o||(e.key&&delete e.key,this.index.push(n)),this.store[n]=e,f&&(e.key=n,this.lambda(f).call(this,e))}),this},batch:function(e,f){for(var n=[],o=0,d=e.length;d>o;o++)this.save(e[o],function(e){n.push(e)});return f&&this.lambda(f).call(this,n),this},get:function(e,f){var n;if(this.isArray(e)){n=[];for(var o=0,d=e.length;d>o;o++)n.push(this.store[e[o]])}else n=this.store[e],n&&(n.key=e);return f&&this.lambda(f).call(this,n),this},exists:function(e,f){return this.lambda(f).call(this,!!this.store[e]),this},all:function(e){for(var f=[],n=0,o=this.index.length;o>n;n++){var d=this.store[this.index[n]];d.key=this.index[n],f.push(d)}return this.fn(this.name,e).call(this,f),this},remove:function(e,f){for(var n=this.isArray(e)?e:[e],o=0,d=n.length;d>o;o++){var i=n[o].key?n[o].key:n[o],t=this.indexOf(this.index,i);0>t||(delete this.store[i],this.index.splice(t,1))}return f&&this.lambda(f).call(this),this},nuke:function(f){return this.store=e[this.name].store={},this.index=e[this.name].index=[],f&&this.lambda(f).call(this),this}}}()),d("undefined"!=typeof i?i:window.Lawnchair)}.call(n,void 0,void 0,void 0,void 0,function(e){f.exports=e})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,f,n){function o(e,f,n){null!=e&&("number"==typeof e?this.fromNumber(e,f,n):null==f&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,f))}function d(){return new o(null)}function i(e,f,n,o,d,i){for(;--i>=0;){var t=f*this[e++]+n[o]+d;d=Math.floor(t/67108864),n[o++]=67108863&t}return d}function t(e,f,n,o,d,i){for(var t=32767&f,l=f>>15;--i>=0;){var u=32767&this[e],p=this[e++]>>15,s=l*u+p*t;u=t*u+((32767&s)<<15)+n[o]+(1073741823&d),d=(u>>>30)+(s>>>15)+l*p+(d>>>30),n[o++]=1073741823&u}return d}function l(e,f,n,o,d,i){for(var t=16383&f,l=f>>14;--i>=0;){var u=16383&this[e],p=this[e++]>>14,s=l*u+p*t;u=t*u+((16383&s)<<14)+n[o]+d,d=(u>>28)+(s>>14)+l*p,n[o++]=268435455&u}return d}function u(e){return ae.charAt(e)}function p(e,f){var n=we[e.charCodeAt(f)];return null==n?-1:n}function s(e){for(var f=this.t-1;f>=0;--f)e[f]=this[f];e.t=this.t,e.s=this.s}function y(e){this.t=1,this.s=0>e?-1:0,e>0?this[0]=e:-1>e?this[0]=e+DV:this.t=0}function c(e){var f=d();return f.fromInt(e),f}function r(e,f){var n;if(16==f)n=4;else if(8==f)n=3;else if(256==f)n=8;else if(2==f)n=1;else if(32==f)n=5;else{if(4!=f)return void this.fromRadix(e,f);n=2}this.t=0,this.s=0;for(var d=e.length,i=!1,t=0;--d>=0;){var l=8==n?255&e[d]:p(e,d);0>l?"-"==e.charAt(d)&&(i=!0):(i=!1,0==t?this[this.t++]=l:t+n>this.DB?(this[this.t-1]|=(l&(1<<this.DB-t)-1)<<t,this[this.t++]=l>>this.DB-t):this[this.t-1]|=l<<t,t+=n,t>=this.DB&&(t-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,t>0&&(this[this.t-1]|=(1<<this.DB-t)-1<<t)),this.clamp(),i&&o.ZERO.subTo(this,this)}function a(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function w(e){if(this.s<0)return"-"+this.negate().toString(e);var f;if(16==e)f=4;else if(8==e)f=3;else if(2==e)f=1;else if(32==e)f=5;else{if(4!=e)return this.toRadix(e);f=2}var n,o=(1<<f)-1,d=!1,i="",t=this.t,l=this.DB-t*this.DB%f;if(t-->0)for(l<this.DB&&(n=this[t]>>l)>0&&(d=!0,i=u(n));t>=0;)f>l?(n=(this[t]&(1<<l)-1)<<f-l,n|=this[--t]>>(l+=this.DB-f)):(n=this[t]>>(l-=f)&o,0>=l&&(l+=this.DB,--t)),n>0&&(d=!0),d&&(i+=u(n));return d?i:"0"}function b(){var e=d();return o.ZERO.subTo(this,e),e}function g(){return this.s<0?this.negate():this}function m(e){var f=this.s-e.s;if(0!=f)return f;var n=this.t;if(f=n-e.t,0!=f)return this.s<0?-f:f;for(;--n>=0;)if(0!=(f=this[n]-e[n]))return f;return 0}function x(e){var f,n=1;return 0!=(f=e>>>16)&&(e=f,n+=16),0!=(f=e>>8)&&(e=f,n+=8),0!=(f=e>>4)&&(e=f,n+=4),0!=(f=e>>2)&&(e=f,n+=2),0!=(f=e>>1)&&(e=f,n+=1),n}function h(){return this.t<=0?0:this.DB*(this.t-1)+x(this[this.t-1]^this.s&this.DM)}function j(e,f){var n;for(n=this.t-1;n>=0;--n)f[n+e]=this[n];for(n=e-1;n>=0;--n)f[n]=0;f.t=this.t+e,f.s=this.s}function v(e,f){for(var n=e;n<this.t;++n)f[n-e]=this[n];f.t=Math.max(this.t-e,0),f.s=this.s}function k(e,f){var n,o=e%this.DB,d=this.DB-o,i=(1<<d)-1,t=Math.floor(e/this.DB),l=this.s<<o&this.DM;for(n=this.t-1;n>=0;--n)f[n+t+1]=this[n]>>d|l,l=(this[n]&i)<<o;for(n=t-1;n>=0;--n)f[n]=0;f[t]=l,f.t=this.t+t+1,f.s=this.s,f.clamp()}function q(e,f){f.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)return void(f.t=0);var o=e%this.DB,d=this.DB-o,i=(1<<o)-1;f[0]=this[n]>>o;for(var t=n+1;t<this.t;++t)f[t-n-1]|=(this[t]&i)<<d,f[t-n]=this[t]>>o;o>0&&(f[this.t-n-1]|=(this.s&i)<<d),f.t=this.t-n,f.clamp()}function z(e,f){for(var n=0,o=0,d=Math.min(e.t,this.t);d>n;)o+=this[n]-e[n],f[n++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o-=e.s;n<this.t;)o+=this[n],f[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<e.t;)o-=e[n],f[n++]=o&this.DM,o>>=this.DB;o-=e.s}f.s=0>o?-1:0,-1>o?f[n++]=this.DV+o:o>0&&(f[n++]=o),f.t=n,f.clamp()}function A(e,f){var n=this.abs(),d=e.abs(),i=n.t;for(f.t=i+d.t;--i>=0;)f[i]=0;for(i=0;i<d.t;++i)f[i+n.t]=n.am(0,d[i],f,i,0,n.t);f.s=0,f.clamp(),this.s!=e.s&&o.ZERO.subTo(f,f)}function B(e){for(var f=this.abs(),n=e.t=2*f.t;--n>=0;)e[n]=0;for(n=0;n<f.t-1;++n){var o=f.am(n,f[n],e,2*n,0,1);(e[n+f.t]+=f.am(n+1,2*f[n],e,2*n+1,o,f.t-n-1))>=f.DV&&(e[n+f.t]-=f.DV,e[n+f.t+1]=1)}e.t>0&&(e[e.t-1]+=f.am(n,f[n],e,2*n,0,1)),e.s=0,e.clamp()}function C(e,f,n){var i=e.abs();if(!(i.t<=0)){var t=this.abs();if(t.t<i.t)return null!=f&&f.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=d());var l=d(),u=this.s,p=e.s,s=this.DB-x(i[i.t-1]);s>0?(i.lShiftTo(s,l),t.lShiftTo(s,n)):(i.copyTo(l),t.copyTo(n));var y=l.t,c=l[y-1];if(0!=c){var r=c*(1<<this.F1)+(y>1?l[y-2]>>this.F2:0),a=this.FV/r,w=(1<<this.F1)/r,b=1<<this.F2,g=n.t,m=g-y,h=null==f?d():f;for(l.dlShiftTo(m,h),n.compareTo(h)>=0&&(n[n.t++]=1,n.subTo(h,n)),o.ONE.dlShiftTo(y,h),h.subTo(l,l);l.t<y;)l[l.t++]=0;for(;--m>=0;){var j=n[--g]==c?this.DM:Math.floor(n[g]*a+(n[g-1]+b)*w);if((n[g]+=l.am(0,j,n,m,0,y))<j)for(l.dlShiftTo(m,h),n.subTo(h,n);n[g]<--j;)n.subTo(h,n)}null!=f&&(n.drShiftTo(y,f),u!=p&&o.ZERO.subTo(f,f)),n.t=y,n.clamp(),s>0&&n.rShiftTo(s,n),0>u&&o.ZERO.subTo(n,n)}}}function D(e){var f=d();return this.abs().divRemTo(e,null,f),this.s<0&&f.compareTo(o.ZERO)>0&&e.subTo(f,f),f}function E(e){this.m=e}function F(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function G(e){return e}function H(e){e.divRemTo(this.m,null,e)}function I(e,f,n){e.multiplyTo(f,n),this.reduce(n)}function J(e,f){e.squareTo(f),this.reduce(f)}function K(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var f=3&e;return f=f*(2-(15&e)*f)&15,f=f*(2-(255&e)*f)&255,f=f*(2-((65535&e)*f&65535))&65535,f=f*(2-e*f%this.DV)%this.DV,f>0?this.DV-f:-f}function L(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function M(e){var f=d();return e.abs().dlShiftTo(this.m.t,f),f.divRemTo(this.m,null,f),e.s<0&&f.compareTo(o.ZERO)>0&&this.m.subTo(f,f),f}function N(e){var f=d();return e.copyTo(f),this.reduce(f),f}function O(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var f=0;f<this.m.t;++f){var n=32767&e[f],o=n*this.mpl+((n*this.mph+(e[f]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=f+this.m.t,e[n]+=this.m.am(0,o,e,f,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function P(e,f){e.squareTo(f),this.reduce(f)}function Q(e,f,n){e.multiplyTo(f,n),this.reduce(n)}function R(){return 0==(this.t>0?1&this[0]:this.s)}function S(e,f){if(e>4294967295||1>e)return o.ONE;var n=d(),i=d(),t=f.convert(this),l=x(e)-1;for(t.copyTo(n);--l>=0;)if(f.sqrTo(n,i),(e&1<<l)>0)f.mulTo(i,t,n);else{var u=n;n=i,i=u}return f.revert(n)}function T(e,f){var n;return n=256>e||f.isEven()?new E(f):new L(f),this.exp(e,n)}function U(){this.i=0,this.j=0,this.S=new Array}function V(e){var f,n,o;for(f=0;256>f;++f)this.S[f]=f;for(n=0,f=0;256>f;++f)n=n+this.S[f]+e[f%e.length]&255,o=this.S[f],this.S[f]=this.S[n],this.S[n]=o;this.i=0,this.j=0}function W(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]}function X(){return new U}function Y(e){ge[me++]^=255&e,ge[me++]^=e>>8&255,ge[me++]^=e>>16&255,ge[me++]^=e>>24&255,me>=xe&&(me-=xe)}function Z(){Y((new Date).getTime())}function $(){if(null==be){for(Z(),be=X(),be.init(ge),me=0;me<ge.length;++me)ge[me]=0;me=0}return be.next()}function _(e){var f;for(f=0;f<e.length;++f)e[f]=$()}function ee(){}function fe(e,f){return new o(e,f)}function ne(e){return 16>e?"0"+e.toString(16):e.toString(16)}function oe(e,f){if(f<e.length+11)return alert("Message too long for RSA"),null;for(var n=new Array,d=e.length-1;d>=0&&f>0;){var i=e.charCodeAt(d--);128>i?n[--f]=i:i>127&&2048>i?(n[--f]=63&i|128,n[--f]=i>>6|192):(n[--f]=63&i|128,n[--f]=i>>6&63|128,n[--f]=i>>12|224)}n[--f]=0;for(var t=new ee,l=new Array;f>2;){for(l[0]=0;0==l[0];)t.nextBytes(l);n[--f]=l[0]}return n[--f]=2,n[--f]=0,new o(n)}function de(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function ie(e,f){null!=e&&null!=f&&e.length>0&&f.length>0?(this.n=fe(e,16),this.e=parseInt(f,16)):alert("Invalid RSA public key")}function te(e){return e.modPowInt(this.e,this.n)}function le(e){var f=oe(e,this.n.bitLength()+7>>3);if(null==f)return null;var n=this.doPublic(f);if(null==n)return null;var o=n.toString(16);return 0==(1&o.length)?o:"0"+o}var ue,pe=0xdeadbeefcafe,se=15715070==(16777215&pe);se&&"Microsoft Internet Explorer"==navigator.appName?(o.prototype.am=t,ue=30):se&&"Netscape"!=navigator.appName?(o.prototype.am=i,ue=26):(o.prototype.am=l,ue=28),o.prototype.DB=ue,o.prototype.DM=(1<<ue)-1,o.prototype.DV=1<<ue;var ye=52;o.prototype.FV=Math.pow(2,ye),o.prototype.F1=ye-ue,o.prototype.F2=2*ue-ye;var ce,re,ae="0123456789abcdefghijklmnopqrstuvwxyz",we=new Array;for(ce="0".charCodeAt(0),re=0;9>=re;++re)we[ce++]=re;for(ce="a".charCodeAt(0),re=10;36>re;++re)we[ce++]=re;for(ce="A".charCodeAt(0),re=10;36>re;++re)we[ce++]=re;E.prototype.convert=F,E.prototype.revert=G,E.prototype.reduce=H,E.prototype.mulTo=I,E.prototype.sqrTo=J,L.prototype.convert=M,L.prototype.revert=N,L.prototype.reduce=O,L.prototype.mulTo=Q,L.prototype.sqrTo=P,o.prototype.copyTo=s,o.prototype.fromInt=y,o.prototype.fromString=r,o.prototype.clamp=a,o.prototype.dlShiftTo=j,o.prototype.drShiftTo=v,o.prototype.lShiftTo=k,o.prototype.rShiftTo=q,o.prototype.subTo=z,o.prototype.multiplyTo=A,o.prototype.squareTo=B,o.prototype.divRemTo=C,o.prototype.invDigit=K,o.prototype.isEven=R,o.prototype.exp=S,o.prototype.toString=w,o.prototype.negate=b,o.prototype.abs=g,o.prototype.compareTo=m,o.prototype.bitLength=h,o.prototype.mod=D,o.prototype.modPowInt=T,o.ZERO=c(0),o.ONE=c(1),U.prototype.init=V,U.prototype.next=W;var be,ge,me,xe=256;if(null==ge){ge=new Array,me=0;var he;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto){var je=window.crypto.random(32);for(he=0;he<je.length;++he)ge[me++]=255&je.charCodeAt(he)}for(;xe>me;)he=Math.floor(65536*Math.random()),ge[me++]=he>>>8,ge[me++]=255&he;me=0,Z()}ee.prototype.nextBytes=_,de.prototype.doPublic=te,de.prototype.setPublic=ie,de.prototype.encrypt=le,f.exports={SecureRandom:ee,byte2Hex:ne,RSAKey:de}},{}],4:[function(e,f,n){function o(e,f){return r.isUndefined(f)?""+f:!r.isNumber(f)||!isNaN(f)&&isFinite(f)?r.isFunction(f)||r.isRegExp(f)?f.toString():f:f.toString()}function d(e,f){return r.isString(e)?e.length<f?e:e.slice(0,f):e}function i(e){return d(JSON.stringify(e.actual,o),128)+" "+e.operator+" "+d(JSON.stringify(e.expected,o),128)}function t(e,f,n,o,d){throw new b.AssertionError({message:n,actual:e,expected:f,operator:o,stackStartFunction:d})}function l(e,f){e||t(e,!0,f,"==",b.ok)}function u(e,f){if(e===f)return!0;if(r.isBuffer(e)&&r.isBuffer(f)){if(e.length!=f.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==f[n])return!1;return!0}return r.isDate(e)&&r.isDate(f)?e.getTime()===f.getTime():r.isRegExp(e)&&r.isRegExp(f)?e.source===f.source&&e.global===f.global&&e.multiline===f.multiline&&e.lastIndex===f.lastIndex&&e.ignoreCase===f.ignoreCase:r.isObject(e)||r.isObject(f)?s(e,f):e==f}function p(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function s(e,f){if(r.isNullOrUndefined(e)||r.isNullOrUndefined(f))return!1;if(e.prototype!==f.prototype)return!1;if(p(e))return p(f)?(e=a.call(e),f=a.call(f),u(e,f)):!1;try{var n,o,d=g(e),i=g(f)}catch(t){return!1}if(d.length!=i.length)return!1;for(d.sort(),i.sort(),o=d.length-1;o>=0;o--)if(d[o]!=i[o])return!1;for(o=d.length-1;o>=0;o--)if(n=d[o],!u(e[n],f[n]))return!1;return!0}function y(e,f){return e&&f?"[object RegExp]"==Object.prototype.toString.call(f)?f.test(e):e instanceof f?!0:f.call({},e)===!0?!0:!1:!1}function c(e,f,n,o){var d;r.isString(n)&&(o=n,n=null);try{f()}catch(i){d=i}if(o=(n&&n.name?" ("+n.name+").":".")+(o?" "+o:"."),e&&!d&&t(d,n,"Missing expected exception"+o),!e&&y(d,n)&&t(d,n,"Got unwanted exception"+o),e&&d&&n&&!y(d,n)||!e&&d)throw d}var r=e("util/"),a=Array.prototype.slice,w=Object.prototype.hasOwnProperty,b=f.exports=l;b.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=i(this),this.generatedMessage=!0);var f=e.stackStartFunction||t;if(Error.captureStackTrace)Error.captureStackTrace(this,f);else{var n=new Error;if(n.stack){var o=n.stack,d=f.name,l=o.indexOf("\n"+d);if(l>=0){var u=o.indexOf("\n",l+1);o=o.substring(u+1)}this.stack=o}}},r.inherits(b.AssertionError,Error),b.fail=t,b.ok=l,b.equal=function(e,f,n){e!=f&&t(e,f,n,"==",b.equal)},b.notEqual=function(e,f,n){e==f&&t(e,f,n,"!=",b.notEqual)},b.deepEqual=function(e,f,n){u(e,f)||t(e,f,n,"deepEqual",b.deepEqual)},b.notDeepEqual=function(e,f,n){u(e,f)&&t(e,f,n,"notDeepEqual",b.notDeepEqual)},b.strictEqual=function(e,f,n){e!==f&&t(e,f,n,"===",b.strictEqual)},b.notStrictEqual=function(e,f,n){e===f&&t(e,f,n,"!==",b.notStrictEqual)},b["throws"]=function(e,f,n){c.apply(this,[!0].concat(a.call(arguments)))},b.doesNotThrow=function(e,f){c.apply(this,[!1].concat(a.call(arguments)))},b.ifError=function(e){if(e)throw e};var g=Object.keys||function(e){var f=[];for(var n in e)w.call(e,n)&&f.push(n);return f}},{"util/":7}],5:[function(e,f,n){"function"==typeof Object.create?f.exports=function(e,f){e.super_=f,e.prototype=Object.create(f.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:f.exports=function(e,f){e.super_=f;var n=function(){};n.prototype=f.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],6:[function(e,f,n){f.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],7:[function(e,f,n){(function(f,o){function d(e,f){var o={seen:[],stylize:t};return arguments.length>=3&&(o.depth=arguments[2]),arguments.length>=4&&(o.colors=arguments[3]),w(f)?o.showHidden=f:f&&n._extend(o,f),j(o.showHidden)&&(o.showHidden=!1),j(o.depth)&&(o.depth=2),j(o.colors)&&(o.colors=!1),j(o.customInspect)&&(o.customInspect=!0),o.colors&&(o.stylize=i),u(o,e,o.depth)}function i(e,f){var n=d.styles[f];return n?"["+d.colors[n][0]+"m"+e+"["+d.colors[n][1]+"m":e}function t(e,f){return e}function l(e){var f={};return e.forEach(function(e,n){f[e]=!0}),f}function u(e,f,o){if(e.customInspect&&f&&A(f.inspect)&&f.inspect!==n.inspect&&(!f.constructor||f.constructor.prototype!==f)){var d=f.inspect(o,e);return x(d)||(d=u(e,d,o)),d}var i=p(e,f);if(i)return i;var t=Object.keys(f),w=l(t);if(e.showHidden&&(t=Object.getOwnPropertyNames(f)),z(f)&&(t.indexOf("message")>=0||t.indexOf("description")>=0))return s(f);if(0===t.length){if(A(f)){var b=f.name?": "+f.name:"";return e.stylize("[Function"+b+"]","special")}if(v(f))return e.stylize(RegExp.prototype.toString.call(f),"regexp");if(q(f))return e.stylize(Date.prototype.toString.call(f),"date");if(z(f))return s(f)}var g="",m=!1,h=["{","}"];if(a(f)&&(m=!0,h=["[","]"]),A(f)){var j=f.name?": "+f.name:"";g=" [Function"+j+"]"}if(v(f)&&(g=" "+RegExp.prototype.toString.call(f)),q(f)&&(g=" "+Date.prototype.toUTCString.call(f)),z(f)&&(g=" "+s(f)),0===t.length&&(!m||0==f.length))return h[0]+g+h[1];if(0>o)return v(f)?e.stylize(RegExp.prototype.toString.call(f),"regexp"):e.stylize("[Object]","special");e.seen.push(f);var k;return k=m?y(e,f,o,w,t):t.map(function(n){return c(e,f,o,w,n,m)}),e.seen.pop(),r(k,g,h)}function p(e,f){if(j(f))return e.stylize("undefined","undefined");if(x(f)){var n="'"+JSON.stringify(f).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(f)?e.stylize(""+f,"number"):w(f)?e.stylize(""+f,"boolean"):b(f)?e.stylize("null","null"):void 0}function s(e){return"["+Error.prototype.toString.call(e)+"]"}function y(e,f,n,o,d){for(var i=[],t=0,l=f.length;l>t;++t)F(f,String(t))?i.push(c(e,f,n,o,String(t),!0)):i.push("");return d.forEach(function(d){d.match(/^\d+$/)||i.push(c(e,f,n,o,d,!0))}),i}function c(e,f,n,o,d,i){var t,l,p;if(p=Object.getOwnPropertyDescriptor(f,d)||{value:f[d]},p.get?l=p.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):p.set&&(l=e.stylize("[Setter]","special")),F(o,d)||(t="["+d+"]"),l||(e.seen.indexOf(p.value)<0?(l=b(n)?u(e,p.value,null):u(e,p.value,n-1),l.indexOf("\n")>-1&&(l=i?l.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+l.split("\n").map(function(e){return"   "+e}).join("\n"))):l=e.stylize("[Circular]","special")),j(t)){if(i&&d.match(/^\d+$/))return l;t=JSON.stringify(""+d),t.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(t=t.substr(1,t.length-2),t=e.stylize(t,"name")):(t=t.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t=e.stylize(t,"string"))}return t+": "+l}function r(e,f,n){var o=0,d=e.reduce(function(e,f){return o++,f.indexOf("\n")>=0&&o++,e+f.replace(/\u001b\[\d\d?m/g,"").length+1},0);return d>60?n[0]+(""===f?"":f+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+f+" "+e.join(", ")+" "+n[1]}function a(e){return Array.isArray(e)}function w(e){return"boolean"==typeof e}function b(e){return null===e}function g(e){return null==e}function m(e){return"number"==typeof e}function x(e){return"string"==typeof e}function h(e){return"symbol"==typeof e}function j(e){return void 0===e}function v(e){return k(e)&&"[object RegExp]"===C(e)}function k(e){return"object"==typeof e&&null!==e}function q(e){return k(e)&&"[object Date]"===C(e)}function z(e){return k(e)&&("[object Error]"===C(e)||e instanceof Error)}function A(e){return"function"==typeof e}function B(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function C(e){return Object.prototype.toString.call(e)}function D(e){return 10>e?"0"+e.toString(10):e.toString(10)}function E(){var e=new Date,f=[D(e.getHours()),D(e.getMinutes()),D(e.getSeconds())].join(":");return[e.getDate(),J[e.getMonth()],f].join(" ")}function F(e,f){return Object.prototype.hasOwnProperty.call(e,f)}var G=/%[sdj%]/g;n.format=function(e){if(!x(e)){for(var f=[],n=0;n<arguments.length;n++)f.push(d(arguments[n]));return f.join(" ")}for(var n=1,o=arguments,i=o.length,t=String(e).replace(G,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(f){return"[Circular]"}default:return e}}),l=o[n];i>n;l=o[++n])t+=b(l)||!k(l)?" "+l:" "+d(l);return t},n.deprecate=function(e,d){function i(){if(!t){if(f.throwDeprecation)throw new Error(d);f.traceDeprecation?console.trace(d):console.error(d),t=!0}return e.apply(this,arguments)}if(j(o.process))return function(){return n.deprecate(e,d).apply(this,arguments)};if(f.noDeprecation===!0)return e;var t=!1;return i};var H,I={};n.debuglog=function(e){if(j(H)&&(H=f.env.NODE_DEBUG||""),e=e.toUpperCase(),!I[e])if(new RegExp("\\b"+e+"\\b","i").test(H)){var o=f.pid;I[e]=function(){var f=n.format.apply(n,arguments);console.error("%s %d: %s",e,o,f)}}else I[e]=function(){};return I[e]},n.inspect=d,d.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=a,n.isBoolean=w,n.isNull=b,n.isNullOrUndefined=g,n.isNumber=m,n.isString=x,n.isSymbol=h,n.isUndefined=j,n.isRegExp=v,n.isObject=k,n.isDate=q,n.isError=z,n.isFunction=A,n.isPrimitive=B,n.isBuffer=e("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",E(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,f){if(!f||!k(f))return e;for(var n=Object.keys(f),o=n.length;o--;)e[n[o]]=f[n[o]];return e}}).call(this,e("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":6,FWaASH:8,inherits:5}],8:[function(e,f,n){function o(){}var d=f.exports={};d.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,f="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(f){var n=[];return window.addEventListener("message",function(e){var f=e.source;if((f===window||null===f)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var o=n.shift();o()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=o,d.addListener=o,d.once=o,d.off=o,d.removeListener=o,d.removeAllListeners=o,d.emit=o,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],9:[function(e,f,n){(function(n){function o(){}function d(){c.log.apply(c,arguments)}function i(){c.log.apply(c,arguments)}function t(){c.warn.apply(c,arguments)}function l(e){w[e]=Date.now()}function u(e){var f=w[e];if(!f)throw new Error("No such label: "+e);var n=Date.now()-f;c.log(e+": "+n+"ms")}function p(){var e=new Error;e.name="Trace",e.message=r.format.apply(null,arguments),c.error(e.stack)}function s(e){c.log(r.inspect(e)+"\n")}function y(e){if(!e){var f=a.call(arguments,1);y.ok(!1,r.format.apply(null,f))}}var c,r=e("util"),y=e("assert"),a=Array.prototype.slice,w={};c="undefined"!=typeof n&&n.console?n.console:"undefined"!=typeof window&&window.console?window.console:{};for(var b=[[o,"log"],[d,"info"],[i,"warn"],[t,"error"],[l,"time"],[u,"timeEnd"],[p,"trace"],[s,"dir"],[y,"assert"]],g=0;g<b.length;g++){var m=b[g],x=m[0],h=m[1];c[h]||(c[h]=x)}f.exports=c}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{assert:4,util:32}],10:[function(e,f,n){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function i(e){return"number"==typeof e}function t(e){return"object"==typeof e&&null!==e}function l(e){return void 0===e}f.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.prototype.emit=function(e){var f,n,o,i,u,p;if(this._events||(this._events={}),"error"===e&&(!this._events.error||t(this._events.error)&&!this._events.error.length)){if(f=arguments[1],f instanceof Error)throw f;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],l(n))return!1;if(d(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(o=arguments.length,i=new Array(o-1),u=1;o>u;u++)i[u-1]=arguments[u];n.apply(this,i)}else if(t(n)){for(o=arguments.length,i=new Array(o-1),u=1;o>u;u++)i[u-1]=arguments[u];for(p=n.slice(),o=p.length,u=0;o>u;u++)p[u].apply(this,i)}return!0},o.prototype.addListener=function(e,f){var n;if(!d(f))throw TypeError("listener must be a function");if(this._events||(this._events={}),
this._events.newListener&&this.emit("newListener",e,d(f.listener)?f.listener:f),this._events[e]?t(this._events[e])?this._events[e].push(f):this._events[e]=[this._events[e],f]:this._events[e]=f,t(this._events[e])&&!this._events[e].warned){var n;n=l(this._maxListeners)?o.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(e,f){function n(){this.removeListener(e,n),o||(o=!0,f.apply(this,arguments))}if(!d(f))throw TypeError("listener must be a function");var o=!1;return n.listener=f,this.on(e,n),this},o.prototype.removeListener=function(e,f){var n,o,i,l;if(!d(f))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,o=-1,n===f||d(n.listener)&&n.listener===f)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,f);else if(t(n)){for(l=i;l-->0;)if(n[l]===f||n[l].listener&&n[l].listener===f){o=l;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,f)}return this},o.prototype.removeAllListeners=function(e){var f,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(f in this._events)"removeListener"!==f&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],d(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},o.prototype.listeners=function(e){var f;return f=this._events&&this._events[e]?d(this._events[e])?[this._events[e]]:this._events[e].slice():[]},o.listenerCount=function(e,f){var n;return n=e._events&&e._events[f]?d(e._events[f])?1:e._events[f].length:0}},{}],11:[function(e,f,n){(function(n){__browserify_shim_require__=e,function(e,f,n,o,d){var i=i||function(e,f){var n={},o=n.lib={},d=o.Base=function(){function e(){}return{extend:function(f){e.prototype=this;var n=new e;return f&&n.mixIn(f),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var f in e)e.hasOwnProperty(f)&&(this[f]=e[f]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=o.WordArray=d.extend({init:function(e,n){e=this.words=e||[],n!=f?this.sigBytes=n:this.sigBytes=4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var f=this.words,n=e.words,o=this.sigBytes,d=e.sigBytes;if(this.clamp(),o%4)for(var i=0;d>i;i++){var t=n[i>>>2]>>>24-i%4*8&255;f[o+i>>>2]|=t<<24-(o+i)%4*8}else if(n.length>65535)for(var i=0;d>i;i+=4)f[o+i>>>2]=n[i>>>2];else f.push.apply(f,n);return this.sigBytes+=d,this},clamp:function(){var f=this.words,n=this.sigBytes;f[n>>>2]&=4294967295<<32-n%4*8,f.length=e.ceil(n/4)},clone:function(){var e=d.clone.call(this);return e.words=this.words.slice(0),e},random:function(f){for(var n=[],o=0;f>o;o+=4)n.push(4294967296*e.random()|0);return new i.init(n,f)}}),t=n.enc={},l=t.Hex={stringify:function(e){for(var f=e.words,n=e.sigBytes,o=[],d=0;n>d;d++){var i=f[d>>>2]>>>24-d%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var f=e.length,n=[],o=0;f>o;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new i.init(n,f/2)}},u=t.Latin1={stringify:function(e){for(var f=e.words,n=e.sigBytes,o=[],d=0;n>d;d++){var i=f[d>>>2]>>>24-d%4*8&255;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var f=e.length,n=[],o=0;f>o;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new i.init(n,f)}},p=t.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(f){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},s=o.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(f){var n=this._data,o=n.words,d=n.sigBytes,t=this.blockSize,l=4*t,u=d/l;u=f?e.ceil(u):e.max((0|u)-this._minBufferSize,0);var p=u*t,s=e.min(4*p,d);if(p){for(var y=0;p>y;y+=t)this._doProcessBlock(o,y);var c=o.splice(0,p);n.sigBytes-=s}return new i.init(c,s)},clone:function(){var e=d.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),y=(o.Hasher=s.extend({cfg:d.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){s.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var f=this._doFinalize();return f},blockSize:16,_createHelper:function(e){return function(f,n){return new e.init(n).finalize(f)}},_createHmacHelper:function(e){return function(f,n){return new y.HMAC.init(e,n).finalize(f)}}}),n.algo={});return n}(Math);i.lib.Cipher||function(e){var f=i,n=f.lib,o=n.Base,d=n.WordArray,t=n.BufferedBlockAlgorithm,l=f.enc,u=(l.Utf8,l.Base64),p=f.algo,s=p.EvpKDF,y=n.Cipher=t.extend({cfg:o.extend(),createEncryptor:function(e,f){return this.create(this._ENC_XFORM_MODE,e,f)},createDecryptor:function(e,f){return this.create(this._DEC_XFORM_MODE,e,f)},init:function(e,f,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=f,this.reset()},reset:function(){t.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var f=this._doFinalize();return f},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?k:h}return function(f){return{encrypt:function(n,o,d){return e(o).encrypt(f,n,o,d)},decrypt:function(n,o,d){return e(o).decrypt(f,n,o,d)}}}}()}),c=(n.StreamCipher=y.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),f.mode={}),r=n.BlockCipherMode=o.extend({createEncryptor:function(e,f){return this.Encryptor.create(e,f)},createDecryptor:function(e,f){return this.Decryptor.create(e,f)},init:function(e,f){this._cipher=e,this._iv=f}}),a=c.CBC=function(){function f(f,n,o){var d=this._iv;if(d){var i=d;this._iv=e}else var i=this._prevBlock;for(var t=0;o>t;t++)f[n+t]^=i[t]}var n=r.extend();return n.Encryptor=n.extend({processBlock:function(e,n){var o=this._cipher,d=o.blockSize;f.call(this,e,n,d),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+d)}}),n.Decryptor=n.extend({processBlock:function(e,n){var o=this._cipher,d=o.blockSize,i=e.slice(n,n+d);o.decryptBlock(e,n),f.call(this,e,n,d),this._prevBlock=i}}),n}(),w=f.pad={},b=w.Pkcs7={pad:function(e,f){for(var n=4*f,o=n-e.sigBytes%n,i=o<<24|o<<16|o<<8|o,t=[],l=0;o>l;l+=4)t.push(i);var u=d.create(t,o);e.concat(u)},unpad:function(e){var f=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=f}},g=(n.BlockCipher=y.extend({cfg:y.cfg.extend({mode:a,padding:b}),reset:function(){y.reset.call(this);var e=this.cfg,f=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var o=n.createEncryptor;else{var o=n.createDecryptor;this._minBufferSize=1}this._mode=o.call(n,this,f&&f.words)},_doProcessBlock:function(e,f){this._mode.processBlock(e,f)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var f=this._process(!0)}else{var f=this._process(!0);e.unpad(f)}return f},blockSize:4}),n.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),m=f.format={},x=m.OpenSSL={stringify:function(e){var f=e.ciphertext,n=e.salt;if(n)var o=d.create([1398893684,1701076831]).concat(n).concat(f);else var o=f;return o.toString(u)},parse:function(e){var f=u.parse(e),n=f.words;if(1398893684==n[0]&&1701076831==n[1]){var o=d.create(n.slice(2,4));n.splice(0,4),f.sigBytes-=16}return g.create({ciphertext:f,salt:o})}},h=n.SerializableCipher=o.extend({cfg:o.extend({format:x}),encrypt:function(e,f,n,o){o=this.cfg.extend(o);var d=e.createEncryptor(n,o),i=d.finalize(f),t=d.cfg;return g.create({ciphertext:i,key:n,iv:t.iv,algorithm:e,mode:t.mode,padding:t.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,f,n,o){o=this.cfg.extend(o),f=this._parse(f,o.format);var d=e.createDecryptor(n,o).finalize(f.ciphertext);return d},_parse:function(e,f){return"string"==typeof e?f.parse(e,this):e}}),j=f.kdf={},v=j.OpenSSL={execute:function(e,f,n,o){o||(o=d.random(8));var i=s.create({keySize:f+n}).compute(e,o),t=d.create(i.words.slice(f),4*n);return i.sigBytes=4*f,g.create({key:i,iv:t,salt:o})}},k=n.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:v}),encrypt:function(e,f,n,o){o=this.cfg.extend(o);var d=o.kdf.execute(n,e.keySize,e.ivSize);o.iv=d.iv;var i=h.encrypt.call(this,e,f,d.key,o);return i.mixIn(d),i},decrypt:function(e,f,n,o){o=this.cfg.extend(o),f=this._parse(f,o.format);var d=o.kdf.execute(n,e.keySize,e.ivSize,f.salt);o.iv=d.iv;var i=h.decrypt.call(this,e,f,d.key,o);return i}})}(),function(){var e=i,f=e.lib,n=f.WordArray,o=f.Hasher,d=e.algo,t=[],l=d.SHA1=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,f){for(var n=this._hash.words,o=n[0],d=n[1],i=n[2],l=n[3],u=n[4],p=0;80>p;p++){if(16>p)t[p]=0|e[f+p];else{var s=t[p-3]^t[p-8]^t[p-14]^t[p-16];t[p]=s<<1|s>>>31}var y=(o<<5|o>>>27)+u+t[p];y+=20>p?(d&i|~d&l)+1518500249:40>p?(d^i^l)+1859775393:60>p?(d&i|d&l|i&l)-1894007588:(d^i^l)-899497514,u=l,l=i,i=d<<30|d>>>2,d=o,o=y}n[0]=n[0]+o|0,n[1]=n[1]+d|0,n[2]=n[2]+i|0,n[3]=n[3]+l|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,f=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return f[o>>>5]|=128<<24-o%32,f[(o+64>>>9<<4)+14]=Math.floor(n/4294967296),f[(o+64>>>9<<4)+15]=n,e.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=o._createHelper(l),e.HmacSHA1=o._createHmacHelper(l)}(),function(e){var f=i,n=f.lib,o=n.Base,d=n.WordArray,t=f.x64={};t.Word=o.extend({init:function(e,f){this.high=e,this.low=f}}),t.WordArray=o.extend({init:function(f,n){f=this.words=f||[],n!=e?this.sigBytes=n:this.sigBytes=8*f.length},toX32:function(){for(var e=this.words,f=e.length,n=[],o=0;f>o;o++){var i=e[o];n.push(i.high),n.push(i.low)}return d.create(n,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),f=e.words=this.words.slice(0),n=f.length,d=0;n>d;d++)f[d]=f[d].clone();return e}})}(),d("undefined"!=typeof i?i:window.CryptoJS)}.call(n,void 0,void 0,void 0,void 0,function(e){f.exports=e})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(e,f,n){f.exports=e(2)},{}],13:[function(e,f,n){var o=e("./v1"),d=e("./v4"),i=d;i.v1=o,i.v4=d,f.exports=i},{"./v1":16,"./v4":17}],14:[function(e,f,n){function o(e,f){var n=f||0,o=d;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]}for(var d=[],i=0;256>i;++i)d[i]=(i+256).toString(16).substr(1);f.exports=o},{}],15:[function(e,f,n){(function(e){var n,o=e.crypto||e.msCrypto;if(o&&o.getRandomValues){var d=new Uint8Array(16);n=function(){return o.getRandomValues(d),d}}if(!n){var i=new Array(16);n=function(){for(var e,f=0;16>f;f++)0===(3&f)&&(e=4294967296*Math.random()),i[f]=e>>>((3&f)<<3)&255;return i}}f.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(e,f,n){function o(e,f,n){var o=f&&n||0,d=f||[];e=e||{};var t=void 0!==e.clockseq?e.clockseq:u,y=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:s+1,r=y-p+(c-s)/1e4;if(0>r&&void 0===e.clockseq&&(t=t+1&16383),(0>r||y>p)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=y,s=c,u=t,y+=122192928e5;var a=(1e4*(268435455&y)+c)%4294967296;d[o++]=a>>>24&255,d[o++]=a>>>16&255,d[o++]=a>>>8&255,d[o++]=255&a;var w=y/4294967296*1e4&268435455;d[o++]=w>>>8&255,d[o++]=255&w,d[o++]=w>>>24&15|16,d[o++]=w>>>16&255,d[o++]=t>>>8|128,d[o++]=255&t;for(var b=e.node||l,g=0;6>g;++g)d[o+g]=b[g];return f?f:i(d)}var d=e("./lib/rng"),i=e("./lib/bytesToUuid"),t=d(),l=[1|t[0],t[1],t[2],t[3],t[4],t[5]],u=16383&(t[6]<<8|t[7]),p=0,s=0;f.exports=o},{"./lib/bytesToUuid":14,"./lib/rng":15}],17:[function(e,f,n){function o(e,f,n){var o=f&&n||0;"string"==typeof e&&(f="binary"==e?new Array(16):null,e=null),e=e||{};var t=e.random||(e.rng||d)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,f)for(var l=0;16>l;++l)f[o+l]=t[l];return f||i(t)}var d=e("./lib/rng"),i=e("./lib/bytesToUuid");f.exports=o},{"./lib/bytesToUuid":14,"./lib/rng":15}],18:[function(e,f,n){function o(){if(window&&window.device)return window.device.uuid;if(navigator&&navigator.device)return navigator.device.uuid;if(window&&window.localStorage){var e=window.localStorage.getItem(i);return e||(e=d(),localStorage.setItem(i,e)),e}throw Error("Cannot create and store client id")}var d=e("uuid").v1,i="feedhenry_sync_client";f.exports={getClientId:o}},{uuid:13}],19:[function(e,f,n){var o,d,i=function(e,f,n){d||(d="/sync/");var i=o+d+e.dataset_id,t=e.req,l=JSON.stringify(t),u=new XMLHttpRequest;u.open("POST",i,!0),u.setRequestHeader("Content-type","application/json; charset=utf-8"),u.onreadystatechange=function(){if(u.readyState===XMLHttpRequest.DONE)if(u.status>=200&&u.status<300||304===u.status){var e;try{u.responseText&&(e=JSON.parse(u.responseText))}catch(o){return n(o)}f(e)}else n(u.responseText)},u.send(l)},t=function(e,f){o=e,d=f};f.exports={handler:i,init:t}},{}],20:[function(e,f,n){var o=e("./sync-client"),d=window.$fh=window.$fh||{};d.sync=o,f.exports=d.sync},{"./sync-client":21}],21:[function(e,f,n){var o=e("../libs/generated/crypto"),d=e("../libs/generated/lawnchair"),i=e("./cloudHandler"),t=e("./clientIdProvider"),l=6e4,u={defaults:{sync_frequency:10,auto_sync_local_updates:!0,notify_client_storage_failed:!0,notify_sync_started:!0,notify_sync_complete:!0,notify_offline_update:!0,notify_collision_detected:!0,notify_remote_update_failed:!0,notify_local_update_applied:!0,notify_remote_update_applied:!0,notify_delta_received:!0,notify_record_delta_received:!0,notify_sync_failed:!0,do_console_log:!1,crashed_count_wait:10,resend_crashed_updates:!0,sync_active:!0,storage_strategy:"html5-filesystem",file_system_quota:61644800,icloud_backup:!1,resend_inflight_pendings_minutes:1440},notifications:{CLIENT_STORAGE_FAILED:"client_storage_failed",SYNC_STARTED:"sync_started",SYNC_COMPLETE:"sync_complete",OFFLINE_UPDATE:"offline_update",COLLISION_DETECTED:"collision_detected",REMOTE_UPDATE_FAILED:"remote_update_failed",REMOTE_UPDATE_APPLIED:"remote_update_applied",LOCAL_UPDATE_APPLIED:"local_update_applied",DELTA_RECEIVED:"delta_received",RECORD_DELTA_RECEIVED:"record_delta_received",SYNC_FAILED:"sync_failed"},datasets:{},config:void 0,notify_callback:void 0,notify_callback_map:{},init_is_called:!1,uid_map:{},init:function(e){u.consoleLog("sync - init called"),u.config=JSON.parse(JSON.stringify(u.defaults));for(var f in e)u.config[f]=e[f];u.init_is_called||(u.init_is_called=!0,u.datasetMonitor()),i.init(u.config.cloudUrl,u.config.cloudPath)},notify:function(e,f){1===arguments.length&&"function"==typeof e?u.notify_callback=e:u.notify_callback_map[e]=f},manage:function(e,f,n,o,d){u.consoleLog("manage - START"),u.config||(u.config=JSON.parse(JSON.stringify(u.defaults)));var i=f||{},t=function(f){u.consoleLog("doManage dataset :: initialised = "+f.initialised+" :: "+e+" :: "+JSON.stringify(i));var t=f.config?f.config:u.config,l=u.setOptions(t,i);f.query_params=n||f.query_params||{},f.meta_data=o||f.meta_data||{},f.config=l,f.syncRunning=!1,f.syncPending=!0,f.initialised=!0,"undefined"==typeof f.meta&&(f.meta={}),u.saveDataSet(e,function(){d&&d()})};u.getDataSet(e,function(e){u.consoleLog("manage - dataset already loaded"),t(e)},function(f){u.consoleLog("manage - dataset not loaded... trying to load"),u.loadDataSet(e,function(f){u.consoleLog("manage - dataset loaded from local storage"),u.doNotify(e,null,u.notifications.LOCAL_UPDATE_APPLIED,"load"),t(f)},function(f){u.consoleLog("manage - Creating new dataset for id "+e);var n={};n.data={},n.pending={},n.meta={},u.datasets[e]=n,t(n)})})},setOptions:function(e,f){e||(e=JSON.parse(JSON.stringify(u.defaults)));var n=JSON.parse(JSON.stringify(e)),o=JSON.parse(JSON.stringify(f));for(var d in o)n[d]=o[d];return n},list:function(e,f,n){u.getDataSet(e,function(e){if(e&&e.data){var o=JSON.parse(JSON.stringify(e.data));f(o)}else n&&n("no_data")},function(e,f){n&&n(e,f)})},getUID:function(e){var f=u.uid_map[e];return f||0===f?f:e},create:function(e,f,n,o){return null==f&&o?o("null_data"):void u.addPendingObj(e,null,f,"create",n,o)},read:function(e,f,n,o){u.getDataSet(e,function(e){f=u.getUID(f);var d=e.data[f];if(d){var i=JSON.parse(JSON.stringify(d));n(i)}else o("unknown_uid")},function(e,f){o&&o(e,f)})},update:function(e,f,n,o,d){f=u.getUID(f),u.addPendingObj(e,f,n,"update",o,d)},"delete":function(e,f,n,o){f=u.getUID(f),u.addPendingObj(e,f,null,"delete",n,o)},getPending:function(e,f){u.getDataSet(e,function(e){var n;e&&(n=e.pending),f(n)},function(e,f){u.consoleLog(e)})},clearPending:function(e,f){u.getDataSet(e,function(n){n.pending={},u.saveDataSet(e,f)})},listCollisions:function(e,f,n){u.getDataSet(e,function(o){u.doCloudCall({dataset_id:e,req:{fn:"listCollisions",meta_data:o.meta_data}},f,n)},n)},removeCollision:function(e,f,n,o){u.getDataSet(e,function(d){u.doCloudCall({dataset_id:e,req:{fn:"removeCollision",hash:f,meta_data:d.meta_data}},n,o)})},setNetworkStatusHandler:function(e){handler&&"function"==typeof handler?u.isOnline=handler:u.consoleLog("setNetworkStatusHandler called  with wrong parameter")},isOnline:function(e){var f=!0;if("undefined"!=typeof navigator.onLine&&(f=navigator.onLine),f&&"undefined"!=typeof navigator.network&&"undefined"!=typeof navigator.network.connection){var n=navigator.network.connection.type;("none"===n||null===n)&&(f=!1)}return e(f)},doNotify:function(e,f,n,o){if(u.notify_callback||u.notify_callback_map[e]){var d=u.notify_callback_map[e]||u.notify_callback;if(u.config["notify_"+n]){var i={dataset_id:e,uid:f,code:n,message:o};setTimeout(function(){d(i)},0)}}},getDataSet:function(e,f,n){var o=u.datasets[e];o?f(o):n&&n("unknown_dataset "+e,e)},getQueryParams:function(e,f,n){var o=u.datasets[e];o?f(o.query_params):n&&n("unknown_dataset "+e,e)},setQueryParams:function(e,f,n,o){var d=u.datasets[e];d?(d.query_params=f,u.saveDataSet(e),n&&n(d.query_params)):o&&o("unknown_dataset "+e,e)},getMetaData:function(e,f,n){var o=u.datasets[e];o?f(o.meta_data):n&&n("unknown_dataset "+e,e)},setMetaData:function(e,f,n,o){var d=u.datasets[e];d?(d.meta_data=f,u.saveDataSet(e),n&&n(d.meta_data)):o&&o("unknown_dataset "+e,e)},getConfig:function(e,f,n){var o=u.datasets[e];o?f(o.config):n&&n("unknown_dataset "+e,e)},setConfig:function(e,f,n,o){var d=u.datasets[e];if(d){var i=u.setOptions(d.config,f);d.config=i,u.saveDataSet(e),n&&n(d.config)}else o&&o("unknown_dataset "+e,e)},stopSync:function(e,f,n){u.setConfig(e,{sync_active:!1},function(){f&&f()},n)},startSync:function(e,f,n){u.setConfig(e,{sync_active:!0},function(){f&&f()},n)},doSync:function(e,f,n){var o=u.datasets[e];o?(o.syncPending=!0,u.saveDataSet(e),f&&f()):n&&n("unknown_dataset "+e,e)},forceSync:function(e,f,n){var o=u.datasets[e];if(o){o.syncForced=!0;var d=o.query_params;d.manualRefresh=!0,o.query_params=d,u.saveDataSet(e),f&&f()}else n&&n("unknown_dataset "+e,e)},sortObject:function(e){if("object"!=typeof e||null===e)return e;var f=[];return Object.keys(e).sort().forEach(function(n){f.push({key:n,value:u.sortObject(e[n])})}),f},sortedStringify:function(e){var f="";try{f=JSON.stringify(u.sortObject(e))}catch(n){console.error("Error stringifying sorted object:"+n)}return f},generateHash:function(e){var f=u.getHashMethod(u.sortedStringify(e));return f.toString()},shouldResendInflightPending:function(e,f){if(e.config&&e.config.resend_inflight_pendings_minutes>0&&f.inFlight&&f.inFlightDate&&!f.crashed){var n=(new Date).getTime(),o=n-f.inFlightDate;if(o>=e.config.resend_inflight_pendings_minutes*l)return!0}return!1},addPendingObj:function(e,f,n,o,d,i){function t(n){n.hash=n.hash||u.generateHash(n),u.getDataSet(e,function(i){i.pending[n.hash]=n,u.updateDatasetFromLocal(i,n),u.config.auto_sync_local_updates&&(i.syncPending=!0),u.saveDataSet(e),u.doNotify(e,f,u.notifications.LOCAL_UPDATE_APPLIED,o),d(n)},function(e,f){i&&i(e,f)})}u.isOnline(function(n){n||u.doNotify(e,f,u.notifications.OFFLINE_UPDATE,o)});var l={};l.inFlight=!1,l.action=o,l.post=JSON.parse(JSON.stringify(n)),l.postHash=u.generateHash(l.post),l.timestamp=(new Date).getTime(),"create"===o?(l.hash=u.generateHash(l),l.uid=l.hash,t(l)):u.read(e,f,function(e){l.uid=f,l.pre=e.data,l.preHash=u.generateHash(e.data),t(l)},function(e,f){i&&i(e,f)})},syncLoop:function(e){u.getDataSet(e,function(f){f.syncPending=!1,f.syncRunning=!0,f.syncLoopStart=(new Date).getTime(),u.doNotify(e,null,u.notifications.SYNC_STARTED,null),u.isOnline(function(n){if(n){var o={};o.fn="sync",o.dataset_id=e,o.query_params=f.query_params,o.config=f.config,o.meta_data=f.meta_data,o.dataset_hash=f.hash,o.acknowledgements=f.acknowledgements||[];var d=f.pending,i=[];for(var t in d)d[t].inFlight||d[t].crashed||d[t].delayed||(d[t].inFlight=!0,d[t].inFlightDate=(new Date).getTime(),i.push(d[t])),u.shouldResendInflightPending(f,d[t])&&i.push(d[t]);o.pending=i,i.length>0&&u.consoleLog("Starting sync loop - global hash = "+f.hash+" :: params = "+JSON.stringify(o,null,2)),u.doCloudCall({dataset_id:e,req:o},function(n){function o(n,o,i){if(n)for(var t in n)d=n[t],i.push(d),f.pending[t]&&f.pending[t].inFlight&&(delete f.pending[t],u.doNotify(e,d.uid,o,d))}var d;if(u.updateCrashedInFlightFromNewData(e,f,n),u.updateDelayedFromNewData(e,f,n),u.updateMetaFromNewData(e,f,n),n.updates){var i=[];u.checkUidChanges(f,n.updates.applied),o(n.updates.applied,u.notifications.REMOTE_UPDATE_APPLIED,i),o(n.updates.failed,u.notifications.REMOTE_UPDATE_FAILED,i),o(n.updates.collisions,u.notifications.COLLISION_DETECTED,i),f.acknowledgements=i}n.hash&&n.hash!==f.hash?(u.consoleLog("Local dataset stale - syncing records :: local hash= "+f.hash+" - remoteHash="+n.hash),u.syncRecords(e)):(u.consoleLog("Local dataset up to date"),u.syncComplete(e,"online",u.notifications.SYNC_COMPLETE))},function(n,o){u.markInFlightAsCrashed(f),u.consoleLog("syncLoop failed : msg="+n+" :: err = "+o),u.syncComplete(e,n,u.notifications.SYNC_FAILED)})}else u.syncComplete(e,"offline",u.notifications.SYNC_FAILED)})})},syncRecords:function(e){u.getDataSet(e,function(f){var n=f.data||{},o={};for(var d in n){var i=d,t=n[d].hash;o[i]=t}var l={};l.fn="syncRecords",l.dataset_id=e,l.query_params=f.query_params,l.clientRecs=o,u.consoleLog("syncRecParams :: "+JSON.stringify(l)),u.doCloudCall({dataset_id:e,req:l},function(o){u.consoleLog("syncRecords Res before applying pending changes :: "+JSON.stringify(o)),u.applyPendingChangesToRecords(f,o),u.consoleLog("syncRecords Res after apply pending changes :: "+JSON.stringify(o));var d;if(o.create)for(d in o.create)n[d]={hash:o.create[d].hash,data:o.create[d].data},u.doNotify(e,d,u.notifications.RECORD_DELTA_RECEIVED,"create");if(o.update)for(d in o.update)n[d].hash=o.update[d].hash,n[d].data=o.update[d].data,u.doNotify(e,d,u.notifications.RECORD_DELTA_RECEIVED,"update");if(o["delete"])for(d in o["delete"])delete n[d],u.doNotify(e,d,u.notifications.RECORD_DELTA_RECEIVED,"delete");u.doNotify(e,o.hash,u.notifications.DELTA_RECEIVED,"partial dataset"),f.data=n,o.hash&&(f.hash=o.hash),u.syncComplete(e,"online",u.notifications.SYNC_COMPLETE)},function(f,n){u.consoleLog("syncRecords failed : msg="+f+" :: err="+n),u.syncComplete(e,f,u.notifications.SYNC_FAILED)})})},syncComplete:function(e,f,n){u.getDataSet(e,function(o){o.syncRunning=!1,o.syncLoopEnd=(new Date).getTime();var d=o.query_params;d.manualRefresh=!1,o.query_params=d,u.saveDataSet(e),u.doNotify(e,o.hash,n,f)})},applyPendingChangesToRecords:function(e,f){var n=e.pending;for(var o in n)if(n.hasOwnProperty(o)){var d=n[o],i=d.uid;if(f.create){var t=f.create;t&&t[i]&&delete t[i]}if(f.update){var l=f.update;l&&l[i]&&delete l[i]}if(f["delete"]){var u=f["delete"];u&&u[i]&&delete u[i]}}},checkUidChanges:function(e,f){if(f){var n={},o=0;for(var d in f)if(f.hasOwnProperty(d)){var i=f[d],t=i.action;if(t&&"create"===t){var l=i.uid,p=i.hash;o++,u.uid_map[p]=l,n[p]=l;var s=e.data[p];s&&(e.data[l]=s,delete e.data[p]);var y=e.meta[p];y&&(e.meta[l]=y,delete e.meta[p])}}if(o>0)for(var c in e.pending)if(e.pending.hasOwnProperty(c)){var r=e.pending[c],a=r.uid;n[a]&&(r.uid=n[a])}}},checkDatasets:function(){for(var e in u.datasets)if(u.datasets.hasOwnProperty(e)){var f=u.datasets[e];if(f&&!f.syncRunning&&(f.config.sync_active||f.syncForced)){var n=f.syncLoopStart,o=f.syncLoopEnd;if(f.syncForced)f.syncPending=!0;else if(null==n)u.consoleLog(e+" - Performing initial sync"),f.syncPending=!0;else if(null!=o){var d=(new Date).getTime()-o,i=1e3*f.config.sync_frequency;d>i&&(f.syncPending=!0)}f.syncPending&&(f.syncForced=!1,u.syncLoop(e))}}},setCloudHandler:function(e){e&&"function"==typeof e?u.cloudHandler=e:u.consoleLog("setCloudHandler called  with wrong parameter")},doCloudCall:function(e,f,n){u.cloudHandler&&"function"==typeof u.cloudHandler?(e&&e.req&&(e.req.__fh={cuid:t.getClientId()}),u.cloudHandler(e,f,n)):console.log("Missing cloud handler for sync. Please refer to documentation")},datasetMonitor:function(){u.checkDatasets(),setTimeout(function(){u.datasetMonitor()},500)},setStorageAdapter:function(e){u.getStorageAdapter=e},setHashMethod:function(e){e&&"function"==typeof e?u.getHashMethod=e:u.consoleLog("setHashMethod called  with wrong parameter")},getStorageAdapter:function(e,f,n){var o=function(n,o){var d=(f?"save to":"load from")+" local storage failed msg: "+n+" err: "+o;u.doNotify(e,null,u.notifications.CLIENT_STORAGE_FAILED,d),u.consoleLog(d)};d({fail:o,adapter:u.config.storage_strategy,size:u.config.file_system_quota,backup:u.config.icloud_backup},function(){return n(null,this)})},getHashMethod:o.SHA1,saveDataSet:function(e,f){u.getDataSet(e,function(n){u.getStorageAdapter(e,!0,function(o,d){d.save({key:"dataset_"+e,val:n},function(){return f?f():void 0})})})},loadDataSet:function(e,f,n){u.getStorageAdapter(e,!1,function(o,d){d.get("dataset_"+e,function(o){if(o&&o.val){var d=o.val;if("string"==typeof d&&(d=JSON.parse(d)),d.initialised=!1,u.datasets[e]=d,u.consoleLog("load from local storage success for dataset_id :"+e),f)return f(d)}else if(n)return n()})})},clearCache:function(e,f){delete u.datasets[e],u.notify_callback_map[e]=null,u.getStorageAdapter(e,!0,function(n,o){o.remove("dataset_"+e,function(){return u.consoleLog("local cache is cleared for dataset : "+e),f?f():void 0})})},updateDatasetFromLocal:function(e,f){var n,o,d=e.pending,i=f.uid;u.consoleLog("updating local dataset for uid "+i+" - action = "+f.action),e.meta[i]=e.meta[i]||{},"create"===f.action&&(e.data[i]&&(u.consoleLog("dataset already exists for uid in create :: "+JSON.stringify(e.data[i])),e.meta[i].fromPending&&(n=e.meta[i].pendingUid,delete d[n])),e.data[i]={}),"update"===f.action&&e.data[i]&&e.meta[i].fromPending&&(u.consoleLog("updating an existing pending record for dataset :: "+JSON.stringify(e.data[i])),n=e.meta[i].pendingUid,o=d[n],o&&(o.inFlight?(u.consoleLog("existing in-inflight pending record = "+JSON.stringify(o)),f.delayed=!0,f.waiting=o.hash):(u.consoleLog("existing pre-flight pending record = "+JSON.stringify(o)),o.post=f.post,o.postHash=f.postHash,delete d[f.hash],f.hash=n))),"delete"===f.action&&e.data[i]&&(e.meta[i].fromPending&&(u.consoleLog("Deleting an existing pending record for dataset :: "+JSON.stringify(e.data[i])),n=e.meta[i].pendingUid,o=d[n],o&&(o.inFlight?(u.consoleLog("existing in-inflight pending record = "+JSON.stringify(o)),f.delayed=!0,f.waiting=o.hash):(u.consoleLog("existing pending record = "+JSON.stringify(o)),"create"===o.action&&(delete d[f.hash],delete d[n]),"update"===o.action&&(f.pre=o.pre,f.preHash=o.preHash,f.inFlight=!1,delete d[n])))),delete e.data[i]),e.data[i]&&(e.data[i].data=f.post,e.data[i].hash=f.postHash,e.meta[i].fromPending=!0,e.meta[i].pendingUid=f.hash)},updateCrashedInFlightFromNewData:function(e,f,n){var o,d,i=({applied:u.notifications.REMOTE_UPDATE_APPLIED,failed:u.notifications.REMOTE_UPDATE_FAILED,collisions:u.notifications.COLLISION_DETECTED},f.pending);if(i){for(o in i)if(i.hasOwnProperty(o)&&(d=i[o],d.inFlight&&d.crashed))if(u.consoleLog("updateCrashedInFlightFromNewData - Found crashed inFlight pending record uid="+d.uid+" :: hash="+d.hash),n&&n.updates&&n.updates.hashes){var t=n.updates.hashes[o];t||(d.crashedCount?d.crashedCount++:d.crashedCount=1)}else d.crashedCount?d.crashedCount++:d.crashedCount=1;for(o in i)i.hasOwnProperty(o)&&(d=i[o],d.inFlight&&d.crashed&&d.crashedCount>f.config.crashed_count_wait&&(u.consoleLog("updateCrashedInFlightFromNewData - Crashed inflight pending record has reached crashed_count_wait limit : "+JSON.stringify(d)),u.consoleLog("updateCrashedInFlightFromNewData - Retryig crashed inflight pending record"),d.crashed=!1,d.inFlight=!1))}},updateDelayedFromNewData:function(e,f,n){var o,d,i=f.pending;if(i)for(o in i)if(i.hasOwnProperty(o)&&(d=i[o],d.delayed&&d.waiting&&(u.consoleLog("updateDelayedFromNewData - Found delayed pending record uid="+d.uid+" :: hash="+d.hash+" :: waiting="+d.waiting),n&&n.updates&&n.updates.hashes))){var t=n.updates.hashes[d.waiting];t&&(u.consoleLog("updateDelayedFromNewData - Waiting pending record is resolved rec="+JSON.stringify(t)),d.delayed=!1,d.waiting=void 0)}},updateMetaFromNewData:function(e,f,n){var o=f.meta;if(o&&n&&n.updates&&n.updates.hashes)for(var d in o)if(o.hasOwnProperty(d)){var i=o[d],t=i.pendingUid;u.consoleLog("updateMetaFromNewData - Found metadata with uid = "+d+" :: pendingHash = "+t);var l=!0;if(t){l=!1;var p=n.updates.hashes[t];p&&(u.consoleLog("updateMetaFromNewData - Found pendingUid in meta data resolved - resolved = "+JSON.stringify(p)),i.pendingUid=void 0,l=!0)}l&&(u.consoleLog("updateMetaFromNewData - both previous and current pendings are resolved for meta data with uid "+d+". Delete it."),delete o[d])}},markInFlightAsCrashed:function(e){var f,n,o=e.pending;if(o){var d={};for(f in o)o.hasOwnProperty(f)&&(n=o[f],n.inFlight&&(u.consoleLog("Marking in flight pending record as crashed : "+f),n.crashed=!0,d[n.uid]=n))}},consoleLog:function(e){u.config.do_console_log&&console.log(e)}};!function(){u.config=u.defaults}(),u.setCloudHandler(i.handler),f.exports={init:u.init,manage:u.manage,notify:u.notify,doList:u.list,getUID:u.getUID,doCreate:u.create,doRead:u.read,doUpdate:u.update,doDelete:u["delete"],listCollisions:u.listCollisions,removeCollision:u.removeCollision,getPending:u.getPending,clearPending:u.clearPending,getDataset:u.getDataSet,getQueryParams:u.getQueryParams,setQueryParams:u.setQueryParams,getMetaData:u.getMetaData,setMetaData:u.setMetaData,getConfig:u.getConfig,setConfig:u.setConfig,startSync:u.startSync,stopSync:u.stopSync,doSync:u.doSync,forceSync:u.forceSync,generateHash:u.generateHash,loadDataSet:u.loadDataSet,clearCache:u.clearCache,doCloudCall:u.doCloudCall,setCloudHandler:u.setCloudHandler,setStorageAdapter:u.setStorageAdapter,setHashMethod:u.setHashMethod,setNetworkStatusHandler:u.setNetworkStatusHandler}},{"../libs/generated/crypto":11,"../libs/generated/lawnchair":12,"./clientIdProvider":18,"./cloudHandler":19}],22:[function(f,n,o){!function(f){
var o="undefined";!function(f,o){"undefined"!=typeof n?n.exports=o():"function"==typeof e&&"object"==typeof e.amd?e(o):this[f]=o()}("log",function(){function e(e){return typeof console===o?y:console[e]===f?console.log!==f?n(console,"log"):y:n(console,e)}function n(e,n){var o=e[n];if(o.bind!==f)return e[n].bind(e);if(Function.prototype.bind===f)return d(o,e);try{return Function.prototype.bind.call(e[n],e)}catch(i){return d(o,e)}}function d(e,f){return function(){Function.prototype.apply.apply(e,[f,arguments])}}function i(e){for(var f=0;f<c.length;f++)s[c[f]]=e(c[f])}function t(){return typeof window!==o&&window.document!==f&&window.document.cookie!==f}function l(){try{return typeof window!==o&&window.localStorage!==f}catch(e){return!1}}function u(e){var f,n=!1;for(var o in s.levels)if(s.levels.hasOwnProperty(o)&&s.levels[o]===e){f=o;break}if(l())try{window.localStorage.loglevel=f}catch(d){n=!0}else n=!0;n&&t()&&(window.document.cookie="loglevel="+f+";")}function p(){var e;if(l()&&(e=window.localStorage.loglevel),e===f&&t()){var n=r.exec(window.document.cookie)||[];e=n[1]}s.levels[e]===f&&(e="WARN"),s.setLevel(s.levels[e])}var s={},y=function(){},c=["trace","debug","info","warn","error"],r=/loglevel=([^;]+)/;return s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.setLevel=function(n){if("number"==typeof n&&n>=0&&n<=s.levels.SILENT){if(u(n),n===s.levels.SILENT)return void i(function(){return y});if(typeof console===o)return i(function(e){return function(){typeof console!==o&&(s.setLevel(n),s[e].apply(s,arguments))}}),"No console available for logging";i(function(f){return n<=s.levels[f.toUpperCase()]?e(f):y})}else{if("string"!=typeof n||s.levels[n.toUpperCase()]===f)throw"log.setLevel() called with invalid level: "+n;s.setLevel(s.levels[n.toUpperCase()])}},s.enableAll=function(){s.setLevel(s.levels.TRACE)},s.disableAll=function(){s.setLevel(s.levels.SILENT)},p(),s})}()},{}],23:[function(f,n,o){(function(f){!function(d){function i(e){throw RangeError(I[e])}function t(e,f){for(var n=e.length;n--;)e[n]=f(e[n]);return e}function l(e,f){return t(e.split(H),f).join(".")}function u(e){for(var f,n,o=[],d=0,i=e.length;i>d;)f=e.charCodeAt(d++),f>=55296&&56319>=f&&i>d?(n=e.charCodeAt(d++),56320==(64512&n)?o.push(((1023&f)<<10)+(1023&n)+65536):(o.push(f),d--)):o.push(f);return o}function p(e){return t(e,function(e){var f="";return e>65535&&(e-=65536,f+=L(e>>>10&1023|55296),e=56320|1023&e),f+=L(e)}).join("")}function s(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:k}function y(e,f){return e+22+75*(26>e)-((0!=f)<<5)}function c(e,f,n){var o=0;for(e=n?K(e/B):e>>1,e+=K(e/f);e>J*z>>1;o+=k)e=K(e/J);return K(o+(J+1)*e/(e+A))}function r(e){var f,n,o,d,t,l,u,y,r,a,w=[],b=e.length,g=0,m=D,x=C;for(n=e.lastIndexOf(E),0>n&&(n=0),o=0;n>o;++o)e.charCodeAt(o)>=128&&i("not-basic"),w.push(e.charCodeAt(o));for(d=n>0?n+1:0;b>d;){for(t=g,l=1,u=k;d>=b&&i("invalid-input"),y=s(e.charCodeAt(d++)),(y>=k||y>K((v-g)/l))&&i("overflow"),g+=y*l,r=x>=u?q:u>=x+z?z:u-x,!(r>y);u+=k)a=k-r,l>K(v/a)&&i("overflow"),l*=a;f=w.length+1,x=c(g-t,f,0==t),K(g/f)>v-m&&i("overflow"),m+=K(g/f),g%=f,w.splice(g++,0,m)}return p(w)}function a(e){var f,n,o,d,t,l,p,s,r,a,w,b,g,m,x,h=[];for(e=u(e),b=e.length,f=D,n=0,t=C,l=0;b>l;++l)w=e[l],128>w&&h.push(L(w));for(o=d=h.length,d&&h.push(E);b>o;){for(p=v,l=0;b>l;++l)w=e[l],w>=f&&p>w&&(p=w);for(g=o+1,p-f>K((v-n)/g)&&i("overflow"),n+=(p-f)*g,f=p,l=0;b>l;++l)if(w=e[l],f>w&&++n>v&&i("overflow"),w==f){for(s=n,r=k;a=t>=r?q:r>=t+z?z:r-t,!(a>s);r+=k)x=s-a,m=k-a,h.push(L(y(a+x%m,0))),s=K(x/m);h.push(L(y(s,0))),t=c(n,g,o==d),n=0,++o}++n,++f}return h.join("")}function w(e){return l(e,function(e){return F.test(e)?r(e.slice(4).toLowerCase()):e})}function b(e){return l(e,function(e){return G.test(e)?"xn--"+a(e):e})}var g="object"==typeof o&&o,m="object"==typeof n&&n&&n.exports==g&&n,x="object"==typeof f&&f;(x.global===x||x.window===x)&&(d=x);var h,j,v=2147483647,k=36,q=1,z=26,A=38,B=700,C=72,D=128,E="-",F=/^xn--/,G=/[^ -~]/,H=/\x2E|\u3002|\uFF0E|\uFF61/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},J=k-q,K=Math.floor,L=String.fromCharCode;if(h={version:"1.2.4",ucs2:{decode:u,encode:p},decode:r,encode:a,toASCII:b,toUnicode:w},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return h});else if(g&&!g.nodeType)if(m)m.exports=h;else for(j in h)h.hasOwnProperty(j)&&(g[j]=h[j]);else d.punycode=h}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(e,f,n){"use strict";function o(e,f){return Object.prototype.hasOwnProperty.call(e,f)}f.exports=function(e,f,n,i){f=f||"&",n=n||"=";var t={};if("string"!=typeof e||0===e.length)return t;var l=/\+/g;e=e.split(f);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var p=e.length;u>0&&p>u&&(p=u);for(var s=0;p>s;++s){var y,c,r,a,w=e[s].replace(l,"%20"),b=w.indexOf(n);b>=0?(y=w.substr(0,b),c=w.substr(b+1)):(y=w,c=""),r=decodeURIComponent(y),a=decodeURIComponent(c),o(t,r)?d(t[r])?t[r].push(a):t[r]=[t[r],a]:t[r]=a}return t};var d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],25:[function(e,f,n){"use strict";function o(e,f){if(e.map)return e.map(f);for(var n=[],o=0;o<e.length;o++)n.push(f(e[o],o));return n}var d=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};f.exports=function(e,f,n,l){return f=f||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(t(e),function(o){var t=encodeURIComponent(d(o))+n;return i(e[o])?e[o].map(function(e){return t+encodeURIComponent(d(e))}).join(f):t+encodeURIComponent(d(e[o]))}).join(f):l?encodeURIComponent(d(l))+n+encodeURIComponent(d(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t=Object.keys||function(e){var f=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&f.push(n);return f}},{}],26:[function(e,f,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":24,"./encode":25}],27:[function(e,f,n){var o=Object.prototype.toString;f.exports=function(e){switch(o.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if("object"==typeof e&&e&&"number"==typeof e.length)try{if("function"==typeof e.callee)return"arguments"}catch(f){if(f instanceof TypeError)return"arguments"}return null===e?"null":void 0===e?"undefined":e&&1===e.nodeType?"element":e===Object(e)?"object":typeof e}},{}],28:[function(f,n,o){(function(){var f=this,d=f._,i={},t=Array.prototype,l=Object.prototype,u=Function.prototype,p=t.push,s=t.slice,y=t.concat,c=l.toString,r=l.hasOwnProperty,a=t.forEach,w=t.map,b=t.reduce,g=t.reduceRight,m=t.filter,x=t.every,h=t.some,j=t.indexOf,v=t.lastIndexOf,k=Array.isArray,q=Object.keys,z=u.bind,A=function(e){return e instanceof A?e:this instanceof A?void(this._wrapped=e):new A(e)};"undefined"!=typeof o?("undefined"!=typeof n&&n.exports&&(o=n.exports=A),o._=A):f._=A,A.VERSION="1.6.0";var B=A.each=A.forEach=function(e,f,n){if(null==e)return e;if(a&&e.forEach===a)e.forEach(f,n);else if(e.length===+e.length){for(var o=0,d=e.length;d>o;o++)if(f.call(n,e[o],o,e)===i)return}else for(var t=A.keys(e),o=0,d=t.length;d>o;o++)if(f.call(n,e[t[o]],t[o],e)===i)return;return e};A.map=A.collect=function(e,f,n){var o=[];return null==e?o:w&&e.map===w?e.map(f,n):(B(e,function(e,d,i){o.push(f.call(n,e,d,i))}),o)};var C="Reduce of empty array with no initial value";A.reduce=A.foldl=A.inject=function(e,f,n,o){var d=arguments.length>2;if(null==e&&(e=[]),b&&e.reduce===b)return o&&(f=A.bind(f,o)),d?e.reduce(f,n):e.reduce(f);if(B(e,function(e,i,t){d?n=f.call(o,n,e,i,t):(n=e,d=!0)}),!d)throw new TypeError(C);return n},A.reduceRight=A.foldr=function(e,f,n,o){var d=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return o&&(f=A.bind(f,o)),d?e.reduceRight(f,n):e.reduceRight(f);var i=e.length;if(i!==+i){var t=A.keys(e);i=t.length}if(B(e,function(l,u,p){u=t?t[--i]:--i,d?n=f.call(o,n,e[u],u,p):(n=e[u],d=!0)}),!d)throw new TypeError(C);return n},A.find=A.detect=function(e,f,n){var o;return D(e,function(e,d,i){return f.call(n,e,d,i)?(o=e,!0):void 0}),o},A.filter=A.select=function(e,f,n){var o=[];return null==e?o:m&&e.filter===m?e.filter(f,n):(B(e,function(e,d,i){f.call(n,e,d,i)&&o.push(e)}),o)},A.reject=function(e,f,n){return A.filter(e,function(e,o,d){return!f.call(n,e,o,d)},n)},A.every=A.all=function(e,f,n){f||(f=A.identity);var o=!0;return null==e?o:x&&e.every===x?e.every(f,n):(B(e,function(e,d,t){return(o=o&&f.call(n,e,d,t))?void 0:i}),!!o)};var D=A.some=A.any=function(e,f,n){f||(f=A.identity);var o=!1;return null==e?o:h&&e.some===h?e.some(f,n):(B(e,function(e,d,t){return o||(o=f.call(n,e,d,t))?i:void 0}),!!o)};A.contains=A.include=function(e,f){return null==e?!1:j&&e.indexOf===j?-1!=e.indexOf(f):D(e,function(e){return e===f})},A.invoke=function(e,f){var n=s.call(arguments,2),o=A.isFunction(f);return A.map(e,function(e){return(o?f:e[f]).apply(e,n)})},A.pluck=function(e,f){return A.map(e,A.property(f))},A.where=function(e,f){return A.filter(e,A.matches(f))},A.findWhere=function(e,f){return A.find(e,A.matches(f))},A.max=function(e,f,n){if(!f&&A.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var o=-(1/0),d=-(1/0);return B(e,function(e,i,t){var l=f?f.call(n,e,i,t):e;l>d&&(o=e,d=l)}),o},A.min=function(e,f,n){if(!f&&A.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var o=1/0,d=1/0;return B(e,function(e,i,t){var l=f?f.call(n,e,i,t):e;d>l&&(o=e,d=l)}),o},A.shuffle=function(e){var f,n=0,o=[];return B(e,function(e){f=A.random(n++),o[n-1]=o[f],o[f]=e}),o},A.sample=function(e,f,n){return null==f||n?(e.length!==+e.length&&(e=A.values(e)),e[A.random(e.length-1)]):A.shuffle(e).slice(0,Math.max(0,f))};var E=function(e){return null==e?A.identity:A.isFunction(e)?e:A.property(e)};A.sortBy=function(e,f,n){return f=E(f),A.pluck(A.map(e,function(e,o,d){return{value:e,index:o,criteria:f.call(n,e,o,d)}}).sort(function(e,f){var n=e.criteria,o=f.criteria;if(n!==o){if(n>o||void 0===n)return 1;if(o>n||void 0===o)return-1}return e.index-f.index}),"value")};var F=function(e){return function(f,n,o){var d={};return n=E(n),B(f,function(i,t){var l=n.call(o,i,t,f);e(d,l,i)}),d}};A.groupBy=F(function(e,f,n){A.has(e,f)?e[f].push(n):e[f]=[n]}),A.indexBy=F(function(e,f,n){e[f]=n}),A.countBy=F(function(e,f){A.has(e,f)?e[f]++:e[f]=1}),A.sortedIndex=function(e,f,n,o){n=E(n);for(var d=n.call(o,f),i=0,t=e.length;t>i;){var l=i+t>>>1;n.call(o,e[l])<d?i=l+1:t=l}return i},A.toArray=function(e){return e?A.isArray(e)?s.call(e):e.length===+e.length?A.map(e,A.identity):A.values(e):[]},A.size=function(e){return null==e?0:e.length===+e.length?e.length:A.keys(e).length},A.first=A.head=A.take=function(e,f,n){return null==e?void 0:null==f||n?e[0]:0>f?[]:s.call(e,0,f)},A.initial=function(e,f,n){return s.call(e,0,e.length-(null==f||n?1:f))},A.last=function(e,f,n){return null==e?void 0:null==f||n?e[e.length-1]:s.call(e,Math.max(e.length-f,0))},A.rest=A.tail=A.drop=function(e,f,n){return s.call(e,null==f||n?1:f)},A.compact=function(e){return A.filter(e,A.identity)};var G=function(e,f,n){return f&&A.every(e,A.isArray)?y.apply(n,e):(B(e,function(e){A.isArray(e)||A.isArguments(e)?f?p.apply(n,e):G(e,f,n):n.push(e)}),n)};A.flatten=function(e,f){return G(e,f,[])},A.without=function(e){return A.difference(e,s.call(arguments,1))},A.partition=function(e,f){var n=[],o=[];return B(e,function(e){(f(e)?n:o).push(e)}),[n,o]},A.uniq=A.unique=function(e,f,n,o){A.isFunction(f)&&(o=n,n=f,f=!1);var d=n?A.map(e,n,o):e,i=[],t=[];return B(d,function(n,o){(f?o&&t[t.length-1]===n:A.contains(t,n))||(t.push(n),i.push(e[o]))}),i},A.union=function(){return A.uniq(A.flatten(arguments,!0))},A.intersection=function(e){var f=s.call(arguments,1);return A.filter(A.uniq(e),function(e){return A.every(f,function(f){return A.contains(f,e)})})},A.difference=function(e){var f=y.apply(t,s.call(arguments,1));return A.filter(e,function(e){return!A.contains(f,e)})},A.zip=function(){for(var e=A.max(A.pluck(arguments,"length").concat(0)),f=new Array(e),n=0;e>n;n++)f[n]=A.pluck(arguments,""+n);return f},A.object=function(e,f){if(null==e)return{};for(var n={},o=0,d=e.length;d>o;o++)f?n[e[o]]=f[o]:n[e[o][0]]=e[o][1];return n},A.indexOf=function(e,f,n){if(null==e)return-1;var o=0,d=e.length;if(n){if("number"!=typeof n)return o=A.sortedIndex(e,f),e[o]===f?o:-1;o=0>n?Math.max(0,d+n):n}if(j&&e.indexOf===j)return e.indexOf(f,n);for(;d>o;o++)if(e[o]===f)return o;return-1},A.lastIndexOf=function(e,f,n){if(null==e)return-1;var o=null!=n;if(v&&e.lastIndexOf===v)return o?e.lastIndexOf(f,n):e.lastIndexOf(f);for(var d=o?n:e.length;d--;)if(e[d]===f)return d;return-1},A.range=function(e,f,n){arguments.length<=1&&(f=e||0,e=0),n=arguments[2]||1;for(var o=Math.max(Math.ceil((f-e)/n),0),d=0,i=new Array(o);o>d;)i[d++]=e,e+=n;return i};var H=function(){};A.bind=function(e,f){var n,o;if(z&&e.bind===z)return z.apply(e,s.call(arguments,1));if(!A.isFunction(e))throw new TypeError;return n=s.call(arguments,2),o=function(){if(!(this instanceof o))return e.apply(f,n.concat(s.call(arguments)));H.prototype=e.prototype;var d=new H;H.prototype=null;var i=e.apply(d,n.concat(s.call(arguments)));return Object(i)===i?i:d}},A.partial=function(e){var f=s.call(arguments,1);return function(){for(var n=0,o=f.slice(),d=0,i=o.length;i>d;d++)o[d]===A&&(o[d]=arguments[n++]);for(;n<arguments.length;)o.push(arguments[n++]);return e.apply(this,o)}},A.bindAll=function(e){var f=s.call(arguments,1);if(0===f.length)throw new Error("bindAll must be passed function names");return B(f,function(f){e[f]=A.bind(e[f],e)}),e},A.memoize=function(e,f){var n={};return f||(f=A.identity),function(){var o=f.apply(this,arguments);return A.has(n,o)?n[o]:n[o]=e.apply(this,arguments)}},A.delay=function(e,f){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},f)},A.defer=function(e){return A.delay.apply(A,[e,1].concat(s.call(arguments,1)))},A.throttle=function(e,f,n){var o,d,i,t=null,l=0;n||(n={});var u=function(){l=n.leading===!1?0:A.now(),t=null,i=e.apply(o,d),o=d=null};return function(){var p=A.now();l||n.leading!==!1||(l=p);var s=f-(p-l);return o=this,d=arguments,0>=s?(clearTimeout(t),t=null,l=p,i=e.apply(o,d),o=d=null):t||n.trailing===!1||(t=setTimeout(u,s)),i}},A.debounce=function(e,f,n){var o,d,i,t,l,u=function(){var p=A.now()-t;f>p?o=setTimeout(u,f-p):(o=null,n||(l=e.apply(i,d),i=d=null))};return function(){i=this,d=arguments,t=A.now();var p=n&&!o;return o||(o=setTimeout(u,f)),p&&(l=e.apply(i,d),i=d=null),l}},A.once=function(e){var f,n=!1;return function(){return n?f:(n=!0,f=e.apply(this,arguments),e=null,f)}},A.wrap=function(e,f){return A.partial(f,e)},A.compose=function(){var e=arguments;return function(){for(var f=arguments,n=e.length-1;n>=0;n--)f=[e[n].apply(this,f)];return f[0]}},A.after=function(e,f){return function(){return--e<1?f.apply(this,arguments):void 0}},A.keys=function(e){if(!A.isObject(e))return[];if(q)return q(e);var f=[];for(var n in e)A.has(e,n)&&f.push(n);return f},A.values=function(e){for(var f=A.keys(e),n=f.length,o=new Array(n),d=0;n>d;d++)o[d]=e[f[d]];return o},A.pairs=function(e){for(var f=A.keys(e),n=f.length,o=new Array(n),d=0;n>d;d++)o[d]=[f[d],e[f[d]]];return o},A.invert=function(e){for(var f={},n=A.keys(e),o=0,d=n.length;d>o;o++)f[e[n[o]]]=n[o];return f},A.functions=A.methods=function(e){var f=[];for(var n in e)A.isFunction(e[n])&&f.push(n);return f.sort()},A.extend=function(e){return B(s.call(arguments,1),function(f){if(f)for(var n in f)e[n]=f[n]}),e},A.pick=function(e){var f={},n=y.apply(t,s.call(arguments,1));return B(n,function(n){n in e&&(f[n]=e[n])}),f},A.omit=function(e){var f={},n=y.apply(t,s.call(arguments,1));for(var o in e)A.contains(n,o)||(f[o]=e[o]);return f},A.defaults=function(e){return B(s.call(arguments,1),function(f){if(f)for(var n in f)void 0===e[n]&&(e[n]=f[n])}),e},A.clone=function(e){return A.isObject(e)?A.isArray(e)?e.slice():A.extend({},e):e},A.tap=function(e,f){return f(e),e};var I=function(e,f,n,o){if(e===f)return 0!==e||1/e==1/f;if(null==e||null==f)return e===f;e instanceof A&&(e=e._wrapped),f instanceof A&&(f=f._wrapped);var d=c.call(e);if(d!=c.call(f))return!1;switch(d){case"[object String]":return e==String(f);case"[object Number]":return e!=+e?f!=+f:0==e?1/e==1/f:e==+f;case"[object Date]":case"[object Boolean]":return+e==+f;case"[object RegExp]":return e.source==f.source&&e.global==f.global&&e.multiline==f.multiline&&e.ignoreCase==f.ignoreCase}if("object"!=typeof e||"object"!=typeof f)return!1;for(var i=n.length;i--;)if(n[i]==e)return o[i]==f;var t=e.constructor,l=f.constructor;if(t!==l&&!(A.isFunction(t)&&t instanceof t&&A.isFunction(l)&&l instanceof l)&&"constructor"in e&&"constructor"in f)return!1;n.push(e),o.push(f);var u=0,p=!0;if("[object Array]"==d){if(u=e.length,p=u==f.length)for(;u--&&(p=I(e[u],f[u],n,o)););}else{for(var s in e)if(A.has(e,s)&&(u++,!(p=A.has(f,s)&&I(e[s],f[s],n,o))))break;if(p){for(s in f)if(A.has(f,s)&&!u--)break;p=!u}}return n.pop(),o.pop(),p};A.isEqual=function(e,f){return I(e,f,[],[])},A.isEmpty=function(e){if(null==e)return!0;if(A.isArray(e)||A.isString(e))return 0===e.length;for(var f in e)if(A.has(e,f))return!1;return!0},A.isElement=function(e){return!(!e||1!==e.nodeType)},A.isArray=k||function(e){return"[object Array]"==c.call(e)},A.isObject=function(e){return e===Object(e)},B(["Arguments","Function","String","Number","Date","RegExp"],function(e){A["is"+e]=function(f){return c.call(f)=="[object "+e+"]"}}),A.isArguments(arguments)||(A.isArguments=function(e){return!(!e||!A.has(e,"callee"))}),"function"!=typeof/./&&(A.isFunction=function(e){return"function"==typeof e}),A.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},A.isNaN=function(e){return A.isNumber(e)&&e!=+e},A.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},A.isNull=function(e){return null===e},A.isUndefined=function(e){return void 0===e},A.has=function(e,f){return r.call(e,f)},A.noConflict=function(){return f._=d,this},A.identity=function(e){return e},A.constant=function(e){return function(){return e}},A.property=function(e){return function(f){return f[e]}},A.matches=function(e){return function(f){if(f===e)return!0;for(var n in e)if(e[n]!==f[n])return!1;return!0}},A.times=function(e,f,n){for(var o=Array(Math.max(0,e)),d=0;e>d;d++)o[d]=f.call(n,d);return o},A.random=function(e,f){return null==f&&(f=e,e=0),e+Math.floor(Math.random()*(f-e+1))},A.now=Date.now||function(){return(new Date).getTime()};var J={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};J.unescape=A.invert(J.escape);var K={escape:new RegExp("["+A.keys(J.escape).join("")+"]","g"),unescape:new RegExp("("+A.keys(J.unescape).join("|")+")","g")};A.each(["escape","unescape"],function(e){A[e]=function(f){return null==f?"":(""+f).replace(K[e],function(f){return J[e][f]})}}),A.result=function(e,f){if(null==e)return void 0;var n=e[f];return A.isFunction(n)?n.call(e):n},A.mixin=function(e){B(A.functions(e),function(f){var n=A[f]=e[f];A.prototype[f]=function(){var e=[this._wrapped];return p.apply(e,arguments),P.call(this,n.apply(A,e))}})};var L=0;A.uniqueId=function(e){var f=++L+"";return e?e+f:f},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},O=/\\|'|\r|\n|\t|\u2028|\u2029/g;A.template=function(e,f,n){var o;n=A.defaults({},n,A.templateSettings);var d=new RegExp([(n.escape||M).source,(n.interpolate||M).source,(n.evaluate||M).source].join("|")+"|$","g"),i=0,t="__p+='";e.replace(d,function(f,n,o,d,l){return t+=e.slice(i,l).replace(O,function(e){return"\\"+N[e]}),n&&(t+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),o&&(t+="'+\n((__t=("+o+"))==null?'':__t)+\n'"),d&&(t+="';\n"+d+"\n__p+='"),i=l+f.length,f}),t+="';\n",n.variable||(t="with(obj||{}){\n"+t+"}\n"),t="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+t+"return __p;\n";try{o=new Function(n.variable||"obj","_",t)}catch(l){throw l.source=t,l}if(f)return o(f,A);var u=function(e){return o.call(this,e,A)};return u.source="function("+(n.variable||"obj")+"){\n"+t+"}",u},A.chain=function(e){return A(e).chain()};var P=function(e){return this._chain?A(e).chain():e};A.mixin(A),B(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var f=t[e];A.prototype[e]=function(){var n=this._wrapped;return f.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],P.call(this,n)}}),B(["concat","join","slice"],function(e){var f=t[e];A.prototype[e]=function(){return P.call(this,f.apply(this._wrapped,arguments))}}),A.extend(A.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof e&&e.amd&&e("underscore",[],function(){return A})}).call(this)},{}],29:[function(e,f,n){function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function d(e,f,n){if(e&&p(e)&&e instanceof o)return e;var d=new o;return d.parse(e,f,n),d}function i(e){return u(e)&&(e=d(e)),e instanceof o?e.format():o.prototype.format.call(e)}function t(e,f){return d(e,!1,!0).resolve(f)}function l(e,f){return e?d(e,!1,!0).resolveObject(f):f}function u(e){return"string"==typeof e}function p(e){return"object"==typeof e&&null!==e}function s(e){return null===e}function y(e){return null==e}var c=e("punycode");n.parse=d,n.resolve=t,n.resolveObject=l,n.format=i,n.Url=o;var r=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,w=["<",">",'"',"`"," ","\r","\n","	"],b=["{","}","|","\\","^","`"].concat(w),g=["'"].concat(b),m=["%","/","?",";","#"].concat(g),x=["/","?","#"],h=255,j=/^[a-z0-9A-Z_-]{0,63}$/,v=/^([a-z0-9A-Z_-]{0,63})(.*)$/,k={javascript:!0,"javascript:":!0},q={javascript:!0,"javascript:":!0},z={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=e("querystring");o.prototype.parse=function(e,f,n){if(!u(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e;o=o.trim();var d=r.exec(o);if(d){d=d[0];var i=d.toLowerCase();this.protocol=i,o=o.substr(d.length)}if(n||d||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var t="//"===o.substr(0,2);!t||d&&q[d]||(o=o.substr(2),this.slashes=!0)}if(!q[d]&&(t||d&&!z[d])){for(var l=-1,p=0;p<x.length;p++){var s=o.indexOf(x[p]);-1!==s&&(-1===l||l>s)&&(l=s)}var y,a;a=-1===l?o.lastIndexOf("@"):o.lastIndexOf("@",l),-1!==a&&(y=o.slice(0,a),o=o.slice(a+1),this.auth=decodeURIComponent(y)),l=-1;for(var p=0;p<m.length;p++){var s=o.indexOf(m[p]);-1!==s&&(-1===l||l>s)&&(l=s)}-1===l&&(l=o.length),this.host=o.slice(0,l),o=o.slice(l),this.parseHost(),this.hostname=this.hostname||"";var w="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!w)for(var b=this.hostname.split(/\./),p=0,B=b.length;B>p;p++){var C=b[p];if(C&&!C.match(j)){for(var D="",E=0,F=C.length;F>E;E++)D+=C.charCodeAt(E)>127?"x":C[E];if(!D.match(j)){var G=b.slice(0,p),H=b.slice(p+1),I=C.match(v);I&&(G.push(I[1]),H.unshift(I[2])),H.length&&(o="/"+H.join(".")+o),this.hostname=G.join(".");break}}}if(this.hostname.length>h?this.hostname="":this.hostname=this.hostname.toLowerCase(),!w){for(var J=this.hostname.split("."),K=[],p=0;p<J.length;++p){var L=J[p];K.push(L.match(/[^A-Za-z0-9_-]/)?"xn--"+c.encode(L):L)}this.hostname=K.join(".")}var M=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+M,this.href+=this.host,w&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!k[i])for(var p=0,B=g.length;B>p;p++){var O=g[p],P=encodeURIComponent(O);P===O&&(P=escape(O)),o=o.split(O).join(P)}var Q=o.indexOf("#");-1!==Q&&(this.hash=o.substr(Q),o=o.slice(0,Q));var R=o.indexOf("?");if(-1!==R?(this.search=o.substr(R),this.query=o.substr(R+1),f&&(this.query=A.parse(this.query)),o=o.slice(0,R)):f&&(this.search="",this.query={}),o&&(this.pathname=o),z[i]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var M=this.pathname||"",L=this.search||"";this.path=M+L}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var f=this.protocol||"",n=this.pathname||"",o=this.hash||"",d=!1,i="";this.host?d=e+this.host:this.hostname&&(d=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(d+=":"+this.port)),this.query&&p(this.query)&&Object.keys(this.query).length&&(i=A.stringify(this.query));var t=this.search||i&&"?"+i||"";return f&&":"!==f.substr(-1)&&(f+=":"),this.slashes||(!f||z[f])&&d!==!1?(d="//"+(d||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):d||(d=""),o&&"#"!==o.charAt(0)&&(o="#"+o),t&&"?"!==t.charAt(0)&&(t="?"+t),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),t=t.replace("#","%23"),f+d+n+t+o},o.prototype.resolve=function(e){return this.resolveObject(d(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(u(e)){var f=new o;f.parse(e,!1,!0),e=f}var n=new o;if(Object.keys(this).forEach(function(e){n[e]=this[e]},this),n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(f){"protocol"!==f&&(n[f]=e[f])}),z[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n;if(e.protocol&&e.protocol!==n.protocol){if(!z[e.protocol])return Object.keys(e).forEach(function(f){n[f]=e[f]}),n.href=n.format(),n;if(n.protocol=e.protocol,e.host||q[e.protocol])n.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var i=n.pathname||"",t=n.search||"";n.path=i+t}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var l=n.pathname&&"/"===n.pathname.charAt(0),p=e.host||e.pathname&&"/"===e.pathname.charAt(0),c=p||l||n.host&&e.pathname,r=c,a=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],w=n.protocol&&!z[n.protocol];if(w&&(n.hostname="",n.port=null,n.host&&(""===a[0]?a[0]=n.host:a.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),c=c&&(""===d[0]||""===a[0])),p)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,a=d;else if(d.length)a||(a=[]),a.pop(),a=a.concat(d),n.search=e.search,n.query=e.query;else if(!y(e.search)){if(w){n.hostname=n.host=a.shift();var b=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;b&&(n.auth=b.shift(),n.host=n.hostname=b.shift())}return n.search=e.search,n.query=e.query,s(n.pathname)&&s(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!a.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var g=a.slice(-1)[0],m=(n.host||e.host)&&("."===g||".."===g)||""===g,x=0,h=a.length;h>=0;h--)g=a[h],"."==g?a.splice(h,1):".."===g?(a.splice(h,1),x++):x&&(a.splice(h,1),x--);if(!c&&!r)for(;x--;x)a.unshift("..");!c||""===a[0]||a[0]&&"/"===a[0].charAt(0)||a.unshift(""),m&&"/"!==a.join("/").substr(-1)&&a.push("");var j=""===a[0]||a[0]&&"/"===a[0].charAt(0);if(w){n.hostname=n.host=j?"":a.length?a.shift():"";var b=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;b&&(n.auth=b.shift(),n.host=n.hostname=b.shift())}return c=c||n.host&&a.length,c&&!j&&a.unshift(""),a.length?n.pathname=a.join("/"):(n.pathname=null,n.path=null),s(n.pathname)&&s(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,f=a.exec(e);f&&(f=f[0],":"!==f&&(this.port=f.substr(1)),e=e.substr(0,e.length-f.length)),e&&(this.hostname=e)}},{punycode:23,querystring:26}],30:[function(e,f,n){f.exports=e(5)},{}],31:[function(e,f,n){f.exports=e(6)},{}],32:[function(e,f,n){f.exports=e(7)},{"./support/isBuffer":31,FWaASH:8,inherits:30}],33:[function(e,f,n){var o=e("./modules/constants"),d=e("./modules/events"),i=e("./modules/logger"),t=e("./modules/ajax"),d=e("./modules/events"),l=e("./modules/waitForCloud"),u=e("./modules/api_act"),p=e("./modules/api_auth"),s=e("./modules/api_sec"),y=e("./modules/api_hash"),c=e("./modules/api_mbaas"),r=e("./modules/api_cloud"),a=e("./modules/api_push"),w=e("./modules/fhparams"),b=e("./modules/appProps"),g=e("./modules/device"),m=e("./modules/sync_cloud_handler"),x=function(e,f){d.addListener(e,f),e===o.INIT_EVENT&&(l.isReady()?f(null,{host:l.getCloudHostUrl()}):l.getInitError()&&f(l.getInitError()))},h=function(e,f){e===o.INIT_EVENT&&l.isReady()?f(null,{host:l.getCloudHostUrl()}):e===o.INIT_EVENT&&l.getInitError()?f(l.getInitError()):d.once(e,f)},j=function(e,f,n){i.warn("$fh.init will be deprecated soon"),l.ready(function(e,o){if(e){if("function"==typeof n)return n(e)}else"function"==typeof f&&f(o.host)})},v=window.$fh||{};v.init=j,v.act=u,v.auth=p,v.cloud=r,v.sec=s,v.hash=y,v.push=a,v.ajax=v.__ajax=t,v.mbaas=c,v.sync=e("fh-sync-js"),v.sync.setCloudHandler(m),v._getDeviceId=g.getDeviceId,v.fh_timeout=6e4,v.getCloudURL=function(){return l.getCloudHostUrl()},v.getFHParams=function(){return w.buildFHParams()},v.getFHHeaders=function(){return w.getFHHeaders()},v.addListener=x,v.on=x,v.once=h;for(var k=["removeListener","removeAllListeners","setMaxListeners","listeners","emit"],q=0;q<k.length;q++)v[k[q]]=d[k[q]];v.on(o.INIT_EVENT,function(e,f){e?(v.cloud_props={},v.app_props={}):(v.cloud_props={hosts:{url:f.host}},v.app_props=b.getAppProps())}),v.on(o.INTERNAL_CONFIG_LOADED_EVENT,function(e,f){e?v.app_props={}:v.app_props=b.getAppProps(),d.emit(o.CONFIG_LOADED_EVENT,null)}),v.reset=l.reset,window.$fh=v,f.exports=v},{"./modules/ajax":35,"./modules/api_act":36,"./modules/api_auth":37,"./modules/api_cloud":38,"./modules/api_hash":39,"./modules/api_mbaas":40,"./modules/api_push":41,"./modules/api_sec":42,"./modules/appProps":43,"./modules/constants":45,"./modules/device":48,"./modules/events":49,"./modules/fhparams":50,"./modules/logger":56,"./modules/sync_cloud_handler":64,"./modules/waitForCloud":66,"fh-sync-js":20}],34:[function(e,f,n){var o=e("url"),d=function(e){this.xdr=e,this.isWrapper=!0,this.readyState=0,this.onreadystatechange=null,this.status=0,this.statusText="",this.responseText="",this.headers={};var f=this;this.xdr.onload=function(){f.readyState=4,f.status=200,f.statusText="",f.responseText=f.xdr.responseText,f.onreadystatechange&&f.onreadystatechange()},this.xdr.onerror=function(){f.onerror&&f.onerror(),f.readyState=4,f.status=0,f.statusText="",f.onreadystatechange&&f.onreadystatechange()},this.xdr.ontimeout=function(){f.readyState=4,f.status=408,f.statusText="timeout",f.onreadystatechange&&f.onreadystatechange()}};d.prototype.open=function(e,f,n){var d=o.parse(f,!0);d.query=d.query||{},d.query.fh_headers=this.headers,this.xdr.open(e,o.format(d))},d.prototype.send=function(e){this.xdr.send(e)},d.prototype.abort=function(){this.xdr.abort()},d.prototype.setRequestHeader=function(e,f){this.headers[e]=f},d.prototype.getResponseHeader=function(e){},f.exports=d},{url:29}],35:[function(e,f,n){function o(e,f,n){return j.emit(f,n),!0}function d(e,f,n,d){return e.global?o(f||D,n,d):void 0}function i(e){e.global&&0===J.active++&&d(e,null,"ajaxStart")}function t(e){e.global&&!--J.active&&d(e,null,"ajaxStop")}function l(e,f){var n=f.context;return f.beforeSend.call(n,e,f)===!1?!1:void d(f,n,"ajaxSend",[e,f]);
}function u(e,f,n){var o=n.context,i="success";n.success.call(o,e,i,f),d(n,o,"ajaxSuccess",[f,n,e]),s(i,f,n)}function p(e,f,n,o){var i=o.context;o.error.call(i,n,f,e),d(o,i,"ajaxError",[n,o,e]),s(f,n,o)}function s(e,f,n){var o=n.context;n.complete.call(o,f,e),d(n,o,"ajaxComplete",[f,n]),t(n)}function y(){}function c(){var e=!1;return navigator.userAgent&&navigator.userAgent.indexOf("MSIE")>=0&&(e=!0),e}function r(e){var f=null;return window.XMLHttpRequest&&(f=new XMLHttpRequest),c()&&e===!0&&"undefined"!=typeof window.XDomainRequest&&"undefined"==typeof window.cordova&&(f=new v(new XDomainRequest)),f}function a(e){return e&&(e==H?"html":e==G?"json":E.test(e)?"script":F.test(e)&&"xml")||"text"}function w(e,f){return(e+"&"+f).replace(/[&?]{1,2}/,"?")}function b(e){"object"===h(e.data)&&("function"==typeof e.data.append?e.formdata=!0:e.data=m(e.data)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=w(e.url,e.data))}function g(e,f,n,o){var d="array"===h(f);for(var i in f){var t=f[i];o&&(i=n?o:o+"["+(d?"":i)+"]"),!o&&d?e.add(t.name,t.value):(n?"array"===h(t):"object"===h(t))?g(e,t,n,i):e.add(i,t)}}function m(e,f){var n=[];return n.add=function(e,f){this.push(K(e)+"="+K(f))},g(n,e,f),n.join("&").replace("%20","+")}function x(e){var f=Array.prototype.slice;return f.call(arguments,1).forEach(function(f){for(A in f)void 0!==f[A]&&(e[A]=f[A])}),e}var h,j=e("./events"),v=e("./XDomainRequestWrapper"),k=e("./logger");try{h=e("type-of")}catch(q){var z=e;h=z("type")}var A,B,C=0,D=window.document,E=/^(?:text|application)\/javascript/i,F=/^(?:text|application)\/xml/i,G="application/json",H="text/html",I=/^\s*$/,J=f.exports=function(f){var n=x({},f||{});window&&window.$fh&&"number"==typeof window.$fh.fh_timeout&&(J.settings.timeout=window.$fh.fh_timeout);for(A in J.settings)void 0===n[A]&&(n[A]=J.settings[A]);i(n),n.crossDomain||(n.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(n.url)&&(RegExp.$1!=window.location.protocol||RegExp.$2!=window.location.host));var o=n.dataType,d=/=\?/.test(n.url);if("jsonp"==o||d)return d||(n.url=w(n.url,(n.jsonp?n.jsonp:"_callback")+"=?")),J.JSONP(n);n.url||(n.url=window.location.toString()),b(n);var t=n.accepts[o],s={},c=/^([\w-]+:)\/\//.test(n.url)?RegExp.$1:window.location.protocol,r=n.xhr(n.crossDomain),g=null;n.crossDomain||(s["X-Requested-With"]="XMLHttpRequest"),t&&(s.Accept=t,t.indexOf(",")>-1&&(t=t.split(",",2)[0]),r.overrideMimeType&&r.overrideMimeType(t)),(n.contentType||n.data&&!n.formdata&&"GET"!=n.type.toUpperCase())&&(s["Content-Type"]=n.contentType||"application/x-www-form-urlencoded"),n.headers=x(s,n.headers||{}),r.onreadystatechange=function(){if(4==r.readyState){clearTimeout(g),g=void 0;var f,d=!1;if(n.tryJSONP&&0===r.status&&n.crossDomain&&!r.isTimeout&&"file:"!=c)return k.debug("retry ajax call with jsonp"),n.type="GET",n.dataType="jsonp",n.data?n.data="_jsonpdata="+JSON.stringify(e("./fhparams").addFHParams(JSON.parse(n.data))):n.data="_jsonpdata="+n.data,J(n);if(r.status>=200&&r.status<300||304==r.status||0==r.status&&"file:"==c){o=o||a(r.getResponseHeader("content-type")),f=r.responseText,k.debug("ajax response :: status = "+r.status+" :: body = "+f);try{"script"==o?(1,eval)(f):"xml"==o?f=r.responseXML:"json"==o&&(f=I.test(f)?null:JSON.parse(f))}catch(i){d=i}d?(k.debug("ajax error",d),p(d,"parsererror",r,n)):u(f,r,n)}else p(null,"error",r,n)}};var m="async"in n?n.async:!0;k.debug("ajax call settings",n),r.open(n.type,n.url,m);for(B in n.headers)r.setRequestHeader(B,n.headers[B]);return l(r,n)===!1?(k.debug("ajax call is aborted due to ajaxBeforeSend"),r.abort(),!1):(n.timeout>0&&(g=setTimeout(function(){k.debug("ajax call timed out"),r.onreadystatechange=y,r.abort(),r.isTimeout=!0,p(null,"timeout",r,n)},n.timeout)),r.send(n.data?n.data:null),r)};J.active=0,J.JSONP=function(e){if(!("type"in e))return J(e);var f,n="jsonp"+ ++C,o=D.createElement("script"),d=function(){n in window&&(window[n]=y),s("abort",i,e)},i={abort:d},t=D.getElementsByTagName("head")[0]||D.documentElement;return e.error&&(o.onerror=function(){i.abort(),e.error()}),window[n]=function(o){clearTimeout(f),f=void 0,delete window[n],u(o,i,e)},b(e),o.src=e.url.replace(/=\?/,"="+n),t.insertBefore(o,t.firstChild),e.timeout>0&&(f=setTimeout(function(){i.abort(),s("timeout",i,e)},e.timeout)),i},J.settings={type:"GET",beforeSend:y,success:y,error:y,complete:y,context:null,global:!0,xhr:r,accepts:{script:"text/javascript, application/javascript",json:G,xml:"application/xml, text/xml",html:H,text:"text/plain"},crossDomain:!1},J.get=function(e,f){return J({url:e,success:f})},J.post=function(e,f,n,o){return"function"===h(f)&&(o=o||n,n=f,f=null),J({type:"POST",url:e,data:f,success:n,dataType:o})},J.getJSON=function(e,f){return J({url:e,success:f,dataType:"json"})};var K=encodeURIComponent},{"./XDomainRequestWrapper":34,"./events":49,"./fhparams":50,"./logger":56,"type-of":27}],36:[function(e,f,n){function o(e,f,n){var o=i.getCloudHost(),d=o.getActUrl(e.act),y=e.req||{},c=t.getFHHeaders();return e.headers&&(c=s.extend(c,e.headers)),l({url:d,tryJSONP:!0,type:"POST",dataType:"json",data:JSON.stringify(y),headers:c,contentType:"application/json",timeout:e.timeout||p.timeout,success:f,error:function(e,f,o){return u(n,e,f,o)}})}var d=e("./logger"),i=e("./waitForCloud"),t=e("./fhparams"),l=e("./ajax"),u=e("./handleError"),p=e("./appProps"),s=e("underscore");f.exports=function(e,f,n){return d.debug("act is called"),n||(n=function(e,f){d.debug(e+":"+JSON.stringify(f))}),e.act?void i.ready(function(i,t){return d.debug("Calling fhact now"),i?n(i.message,i):void o(e,f,n)}):n("act_no_action",{})}},{"./ajax":35,"./appProps":43,"./fhparams":50,"./handleError":51,"./logger":56,"./waitForCloud":66,underscore:28}],37:[function(e,f,n){function o(e,f,n,o,u){var p=c.getAppProps(),y=p.host+s.boxprefix+"admin/authpolicy/"+e;p.local&&(y=i.getCloudHostUrl()+s.boxprefix+"admin/authpolicy/"+e),l({url:y,type:"POST",tryJSONP:!0,data:JSON.stringify(f),dataType:"json",contentType:"application/json",timeout:n.timeout||p.timeout,headers:t.getFHHeaders(),success:function(e){return o?o(e):void 0},error:function(f,n,o){d.error("got error when calling "+e,f.responseText||f,o),u&&u(f,n,o)}})}var d=e("./logger"),i=e("./waitForCloud"),t=e("./fhparams"),l=e("./ajax"),u=e("./handleError"),p=e("./device"),s=e("./constants"),y=e("./checkAuth"),c=e("./appProps"),r=e("./data"),a=function(e,f,n){return n||(n=function(e,f){d.debug(e+":"+JSON.stringify(f))}),e.policyId?e.clientToken?void i.ready(function(d,l){if(d)return n(d.message,d);var s={};s.policyId=e.policyId,s.clientToken=e.clientToken;var y=i.getCloudHost();y.getEnv()&&(s.environment=y.getEnv()),e.endRedirectUrl&&(s.endRedirectUrl=e.endRedirectUrl,e.authCallback&&(s.endRedirectUrl+=(/\?/.test(s.endRedirectUrl)?"&":"?")+"_fhAuthCallback="+e.authCallback)),s.params={},e.params&&(s.params=e.params);var c=e.endRedirectUrl||"status=complete";s.device=p.getDeviceId(),s=t.addFHParams(s),o("auth",s,e,function(e){a.authenticateHandler(c,e,f,n)},function(e,f,o){u(n,e,f,o)})}):n("auth_no_clientToken",{}):n("auth_no_policyId",{})};a.hasSession=function(e){r.sessionManager.exists(e)},a.clearSession=function(e){r.sessionManager.read(function(f,n){return f?e(f):(n&&o("revokesession",n,{}),r.sessionManager.remove(e),void t.setAuthSessionToken(void 0))})},a.authenticateHandler=y.handleAuthResponse,a.verify=function(e){r.sessionManager.read(function(f,n){return f?e(f):n?void o("verifysession",n,{},function(f){return e(null,f.isValid)},function(f,n,o){return e("network_error")}):e("no_session")})},f.exports=a},{"./ajax":35,"./appProps":43,"./checkAuth":44,"./constants":45,"./data":47,"./device":48,"./fhparams":50,"./handleError":51,"./logger":56,"./waitForCloud":66}],38:[function(e,f,n){function o(e,f,n){var o,d=i.getCloudHost(),y=d.getCloudUrl(e.path),c=e.data||{},r=e.method||"POST";o=-1!==["POST","PUT","PATCH","DELETE"].indexOf(r.toUpperCase())?JSON.stringify(c):c;var a=t.getFHHeaders();return e.headers&&(a=s.extend(a,e.headers)),l({url:y,type:r,dataType:e.dataType||"json",data:o,contentType:e.contentType||"application/json",timeout:e.timeout||p.timeout,headers:a,success:f,error:function(e,f,o){return u(n,e,f,o)}})}var d=e("./logger"),i=e("./waitForCloud"),t=e("./fhparams"),l=e("./ajax"),u=e("./handleError"),p=e("./appProps"),s=e("underscore");f.exports=function(e,f,n){d.debug("cloud is called"),n||(n=function(e,f){d.debug(e+":"+JSON.stringify(f))}),i.ready(function(i,t){return d.debug("Calling fhact now"),i?n(i.message,i):void o(e,f,n)})}},{"./ajax":35,"./appProps":43,"./fhparams":50,"./handleError":51,"./logger":56,"./waitForCloud":66,underscore:28}],39:[function(e,f,n){var o=e("./security/hash");f.exports=function(e,f,n){var d={};"undefined"==typeof e.algorithm&&(e.algorithm="MD5"),d.act="hash",d.params=e,o(d,f,n)}},{"./security/hash":62}],40:[function(e,f,n){var o=e("./logger"),d=e("./waitForCloud"),i=e("./fhparams"),t=e("./ajax"),l=e("./handleError"),u=(e("./constants"),e("./appProps"));f.exports=function(e,f,n){o.debug("mbaas is called."),n||(n=function(e,f){console.debug(e+":"+JSON.stringify(f))});var p=e.service,s=e.params;d.ready(function(y,c){if(o.debug("Calling mbaas now"),y)return n(y.message,y);var r=d.getCloudHost(),a=r.getMBAASUrl(p);return s=i.addFHParams(s),t({url:a,tryJSONP:!0,type:"POST",dataType:"json",data:JSON.stringify(s),headers:i.getFHHeaders(),contentType:"application/json",timeout:e.timeout||u.timeout,success:f,error:function(e,f,o){return l(n,e,f,o)}})})}},{"./ajax":35,"./appProps":43,"./constants":45,"./fhparams":50,"./handleError":51,"./logger":56,"./waitForCloud":66}],41:[function(e,f,n){var o=e("./logger"),d=e("./appProps"),i=e("./waitForCloud");f.exports=function(e,f,n,t){n||(n=function(e,f){o.debug(e+":"+JSON.stringify(f))}),i.ready(function(i,l){if(o.debug("push is called"),i)return n(i.message,i);if(window.push){var u=d.getAppProps();if(u.pushServerURL=u.host+"/api/v2/ag-push",t)for(var p in t)u[p]=t[p];window.push.register(e,f,n,u)}else n("push plugin not installed")})}},{"./appProps":43,"./logger":56,"./waitForCloud":66}],42:[function(e,f,n){var o=e("./security/aes-keygen"),d=e("./security/aes-node"),i=e("./security/rsa-node"),t=e("./security/hash");f.exports=function(e,f,n){return e.act?e.params?e.params.algorithm?(e.params.algorithm=e.params.algorithm.toLowerCase(),"hash"===e.act?t(e,f,n):"encrypt"===e.act?"aes"===e.params.algorithm?d.encrypt(e,f,n):"rsa"===e.params.algorithm?i.encrypt(e,f,n):n("encrypt_bad_algorithm:"+e.params.algorithm,{},e):"decrypt"===e.act?"aes"===e.params.algorithm?d.decrypt(e,f,n):n("decrypt_bad_algorithm:"+e.params.algorithm,{},e):"keygen"===e.act?"aes"===e.params.algorithm?o(e,f,n):n("keygen_bad_algorithm:"+e.params.algorithm,{},e):void 0):void n("no_params_algorithm",{},e):void n("no_params",{},e):void n("bad_act",{},e)}},{"./security/aes-keygen":60,"./security/aes-node":61,"./security/hash":62,"./security/rsa-node":63}],43:[function(e,f,n){var o=e("./constants"),d=e("./ajax"),i=e("./logger"),t=e("./queryMap"),l=e("underscore"),u=null,p=function(e){function f(f){l.extend(u,f,s),"undefined"!=typeof p.url&&(u.host=p.url),u.local=!!(s.host||p.url||f.local&&f.host),e(null,u)}var n=document.location.href,p=t(n.replace(/#.*?$/g,"")),s={};for(var y in p)p.hasOwnProperty(y)&&0===y.indexOf("fh_")&&(s[y.substr(3)]=decodeURI(p[y]));u={appid:"000000000000000000000000",appkey:"0000000000000000000000000000000000000000",projectid:"000000000000000000000000",connectiontag:"0.0.1"};var c=p.fhconfig||o.config_js;d({url:c,dataType:"json",success:function(n){return i.debug("fhconfig = "+JSON.stringify(n)),null==n?window.fh_app_props?f(window.fh_app_props):e(new Error("app_config_missing")):void f(n)},error:function(n,d,t){return window.fh_app_props?f(window.fh_app_props):(i.error(o.config_js+" Not Found"),void e(new Error("app_config_missing")))}})},s=function(e){u=e},y=function(){return u};f.exports={load:p,getAppProps:y,setAppProps:s}},{"./ajax":35,"./constants":45,"./logger":56,"./queryMap":58,underscore:28}],44:[function(e,f,n){var o=e("./logger"),d=e("./queryMap"),i=e("./fhparams"),t=e("./data"),l=function(e){if(/\_fhAuthCallback/.test(e)){var f=d(e);if(f){var n=f._fhAuthCallback;if(n)if(f.result&&"success"===f.result){var o={sessionToken:f.fh_auth_session,authResponse:JSON.parse(decodeURIComponent(decodeURIComponent(f.authResponse)))};i.setAuthSessionToken(f.fh_auth_session),t.sessionManager.save(f.fh_auth_session),window[n](null,o)}else window[n]({message:f.message})}}},u=function(e,f,n,l){if(f.status&&"ok"===f.status){var u=function(e){return e.sessionToken?(i.setAuthSessionToken(e.sessionToken),void t.sessionManager.save(e.sessionToken,function(){return n(e)})):n(e)};if(f.url){var p=null,s=function(f){if(f.indexOf(e)>-1){p&&p.close();var n=d(f);if(n)if(n.result&&"success"===n.result){var o={sessionToken:n.fh_auth_session,authResponse:JSON.parse(decodeURIComponent(decodeURIComponent(n.authResponse)))};u(o)}else l&&l("auth_failed",{message:n.message});else l&&l("auth_failed",{message:n.message})}};if(window.PhoneGap||window.cordova)if(window.plugins&&window.plugins.childBrowser)"function"==typeof window.plugins.childBrowser.showWebPage&&(window.plugins.childBrowser.onLocationChange=s,window.plugins.childBrowser.showWebPage(f.url),p=window.plugins.childBrowser);else try{p=window.open(f.url,"_blank","location=yes"),p.addEventListener("loadstart",function(e){s(e.url)})}catch(y){o.info("InAppBrowser plugin is not intalled."),u(f)}else document.location.href=f.url}else u(f)}else l&&l("auth_failed",f)};window.addEventListener?window.addEventListener("load",function(){l(window.location.href)},!1):window.attachEvent&&window.attachEvent("onload",function(){l(window.location.href)}),f.exports={handleAuthResponse:u}},{"./data":47,"./fhparams":50,"./logger":56,"./queryMap":58}],45:[function(e,f,n){f.exports={boxprefix:"/box/srv/1.1/",sdk_version:"3.0.2",config_js:"fhconfig.json",INIT_EVENT:"fhinit",INTERNAL_CONFIG_LOADED_EVENT:"internalfhconfigloaded",CONFIG_LOADED_EVENT:"fhconfigloaded",SESSION_TOKEN_STORAGE_NAME:"fh_session_token",SESSION_TOKEN_KEY_NAME:"sessionToken"}},{}],46:[function(e,f,n){f.exports={readCookieValue:function(e){for(var f=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var d=n[o];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(f))return d.substring(f.length,d.length)}return null},createCookie:function(e,f){var n=new Date;n.setTime(n.getTime()+31536e8);var o="; expires="+n.toGMTString();document.cookie=e+"="+f+o+"; path = /"}}},{}],47:[function(e,f,n){var o=e("../../libs/generated/lawnchair"),d=e("./lawnchair-ext"),i=e("./logger"),t=e("./constants"),l={DEFAULT_ADAPTERS:["dom","webkit-sqlite","window-name"],getStorage:function(e,f,n){var d=l.DEFAULT_ADAPTERS,t=n||function(){};f&&f.length>0&&(d="string"==typeof f?[f]:f);var u={name:e,adapter:d,fail:function(e,f){var n="read/save from/to local storage failed  msg:"+e+" err:"+f;i.error(n,f),t(n,{})}},p=o(u,function(){});return p},addFileStorageAdapter:function(e,f){o.adapter("localFileStorage",d.fileStorageAdapter(e,f))},sessionManager:{read:function(e){l.getStorage(t.SESSION_TOKEN_STORAGE_NAME).get(t.SESSION_TOKEN_KEY_NAME,function(f){return e?e(null,f):void 0})},exists:function(e){l.getStorage(t.SESSION_TOKEN_STORAGE_NAME).exists(t.SESSION_TOKEN_KEY_NAME,function(f){return e?e(null,f):void 0})},remove:function(e){l.getStorage(t.SESSION_TOKEN_STORAGE_NAME).remove(t.SESSION_TOKEN_KEY_NAME,function(){return e?e():void 0})},save:function(e,f){l.getStorage(t.SESSION_TOKEN_STORAGE_NAME).save({key:t.SESSION_TOKEN_KEY_NAME,sessionToken:e},function(e){return f?f():void 0})}}};f.exports=l},{"../../libs/generated/lawnchair":2,"./constants":45,"./lawnchair-ext":54,"./logger":56}],48:[function(e,f,n){var o=e("./cookies"),d=e("./uuid"),i=e("./logger");f.exports={getDeviceId:function(){if("undefined"!=typeof window.fhdevice&&"undefined"!=typeof window.fhdevice.uuid)return window.fhdevice.uuid;if("undefined"!=typeof window.device&&"undefined"!=typeof window.device.uuid)return window.device.uuid;if("undefined"!=typeof navigator.device&&"undefined"!=typeof navigator.device.uuid)return navigator.device.uuid;var e="mock_uuid",f=o.readCookieValue(e);return f||(f=d.createUUID(),o.createCookie(e,f)),f},getCuidMap:function(){return"undefined"!=typeof window.fhdevice&&"undefined"!=typeof window.fhdevice.cuidMap?window.fhdevice.cuidMap:"undefined"!=typeof window.device&&"undefined"!=typeof window.device.cuidMap?window.device.cuidMap:"undefined"!=typeof navigator.device&&"undefined"!=typeof navigator.device.cuidMap?navigator.device.cuidMap:null},getDestination:function(){var f=null,n=e("./platformsMap"),o=navigator.userAgent,d=document.location.search.split("fh_destination_code=");return d.length>1?f=d[1]:"undefined"!=typeof window.fh_destination_code?f=window.fh_destination_code:n.forEach(function(e){e.test.forEach(function(n){o.indexOf(n)>-1&&(f=e.destination)})}),null==f&&(f="web"),i.debug("destination = "+f),f}}},{"./cookies":46,"./logger":56,"./platformsMap":57,"./uuid":65}],49:[function(e,f,n){var o=e("events").EventEmitter,d=new o;d.setMaxListeners(0),f.exports=d},{events:10}],50:[function(e,f,n){var o=e("./device"),d=e("./sdkversion"),i=e("./appProps"),t=e("./logger"),l=null,u=null,p=function(){if(l)return l;var e={};e.cuid=o.getDeviceId(),e.cuidMap=o.getCuidMap(),e.destination=o.getDestination(),(window.device||navigator.device)&&(e.device=window.device||navigator.device),"undefined"!=typeof window.fh_app_version&&(e.app_version=fh_app_version),"undefined"!=typeof window.fh_project_version&&(e.project_version=fh_project_version),"undefined"!=typeof window.fh_project_app_version&&(e.project_app_version=fh_project_app_version),e.sdk_version=d(),u&&(e.sessionToken=u);var f=i.getAppProps();return f&&(e.appid=f.appid,e.appkey=f.appkey,e.projectid=f.projectid,e.analyticsTag=f.analyticsTag,e.connectiontag=f.connectiontag,f.init&&(e.init="string"==typeof f.init?JSON.parse(f.init):f.init)),l=e,t.debug("fhparams = ",l),e},s=function(e){var f=e||{};return f.__fh=p(),f},y=function(){var e={},f=p();for(var n in f)f.hasOwnProperty(n)&&(e["X-FH-"+n]=f[n]);return e},c=function(e){u=e,l=null};f.exports={buildFHParams:p,addFHParams:s,setAuthSessionToken:c,getFHHeaders:y}},{"./appProps":43,"./device":48,"./logger":56,"./sdkversion":59}],51:[function(e,f,n){f.exports=function(e,f,n,o){var d,i=0;if(f)try{i=f.status;var t=JSON.parse(f.responseText);d=t.error||t.msg||t,d instanceof Array&&(d=d.join("\n"))}catch(l){d=f.responseText}e&&e(d,{status:i,message:n,error:o})}},{}],52:[function(e,f,n){function o(e){var f=e;return"/"===f.charAt(f.length-1)&&(f=f.substring(0,f.length-1)),f}function d(e){var f=e;return f.length>1&&"/"===f.charAt(0)&&(f=f.substring(1,f.length)),f}function i(e){this.cloud_props=e,this.cloud_host=void 0,this.app_env=null,this.isLegacy=!1}var t=e("./constants"),l=e("./appProps");i.prototype.getHost=function(e){if(this.cloud_host)return this.cloud_host;var f,n;if(this.cloud_props&&this.cloud_props.hosts&&(f=this.cloud_props.hosts.url,"undefined"==typeof f)){var d=this.cloud_props.hosts.releaseCloudUrl;n=this.cloud_props.hosts.releaseCloudType,"undefined"!=typeof e&&e.indexOf("dev")>-1&&(d=this.cloud_props.hosts.debugCloudUrl,n=this.cloud_props.hosts.debugCloudType),f=d}return f=o(f),this.cloud_host=f,"fh"===n&&(this.isLegacy=!0),f},i.prototype.getActUrl=function(e){var f=l.getAppProps()||{};return"undefined"==typeof this.cloud_host&&this.getHost(f.mode),this.isLegacy?this.cloud_host+t.boxprefix+"act/"+this.cloud_props.domain+"/"+f.appid+"/"+e+"/"+f.appid:this.cloud_host+"/cloud/"+e},i.prototype.getMBAASUrl=function(e){var f=l.getAppProps()||{};return"undefined"==typeof this.cloud_host&&this.getHost(f.mode),this.cloud_host+"/mbaas/"+e},i.prototype.getCloudUrl=function(e){var f=l.getAppProps()||{};return"undefined"==typeof this.cloud_host&&this.getHost(f.mode),this.cloud_host+"/"+d(e)},i.prototype.getEnv=function(){return this.app_env?this.app_env:(this.cloud_props&&this.cloud_props.hosts&&(this.app_env=this.cloud_props.hosts.environment),this.app_env)},f.exports=i},{"./appProps":43,"./constants":45}],53:[function(e,f,n){var o=(e("./loadScript"),e("./constants")),d=e("./fhparams"),i=e("./ajax"),t=e("./handleError"),l=e("./logger"),u=e("./security/hash"),p=e("./appProps"),s=e("./constants"),y=e("./events"),c=e("./data"),r=function(e){p.load(function(f,n){return f?e(f):(y.emit(s.INTERNAL_CONFIG_LOADED_EVENT,null,n),a(n,e))})},a=function(e,f){if(e.loglevel&&l.setLevel(e.loglevel),e.local){var n={domain:"local",firstTime:!1,hosts:{debugCloudType:"node",debugCloudUrl:e.host,releaseCloudType:"node",releaseCloudUrl:e.host,type:"cloud_nodejs",url:e.host},init:{trackId:"000000000000000000000000"},status:"ok"};return f(null,{cloud:n})}c.addFileStorageAdapter(e,u);var p=function(e,n,o,u){var p=d.buildFHParams();i({url:e,type:"POST",tryJSONP:!0,dataType:"json",contentType:"application/json",data:JSON.stringify(p),timeout:n.timeout,success:function(e){u&&u.save({key:"fh_init",value:e},function(){}),f&&f(null,{cloud:e})},error:function(e,n,d){var i="unknown";e&&(i=e.status+" - "+e.responseText),l.error("App init returned error : "+i),!o||e&&400===e.status?(e&&400===e.status?l.error(e.responseText):l.error("No cached host found. Init failed."),t(function(e,n){f&&f({error:n,message:e})},e,n,d)):(l.info("Using cached host: "+JSON.stringify(o)),f&&f(null,{cloud:o}))}})},s=null,y=e.host+o.boxprefix+"app/init";try{s=c.getStorage("fh_init_storage",null),s.get("fh_init",function(f){var n=null;f&&null!==f.value&&"undefined"!=typeof f.value&&""!==f&&(f="string"==typeof f?JSON.parse(f):f,f.value="string"==typeof f.value?JSON.parse(f.value):f.value,f.value.init?e.init=f.value.init:e.init="string"==typeof f.value?JSON.parse(f.value):f.value,f.value.hosts&&(n=f.value)),p(y,e,n,s)})}catch(r){p(y,e,null,null)}};f.exports={init:r,loadCloudProps:a}},{"./ajax":35,"./appProps":43,"./constants":45,"./data":47,"./events":49,"./fhparams":50,"./handleError":51,"./loadScript":55,"./logger":56,"./security/hash":62}],54:[function(e,f,n){var o=function(e,f){function n(e){console&&console.log(e)}function o(o,d){o=e.appid+o,f({algorithm:"MD5",text:o},function(e){var f=e.hashvalue+".txt";return"undefined"==typeof navigator.externalstorage?(n("filenameForKey key="+o+" , Filename: "+f),d(f)):void navigator.externalstorage.enable(function(e){var n=f;return e.path&&(n=e.path,n.match(/\/$/)||(n+="/"),n+=f),f=n,d(f)},function(e){return d(f)})})}var d=function(e,f){if(!console)throw e;console.log("error in file system adapter !",e,f)};return{valid:function(){return!!window.requestFileSystem},init:function(e,f){e&&"function"==typeof e.fail&&(d=e.fail),f&&this.fn(this.name,f).call(this,this)},keys:function(e){throw"Currently not supported"},save:function(e,f){var n=e.key,i=e.val||e.value;o(n,function(e){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(o){o.root.getFile(e,{create:!0},function(e){e.createWriter(function(e){e.onwrite=function(){return f({key:n,val:i})},e.write(i)},function(){d("[save] Failed to create file writer")})},function(){d("[save] Failed to getFile")})},function(){d("[save] Failed to requestFileSystem")})})},batch:function(e,f){throw"Currently not supported"},get:function(e,f){o(e,function(n){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(o){o.root.getFile(n,{},function(n){n.file(function(n){var o=new FileReader;o.onloadend=function(n){var o=n.target.result;try{o=decodeURIComponent(o)}catch(d){}return f({key:e,val:o})},o.readAsText(n)},function(){d("[load] Failed to getFile")})},function(){f({key:e,val:null})})},function(){d("[load] Failed to get fileSystem")})})},exists:function(e,f){o(e,function(e){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(n){n.root.getFile(e,{},function(e){return f(!0)},function(e){return f(!1)})})})},all:function(e){throw"Currently not supported"},remove:function(e,f){o(e,function(n){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(o){o.root.getFile(n,{},function(n){n.remove(function(){return f({key:e,val:null})},function(){d("[remove] Failed to remove file")})},function(){d("[remove] Failed to getFile")})},function(){d("[remove] Failed to get fileSystem")})})},nuke:function(e){throw"Currently not supported"}}};f.exports={fileStorageAdapter:o}},{}],55:[function(e,f,n){f.exports=function(e,f){var n,o=document.head||document.getElementsByTagName("head")[0]||document.documentElement;n=document.createElement("script"),n.async="async",n.src=e,n.type="text/javascript",n.onload=n.onreadystatechange=function(){(!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,o&&n.parentNode&&o.removeChild(n),n=void 0,f&&"function"==typeof f&&f())},o.insertBefore(n,o.firstChild)}},{}],56:[function(e,f,n){var o=(e("console"),e("loglevel"));o.setLevel("info"),f.exports=o},{console:9,loglevel:22}],57:[function(e,f,n){f.exports=[{destination:"ipad",test:["iPad"]},{destination:"iphone",test:["iPhone"]},{destination:"android",test:["Android"]},{destination:"blackberry",test:["BlackBerry","BB10","RIM Tablet OS"]},{destination:"windowsphone",test:["Windows Phone 8"]},{destination:"windowsphone7",test:["Windows Phone OS 7"]}]},{}],58:[function(e,f,n){f.exports=function(e){var f={},n=e.split("?");if(2===n.length){var o=n[1],d=o.split("&");f={};for(var i=0;i<d.length;i++){var t=d[i],l=t.split("=");f[l[0]]=l[1]}}return f}},{}],59:[function(e,f,n){var o=e("./constants");f.exports=function(){var e="FH_JS_SDK";return"undefined"!=typeof window.fh_destination_code?e="FH_HYBRID_SDK":(window.PhoneGap||window.cordova)&&(e="FH_PHONEGAP_SDK"),e+"/"+o.sdk_version}},{"./constants":45}],60:[function(e,f,n){var o=e("../../../libs/rsa"),d=o.SecureRandom,i=o.byte2Hex,t=function(e){var f=new d,n=new Array(e);f.nextBytes(n);for(var o="",t=0;t<n.length;t++)o+=i(n[t]);return o},l=function(e,f,n){if(!e.params.keysize)return void n("no_params_keysize",{},e);if("aes"!==e.params.algorithm.toLowerCase())return void n("keygen_bad_algorithm",{},e);var o=parseInt(e.params.keysize,10);return o>100&&(o/=8),"undefined"==typeof d?n("security library is not loaded."):f({algorithm:"AES",secretkey:t(o),iv:t(o)})};f.exports=l},{"../../../libs/rsa":3}],61:[function(e,f,n){var o=e("../../../libs/generated/crypto"),d=function(e,f,n){var d=["key","plaintext","iv"];if("aes"!==e.params.algorithm.toLowerCase())return n("encrypt_bad_algorithm",{},e);for(var i=0;d>i;i++){var t=d[i];if(!e.params[t])return n("no_params_"+t,{},e)}var l=o.AES.encrypt(e.params.plaintext,o.enc.Hex.parse(e.params.key),{iv:o.enc.Hex.parse(e.params.iv)});return cipher_text=o.enc.Hex.stringify(l.ciphertext),f({ciphertext:cipher_text})},i=function(e,f,n){var d=["key","ciphertext","iv"];if("aes"!==e.params.algorithm.toLowerCase())return n("decrypt_bad_algorithm",{},e);for(var i=0;d>i;i++){var t=d[i];if(!e.params[t])return n("no_params_"+t,{},e)}var l=o.enc.Hex.parse(e.params.ciphertext),u=o.enc.Base64.stringify(l),p=o.AES.decrypt(u,o.enc.Hex.parse(e.params.key),{iv:o.enc.Hex.parse(e.params.iv)});try{return f({plaintext:p.toString(o.enc.Utf8)})}catch(s){return n(s)}};f.exports={encrypt:d,decrypt:i}},{"../../../libs/generated/crypto":1}],62:[function(e,f,n){var o=e("../../../libs/generated/crypto"),d=function(e,f,n){if(!e.params.text)return void n("hash_no_text",{},e);var d;if("md5"===e.params.algorithm.toLowerCase())d=o.MD5(e.params.text).toString(o.enc.Hex);else if("sha1"===e.params.algorithm.toLowerCase())d=o.SHA1(e.params.text).toString(o.enc.Hex);else if("sha256"===e.params.algorithm.toLowerCase())d=o.SHA256(e.params.text).toString(o.enc.Hex);else{if("sha512"!==e.params.algorithm.toLowerCase())return n("hash_unsupported_algorithm: "+e.params.algorithm);d=o.SHA512(e.params.text).toString(o.enc.Hex)}return f({hashvalue:d})};f.exports=d},{"../../../libs/generated/crypto":1}],63:[function(e,f,n){var o=e("../../../libs/rsa"),d=o.RSAKey,i=function(e,f,n){var o=["modulu","plaintext"];if("rsa"!==e.params.algorithm.toLowerCase())return n("encrypt_bad_algorithm",{},e);for(var i=0;o>i;i++){var t=o[i];if(!e.params[t])return n("no_params_"+t,{},e)}var l=new d;l.setPublic(e.params.modulu,"10001");var u=e.params.plaintext;return cipher_text=l.encrypt(u),f({ciphertext:cipher_text})};f.exports={encrypt:i}},{"../../../libs/rsa":3}],64:[function(e,f,n){var o=e("./api_cloud");f.exports=function(e,f,n){o({path:"/mbaas/sync/"+e.dataset_id,method:"post",data:e.req},f,n)}},{"./api_cloud":38}],65:[function(e,f,n){f.exports={createUUID:function(){for(var e=[],f="0123456789ABCDEF",n=0;32>n;n++)e[n]=f.substr(Math.floor(16*Math.random()),1);e[12]="4",e[16]=f.substr(3&e[16]|8,1);var o=e.join("");return o}}},{}],66:[function(e,f,n){var o,d=e("./initializer"),i=e("./events"),t=e("./hosts"),l=e("./constants"),u=e("./logger"),p=e("./data"),s=e("./fhparams"),y=!1,c=!1,r=null,a=function(e){if(c)return e(null,{host:b()});if(i.once(l.INIT_EVENT,function(f,n){return e(f,n)}),!y){y=!0;var f=function(){p.sessionManager.read(function(e,f){f&&f.sessionToken&&s.setAuthSessionToken(f.sessionToken),d.init(function(e,f){return y=!1,e?(r=e,i.emit(l.INIT_EVENT,e)):(r=null,c=!0,o=new t(f.cloud),i.emit(l.INIT_EVENT,null,{host:b()}))})})};"undefined"!=typeof window.cordova||"undefined"!=typeof window.phonegap?document.addEventListener("deviceready",f,!1):f()}},w=function(){return o},b=function(){if("undefined"!=typeof o){var f=e("./appProps").getAppProps();return o.getHost(f.mode)}return void 0},g=function(){return c},m=function(){return r},x=function(){c=!1,y=!1,o=void 0,r=void 0,a(function(){})};a(function(e,f){e?"app_config_missing"!==e.message?u.error("Failed to initialise fh."):u.info("No fh config file"):u.info("fh cloud is ready")}),f.exports={ready:a,isReady:g,getCloudHost:w,getCloudHostUrl:b,getInitError:m,reset:x}},{"./appProps":43,"./constants":45,"./data":47,"./events":49,"./fhparams":50,"./hosts":52,"./initializer":53,"./logger":56}]},{},[33])(33)}),function(root){if(!JSON)var JSON=function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapeable.test(e)?'"'+e.replace(escapeable,function(e){var f=meta[e];return"string"==typeof f?f:(f=e.charCodeAt(),"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16))})+'"':'"'+e+'"'}function str(e,f){var n,o,d,i,t,l=gap,u=f[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(f,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,t=[],"number"==typeof u.length&&!u.propertyIsEnumerable("length")){for(i=u.length,n=0;i>n;n+=1)t[n]=str(n,u)||"null";return d=0===t.length?"[]":gap?"[\n"+gap+t.join(",\n"+gap)+"\n"+l+"]":"["+t.join(",")+"]",gap=l,d}if("object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)o=rep[n],"string"==typeof o&&(d=str(o,u,rep),d&&t.push(quote(o)+(gap?": ":":")+d));else for(o in u)d=str(o,u,rep),d&&t.push(quote(o)+(gap?": ":":")+d);return d=0===t.length?"{}":gap?"{\n"+gap+t.join(",\n"+gap)+"\n"+l+"}":"{"+t.join(",")+"}",gap=l,d}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;return{stringify:function(e,f,n){var o;if(gap="",indent="",n)if("number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(f){if("function"!=typeof f&&("object"!=typeof f||"number"!=typeof f.length))throw new Error("JSON.stringify");rep=f}else rep=function(e,f){return Object.hasOwnProperty.call(this,e)?f:void 0};return str("",{"":e})},parse:function(text,reviver){function walk(e,f){var n,o,d=e[f];if(d&&"object"==typeof d)for(n in d)Object.hasOwnProperty.call(d,n)&&(o=walk(d,n),void 0!==o?d[n]=o:delete d[n]);return reviver.call(e,f,d)}var j;if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),
"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")},quote:quote}}();if(function(){if(!window.google||!google.gears){var e=null;if("undefined"!=typeof GearsFactory)e=new GearsFactory;else try{e=new ActiveXObject("Gears.Factory"),-1!=e.getBuildInfo().indexOf("ie_mobile")&&e.privateSetGlobalObject(this)}catch(f){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(e=document.createElement("object"),e.style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}e&&(window.google||(google={}),google.gears||(google.gears={factory:e}))}}(),Persist=function(){var e,f,n,o,d,t,l="0.2.0";t=function(){var e,f="Thu, 01-Jan-1970 00:00:01 GMT",n=864e5,o=["expires","path","domain"],d=escape,t=unescape,l=document,u=function(){var e=new Date;return e.setTime(e.getTime()),e},p=function(e,f){var n,i,t,l=[],u=arguments.length>2?arguments[2]:{};for(l.push(d(e)+"="+d(f)),n=0;n<o.length;n++)i=o[n],(t=u[i])&&l.push(i+"="+t);return u.secure&&l.push("secure"),l.join("; ")},s=function(){var e="__EC_TEST__",f=new Date;return f=f.toGMTString(),this.set(e,f),this.enabled=this.remove(e)==f,this.enabled};return e={set:function(e,f){var o=arguments.length>2?arguments[2]:{},d=u(),t={};o.expires&&(o.expires*=n,t.expires=new Date(d.getTime()+o.expires),t.expires=t.expires.toGMTString());var s=["path","domain","secure"];for(i=0;i<s.length;i++)o[s[i]]&&(t[s[i]]=o[s[i]]);var y=p(e,f,t);return l.cookie=y,f},has:function(e){e=d(e);var f=l.cookie,n=f.indexOf(e+"="),o=(n+e.length+1,f.substring(0,e.length));return!n&&e!=o||0>n?!1:!0},get:function(e){e=d(e);var f,n=l.cookie,o=n.indexOf(e+"="),i=o+e.length+1,u=n.substring(0,e.length);return!o&&e!=u||0>o?null:(f=n.indexOf(";",i),0>f&&(f=n.length),t(n.substring(i,f)))},remove:function(n){var o=e.get(n),d={expires:f};return l.cookie=p(n,"",d),o},keys:function(){var e,f,n=l.cookie,o=n.split("; "),d=[];for(e=0;e<o.length;e++)f=o[e].split("="),d.push(t(f[0]));return d},all:function(){var e,f,n=l.cookie,o=n.split("; "),d=[];for(e=0;e<o.length;e++)f=o[e].split("="),d.push([t(f[0]),t(f[1])]);return d},version:"0.2.1",enabled:!1},e.enabled=s.call(e),e}();var u=function(){return Array.prototype.indexOf?function(e,f){return Array.prototype.indexOf.call(e,f)}:function(e,f){var n,o;for(n=0,o=e.length;o>n;n++)if(e[n]==f)return n;return-1}}();d=function(){},n=function(e){return"PS"+e.replace(/_/g,"__").replace(/ /g,"_s")},C={search_order:["localstorage","whatwg_db","globalstorage","gears","ie","flash","cookie"],name_re:/^[a-z][a-z0-9_ -]+$/i,methods:["init","get","set","remove","load","save"],sql:{version:"1",create:"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",get:"SELECT v FROM persist_data WHERE k = ?",set:"INSERT INTO persist_data(k, v) VALUES (?, ?)",remove:"DELETE FROM persist_data WHERE k = ?"},flash:{div_id:"_persist_flash_wrap",id:"_persist_flash",path:"persist.swf",size:{w:1,h:1},args:{autostart:!0}}},f={gears:{size:-1,test:function(){try{return window.google&&window.google.gears?!0:!1}catch(e){return!1}},methods:{transaction:function(e){var f=this.db;f.execute("BEGIN").close(),e.call(this,f),f.execute("COMMIT").close()},init:function(){var e;e=this.db=google.gears.factory.create("beta.database"),e.open(n(this.name)),e.execute(C.sql.create).close()},get:function(e,f,n){var o,d=C.sql.get;f&&this.transaction(function(i){var t,l;o=i.execute(d,[e]),t=o.isValidRow(),l=t?o.field(0):null,o.close(),f.call(n||this,t,l)})},set:function(e,f,n,o){var d=C.sql.remove,i=C.sql.set;this.transaction(function(t){t.execute(d,[e]).close(),t.execute(i,[e,f]).close(),n&&n.call(o||this,!0,f)})},remove:function(e,f,n){var o=C.sql.get;sql=C.sql.remove,r,val=null,is_valid=!1,this.transaction(function(d){f&&(r=d.execute(o,[e]),is_valid=r.isValidRow(),val=is_valid?r.field(0):null,r.close()),(!f||is_valid)&&d.execute(sql,[e]).close(),f&&f.call(n||this,is_valid,val)})}}},whatwg_db:{size:204800,test:function(){try{var e="PersistJS Test",n="Persistent database test.";return window.openDatabase&&window.openDatabase(e,C.sql.version,n,f.whatwg_db.size)?!0:!1}catch(o){return!1}},methods:{transaction:function(e){this.db_created||this.db.transaction(function(e){e.executeSql(C.sql.create,[],function(){this.db_created=!0})},d),this.db.transaction(e)},init:function(){this.db=openDatabase(this.name,C.sql.version,this.o.about||"Persistent storage for "+this.name,this.o.size||f.whatwg_db.size)},get:function(e,f,n){var o=C.sql.get;f&&(n=n||this,this.transaction(function(d){d.executeSql(o,[e],function(e,o){o.rows.length>0?f.call(n,!0,o.rows.item(0).v):f.call(n,!1,null)})}))},set:function(e,f,n,o){var d=C.sql.remove,i=C.sql.set;return this.transaction(function(t){t.executeSql(d,[e],function(){t.executeSql(i,[e,f],function(e,d){n&&n.call(o||this,!0,f)})})}),f},remove:function(e,f,n){var o=C.sql.get;sql=C.sql.remove,this.transaction(function(d){f?d.executeSql(o,[e],function(o,d){if(d.rows.length>0){var i=d.rows.item(0).v;o.executeSql(sql,[e],function(e,o){f.call(n||this,!0,i)})}else f.call(n||this,!1,null)}):d.executeSql(sql,[e])})}}},globalstorage:{size:5242880,test:function(){try{return window.globalStorage?!0:!1}catch(e){return!1}},methods:{key:function(e){return n(this.name)+n(e)},init:function(){alert("domain = "+this.o.domain),this.store=globalStorage[this.o.domain]},get:function(e,f,n){e=this.key(e),f&&f.call(n||this,!0,this.store.getItem(e))},set:function(e,f,n,o){e=this.key(e),this.store.setItem(e,f),n&&n.call(o||this,!0,f)},remove:function(e,f,n){var o;e=this.key(e),o=this.store[e],this.store.removeItem(e),f&&f.call(n||this,null!==o,o)}}},localstorage:{size:-1,test:function(){try{return window.localStorage?!0:!1}catch(e){return!1}},methods:{key:function(e){return n(this.name)+n(e)},init:function(){this.store=localStorage},get:function(e,f,n){e=this.key(e),f&&f.call(n||this,!0,this.store.getItem(e))},set:function(e,f,n,o){e=this.key(e),this.store.setItem(e,f),n&&n.call(o||this,!0,f)},remove:function(e,f,n){var o;e=this.key(e),o=this.store.getItem(e),this.store.removeItem(e),f&&f.call(n||this,null!==o,o)}}},ie:{prefix:"_persist_data-",size:65536,test:function(){try{return window.ActiveXObject?!0:!1}catch(e){return!1}},make_userdata:function(e){var f=document.createElement("div");return f.id=e,f.style.display="none",f.addBehavior("#default#userdata"),document.body.appendChild(f),f},methods:{init:function(){var e=f.ie.prefix+n(this.name);this.el=f.ie.make_userdata(e),this.o.defer&&this.load()},get:function(e,f,o){var d;e=n(e),this.o.defer||this.load(),d=this.el.getAttribute(e),f&&f.call(o||this,d?!0:!1,d)},set:function(e,f,o,d){e=n(e),this.el.setAttribute(e,f),this.o.defer||this.save(),o&&o.call(d||this,!0,f)},remove:function(e,f,o){var d;e=n(e),this.o.defer||this.load(),d=this.el.getAttribute(e),this.el.removeAttribute(e),this.o.defer||this.save(),f&&f.call(o||this,d?!0:!1,d)},load:function(){this.el.load(n(this.name))},save:function(){this.el.save(n(this.name))}}},cookie:{delim:":",size:4e3,test:function(){try{return e.Cookie.enabled?!0:!1}catch(f){return!1}},methods:{key:function(e){return this.name+f.cookie.delim+e},get:function(e,f,n){var o;e=this.key(e),o=t.get(e),f&&f.call(n||this,null!=o,o)},set:function(e,f,n,o){e=this.key(e),t.set(e,f,this.o),n&&n.call(o||this,!0,f)},remove:function(e,f,n,o){var f;e=this.key(e),f=t.remove(e),n&&n.call(o||this,null!=f,f)}}},flash:{test:function(){try{if(!deconcept||!deconcept.SWFObjectUtil)return!1;var e=deconcept.SWFObjectUtil.getPlayerVersion().major;return e>=8?!0:!1}catch(f){return!1}},methods:{init:function(){if(!f.flash.el){var e,n,o,d=C.flash;o=document.createElement("div"),o.id=d.div_id,document.body.appendChild(o),e=new deconcept.SWFObject(this.o.swf_path||d.path,d.id,d.size.w,d.size.h,"8");for(n in d.args)e.addVariable(n,d.args[n]);e.write(o),f.flash.el=document.getElementById(d.id)}this.el=f.flash.el},get:function(e,f,o){var d;e=n(e),d=this.el.get(this.name,e),f&&f.call(o||this,null!==d,d)},set:function(e,f,o,d){var i;e=n(e),i=this.el.set(this.name,e,f),o&&o.call(d||this,!0,f)},remove:function(e,f,o){var d;e=n(e),d=this.el.remove(this.name,e),f&&f.call(o||this,!0,d)}}}};var o=function(){var n,o,i,t,l=C.methods,u=C.search_order;for(n=0,o=l.length;o>n;n++)e.Store.prototype[l[n]]=d;for(e.type=null,e.size=-1,n=0,o=u.length;!e.type&&o>n;n++)if(i=f[u[n]],i.test()){e.type=u[n],e.size=i.size;for(t in i.methods)e.Store.prototype[t]=i.methods[t]}e._init=!0};return e={VERSION:l,type:null,size:0,add:function(e){f[e.id]=e,C.search_order=[e.id].concat(C.search_order),o()},remove:function(e){var n=u(C.search_order,e);0>n||(C.search_order.splice(n,1),delete f[e],o())},Cookie:t,Store:function(f,n){if(!C.name_re.exec(f))throw new Error("Invalid name");if(!e.type)throw new Error("No suitable storage found");n=n||{},this.name=f,n.domain=n.domain||location.host||"localhost",n.domain=n.domain.replace(/:\d+$/,""),this.o=n,n.expires=n.expires||730,n.path=n.path||"/",this.init()}},o(),e}(),"undefined"==typeof deconcept)var deconcept=new Object;"undefined"==typeof deconcept.util&&(deconcept.util=new Object),"undefined"==typeof deconcept.SWFObjectUtil&&(deconcept.SWFObjectUtil=new Object),deconcept.SWFObject=function(e,f,n,o,d,i,t,l,u,p){if(document.getElementById){this.DETECT_KEY=p?p:"detectflash",this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY),this.params=new Object,this.variables=new Object,this.attributes=new Array,e&&this.setAttribute("swf",e),f&&this.setAttribute("id",f),n&&this.setAttribute("width",n),o&&this.setAttribute("height",o),d&&this.setAttribute("version",new deconcept.PlayerVersion(d.toString().split("."))),this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion(),!window.opera&&document.all&&this.installedVer.major>7&&(deconcept.SWFObject.doPrepUnload=!0),i&&this.addParam("bgcolor",i);var s=t?t:"high";this.addParam("quality",s),this.setAttribute("useExpressInstall",!1),this.setAttribute("doExpressInstall",!1);var y=l?l:window.location;this.setAttribute("xiRedirectUrl",y),this.setAttribute("redirectUrl",""),u&&this.setAttribute("redirectUrl",u)}},deconcept.SWFObject.prototype={useExpressInstall:function(e){this.xiSWFPath=e?e:"expressinstall.swf",this.setAttribute("useExpressInstall",!0)},setAttribute:function(e,f){this.attributes[e]=f},getAttribute:function(e){return this.attributes[e]},addParam:function(e,f){this.params[e]=f},getParams:function(){return this.params},addVariable:function(e,f){this.variables[e]=f},getVariable:function(e){return this.variables[e]},getVariables:function(){return this.variables},getVariablePairs:function(){var e,f=new Array,n=this.getVariables();for(e in n)f.push(e+"="+n[e]);return f},getSWFHTML:function(){var e="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","PlugIn"),this.setAttribute("swf",this.xiSWFPath)),e='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'"',e+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var f=this.getParams();for(var n in f)e+=[n]+'="'+f[n]+'" ';var o=this.getVariablePairs().join("&");o.length>0&&(e+='flashvars="'+o+'"'),e+="/>"}else{this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","ActiveX"),this.setAttribute("swf",this.xiSWFPath)),e='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'">',e+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var f=this.getParams();for(var n in f)e+='<param name="'+n+'" value="'+f[n]+'" />';var o=this.getVariablePairs().join("&");o.length>0&&(e+='<param name="flashvars" value="'+o+'" />'),e+="</object>"}return e},write:function(e){if(this.getAttribute("useExpressInstall")){var f=new deconcept.PlayerVersion([6,0,65]);this.installedVer.versionIsValid(f)&&!this.installedVer.versionIsValid(this.getAttribute("version"))&&(this.setAttribute("doExpressInstall",!0),this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl"))),document.title=document.title.slice(0,47)+" - Flash Player Installation",this.addVariable("MMdoctitle",document.title))}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n="string"==typeof e?document.getElementById(e):e;return n.innerHTML=this.getSWFHTML(),!0}return""!=this.getAttribute("redirectUrl")&&document.location.replace(this.getAttribute("redirectUrl")),!1}},deconcept.SWFObjectUtil.getPlayerVersion=function(){var e=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var f=navigator.plugins["Shockwave Flash"];f&&f.description&&(e=new deconcept.PlayerVersion(f.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".")))}else{try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(o){try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");e=new deconcept.PlayerVersion([6,0,21]),n.AllowScriptAccess="always"}catch(o){if(6==e.major)return e}try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(o){}}null!=n&&(e=new deconcept.PlayerVersion(n.GetVariable("$version").split(" ")[1].split(",")))}return e},deconcept.PlayerVersion=function(e){this.major=null!=e[0]?parseInt(e[0]):0,this.minor=null!=e[1]?parseInt(e[1]):0,this.rev=null!=e[2]?parseInt(e[2]):0},deconcept.PlayerVersion.prototype.versionIsValid=function(e){return this.major<e.major?!1:this.major>e.major?!0:this.minor<e.minor?!1:this.minor>e.minor?!0:this.rev<e.rev?!1:!0},deconcept.util={getRequestParameter:function(e){var f=document.location.search||document.location.hash;if(f)for(var n=f.substring(1).split("&"),o=0;o<n.length;o++)if(n[o].substring(0,n[o].indexOf("="))==e)return n[o].substring(n[o].indexOf("=")+1);return""}},deconcept.SWFObjectUtil.cleanupSWFs=function(){for(var e=document.getElementsByTagName("OBJECT"),f=0;f<e.length;f++){e[f].style.display="none";for(var n in e[f])"function"==typeof e[f][n]&&(e[f][n]=function(){})}},deconcept.SWFObject.doPrepUnload&&(deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){},window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)},window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload)),null==Array.prototype.push&&(Array.prototype.push=function(e){return this[this.length]=e,this.length});var getQueryParamValue=deconcept.util.getRequestParameter,FlashObject=deconcept.SWFObject,SWFObject=deconcept.SWFObject,$fh=root.$fh||{};"object"==typeof fh_app_props&&($fh.app_props=fh_app_props),$fh.legacy={};var defaultargs={success:function(){},failure:function(){},params:{}},handleargs=function(e,f,n){var o=[null,null,null],d=[null,null,null],i=e.length;i>2?(d[0]=e[i-3],d[1]=e[i-2],d[2]=e[i-1]):2==i?(d[1]=e[0],d[2]=e[1]):1==i&&(d[2]=e[0]);for(var t=0,l=0;3>t;t++){var u=d[t],p=typeof u;!u||0!=l||"object"!=p&&"boolean"!=p?u&&"function"==p&&(l=0==l?1:l,o[l++]=u):o[l++]=u}if(null==o[0])o[0]=f?f:defaultargs.params;else{var s=o[0];s._defaults=[];for(var y in f)f.hasOwnProperty(y)&&"undefined"==typeof s[y]&&(s[y]=f[y],s._defaults.push(y))}o[1]=null==o[1]?defaultargs.success:o[1],o[2]=null==o[2]?defaultargs.failure:o[2],n(o[0],o[1],o[2])},eventSupported=function(e){var f=document.createElement("i");return e in f||f.setAttribute&&f.setAttribute(e,"return;")||!1},__is_ready=!1,__ready_list=[],__ready_bound=!1,boxprefix="/box/srv/1.1/";_getHostPrefix=function(){return $fh.app_props.host+boxprefix};var __ready=function(){if(!__is_ready&&(__is_ready=!0,__ready_list)){try{for(;__ready_list[0];)__ready_list.shift().apply(document,[])}finally{}__ready_list=null}},__bind_ready=function(){__ready_bound||(__ready_bound=!0,document.addEventListener?(document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),__ready()},!1),window.addEventListener("load",__ready,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),__ready())}),window.attachEvent("onload",__ready),document.documentElement.doScroll&&window==window.top&&function(){if(!__is_ready){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}__ready()}}()))};__bind_ready();var _mapScriptLoaded="undefined"!=typeof google&&"undefined"!=typeof google.maps&&"undefined"!=typeof google.maps.Map,_mapLoadSuccessParameters=[],_mapScriptLoading=!1,_loadMapScript=function(){var e=document.createElement("script");e.type="text/javascript";var f=document.location.protocol;f="http:"===f||"https:"===f?f:"https:",e.src=f+"//maps.google.com/maps/api/js?sensor=true&callback=$fh._mapLoaded",document.body.appendChild(e)},audio_obj=null,audio_is_playing=!1;$fh.__dest__={send:function(e,f,n){n("send_nosupport")},notify:function(e,f,n){n("notify_nosupport")},contacts:function(e,f,n){n("contacts_nosupport")},acc:function(e,f,n){n("acc_nosupport")},geo:function(e,f,n){n("geo_nosupport")},cam:function(e,f,n){n("cam_nosupport")},device:function(e,f,n){n("device_nosupport")},listen:function(e,f,n){n("listen_nosupport")},handlers:function(e,f,n){n("handlers_no_support")},file:function(e,f,n){n("file_nosupport")},env:function(e,f,n){f({height:window.innerHeight,width:window.innerWidth})},data:function(e,f,n){if($fh._persist||($fh._persist=new Persist.Store("FH"+$fh.app_props.appid,{swf_path:"/static/c/start/swf/persist.swf"})),!e.key)return void n("data_nokey");var o={load:function(){$fh._persist.get(e.key,function(n,o){f(n?{key:e.key,val:o}:{key:e.key,val:null})})},save:function(){if(!e.val)return void n("data_noval");try{$fh._persist.set(e.key,e.val)}catch(o){return void n("data_error",{},e)}f()},remove:function(){$fh._persist.remove(e.key,function(n,o){f(n?{key:e.key,val:o}:{key:e.key,val:null})})}};o[e.act]?o[e.act]():n("data_badact",e)},log:function(e,f,n){"undefined"==typeof console?n("log_nosupport"):console.log(e.message)},ori:function(e,f,n){if("undefined"==typeof e.act||"listen"==e.act)eventSupported("onorientationchange")?window.addEventListener("orientationchange",f,!1):n("ori_nosupport",{},e);else if("set"==e.act){if(!e.value)return void n("ori_no_value",{},e);"portrait"==e.value?(document.getElementsByTagName("body")[0].style["-moz-transform"]="",document.getElementsByTagName("body")[0].style["-webkit-transform"]="",f({orientation:"portrait"})):(document.getElementsByTagName("body")[0].style["-moz-transform"]="rotate(90deg)",document.getElementsByTagName("body")[0].style["-webkit-transform"]="rotate(90deg)",f({orientation:"landscape"}))}else n("ori_badact",{},e)},map:function(e,f,n){if(!e.target)return void n("map_notarget",{},e);if(!e.lat)return void n("map_nolatitude",{},e);if(!e.lon)return void n("map_nologitude",{},e);var o=e.target;if("string"==typeof o){var d=null;if("undefined"!=typeof jQuery)try{var i=jQuery(o);i.length>0&&(d=i[0])}catch(t){d=null}null==d&&(d=document.getElementById(o)),o=d}else"object"==typeof o?1===o.nodeType&&"string"==typeof o.nodeName||(o=o[0]):o=null;if(!o)return void n("map_nocontainer",{},e);if(_mapScriptLoaded){var l={};l.zoom=e.zoom?e.zoom:8,l.center=new google.maps.LatLng(e.lat,e.lon),l.mapTypeId=google.maps.MapTypeId.ROADMAP;var u=new google.maps.Map(o,l);f({map:u})}else"function"==typeof f&&_mapLoadSuccessParameters.push({target:o,successFunction:f,mOptions:e}),$fh._mapLoaded=function(){_mapScriptLoaded=!0;for(var e=_mapLoadSuccessParameters.shift();"undefined"!=typeof e;){var f=e.mOptions,n={};n.zoom=f.zoom?f.zoom:8,n.center=new google.maps.LatLng(f.lat,f.lon),n.mapTypeId=google.maps.MapTypeId.ROADMAP;var o=new google.maps.Map(e.target,n);e.successFunction({map:o}),e=_mapLoadSuccessParameters.shift()}},_mapScriptLoading||(_mapScriptLoading=!0,_loadMapScript()),setTimeout(function(){_mapScriptLoaded||n("map_timeout",{},e)},2e4)},audio:function(e,f,n){if(null==!audio_obj&&"play"==e.act&&(!e.path||""==e.path))return void n("no_audio_path");var o={play:function(){if(null==audio_obj){if(audio_obj=document.createElement("audio"),!(audio_obj.play?!0:!1))return void n("audio_not_support");if(e.type){var d=audio_obj.canPlayType(e.type);if("no"==d||""==d)return void n("audio_type_not_supported")}audio_obj.src=e.path,e.controls&&(audio_obj.controls="controls"),e.autoplay&&(audio_obj.autoplay="autoplay"),e.loop&&(audio_obj.loop="loop"),document.body.appendChild(audio_obj),audio_obj.play(),audio_is_playing=!0,f()}else e.path&&e.path!=audio_obj.src?(audio_is_playing&&o.stop(!0),o.play()):audio_is_playing||(audio_obj.play(),audio_is_playing=!0,f())},pause:function(){null!=audio_obj&&audio_is_playing?("function"==typeof audio_obj.pause?audio_obj.pause():"function"==typeof audio_obj.stop&&audio_obj.stop(),audio_is_playing=!1,f()):n("no_audio_playing")},stop:function(e){null!=audio_obj?("function"==typeof audio_obj.stop?audio_obj.stop():"function"==typeof audio_obj.pause&&audio_obj.pause(),document.body.removeChild(audio_obj),audio_obj=null,audio_is_playing=!1,e||f()):n("no_audio")}};o[e.act]?o[e.act]():n("data_badact",e)},webview:function(e,f,n){n("webview_nosupport")},ready:function(e,f,n){__bind_ready(),__is_ready?f.apply(document,[]):__ready_list.push(f)}},$fh.send=function(){handleargs(arguments,{type:"email"},$fh.__dest__.send)},$fh.notify=function(){handleargs(arguments,{type:"vibrate"},$fh.__dest__.notify)},$fh.contacts=function(){handleargs(arguments,{act:"list"},$fh.__dest__.contacts)},$fh.acc=function(){handleargs(arguments,{act:"register",interval:0},$fh.__dest__.acc)},$fh.geo=function(){handleargs(arguments,{act:"register",interval:0},$fh.__dest__.geo)},$fh.cam=function(){handleargs(arguments,{act:"picture"},$fh.__dest__.cam)},$fh.data=function(){handleargs(arguments,{act:"load"},$fh.__dest__.data)},$fh.log=function(){handleargs(arguments,{message:"none"},$fh.__dest__.log)},$fh.device=function(){handleargs(arguments,{},$fh.__dest__.device)},$fh.listen=function(){handleargs(arguments,{act:"add"},$fh.__dest__.listen)},$fh.ori=function(){handleargs(arguments,{},$fh.__dest__.ori)},$fh.map=function(){handleargs(arguments,{},$fh.__dest__.map)},$fh.audio=function(){handleargs(arguments,{},$fh.__dest__.audio)},$fh.webview=function(){handleargs(arguments,{},$fh.__dest__.webview)},$fh.ready=function(){handleargs(arguments,{},$fh.__dest__.ready)},$fh.handlers=function(){handleargs(arguments,{type:"back"},$fh.__dest__.handlers)},$fh.file=function(){handleargs(arguments,{act:"upload"},$fh.__dest__.file)},$fh.env=function(){handleargs(arguments,{},function(e,f,n){$fh.__dest__.env({},function(e){e.application=$fh.app_props.appid,$fh._getDeviceId&&(e.uuid=$fh._getDeviceId()),e.agent=navigator.userAgent||"unknown",f(e)})})},$fh.device=function(){handleargs(arguments,{},function(e,f,n){})},$fh.geoip=function(){handleargs(arguments,{act:"get"},function(e,f,n){if("get"==e.act){var o={instance:$fh.app_props.appid,domain:$fh.cloud_props.domain};$fh.__ajax({url:_getHostPrefix()+"act/wid/geoip/resolve",type:"POST",data:JSON.stringify(o),success:function(e){for(var n in e.geoip)e[n]=e.geoip[n];f(e)}})}else n("geoip_badact",e)})},$fh.web=function(e,f,n){handleargs(arguments,{method:"GET"},function(e,f,n){e.url||n("bad_url"),e.is_local?$fh.__ajax({url:e.url,type:"GET",dataType:"html",success:function(e){var n={};n.status=200,n.body=e,f(n)},error:function(){n()}}):$fh.__ajax({url:_getHostPrefix()+"act/wid/web",type:"POST",data:JSON.stringify(e),success:function(e){f(e)}})})},$fh.__webview_win=void 0,$fh.__dest__.webview=function(e,f,n){if("act"in e&&"open"!==e.act)"close"===e.act&&("undefined"!=typeof $fh.__webview_win&&($fh.__webview_win.close(),$fh.__webview_win=void 0),f("closed"));else{if(!e.url)return void n("no_url");e.url;$fh.__webview_win=window.open(e.url,"_blank"),f("opened")}},("undefined"!=typeof window.PhoneGap||"undefined"!=typeof window.cordova)&&($fh.__dest__.ready=function(e,f,n){if(__is_ready)try{f()}catch(o){console.log("Error during $fh.ready. Skip. Error = "+o.message)}else __ready_list.push(f)}),$fh.__dest__.geo=function(e,f,n){if("undefined"!=typeof navigator.geolocation)if(e.act&&"register"!=e.act)"unregister"==e.act?($fh.__dest__._geoWatcher&&(navigator.geolocation.clearWatch($fh.__dest__._geoWatcher),$fh.__dest__._geoWatcher=void 0),f()):n("geo_badact",{},e);else{if($fh.__dest__._geoWatcher)return void n("geo_inuse",{},e);if(0==e.interval&&navigator.geolocation.getCurrentPosition(function(e){var n=e.coords,o={lon:n.longitude,lat:n.latitude,alt:n.altitude,acc:n.accuracy,head:n.heading,speed:n.speed,when:e.timestamp};f(o)},function(f){n("error_geo",{},e)},{timeout:3e4,enableHighAccuracy:!0}),e.interval>0){var o=navigator.geolocation.watchPosition(function(e){var n=e.coords,o={lon:n.longitude,lat:n.latitude,alt:n.altitude,acc:n.accuracy,head:n.heading,speed:n.speed,when:e.timestamp};f(o)},function(){n("error_geo",{},e)},{frequency:e.interval});$fh.__dest__._geoWatcher=o}}else n("geo_nosupport",{},e)},$fh.__dest__.acc=function(e,f,n){f({x:4*Math.random()-2,y:4*Math.random()-2,z:4*Math.random()-2,when:(new Date).getTime()})},root.$fh=$fh}(window||this),function(e){var f=function(e){function n(e,n){var o={updateForms:!0};if("undefined"==typeof n)n=e;else for(var d in e)o[d]=e[d];var i=o.config||{};f.config=f.models.config,f.config.init(i,function(e){e&&$fh.forms.log.e("Form config loading error: ",e),f.models.log.loadLocal(function(e){e&&console.error("Error loading config from local storage"),f.models.submissions.loadLocal(function(e){e&&console.error("Error loading submissions"),f.models.uploadManager.loadLocal(function(e){$fh.forms.log.d("Upload Manager loaded from memory."),e&&$fh.forms.log.e("Error loading upload manager from memory ",e),f.models.uploadManager.start(),$fh.forms.log.l("Refreshing Theme."),f.models.theme.refresh(!0,function(e){e&&$fh.forms.log.e("Error refreshing theme ",e),o.updateForms===!0?($fh.forms.log.l("Refreshing Forms."),f.models.forms.refresh(!0,function(e){e&&$fh.forms.log.e("Error refreshing forms: ",e),n()})):n()})})})})})}return e.init=n,e}(f||{});f.utils=function(e){function f(){return"undefined"!=typeof window.Phonegap||"undefined"!=typeof window.cordova}function n(e,f){if(f.constructor&&f.constructor===Function)for(var n in f.prototype)e.prototype[n]=f.prototype[n];else for(var o in f)e.prototype[o]=f[o]}function o(e){var f=new Date;return e?f.getTimezoneOffset():f}function d(e){var f=e.getProps(),n=f._id,d=f._type,i=o().getTime();return n&&d?n+"_"+d+"_"+i:n?n+"_"+i:d?d+"_"+i:i}function i(e,f){"undefined"!=typeof $fh&&$fh.hash?$fh.hash({algorithm:"MD5",text:e},function(e){e&&e.hashvalue?f(null,e.hashvalue):f("Crypto failed.")}):f("Crypto not found")}function t(e,f){$fh.forms.log.d("Sending mail: ",e),$fh.send(e,function(){f(null)},function(e){f(e)})}return e.extend=n,e.localId=d,e.md5=i,e.getTime=o,e.send=t,e.isPhoneGap=f,e.generateGlobalEventName=function(e,f){return""+e+":"+f},e}(f.utils||{}),f.utils=function(e){function n(){return m(),x}function o(e,f){if(!e instanceof File)return f("Only file object can be used for converting");var n=new FileReader;n.onloadend=function(e){var n=e.target.result;return f(null,n)},n.readAsDataURL(e)}function d(e){var n;if(f.utils.isPhoneGap())n=e;else{var o="text/plain";try{n=new Blob([e],{type:o})}catch(d){var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===d.name&&i){var t=new i;t.append([e.buffer]),n=t.getBlob(o)}else n=e}}return n}function i(e){l("dummy.txt","TestContnet",function(f,n){return f?e(f):void b("dummy.txt",0,{},function(f,n){var o=n.localURL.replace("dummy.txt","");return n.remove(),e(null,o)})})}function t(e){var f=null;if("object"==typeof e&&null!==e)if(e instanceof File||e instanceof Blob)f=e;else{var n=JSON.stringify(e);f=d(n)}else"string"==typeof e&&(f=d(e));return f}function l(e,n,o){var d=t(n);if(null===d)return o("Invalid content type. Object was null");var i=d.size||d.length;b(e,i,{create:!0},function(n,i){n?o(n):f.utils.isPhoneGap()&&d instanceof File?i.getParent(function(f){w(d.localURL,function(n,d){return n?o(n):(e=i.name,void i.remove(function(){d.copyTo(f,e,function(e){return o(null,e)},function(e){return o(e)})},function(e){return o(e)}))},function(e){return o(e)})},function(e){return o(e)}):i.createWriter(function(e){function f(e){return o(null,e)}function n(){e.onwriteend=f,e.write(d)}e.onwriteend=n,e.truncate(0)},function(e){o("Failed to create file write:"+e)})})}function u(e,f){b(e,0,{},function(e,n){return e?"NotFoundError"!==e.name&&1!==e.code?f(e):f(null,null):void n.remove(function(){f(null,null)},function(e){f("Failed to remove file"+e)})})}function p(e){function f(f){var o=f.root.createReader();o.readEntries(n,e)}function n(f){async.forEachSeries(f,function(e,f){e.isDirectory?e.removeRecursively(f,f):e.remove(f,f)},e)}h(j,0,f,e)}function s(e,f){a(e,function(e,n){if(e)f(e);else{var o=new FileReader;o.onloadend=function(e){var n=e.target.result;"object"==typeof n&&(n=JSON.stringify(n));try{n=decodeURIComponent(n)}catch(o){}return f(null,n)},o.readAsText(n)}})}function y(e,f){a(e,function(e,n){if(e)return f(e);var o=new FileReader;o.onloadend=function(e){var n=e.target.result;return f(null,n)},o.readAsDataURL(n)})}function c(e,f){a(e,function(e,n){if(e)return f(e);var o=n.type,d=new FileReader;d.onloadend=function(e){var n=e.target.result,d=new Blob([n],{type:o});f(null,d)},d.readAsArrayBuffer(n)})}function r(e,f){a(e,f)}function a(e,f){b(e,0,{},function(e,n){return e?f(e):void n.file(function(e){f(null,e)},function(e){f(e)})})}function w(e,f){-1===e.indexOf("file://")&&"Win32NT"!==window.device.platform&&"windows"!==window.device.platform&&(e="file://"+e),window.resolveLocalFileSystemURL(e,function(e){return f(null,e)},function(e){return f(e)})}function b(e,n,o,d){m(),"string"==typeof e?h(j,n,function(i){i.root.getFile(e,o,function(e){d(null,e)},function(i){if("QuotaExceededError"===i.name||10===i.code){var t=1073741824;g(t,function(f,i){b(e,n,o,d)})}else{if(!f.utils.isPhoneGap())return d(i);w(e,d)}})},function(){d("Failed to requestFileSystem")}):"function"==typeof d&&d("Expected file name to be a string but was "+e)}function g(e,f){navigator.webkitPersistentStorage?navigator.webkitPersistentStorage.requestQuota(e,function(e){f(null,e)},function(e){f(e,0)}):f(null,e)}function m(){window.requestFileSystem?(h=window.requestFileSystem,x=!0):window.webkitRequestFileSystem?(h=window.webkitRequestFileSystem,x=!0):x=!1,window.LocalFileSystem?j=window.LocalFileSystem.PERSISTENT:window.PERSISTENT&&(j=window.PERSISTENT)}e.fileSystem={isFileSystemAvailable:n,save:l,remove:u,readAsText:s,readAsBlob:c,readAsBase64Encoded:y,readAsFile:r,fileToBase64:o,getBasePath:i,clearFileSystem:p};var x=!1,h=function(){console.error("No file system available")},j=1;return m(),e}(f.utils||{}),f.utils=function(e){function f(){return c(),b}function n(){return c(),w}function o(e,f){c(),u(e,f)}function d(){if(h){if(h.stop)h.stop();else{var e=h.getTracks();e&&0!==e.length&&e[0].stop()}h=null}}function i(e,f){e=e||{},$fh.forms.log.d("Taking photo ",e,w);var n=e.targetWidth?e.targetWidth:$fh.forms.config.get("targetWidth",640),o=e.targetHeight?e.targetHeight:$fh.forms.config.get("targetHeight",480),d=e.quality?e.quality:$fh.forms.config.get("quality",50),i="undefined"!=typeof e.saveToPhotoAlbum?e.saveToPhotoAlbum:$fh.forms.config.get("saveToPhotoAlbum"),l=e.encodingType?e.encodingType:$fh.forms.config.get("encodingType","jpeg");e.targetWidth=n,e.targetHeight=o,e.quality=d,e.saveToPhotoAlbum=i,e.encodingType=l,"undefined"==typeof e.sourceType&&"undefined"!=typeof Camera&&(e.sourceType=Camera.PictureSourceType.CAMERA),w?t(e,f):b?a(e,f):f("Your device does not support camera.")}function t(e,f){e.encodingType="jpeg"===e.encodingType?Camera.EncodingType.JPEG:Camera.EncodingType.PNG,
navigator.camera.getPicture(l(f),f,{quality:e.quality,targetWidth:e.targetWidth,targetHeight:e.targetHeight,sourceType:e.sourceType,saveToPhotoAlbum:e.saveToPhotoAlbum,destinationType:Camera.DestinationType.FILE_URI,encodingType:e.encodingType})}function l(e){return function(f){var n=f;e(null,n)}}function u(e,f){$fh.forms.log.d("Taking photo _html5Camera",e,w);var n=e.targetWidth||$fh.forms.config.get("targetWidth"),o=e.targetHeight||$fh.forms.config.get("targetHeight");g.width=n,g.height=o,m.width=n,m.height=o,h?($fh.forms.log.e("Media device was not released by browser."),f("Media device occupied.")):navigator.getUserMedia({video:!0,audio:!1},function(e){g.src=window.URL.createObjectURL(e),h=e,f(null,g)},f)}function p(e,f){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.barcodeScanner?void cordova.plugins.barcodeScanner.scan(function(e){return $fh.forms.log.d("Barcode Found: "+JSON.stringify(e)),f(null,e)},function(e){$fh.forms.log.e("Scanning failed: "+e),f("Scanning failed: "+e)}):f("Barcode plugin not installed")}function s(e,f){return $fh.forms.log.e("Web Barcode Decoding not supported yet."),f("Web Barcode Decoding not supported yet.")}function y(e,f){n()?p(e,f):s(e,f)}function c(){$fh.forms.log.d("Checking env"),navigator.camera&&navigator.camera.getPicture?w=!0:r()?(b=!0,g=document.createElement("video"),g.autoplay="autoplay",m=document.createElement("canvas"),x=m.getContext("2d")):console.error("Cannot detect usable media API. Camera will not run properly on this device.")}function r(){return navigator.getUserMedia?!0:navigator.webkitGetUserMedia?(navigator.getUserMedia=navigator.webkitGetUserMedia,!0):navigator.mozGetUserMedia?(navigator.getUserMedia=navigator.mozGetUserMedia,!0):navigator.msGetUserMedia?(navigator.getUserMedia=navigator.msGetUserMedia,!0):!1}function a(e,f){if($fh.forms.log.d("Snapshot ",e),h){x.drawImage(g,0,0,e.targetWidth,e.targetHeight);var n=m.toDataURL("image/png"),o=x.getImageData(0,0,e.targetWidth,e.targetHeight);return e.cancelHtml5Camera&&d(),e.rawData?f(null,{imageData:o,width:e.targetWidth,height:e.targetHeight,base64:n}):f(null,n)}$fh.forms.log.e("Media resource is not available"),f("Resource not available")}e.takePhoto=i,e.isPhoneGapCamAvailable=n,e.isHtml5CamAvailable=f,e.initHtml5Camera=o,e.cancelHtml5Camera=d,e.captureBarcode=y;var w=!1,b=!1,g=null,m=null,x=null,h=null;return e}(f.utils||{}),f.web=function(e){return e.uploadFile=function(e,f,n){$fh.forms.log.d("Phonegap uploadFile ",e,f);var o=f.localURL;if(!$fh.forms.config.isOnline())return $fh.forms.log.e("Phonegap uploadFile. Not Online.",e,f),n("No Internet Connection Available.");var d=function(f){$fh.forms.log.d("upload to url ",e," sucessful"),f.response=f.response||{},"string"==typeof f.response&&(f.response=JSON.parse(f.response)),n(null,f.response)},i=function(e){$fh.forms.log.e("An error uploading a file has occurred: Code = "+e.code),$fh.forms.log.d("upload error source "+e.source),$fh.forms.log.d("upload error target "+e.target),n(e)},t=new FileUploadOptions;t.fileName=null==f.name||""===f.name?"image.png":f.name,t.mimeType=f.contentType?f.contentType:"application/octet-stream",t.httpMethod="https",t.chunkedMode=!0,t.fileKey="file",t.headers={Connection:"close"},$fh.forms.log.d("Beginning file upload ",e,t);var l=new FileTransfer;l.upload(o,encodeURI(e),d,i,t)},e.downloadFile=function(e,n,o){$fh.forms.log.d("Phonegap downloadFile ",e,n);var d=new FileTransfer;return $fh.forms.config.isOnline()?void f.utils.fileSystem.getBasePath(function(f,i){function t(e){return $fh.forms.log.d("File Download Completed Successfully. FilePath: "+e.fullPath),o(null,e.toURL())}function l(e){return $fh.forms.log.e("Error downloading file "+n.fileName+" code: "+e.code),o("Error downloading file "+n.fileName+" code: "+e.code)}if(f)return $fh.forms.log.e("Error getting base path for file download: "+e),o(f);if(!n.fileName)return $fh.forms.log.e("No file name associated with the file to download"),o("No file name associated with the file to download");$fh.forms.log.d("File name for file "+n.fileName+" found. Starting download");var u=i+n.fileName;d.download(encodeURI(e),u,t,l,!1,{headers:{Connection:"close"}})}):($fh.forms.log.e("Phonegap downloadFile. Not Online.",e,n),o("No Internet Connection Available."))},e}(f.web||{}),f.web.ajax=function(e){function f(){}function n(e,f){$fh.forms.log.d("Ajax get ",e),d({url:e,type:"GET",dataType:"json",success:function(n,o){$fh.forms.log.d("Ajax get",e,"Success"),f(null,n)},error:function(n,o,d){$fh.forms.log.e("Ajax get",e,"Fail",n,o,d),f(n)}})}function o(e,f,n){$fh.forms.log.d("Ajax post ",e,f);var o,i=!1;if("object"==typeof f)if(f instanceof File){i=!0,o=new FormData;var t=f.name;o.append(t,f),f=o}else f=JSON.stringify(f);var l={url:e,type:"POST",data:f,dataType:"json",success:function(f,o){$fh.forms.log.d("Ajax post ",e," Success"),n(null,f)},error:function(f,o,d){$fh.forms.log.e("Ajax post ",e," Fail ",f,o,d),n(f)}};i===!1&&(l.contentType="application/json"),d(l)}e="undefined"!=typeof $fh&&$fh.__ajax?$fh.__ajax:f,e.get=n,e.post=o;var d=e;return e}(f.web.ajax||{}),f.stores=function(e){function f(e){this.name=e}return e.Store=f,f.prototype.create=function(e,f){throw"Create not implemented:"+this.name},f.prototype.read=function(e,f){throw"Read not implemented:"+this.name},f.prototype.update=function(e,f){throw"Update not implemented:"+this.name},f.prototype.removeEntry=function(e,f){throw"Delete not implemented:"+this.name},f.prototype.upsert=function(e,f){throw"Upsert not implemented:"+this.name},e}(f.stores||{}),f.stores=function(e){function n(){f.stores.Store.call(this,"LocalStorage")}function o(e){return"function"==typeof e.getLocalId?e.getLocalId():e}function d(){p()?t.apply({},arguments):i.apply({},arguments)}function i(e,f,n){return $fh&&$fh.data?void $fh.data(e,function(n){return"undefined"==typeof n&&(n={key:e.key,val:e.val}),"remove"===e.act.toLowerCase()?f(null,null):void f(null,n.val?n.val:null)},n):f()}function t(e,n,o){function d(e){return"undefined"!=typeof o?o(e,{}):void 0}function i(e,n){var o=f.config.get("appId","unknownAppId");e+=o,l.md5(e,function(f,o){f&&(o=e);var d=o;return-1===e.indexOf("filePlaceHolder")&&(d+=".txt"),"undefined"==typeof navigator.externalstorage?n(d):void navigator.externalstorage.enable(function(e){var f=d;return e.path&&(f=e.path,f.match(/\/$/)||(f+="/"),f+=d),d=f,n(d)},function(e){return n(d)})})}function t(e,f){i(e,function(e){u.save(e,f,function(e,o){e?d(e):n(null,f)})})}function p(e){i(e,function(e){u.remove(e,function(e){e?"NotFoundError"===e.name||1===e.code?n(null,null):d(e):n(null,null)})})}function s(e){i(e,function(e){u.readAsText(e,function(e,f){e?"NotFoundError"===e.name||1===e.code?n(null,null):d(e):n(null,f)})})}function y(e){i(e,function(e){u.readAsFile(e,function(e,f){e?"NotFoundError"===e.name||1===e.code?n(null,null):d(e):n(null,f)})})}return"undefined"==typeof e.act?s(e.key):"save"===e.act?t(e.key,e.val):"remove"===e.act?p(e.key):"load"===e.act?s(e.key):"loadFile"===e.act?y(e.key):"undefined"!=typeof o?o("Action ["+e.act+"] is not defined",{}):void 0}var l=f.utils,u=l.fileSystem,p=function(){};return f.utils.extend(n,f.stores.Store),n.prototype.create=function(e,f){var n=l.localId(e);e.setLocalId(n),this.update(e,f)},n.prototype.read=function(e,f){if("object"==typeof e&&"offlineTest"===e.get("_type"))return f(null,{});var n=o(e);null!=n?d({act:"load",key:n.toString()},f,f):f(null,null)},n.prototype.update=function(e,f){var n=o(e),i=e.getProps(),t=JSON.stringify(i);d({act:"save",key:n.toString(),val:t},f,f)},n.prototype.removeEntry=function(e,f){var n=o(e);d({act:"remove",key:n.toString()},f,f)},n.prototype.upsert=function(e,f){var n=o(e);null===n?this.create(e,f):this.update(e,f)},n.prototype.switchFileSystem=function(e){p=function(){return e}},n.prototype.defaultStorage=function(){p=function(){return u.isFileSystemAvailable()}},n.prototype.saveFile=function(e,f,n){return p()?void d({act:"save",key:e,val:f},n,n):n("File system not available")},n.prototype.updateTextFile=function(e,f,n){d({act:"save",key:e,val:f},n,n)},n.prototype.readFile=function(e,f){d({act:"loadFile",key:e},f,f)},n.prototype.readFileText=function(e,f){d({act:"load",key:e},f,f)},p=function(){return u.isFileSystemAvailable()},e.localStorage=new n,e}(f.stores||{}),f.stores=function(e){function n(){d.call(this,"MBaaS")}function o(e){$fh.forms.log.d("_getUrl ",e);var n=e.get("_type"),o=f.config.getCloudHost(),d=f.config.get("mbaasBaseUrl"),i=f.config.get("formUrls"),t="";i[n]?t=i[n]:$fh.forms.log.e("type not found to get url:"+n);var l=o+d+t,u={};switch(u.appId=f.config.get("appId"),n){case"config":u.appid=e.get("appId"),u.deviceId=e.get("deviceId");break;case"form":u.formId=e.get("_id");break;case"formSubmission":u.formId=e.getFormId();break;case"fileSubmission":u.submissionId=e.getSubmissionId(),u.hashName=e.getHashName(),u.fieldId=e.getFieldId();break;case"base64fileSubmission":u.submissionId=e.getSubmissionId(),u.hashName=e.getHashName(),u.fieldId=e.getFieldId();break;case"submissionStatus":u.submissionId=e.get("submissionId");break;case"completeSubmission":u.submissionId=e.get("submissionId");break;case"formSubmissionDownload":u.submissionId=e.getSubmissionId();break;case"fileSubmissionDownload":u.submissionId=e.getSubmissionId(),u.fileGroupId=e.getFileGroupId();break;case"offlineTest":return"http://127.0.0.1:8453"}for(var p in u)l=l.replace(":"+p,u[p]);return l}var d=f.stores.Store;return e.mBaaS=new n,f.utils.extend(n,d),n.prototype.checkStudio=function(){return f.config.get("studioMode")},n.prototype.create=function(e,n){var d=this;if(d.checkStudio())n("Studio mode mbaas not supported");else{var i=o(e);d.isFileAndPhoneGap(e)?f.web.uploadFile(i,e.getProps(),n):f.web.ajax.post(i,e.getProps(),n)}},n.prototype.isFileAndPhoneGap=function(e){var f=this;return f.isFileTransfer(e)&&f.isPhoneGap()},n.prototype.isFileTransfer=function(e){return"fileSubmission"===e.get("_type")||"base64fileSubmission"===e.get("_type")||"fileSubmissionDownload"===e.get("_type")},n.prototype.isPhoneGap=function(){return"undefined"!=typeof window.Phonegap||"undefined"!=typeof window.cordova},n.prototype.read=function(e,n){var d=this;if(d.checkStudio())n("Studio mode mbaas not supported");else if("offlineTest"===e.get("_type"))n("offlinetest. ignore");else{var i=o(e);if(d.isFileTransfer(e)&&d.isPhoneGap())f.web.downloadFile(i,e.getFileMetaData(),n);else{if(d.isFileTransfer(e))return n(null,e.getRemoteFileURL());f.web.ajax.get(i,n)}}},n.prototype.update=function(e,f){},n.prototype["delete"]=function(e,f){},n.prototype.completeSubmission=function(e,n){if(this.checkStudio())return n("Studio mode mbaas not supported");var d=o(e);f.web.ajax.post(d,{},n)},n.prototype.submissionStatus=function(e,n){if(this.checkStudio())return n("Studio mode mbaas not supported");var d=o(e);f.web.ajax.get(d,n)},n.prototype.isOnline=function(e){var n=f.config.getCloudHost(),o=n+f.config.get("statusUrl","/sys/info/ping");f.web.ajax.get(o,function(f){return f?($fh.forms.log.e("Online status ajax ",f),e(!1)):($fh.forms.log.d("Online status ajax success"),e(!0))})},e}(f.stores||{}),f.stores=function(e){function n(e,f){o.call(this,"DataAgent"),this.remoteStore=e,this.localStore=f}var o=f.stores.Store;return e.DataAgent=n,e.dataAgent=new n(f.stores.mBaaS,f.stores.localStorage),f.utils.extend(n,o),n.prototype.read=function(e,f){$fh.forms.log.d("DataAgent read ",e);var n=this;this.localStore.read(e,function(o,d){o||!d?($fh.forms.log.d("Error reading model from localStore ",e,o),n.refreshRead(e,f)):f(null,d,!1)})},n.prototype.refreshRead=function(e,f){$fh.forms.log.d("DataAgent refreshRead ",e);var n=this;this.remoteStore.read(e,function(o,d){o?($fh.forms.log.e("Error reading model from remoteStore ",e,o),f(o)):($fh.forms.log.d("Model refresh successfull from remoteStore ",e,d),e.fromJSON(d),n.localStore.upsert(e,function(){var e=Array.prototype.slice.call(arguments,0);e.push(!0),f.apply({},e)}))})},n.prototype.attemptRead=function(e,f){$fh.forms.log.d("DataAgent attemptRead ",e);var n=this;n.checkOnlineStatus(function(o){$fh.forms.config.isOnline()?n.refreshRead(e,function(o){o?n.read(e,f):f.apply({},arguments)}):n.read(e,f)})},n.prototype.checkOnlineStatus=function(e){$fh.forms.log.d("DataAgent check online status ");var n=this;return f.utils.isPhoneGap()&&navigator.connection&&navigator.connection.type&&navigator.connection.type===Connection.NONE?($fh.forms.config.offline(),e(!1)):void n.remoteStore.isOnline(function(f){f===!1?$fh.forms.config.offline():$fh.forms.config.online(),e(null,f)})},e}(f.stores||{}),f.models=function(e){function n(e){if(this.props={_id:null,_type:null,_ludid:null},this.utils=f.utils,this.events={},"undefined"!=typeof e)for(var n in e)this.props[n]=e[n];this.touch()}return n.prototype.on=function(e,f){this.events[e]||(this.events[e]=[]),this.events[e].indexOf(f)<0&&this.events[e].push(f)},n.prototype.off=function(e,f){this.events[e]&&this.events[e].indexOf(f)>=0&&this.events[e].splice(this.events[e].indexOf(f),1)},n.prototype.getType=function(){return this.get("_type")},n.prototype.clearEvents=function(){this.events={}},n.prototype.emit=function(){var e=Array.prototype.slice.call(arguments,0),f=e.shift(),n=this.events[f],o=e.slice(0);if(n&&n.length>0)for(var d=0;d<n.length;d++){var i=n[d];i.apply(this,e);var t=this.getType();if(t){var l=this.utils.generateGlobalEventName(t,f);o.unshift(l),$fh.forms.emit.apply(this,o)}}},n.prototype.getProps=function(){return this.props},n.prototype.get=function(e,f){return"undefined"==typeof this.props[e]?f:this.props[e]},n.prototype.set=function(e,f){this.props[e]=f},n.prototype.setLocalId=function(e){this.set("_ludid",e)},n.prototype.getLocalId=function(){return this.get("_ludid")},n.prototype.toJSON=function(){var e={};for(var f in this.props)e[f]=this.props[f];return e},n.prototype.fromJSON=function(e){if("string"==typeof e)this.fromJSONStr(e);else for(var f in e)this.set(f,e[f]);this.touch()},n.prototype.fromJSONStr=function(e){try{var f=JSON.parse(e);this.fromJSON(f)}catch(n){console.error("Error parsing JSON",n)}},n.prototype.touch=function(){this.set("_localLastUpdate",f.utils.getTime())},n.prototype.getLocalUpdateTimeStamp=function(){return this.get("_localLastUpdate")},n.prototype.genLocalId=function(){return f.utils.localId(this)},n.prototype.refresh=function(e,f){function n(e,n){!e&&n?(d.fromJSON(n),f(null,d)):f(e,d)}var o=this.getDataAgent(),d=this;"undefined"==typeof f&&(f=e,e=!1),e?o.attemptRead(this,n):o.read(this,n)},n.prototype.attemptRefresh=function(e){var f=this.getDataAgent(),n=this;f.attemptRead(this,function(f,o){!f&&o?(n.fromJSON(o),e(null,n)):e(f,n)})},n.prototype.loadLocal=function(e){var n=f.stores.localStorage,o=this;n.read(this,function(f,n){f?e(f):(n&&o.fromJSON(n),e(f,o))})},n.prototype.saveLocal=function(e){var n=f.stores.localStorage;n.upsert(this,e)},n.prototype.clearLocal=function(e){var n=f.stores.localStorage;n.removeEntry(this,e)},n.prototype.getDataAgent=function(){return this.dataAgent||this.setDataAgent(f.stores.dataAgent),this.dataAgent},n.prototype.setDataAgent=function(e){this.dataAgent=e},e.Model=n,e}(f.models||{}),f.models=function(e){function n(){o.call(this,{_type:"config",_ludid:"config"})}var o=f.models.Model,d=!0,i="notset";return f.utils.extend(n,o),n.prototype.init=function(e,f){e.studioMode?(this.set("studioMode",!0),this.fromJSON(e),f()):(this.set("studioMode",!1),this.staticConfig(e),this.refresh(!0,f))},n.prototype.isStudioMode=function(){return this.get("studioMode")},n.prototype.refresh=function(e,f){function n(e,n){var o={};if(!e&&n){if("string"==typeof n)try{o=JSON.parse(n)}catch(i){return $fh.forms.log.e("Invalid json config defintion from remote",i),o={},f(i,null)}else o=n;d.set("defaultConfigValues",o),d.saveLocal(function(e,n){f(e,d)})}else f(e,d)}var o=this.getDataAgent(),d=this;"undefined"==typeof f&&(f=e,e=!1),d.loadLocal(function(e,f){e&&$fh.forms.log.e("Config loadLocal ",e),o.remoteStore.read(d,n)})},n.prototype.getCloudHost=function(){return i},n.prototype.staticConfig=function(e){var f=this,n={defaultConfigValues:{},userConfigValues:{}};f.get("userConfigValues")&&(n.userConfigValues=f.get("userConfigValues"));var o=$fh&&$fh.app_props?$fh.app_props.appid:e.appid,d=$fh&&$fh.app_props?$fh.app_props.mode:"dev";f.set("appId",o),f.set("env",d),$fh&&$fh._getDeviceId?f.set("deviceId",$fh._getDeviceId()):f.set("deviceId","notset"),f._initMBaaS(e),e||(e={}),e.config_admin_user&&delete e.config_admin_user,n.defaultConfigValues=e;var i={sent_save_min:5,sent_save_max:1e3,targetWidth:640,targetHeight:480,quality:50,debug_mode:!1,logger:!1,max_retries:3,timeout:7,log_line_limit:5e3,log_email:"test@example.com",log_level:3,log_levels:["error","warning","log","debug"],config_admin_user:!0,picture_source:"both",saveToPhotoAlbum:!0,encodingType:"jpeg",sent_items_to_keep_list:[5,10,20,30,40,50,100]};for(var t in i)n.defaultConfigValues[t]=i[t];f.fromJSON(n)},n.prototype._initMBaaS=function(e){var f=this;e=e||{};var n=$fh.cloud_props,o=$fh.app_props;o&&(i=o.host),n&&n.hosts&&(i=n.hosts.url),"string"==typeof e.cloudHost&&(i=e.cloudHost),f.set("mbaasBaseUrl","/mbaas");f.get("appId");f.set("formUrls",{forms:"/forms/:appId",form:"/forms/:appId/:formId",theme:"/forms/:appId/theme",formSubmission:"/forms/:appId/:formId/submitFormData",fileSubmission:"/forms/:appId/:submissionId/:fieldId/:hashName/submitFormFile",base64fileSubmission:"/forms/:appId/:submissionId/:fieldId/:hashName/submitFormFileBase64",submissionStatus:"/forms/:appId/:submissionId/status",formSubmissionDownload:"/forms/:appId/submission/:submissionId",fileSubmissionDownload:"/forms/:appId/submission/:submissionId/file/:fileGroupId",completeSubmission:"/forms/:appId/:submissionId/completeSubmission",config:"/forms/:appid/config/:deviceId"}),f.set("statusUrl","/sys/info/ping")},n.prototype.setOnline=function(){var e=d;d=!0,e||this.emit("online")},n.prototype.setOffline=function(){var e=d;d=!1,e&&this.emit("offline")},n.prototype.isOnline=function(){return f.utils.isPhoneGap()&&navigator.connection&&navigator.connection.type?d===!0&&navigator.connection.type!==Connection.NONE:d===!0},n.prototype.isStudioMode=function(){return this.get("studioMode",!1)},e.config=new n,e}(f.models||{}),f.models=function(e){function n(){o.call(this,{_type:"forms",_ludid:"forms_list",loaded:!1})}var o=f.models.Model;return f.utils.extend(n,o),n.prototype.isFormUpdated=function(e){var f=e.get("_id"),n=e.getLastUpdate(),o=this.getFormMetaById(f);return o?n!==o.lastUpdatedTimestamp:!1},n.prototype.setLocalId=function(){$fh.forms.log.e("Forms setLocalId. Not Permitted for Forms.")},n.prototype.getFormMetaById=function(e){$fh.forms.log.d("Forms getFormMetaById ",e);for(var f=this.getFormsList(),n=0;n<f.length;n++){var o=f[n];if(o._id===e)return o}return $fh.forms.log.e("Forms getFormMetaById: No form found for id: ",e),null},n.prototype.size=function(){return this.get("forms").length},n.prototype.getFormsList=function(){return this.get("forms",[])},n.prototype.getFormIdByIndex=function(e){return $fh.forms.log.d("Forms getFormIdByIndex: ",e),this.getFormsList()[e]._id},e.forms=new n,e}(f.models||{}),f.models=function(e){function n(e,n){function i(){function e(){return l.fromJSON(p),l.initialise(),d[l.getFormId()]=l,n(null,l)}return $fh.forms.log.d("Form: loadFromLocal ",u,p,s,y),d[s]?(n(null,d[s]),d[s]):p?e():void l.refresh(!1,function(e,f){return e?n(e):(f.initialise(),d[s]=f,n(null,f))})}function t(){function e(e){$fh.forms.log.d("Form: checkForUpdate",u,p,s,y),e.refresh(!1,function(o,i){o&&$fh.forms.log.e("Error refreshing form from local: ",o),f.models.forms.isFormUpdated(e)?e.refresh(!0,function(f,o){return f?n(f,null):(e.initialise(),d[s]=o,n(f,o))}):(e.initialise(),d[s]=i,n(o,i))})}return $fh.forms.log.d("Form: loadFromRemote",u,p,s,y),d[s]&&($fh.forms.log.d("Form: loaded from cache",u,p,s,y),!f.models.forms.isFormUpdated(d[s]))?(n(null,d[s]),d[s]):void e(l)}var l=this,u=e.rawMode||!1,p=e.rawData||null,s=e.formId,y=e.fromRemote;return $fh.forms.log.d("Form: ",u,p,s,y),"function"!=typeof y&&"function"!=typeof n?$fh.forms.log.e("a callback function is required for initialising form data. new Form (formId, [isFromRemote], cb)"):("function"==typeof y&&(n=y,y=!1),s?(o.call(l,{_id:s,_type:"form"}),l.set("_id",s),l.setLocalId(l.genLocalId(s)),void(u===!0?i():t())):n("Cannot initialise a form object without an id. id:"+s,null))}var o=f.models.Model;e.Form=n;var d={};return f.utils.extend(n,o),n.prototype.getLastUpdate=function(){return $fh.forms.log.d("Form: getLastUpdate"),this.get("lastUpdatedTimestamp")},n.prototype.genLocalId=function(e){return e="string"==typeof e?e:this.get("_id",""),"form_"+e},n.prototype.initialise=function(){this.filterAdminFields(),this.initialisePage(),this.initialiseFields(),this.initialiseRules()},n.prototype.filterAdminFields=function(){for(var e=this.getPagesDef(),f={},n=0;n<e.length;n++){for(var o=e[n],d=o.fields,i=[],t=0,l=0;l<d.length;l++){var u=d[l];u.adminOnly||(f[u._id]={page:n,field:t},t++,i.push(u))}e[n].fields=i}this.set("pages",e),this.set("fieldRef",f)},n.prototype.initialiseFields=function(){$fh.forms.log.d("Form: initialiseFields");var e=this.getFieldRef();this.fields={};for(var n in e){var o=e[n],d=o.page,i=o.field;if(void 0===d||void 0===i)throw"Corruptted field reference";var t=this.getFieldDefByIndex(d,i);if(!t)throw"Field def is not found.";this.fields[n]=new f.models.Field(t,this)}},n.prototype.initialiseRules=function(){$fh.forms.log.d("Form: initialiseRules"),this.rules={};for(var e=this.getPageRules(),n=this.getFieldRules(),o=[],d=0;d<e.length;d++){var i=e[d];o.push({type:"page",definition:i})}for(d=0;d<n.length;d++){var t=n[d];o.push({type:"field",definition:t})}for(d=0;d<o.length;d++)for(var l=o[d],u=new f.models.Rule(l),p=u.getRelatedFieldId(),s=0;s<p.length;s++){var y=p[s];this.rules[y]||(this.rules[y]=[]),this.rules[y].push(u)}},n.prototype.getRulesByFieldId=function(e){return $fh.forms.log.d("Form: getRulesByFieldId"),this.rules[e]},n.prototype.initialisePage=function(){$fh.forms.log.d("Form: initialisePage");var e=this.getPagesDef();this.pages=[];for(var n=0;n<e.length;n++){var o=e[n],d=new f.models.Page(o,this);this.pages.push(d)}},n.prototype.getPageNumberByFieldId=function(e){return e?this.getFieldRef()[e].page:null},n.prototype.getPageModelList=function(){return this.pages},n.prototype.getName=function(){return this.get("name","")},n.prototype.getDescription=function(){return this.get("description","")},n.prototype.getPageRules=function(){return this.get("pageRules",[])},n.prototype.getFieldRules=function(){return this.get("fieldRules",[])},n.prototype.getFieldRef=function(){return this.get("fieldRef",{})},n.prototype.getPagesDef=function(){return this.get("pages",[])},n.prototype.getPageRef=function(){return this.get("pageRef",{})},n.prototype.getFieldModelById=function(e){return this.fields[e]},n.prototype.getFieldModelByCode=function(e){var f=this;if(!e||"string"!=typeof e)return null;for(var n in f.fields){var o=f.fields[n];if(null!==o.getCode()&&o.getCode()===e)return o}return null},n.prototype.getFieldDefByIndex=function(e,f){$fh.forms.log.d("Form: getFieldDefByIndex: ",e,f);var n=this.getPagesDef(),o=n[e];if(o){var d=o.fields?o.fields:[],i=d[f];if(i)return i}return $fh.forms.log.e("Form: getFieldDefByIndex: No field found for page and field index: ",e,f),null},n.prototype.getPageModelById=function(e){$fh.forms.log.d("Form: getPageModelById: ",e);var f=this.getPageRef()[e];return"undefined"!=typeof f?this.pages[f]:void $fh.forms.log.e("page id is not found in pageRef: "+e)},n.prototype.newSubmission=function(){return $fh.forms.log.d("Form: newSubmission"),f.models.submission.newInstance(this)},n.prototype.getFormId=function(){return this.get("_id")},n.prototype.removeFromCache=function(){$fh.forms.log.d("Form: removeFromCache"),d[this.getFormId()]&&delete d[this.getFormId()]},n.prototype.getFileFieldsId=function(){$fh.forms.log.d("Form: getFileFieldsId");var e=[];for(var f in this.fields){var n=this.fields[f];("file"===n.getType()||"photo"===n.getType()||"signature"===n.getType())&&e.push(f)}return e},n.prototype.getRuleEngine=function(){if($fh.forms.log.d("Form: getRuleEngine"),this.rulesEngine)return this.rulesEngine;var e=this.getProps();return this.rulesEngine=new f.RulesEngine(e),this.rulesEngine},n.prototype.getFieldsInSection=function(e){for(var f=this,n=f.getPageNumberByFieldId(e),o=f.pages[n],d=o.getFieldDef(),i=[],t=null,l=0;l<d.length;l++){var u=d[l];if(u._id===e)t=l;else if(l>t&&"sectionBreak"!==u.type)i.push(u);else if(l>t&&"sectionBreak"===u.type)break}return i},e}(f.models||{}),f.models=function(e){function n(e){$fh.forms.log.d("FileSubmission ",e),o.call(this,{_type:"fileSubmission",data:e})}var o=f.models.Model;return e.FileSubmission=n,f.utils.extend(n,o),n.prototype.loadFile=function(e){$fh.forms.log.d("FileSubmission loadFile");var n=this.getHashName(),o=this;f.stores.localStorage.readFile(n,function(f,d){f?($fh.forms.log.e("FileSubmission loadFile. Error reading file",n,f),e(f)):($fh.forms.log.d("FileSubmission loadFile. File read correctly",n,d),o.fileObj=d,e(null))})},n.prototype.getProps=function(){return this.fileObj?($fh.forms.log.d("FileSubmissionDownload: file object found"),this.fileObj):void $fh.forms.log.e("FileSubmissionDownload: no file object found")},n.prototype.setSubmissionId=function(e){$fh.forms.log.d("FileSubmission setSubmissionId.",e),this.set("submissionId",e)},n.prototype.getSubmissionId=function(){return this.get("submissionId")},n.prototype.getHashName=function(){return this.get("data").hashName},n.prototype.getFieldId=function(){return this.get("data").fieldId},e}(f.models||{}),f.models=function(e){function n(e){$fh.forms.log.d("FileSubmissionDownload ",e),o.call(this,{_type:"fileSubmissionDownload",data:e})}var o=f.models.Model;return e.FileSubmissionDownload=n,f.utils.extend(n,o),n.prototype.setSubmissionId=function(e){$fh.forms.log.d("FileSubmission setSubmissionId.",e),this.set("submissionId",e)},n.prototype.getSubmissionId=function(){return $fh.forms.log.d("FileSubmission getSubmissionId: ",this.get("submissionId")),this.get("submissionId","")},n.prototype.getHashName=function(){return $fh.forms.log.d("FileSubmission getHashName: ",this.get("data").hashName),this.get("data",{}).hashName},n.prototype.getFieldId=function(){return $fh.forms.log.d("FileSubmission getFieldId: ",this.get("data").fieldId),this.get("data",{}).fieldId},n.prototype.getFileMetaData=function(){return $fh.forms.log.d("FileSubmission getFileMetaData: ",this.get("data")),this.get("data")?$fh.forms.log.d("FileSubmission getFileMetaData: data found",this.get("data")):$fh.forms.log.e("FileSubmission getFileMetaData: No data found"),this.get("data",{})},n.prototype.getFileGroupId=function(){return $fh.forms.log.d("FileSubmission getFileGroupId: ",this.get("data")),this.get("data",{}).groupId||"notset"},n.prototype.getRemoteFileURL=function(){function e(){var e=n.getSubmissionId(),o=n.getFileGroupId(),d=f.config.get("formUrls",{}).fileSubmissionDownload;return d?(d=d.replace(":submissionId",e),d=d.replace(":fileGroupId",o),d=d.replace(":appId",f.config.get("appId","notSet")),f.models.config.getCloudHost()+"/mbaas"+d):"notset"}var n=this;return $fh.forms.log.d("FileSubmission getRemoteFileURL: "),e()},e}(f.models||{}),f.models=function(e){function n(e){o.call(this,{_type:"formSubmission",data:e})}var o=f.models.Model;return e.FormSubmission=n,f.utils.extend(n,o),n.prototype.getProps=function(){return this.get("data")},n.prototype.getFormId=function(){return this.get("data")||$fh.forms.log.e("No form data for form submission"),this.get("data").formId},e}(f.models||{}),f.models=function(e){function n(e){o.call(this,{_type:"completeSubmission",submissionId:e.get("submissionId"),localSubmissionId:e.get("localSubmissionId")})}var o=f.models.Model;return e.FormSubmissionComplete=n,f.utils.extend(n,o),e}(f.models||{}),f.models=function(e){function n(e){o.call(this,{_type:"formSubmissionDownload",data:e})}var o=f.models.Model;return e.FormSubmissionDownload=n,f.utils.extend(n,o),n.prototype.getSubmissionId=function(){return this.get("data").get("submissionId","not-set")},e}(f.models||{}),f.models=function(e){function n(e){o.call(this,{_type:"submissionStatus",submissionId:e.get("submissionId"),localSubmissionId:e.get("localSubmissionId")})}var o=f.models.Model;return e.FormSubmissionStatus=n,f.utils.extend(n,o),e}(f.models||{}),f.models=function(e){function n(e){o.call(this,e),this.set("_type","base64fileSubmission")}var o=f.models.FileSubmission;return e.Base64FileSubmission=n,f.utils.extend(n,o),e}(f.models||{}),f.models=function(e){function n(){o.call(this,{_type:"submissions",_ludid:"submissions_list",submissions:[]})}var o=f.models.Model;return f.utils.extend(n,o),n.prototype.setLocalId=function(){$fh.forms.log.e("Submissions setLocalId. Not Permitted for submissions.")},n.prototype.saveSubmission=function(e,f){$fh.forms.log.d("Submissions saveSubmission");var n=this;this.updateSubmissionWithoutSaving(e),this.clearSentSubmission(function(){n.saveLocal(f)})},n.prototype.updateSubmissionWithoutSaving=function(e){$fh.forms.log.d("Submissions updateSubmissionWithoutSaving");var f=this.pruneSubmission(e),n=f._ludid;if(n){var o=this.findMetaByLocalId(n),d=this.get("submissions");o?(d.splice(d.indexOf(o),1),d.push(f)):d.push(f)}else $fh.forms.log.e("Invalid submission for localId:",n,JSON.stringify(e))},n.prototype.clearSentSubmission=function(e){$fh.forms.log.d("Submissions clearSentSubmission");var f=this,n=$fh.forms.config.get("max_sent_saved")?$fh.forms.config.get("max_sent_saved"):$fh.forms.config.get("sent_save_min"),o=(this.get("submissions"),this.getSubmitted());if(o.length>n){$fh.forms.log.d("Submissions clearSentSubmission pruning sentSubmissions.length>maxSent"),o=o.sort(function(e,f){return Date(e.submittedDate)<Date(f.submittedDate)?1:-1});for(var d=[];o.length>n;)d.push(o.pop());for(var i=d.length,t=0;t<d.length;t++){var l=d[t];f.getSubmissionByMeta(l,function(f,n){n.clearLocal(function(f){f&&$fh.forms.log.e("Submissions clearSentSubmission submission clearLocal",f),i--,0===i&&e(null,null)})})}}else e(null,null)},n.prototype.findByFormId=function(e){$fh.forms.log.d("Submissions findByFormId",e);for(var f=[],n=this.get("submissions"),o=0;o<n.length;o++){var d=n[o];n[o].formId===e&&f.push(d)}return f},n.prototype.getSubmissions=function(){return this.get("submissions")},n.prototype.getSubmissionMetaList=n.prototype.getSubmissions,n.prototype.getSubmissionByLocalId=function(e,f){var n=this;$fh.forms.log.d("Submissions getSubmissionByLocalId",e);var o=n.findMetaByLocalId(e);return o?void n.getSubmissionByMeta(o,f):f("No submissions for localId: "+e)},n.prototype.getSubmissionByRemoteId=function(e,f){var n=this;$fh.forms.log.d("Submissions getSubmissionByRemoteId",e);var o=n.findMetaByRemoteId(e);return o?void n.getSubmissionByMeta(o,f):f("No submissions for remoteId: "+e)},n.prototype.findMetaByLocalId=function(e){$fh.forms.log.d("Submissions findMetaByLocalId",e);for(var f=this.get("submissions"),n=0;n<f.length;n++){var o=f[n];if(f[n]._ludid===e)return o}return $fh.forms.log.e("Submissions findMetaByLocalId: No submissions for localId: ",e),null},n.prototype.findMetaByRemoteId=function(e){e=e||"",$fh.forms.log.d("Submissions findMetaByRemoteId: "+e);for(var f=this.get("submissions"),n=0;n<f.length;n++){var o=f[n];if(f[n].submissionId&&f[n].submissionId===e)return o}return null},n.prototype.pruneSubmission=function(e){$fh.forms.log.d("Submissions pruneSubmission");for(var f=["_id","_ludid","status","formName","formId","_localLastUpdate","createDate","submitDate","deviceFormTimestamp","errorMessage","submissionStartedTimestamp","submittedDate","submissionId","saveDate","uploadStartDate"],n=e.getProps(),o={},d=0;d<f.length;d++){var i=f[d];o[i]=n[i]}return o},n.prototype.clear=function(e){$fh.forms.log.d("Submissions clear");var f=this;this.clearLocal(function(n){n?($fh.forms.log.e(n),e(n)):(f.set("submissions",[]),e(null,null))})},n.prototype.getDrafts=function(e){
return $fh.forms.log.d("Submissions getDrafts: ",e),e||(e={}),e.status="draft",this.findByStatus(e)},n.prototype.getPending=function(e){return $fh.forms.log.d("Submissions getPending: ",e),e||(e={}),e.status="pending",this.findByStatus(e)},n.prototype.getSubmitted=function(e){return $fh.forms.log.d("Submissions getSubmitted: ",e),e||(e={}),e.status="submitted",this.findByStatus(e)},n.prototype.getError=function(e){return $fh.forms.log.d("Submissions getError: ",e),e||(e={}),e.status="error",this.findByStatus(e)},n.prototype.getInProgress=function(e){return $fh.forms.log.d("Submissions getInProgress: ",e),e||(e={}),e.status="inprogress",this.findByStatus(e)},n.prototype.getDownloaded=function(e){return $fh.forms.log.d("Submissions getDownloaded: ",e),e||(e={}),e.status="downloaded",this.findByStatus(e)},n.prototype.findByStatus=function(e){if($fh.forms.log.d("Submissions findByStatus: ",e),e||(e={}),"string"==typeof e&&(e={status:e}),null===e.status)return[];for(var f=e.status,n=e.formId,o=e.sortField||"createDate",d=this.get("submissions",[]),i=[],t=0;t<d.length;t++)f.indexOf(d[t].status)>-1&&(null!=n?d[t].formId===n&&i.push(d[t]):i.push(d[t]));return i=i.sort(function(e,f){return Date(e[o])<Date(f[o])?-1:1})},n.prototype.getSubmissionByMeta=function(e,n){$fh.forms.log.d("Submissions getSubmissionByMeta: ",e);var o=e._ludid;o?f.models.submission.fromLocal(o,n):($fh.forms.log.e("Submissions getSubmissionByMeta: local id not found for retrieving submission.",o,e),n("local id not found for retrieving submission"))},n.prototype.removeSubmission=function(e,f){$fh.forms.log.d("Submissions removeSubmission: ",e);var n=this.indexOf(e);n>-1&&this.get("submissions").splice(n,1),this.saveLocal(f)},n.prototype.indexOf=function(e,f){$fh.forms.log.d("Submissions indexOf: ",e);for(var n=this.get("submissions"),o=0;o<n.length;o++){n[o];if(n[o]._ludid===e)return o}return-1},e.submissions=new n,e}(f.models||{}),f.models=function(e){function n(e,n){n=n?n:{};var o=new i(e,n);return n.submissionId&&f.models.submissions.updateSubmissionWithoutSaving(o),o}function o(e,f){if($fh.forms.log.d("Submission fromLocal: ",e),t[e])$fh.forms.log.d("Submission fromLocal from cache: ",e),f(null,t[e]);else{$fh.forms.log.d("Submission fromLocal not in cache. Loading from local storage.: ",e);var n=new i;n.setLocalId(e),n.loadLocal(function(n,o){if(n)$fh.forms.log.e("Submission fromLocal. Error loading from local: ",e,n),f(n);else{if($fh.forms.log.d("Submission fromLocal. Load from local sucessfull: ",e),o.isDownloadSubmission())return f(null,o);o.reloadForm(function(n,d){n?($fh.forms.log.e("Submission fromLocal. reloadForm. Error re-loading form: ",e,n),f(n)):($fh.forms.log.d("Submission fromLocal. reloadForm. Re-loading form successfull: ",e),t[e]=o,f(null,o))})}})}}function d(e){var f={},n=null;return _.each(e.pages,function(o){n=null,_.each(o.fieldsIds,function(o){var d=e.fields[o];"sectionBreak"===d.props.type?n=d:"pageBreak"!==d.props.type&&(f[d.props._id]=n)})}),f}function i(e,n){n=n||{},$fh.forms.log.d("Submission: ",n),l.call(this,{_type:"submission"}),"undefined"!=typeof e&&e?(this.set("formName",e.get("name")),this.set("formId",e.get("_id")),this.set("deviceFormTimestamp",e.getLastUpdate()),this.set("createDate",f.utils.getTime()),this.set("timezoneOffset",f.utils.getTime(!0)),this.set("appId",f.config.get("appId")),this.set("appEnvironment",f.config.get("env")),this.set("appCloudName",""),this.set("comments",[]),this.set("formFields",[]),this.set("saveDate",null),this.set("submitDate",null),this.set("uploadStartDate",null),this.set("submittedDate",null),this.set("userId",null),this.set("filesInSubmission",[]),this.set("deviceId",f.config.get("deviceId")),this.transactionMode=!1,this.applyDefaultValues(e)):(this.set("appId",f.config.get("appId")),n.submissionId?(this.set("downloadSubmission",!0),this.setRemoteSubmissionId(n.submissionId)):this.set("status","new")),this.set("status","new"),this.genLocalId();var o=this.getLocalId();t[o]=this}e.submission={newInstance:n,fromLocal:o};var t={},l=f.models.Model,u={"new":["draft","pending"],draft:["pending","draft"],pending:["inprogress","error","draft"],inprogress:["pending","error","inprogress","downloaded","queued"],submitted:[],error:["draft","pending","error"],downloaded:[],queued:["error","submitted"]};return f.utils.extend(i,l),i.prototype.saveDraft=function(e){$fh.forms.log.d("Submission saveDraft: ");var n="draft",o=this;this.set("timezoneOffset",f.utils.getTime(!0)),this.set("saveDate",f.utils.getTime()),this.changeStatus(n,function(f){return f?e(f):(o.emit("savedraft"),void e(null,null))})},i.prototype.validateField=function(e,f){$fh.forms.log.d("Submission validateField: ",e);var n=this;this.getForm(function(o,d){if(o)f(o);else{var i=n.getProps(),t=d.getRuleEngine();t.validateField(e,i,f)}})},i.prototype.checkRules=function(e){$fh.forms.log.d("Submission checkRules: ");var f=this;this.getForm(function(n,o){if(n)e(n);else{var d=f.getProps(),i=o.getRuleEngine();i.checkRules(d,e)}})},i.prototype.performValidation=function(e){var f=this;f.getForm(function(n,o){if(n)return $fh.forms.log.e("Submission submit: Error getting form ",n),e(n);var d=o.getRuleEngine(),i=f.getProps();d.validateForm(i,e)})},i.prototype.validateSubmission=function(e){var f=this;f.performValidation(function(n,o){if(n)return e(n);var d=o.validation;return d.valid?e(null,d.valid):(f.emit("validationerror",d),void e(null,d.valid))})},i.prototype.removeHiddenFieldValues=function(e){var f=this;async.waterfall([function(e){f.checkRules(e)},function(e,n){f.getForm(function(f,o){return n(f,e,o)})},function(e,n,o){var d=e.actions,i=["fields","pages"],t=_.map(i,function(e){var o=[],i=_.map(d[e]||{},function(e,f){return"hide"===e.action?{id:e.targetId,sectionIndex:e.sectionIndex}:null});return o="pages"===e?_.map(i,function(e){if(!e)return[];var o=n.getPageModelById(e.id)||{};if(!o.fieldsIds)return[];var d=f.getFormFields();return d=d.filter(function(e){return o.fieldsIds.find(function(f){return f===e.fieldId})}),d.forEach(function(e){e.id=e.fieldId}),d}):i,_.compact(_.flatten(o))});t=_.flatten(t),async.forEachSeries(t,function(e,n){f.removeFieldValue(e.id,null,e.sectionIndex,n)},function(e){return e&&$fh.forms.log.e("Error removing fields",e),o(e)})}],e)},i.prototype.submit=function(e){var n=this;$fh.forms.log.d("Submission submit: ");var o="pending";n.set("timezoneOffset",f.utils.getTime(!0)),n.pruneNullValues(),async.waterfall([function(e){n.removeHiddenFieldValues(e)},function(e){n.pruneRemovedFields(e)},function(e){n.performValidation(function(f,n){return f&&$fh.forms.log.e("Submission submit validateForm: Error validating form ",f),e(f,n)})},function(e,f){$fh.forms.log.d("Submission submit: validateForm. Completed result",e);var d=e.validation||{};d.valid?($fh.forms.log.d("Submission submit: validateForm. Completed Form Valid",e),n.set("submitDate",new Date),n.changeStatus(o,function(e){e?f(e):(n.emit("submit"),f(null,null))})):($fh.forms.log.d("Submission submit: validateForm. Completed Validation error",e),n.emit("validationerror",d),f("Validation error"))}],e)},i.prototype.getUploadTask=function(e){var n=this.getUploadTaskId();n?f.models.uploadManager.getTaskById(n,e):e(null,null)},i.prototype.getFormId=function(){return this.get("formId")},i.prototype.getFormSubmittedAgainst=function(){return this.get("formSubmittedAgainst")},i.prototype.getDownloadTask=function(e){var f=this;if($fh.forms.log.d("getDownloadTask"),f.isDownloadSubmission())f.getUploadTask(e);else if(e&&"function"==typeof e)return $fh.forms.log.e("Submission is not a download submission"),e("Submission is not a download submission")},i.prototype.cancelUploadTask=function(e){var n="submit",o=this;f.models.uploadManager.cancelSubmission(this,function(f){f&&$fh.forms.log.e(f),o.changeStatus(n,e)})},i.prototype.getUploadTaskId=function(){return this.get("uploadTaskId")},i.prototype.setUploadTaskId=function(e){this.set("uploadTaskId",e)},i.prototype.isInProgress=function(){return"inprogress"===this.get("status")},i.prototype.isDownloaded=function(){return"downloaded"===this.get("status")},i.prototype.isSubmitted=function(){return"submitted"===this.get("status")},i.prototype.submitted=function(e){var n=this;if(n.isDownloadSubmission()){var o="Downloaded submissions should not call submitted function.";return $fh.forms.log.e(o),e(o)}$fh.forms.log.d("Submission submitted called");var d="submitted";n.set("submittedDate",f.utils.getTime()),n.changeStatus(d,function(f){f?($fh.forms.log.e("Error setting submitted status "+f),e(f)):($fh.forms.log.d("Submitted status set for submission "+n.get("submissionId")+" with localId "+n.getLocalId()),n.emit("submitted",n.get("submissionId")),e(null,null))})},i.prototype.queued=function(e){var n=this;if(n.isDownloadSubmission()){var o="Downloaded submissions should not call queued function.";return $fh.forms.log.e(o),e(o)}var d="queued";n.set("queuedDate",f.utils.getTime()),n.changeStatus(d,function(f){f?($fh.forms.log.e("Error setting queued status "+f),e(f)):($fh.forms.log.d("Queued status set for submission "+n.get("submissionId")+" with localId "+n.getLocalId()),n.emit("queued",n.get("submissionId")),e(null,n))})},i.prototype.downloaded=function(e){$fh.forms.log.d("Submission Downloaded called");var n=this,o="downloaded";n.set("downloadedDate",f.utils.getTime()),n.pruneNullValues(),n.changeStatus(o,function(f){f?($fh.forms.log.e("Error setting downloaded status "+f),e(f)):($fh.forms.log.d("Downloaded status set for submission "+n.get("submissionId")+" with localId "+n.getLocalId()),n.emit("downloaded",n.get("submissionId")),e(null,n))})},i.prototype.pruneNullValues=function(){for(var e=this.getFormFields(),f=0;f<e.length;f++)e[f].fieldValues=e[f].fieldValues||[],e[f].fieldValues=e[f].fieldValues.filter(function(e){return null!==e&&"undefined"!=typeof e});this.setFormFields(e)},i.prototype.pruneRemovedFields=function(e){var f=this,n=this.getFormFields(),o=[],d=[];this.getForm(function(i,t){return i?e(i):(_.each(n,function(e){var f=e.fieldId;t.fields.hasOwnProperty(f)?o.push(e):d.push(f)}),void async.forEach(d,function(e,n){f.removeFieldValue(e,null,n)},function(n){f.set("formFields",o),e(n)}))})},i.prototype.applyDefaultValues=function(e){var f=this.getFormFields();_.each(e.fields,function(e,n){var o=e.getDefaultValue();if(o){var d=_.findWhere(f,{fieldId:n});d||f.push({fieldId:n,fieldValues:[o]})}})},i.prototype.genLocalId=function(){var e=f.utils.localId(this),n=this.get("formId")||Math.ceil(1e5*Math.random());this.setLocalId(n+"_"+e)},i.prototype.changeStatus=function(e,f){if(this.isStatusValid(e)){this.set("status",e),this.saveToList(function(e){e&&$fh.forms.log.e(e)}),this.saveLocal(f)}else $fh.forms.log.e("Target status is not valid: "+e),f("Target status is not valid: "+e)},i.prototype.upload=function(e){var n="inprogress",o=this;return this.isStatusValid(n)?(this.set("status",n),this.set("uploadStartDate",f.utils.getTime()),f.models.submissions.updateSubmissionWithoutSaving(this),f.models.uploadManager.queueSubmission(o,function(f,n){f?e(f):(n.set("error",null),n.saveLocal(function(e){e&&$fh.forms.log.e("Error saving upload task: "+e)}),o.emit("inprogress",n),n.on("progress",function(e){$fh.forms.log.d("Emitting upload progress for submission: "+o.getLocalId()+JSON.stringify(e)),o.emit("progress",e)}),e(null,n))}),void 0):e("Invalid Status to upload a form submission.")},i.prototype.download=function(e){var n=this;$fh.forms.log.d("Starting download for submission: "+n.getLocalId());var o="pending";return this.isStatusValid(o)?(this.set("status",o),o="inprogress",this.isStatusValid(o)?(this.set("status",o),void f.models.uploadManager.queueSubmission(n,function(f,o){return f?e(f):(o.set("error",null),o.saveLocal(function(e){e&&$fh.forms.log.e("Error saving download task: "+e)}),n.emit("inprogress",o),o.on("progress",function(e){$fh.forms.log.d("Emitting download progress for submission: "+n.getLocalId()+JSON.stringify(e)),n.emit("progress",e)}),e(null,o))})):e("Invalid Status to dowload a form submission")):e("Invalid Status to download a form submission.")},i.prototype.saveToList=function(e){f.models.submissions.saveSubmission(this,e)},i.prototype.error=function(e,f){this.set("errorMessage",e);var n="error";this.changeStatus(n,f),this.emit("error",e)},i.prototype.getStatus=function(){return this.get("status")},i.prototype.getErrorMessage=function(){return this.get("errorMessage","No Error")},i.prototype.isStatusValid=function(e){$fh.forms.log.d("isStatusValid. Target Status: "+e+" Current Status: "+this.get("status").toLowerCase());var f=this.get("status").toLowerCase(),n=u[f];return n.indexOf(e)>-1?!0:(this.set("status","error"),!1)},i.prototype.addComment=function(e,n){var o=f.utils.getTime(),d=o.getTime(),i={madeBy:"undefined"==typeof n?"":n.toString(),madeOn:o,value:e,timeStamp:d};return this.getComments().push(i),d},i.prototype.getComments=function(){return this.get("comments")},i.prototype.removeComment=function(e){for(var f=this.getComments(),n=0;n<f.length;n++){var o=f[n];if(o.timeStamp===e)return void f.splice(n,1)}},i.prototype.populateFilesInSubmission=function(){for(var e=this,f=[],n=e.getSubmissionFiles(),o=0;o<n.length;o++)n[o].fileName?f.push(n[o].fileName):n[o].hashName&&f.push(n[o].hashName);e.set("filesInSubmission",n)},i.prototype.getSubmissionFiles=function(){var e=this;$fh.forms.log.d("In getSubmissionFiles: "+e.getLocalId());for(var f=[],n=e.getFormFields(),o=0;o<n.length;o++)for(var d=n[o].fieldValues||[],i=0;i<d.length;i++)d[i]&&d[i].fileName?f.push(d[i]):d[i]&&d[i].hashName&&f.push(d[i]);return f},i.prototype.addInputValue=function(e,f){function n(n,o){i.tmpFields[p]||(i.tmpFields[p]=[]),e.isStore=!1,o.processInput(e,function(e,n){return e?f(e):(l>-1?i.tmpFields[p][l]=n:i.tmpFields[p].push(n),f(null,n))})}function o(n,o){var d=i.getInputValueObjectById(t,u);l>-1&&d.fieldValues[l]&&("string"==typeof d.fieldValues[l].hashName?e.previousFile=d.fieldValues[l]:e.previousValue=d.fieldValues[l]),o.processInput(e,function(e,n){return e?f(e):(l>-1?d.fieldValues[l]=n:d.fieldValues.push(n),n&&"string"==typeof n.hashName&&i.pushFile(n.hashName),f(null,n))})}function d(e,d){var l=d.getFieldModelById(t);return l?void(i.transactionMode?n(d,l):o(d,l)):f("No field model found for fieldId "+t)}$fh.forms.log.d("Adding input value: ",JSON.stringify(e||{}));var i=this,t=e.fieldId,l=(e.value,void 0===e.index?-1:e.index),u=e.sectionIndex?e.sectionIndex:0,p=t+":"+u;return t?void this.getForm(d):f("Invalid parameters. fieldId is required")},i.prototype.pushFile=function(e){var f=this.get("filesInSubmission",[]);"string"==typeof e&&-1===f.indexOf(e)&&(f.push(e),this.set("filesInSubmission",f))},i.prototype.removeFileValue=function(e){var f=this.get("filesInSubmission",[]);"string"==typeof e&&f.indexOf(e)>-1&&(f.splice(f.indexOf(e),1),this.set("filesInSubmission",f))},i.prototype.getInputValueByFieldId=function(e,f,n){!n&&_.isFunction(f)&&(n=f,f=0);var o=this.getInputValueObjectById(e,f).fieldValues;this.getForm(function(f,d){var i=d.getFieldModelById(e);i.convertSubmission(o,n)})},i.prototype.reset=function(){var e=this;e.clearLocalSubmissionFiles(function(f){e.set("formFields",[])})},i.prototype.isDownloadSubmission=function(){return this.get("downloadSubmission")===!0},i.prototype.getSubmissionFile=function(e,n){f.stores.localStorage.readFile(e,n)},i.prototype.clearLocalSubmissionFiles=function(e){$fh.forms.log.d("In clearLocalSubmissionFiles");var n=this,o=n.get("filesInSubmission",[]);$fh.forms.log.d("Files to clear ",o);for(var d in o)$fh.forms.log.d("Clearing file "+o[d]),f.stores.localStorage.removeEntry(o[d],function(e){e&&$fh.forms.log.e("Error removing files from "+e)});e()},i.prototype.startInputTransaction=function(){this.transactionMode=!0,this.tmpFields={}},i.prototype.endInputTransaction=function(e){this.transactionMode=!1;var n={},o="",d=0,i=[],t="";if(e){n=this.tmpFields;for(o in n){var l=o.split(":"),u=this.getInputValueObjectById(l[0],parseInt(l[1]));for(i=n[o],d=0;d<i.length;d++)t=i[d],u.fieldValues.push(t),"string"==typeof t.hashName&&this.pushFile(t.hashName)}this.tmpFields={}}else{n=this.tmpFields,this.tmpFields={};for(o in n)for(i=n[o],d=0;d<i.length;d++)t=i[d],"string"==typeof t.hashName&&f.stores.localStorage.removeEntry(t.hashName,function(e){$fh.forms.log.e("Error removing file from transaction ",e)})}},i.prototype.removeFieldValue=function(e,n,o,d){!d&&_.isFunction(o)&&(d=o,o=0),d=d||function(){};var i=this,t=[],l={};t=this.transactionMode?this.tmpFields[e+":"+o]:this.getInputValueObjectById(e,o).fieldValues,null===n||"undefined"==typeof n?l=t.splice(0,t.length):t.length>n&&(l=t.splice(n,1,null)),async.forEach(l,function(e,n){e&&e.hashName?f.stores.localStorage.removeEntry(e.hashName,function(f){return f?$fh.forms.log.e("Error removing file: ",f,e):i.removeFileValue(e.hashName),n(null,e)}):async.setImmediate(function(){return n()})},function(e){d(e)})},i.prototype.removeFormField=function(e,f){if(this.transactionMode)delete this.tmpFields[e+":"+f];else{var n=this.getInputValueObjectById(e,f),o=this.getFormFields(),d=o.indexOf(n);d>-1&&o.splice(d,1)}},i.prototype.getInputValueObjectById=function(e,f){_.isUndefined(f)&&(f=0);for(var n=this.getFormFields(),o=0;o<n.length;o++){var d=n[o],i=_.isUndefined(d.sectionIndex)||d.sectionIndex===f;if(d.fieldId._id&&d.fieldId._id===e&&i)return d;if(d.fieldId===e&&i)return d}var t={fieldId:e,fieldValues:[],sectionIndex:f||0};return n.push(t),t},i.prototype.getFieldValues=function(e){var f=this.getFormFields();return f.filter(function(f){return f.fieldId._id?f.fieldId._id===e:f.fieldId===e})},i.prototype.getSectionValues=function(e,f,n){_.isUndefined(f)&&(f=0);var o=this.getFormFields();this.getForm(function(i,t){var l=d(t),u=o.filter(function(n){var o=l[n.fieldId]&&l[n.fieldId].props._id===e;return o&&n.sectionIndex===f});n(null,u)})},i.prototype.getForm=function(e){var n=f.models.Form,o=this.get("formId");return o?($fh.forms.log.d("FormId found for getForm: "+o),void new n({formId:o,rawMode:!0},e)):($fh.forms.log.e("No form Id specified for getForm"),e("No form Id specified for getForm"))},i.prototype.reloadForm=function(e){$fh.forms.log.d("Submission reload form");var n=f.models.Form,o=this.get("formId"),d=this;new n({formId:o,rawMode:!0},function(f,n){f?e(f):(d.form=n,d.get("deviceFormTimestamp",null)||d.set("deviceFormTimestamp",n.getLastUpdate()),e(null,n))})},i.prototype.getFileInputValues=function(e){var f=this;f.getFileFieldsId(function(n,o){return n?e(n):e(null,f.getInputValueArray(o))})},i.prototype.getFormFields=function(){return this.get("formFields",[])},i.prototype.setFormFields=function(e){return this.get("formFields",e)},i.prototype.getFileFieldsId=function(e){var f=this,n=[];if(f.isDownloadSubmission()){for(var o=f.getFormFields(),d=0;d<o.length;d++){var i=o[d].fieldId||{};("file"===i.type||"photo"===i.type||"signature"===i.type)&&i._id&&n.push(i._id)}return e(null,n)}f.getForm(function(f,n){return f?($fh.forms.log.e("Error getting form for getFileFieldsId"+f),e(f)):e(f,n.getFileFieldsId())})},i.prototype.updateFileLocalURI=function(e,f,n){$fh.forms.log.d("updateFileLocalURI: "+f);var o=this;return e=e||{},e.fileName&&f?void o.findFilePlaceholderFieldId(e.fileName,function(d,i){if(d)return n(d);if(!i.fieldId)return $fh.forms.log.e("No file field matches the placeholder name "+e.fileName),n("No file field matches the placeholder name "+e.fileName);var t=o.getInputValueObjectById(i.fieldId,i.sectionIndex).fieldValues[i.valueIndex];t.localURI=f,o.getInputValueObjectById(i.fieldId,i.sectionIndex).fieldValues[i.valueIndex]=t,o.saveLocal(n)}):($fh.forms.log.e("Submission: updateFileLocalURI : No fileName for submissionId : "+JSON.stringify(e)),n("Submission: updateFileLocalURI : No fileName for submissionId : "+JSON.stringify(e)))},i.prototype.findFilePlaceholderFieldId=function(e,f){var n=this,o={};n.getFileFieldsId(function(d,i){for(var t=0;t<i.length;t++){var l=i[t],u=n.getFieldValues(l);u.forEach(function(f){for(var d=n.getInputValueObjectById(f.fieldId,f.sectionIndex),i=0;i<d.fieldValues.length;i++){var t=d.fieldValues[i];t&&null!==t.fileName&&t.fileName===e&&(o.fieldId=l,o.valueIndex=i,o.sectionIndex=f.sectionIndex)}})}return f(null,o)})},i.prototype.getInputValueArray=function(e){for(var f=this,n=[],o=0;o<e.length;o++){var d=e[o],i=this.getFieldValues(d);i.forEach(function(e){for(var o=f.getInputValueObjectById(d,e.sectionIndex),i=0;i<o.fieldValues.length;i++){var t=o.fieldValues[i];t&&(t.fieldId=d,n.push(t))}})}return n},i.prototype.clearLocal=function(e){var n=this;f.models.uploadManager.cancelSubmission(n,function(o,d){return o?($fh.forms.log.e(o),e(o)):void f.models.submissions.removeSubmission(n.getLocalId(),function(f){return f?($fh.forms.log.e(f),e(f)):void n.clearLocalSubmissionFiles(function(){l.prototype.clearLocal.call(n,function(f){return f?($fh.forms.log.e(f),e(f)):void e(null,null)})})})})},i.prototype.getRemoteSubmissionId=function(){return this.get("submissionId")||this.get("_id")},i.prototype.setRemoteSubmissionId=function(e){e&&(this.set("submissionId",e),this.set("_id",e))},i.prototype.removeSection=function(e,f,n){var o=this;n=n||function(){};async.waterfall([function(e){o.getForm(e)},function(n,d){var i=n.getFieldsInSection(e);async.forEachSeries(i,function(e,n){o.removeFieldValue(e._id,null,f,n)},function(e){d(e)})},function(e){o.pruneRemovedFields(e)}],n)},e}(f.models||{}),f.models=function(e){function n(e,f){o.call(this,{_type:"field"}),e&&(this.fromJSON(e),this.genLocalId()),f&&(this.form=f)}var o=f.models.Model;return f.utils.extend(n,o),n.prototype.isRequired=function(){return this.get("required")},n.prototype.getFieldValidation=function(){return this.getFieldOptions().validation||{}},n.prototype.getFieldDefinition=function(){return this.getFieldOptions().definition||{}},n.prototype.getMinRepeat=function(){var e=this.getFieldDefinition();return e.minRepeat||1},n.prototype.getMaxRepeat=function(){var e=this.getFieldDefinition();return e.maxRepeat||1},n.prototype.getFieldOptions=function(){return this.get("fieldOptions",{validation:{},definition:{}})},n.prototype.getPhotoOptions=function(){var e={targetWidth:null,targetHeight:null,quality:null,saveToPhotoAlbum:null,pictureSource:null,encodingType:null},f=this.getFieldDefinition();return e.targetWidth=f.photoWidth,e.targetHeight=f.photoHeight,e.quality=f.photoQuality,e.saveToPhotoAlbum=f.saveToPhotoAlbum,e.pictureSource=f.photoSource,e.encodingType=f.photoType,e},n.prototype.isRepeating=function(){return this.get("repeating",!1)},n.prototype.getType=function(){return this.get("type","text")},n.prototype.getFieldId=function(){return this.get("_id","")},n.prototype.getName=function(){return this.get("name","unknown")},n.prototype.getCode=function(){return this.get("fieldCode",null)},n.prototype.getHelpText=function(){return this.get("helpText","")},n.prototype.getDefaultValue=function(){var e=this.getFieldDefinition();return this.isMultiChoiceField()?this.getDefaultMultiValue():e.defaultValue},n.prototype.getDefaultMultiValue=function(){var e=this.getFieldDefinition();if(!e.options)return null;var f=_.filter(e.options,function(e){return e.checked});return _.isEmpty(f)?null:(f=_.pluck(f,"label"),this.isCheckboxField()?f:_.first(f))},n.prototype.isAdminField=function(){return this.get("adminOnly")},n.prototype.isMultiChoiceField=function(){return this.isCheckboxField()||this.isRadioField()||this.isDropdownField()},n.prototype.isCheckboxField=function(){return"checkboxes"===this.get("type")},n.prototype.isRadioField=function(){return"radio"===this.get("type")},n.prototype.isDropdownField=function(){return"dropdown"===this.get("type")},n.prototype.isSectionBreak=function(){return"sectionBreak"===this.get("type")},n.prototype.processInput=function(e,f){var n=this.getType(),o="process_"+n,d=e.value;return"undefined"==typeof d||null===d?f(null,d):void(this[o]&&"function"==typeof this[o]?this[o](e,f):f(null,d))},n.prototype.convertSubmission=function(e,f){var n=this.getType(),o="convert_"+n;this[o]&&"function"==typeof this[o]?this[o](e,f):f(null,e)},n.prototype.validate=function(e,f,n){"function"==typeof f&&(n=f,f=0),this.form.getRuleEngine().validateFieldValue(this.getFieldId(),e,f,n)},n.prototype.getRules=function(){var e=this.getFieldId();return this.form.getRulesByFieldId(e)},n.prototype.setVisible=function(e){this.set("visible",e),e?this.emit("visible"):this.emit("hidden")},n.prototype.getSectionId=function(){var e=this,f=e.getFieldId(),n=e.getType();if("sectionBreak"===n)return f;var o=e.form,d=o?o.getFieldRef()[f]:null;if(!d||!d.field||0===d.fieldRef)return null;var i=o.pages[d.page],t=null;return i.fieldsIds.some(function(e){var n=i.getFieldModelById(e);return n.isSectionBreak()&&(t=e),e===f}),t},e.Field=n,e}(f.models||{}),f.models.Field=function(e){return e.prototype.process_barcode=function(e,f){var n=e.value||{};return"string"==typeof n.text&&"string"==typeof n.format?f(null,{text:n.text,format:n.format}):f("Invalid barcode parameters.")},e}(f.models.Field||{}),f.models.Field=function(e){return e.prototype.getCheckBoxOptions=function(){var e=this.getFieldDefinition();if(e.options)return e.options;throw"checkbox choice definition is not found in field definition"},e.prototype.process_checkboxes=function(e,f){var n=e.value;n&&n.selections&&n.selections instanceof Array?f(null,n):f("the input value for processing checkbox field should be like {selections: [val1,val2]}")},e.prototype.convert_checkboxes=function(e,f){for(var n=[],o=0;o<e.length;o++)n.push(e[o].selections);f(null,n)},e}(f.models.Field||{}),f.models.Field=function(e){return e.prototype.process_file=function(e,n){function o(e,f){return e=e||"",f=f||"",e.length>0?e:f.indexOf(".png")>-1?"image/png":f.indexOf(".jpg")>-1?"image/jpeg":"application/octet-stream"}function d(e,f){if(e=e||"",e.length>0)return e;var n=f.lastIndexOf("/");return n>-1?f.slice(n):null}var i=e.value,t=void 0===e.isStore?!0:e.isStore,l=(new Date).getTime(),u=e.previousFile||{},p=null;if("undefined"==typeof i||null===i)return n("No input value to process_file",null);var s=i;i instanceof HTMLInputElement&&(s=i.files[0]||{}),"undefined"==typeof s.lastModifiedDate&&(l=f.utils.getTime().getTime()),s.lastModifiedDate instanceof Date&&(l=s.lastModifiedDate.getTime());var y=d(s.name||s.fileName,s.fullPath),c=o(s.type||s.fileType,y);if(null===y&&!u.fileName)return n("Expected picture to be PNG or JPEG but was null");if(u.hashName){if(y===u.hashName||s.hashName===u.hashName)return n(null,u);if("application/octet-stream"===c)return n(null,u)}u={fileName:y,fileSize:s.size,fileType:c,fileUpdateTime:l,hashName:"",imgHeader:"",contentType:"binary"};var r=y+(new Date).getTime()+Math.ceil(1e5*Math.random());f.utils.md5(r,function(e,o){p=o,e&&(p=r),p="filePlaceHolder"+p,0===y.length&&(u.fileName=p),u.hashName=p,t?f.stores.localStorage.saveFile(p,s,function(e,f){e?($fh.forms.log.e(e),n(e)):n(null,u)}):n(null,u)})},e}(f.models.Field||{}),f.models.Field=function(e){return e.prototype.process_location=function(e,f){var n=e.value,o=this.getFieldDefinition(),d={};switch(o.locationUnit){case"latlong":n.lat&&n["long"]?(d={lat:n.lat,"long":n["long"]},f(null,d)):f("the input values for latlong field is {lat: number, long: number}");break;case"eastnorth":n.zone&&n.eastings&&n.northings?(d={zone:n.zone,eastings:n.eastings,northings:n.northings},f(null,d)):f("the input values for northeast field is {zone: text, eastings: text, northings:text}");break;default:f("Invalid subtype type of location field, allowed types: latlong and eastnorth, was: "+o.locationUnit)}},e}(f.models.Field||{}),f.models.Field=function(e){return e.prototype.getMatrixRows=function(){var e=this.getFieldDefinition();if(e.rows)return e.rows;throw"matrix rows definition is not found in field definition"},e.prototype.getMatrixCols=function(){var e=this.getFieldDefinition();if(e.columns)return e.columns;throw"matrix columns definition is not found in field definition"},e}(f.models.Field||{}),f.models.Field=function(e){return e.prototype.getRadioOption=function(){var e=this.getFieldDefinition();if(e.options)return e.options;throw"Radio options definition is not found in field definition"},e}(f.models.Field||{}),f.models.Field=function(e){return e.prototype.getDropdownOptions=function(){var e=this.getFieldDefinition(),f=[];e.include_blank_option&&f.push({label:""});for(var n=e.options||[],o=0;o<n.length;o++)f.push(n[o]);return f},e}(f.models.Field||{}),f.models.Field=function(e){function n(e,n){var d=this,i=e.value,t=void 0===e.isStore?!0:e.isStore,l=e.previousFile||{};if("string"!=typeof i)return n("Expected base64 string image or file URI but parameter was not a string",null);if(i.length<1)return n("Expected base64 string or file uri but got string of lenght 0:  "+i,null);if(i.indexOf(";base64,")>-1){var u="",p=i.split(";base64,"),s=p[0].split(":")[1],y=s.split("/")[1],c=i.length;o(function(e,o){u=l.hashName?l.hashName:"filePlaceHolder"+o;var d={fileName:u+"."+y,hashName:u,contentType:"base64",fileSize:c,fileType:s,imgHeader:"data:"+s+";base64,",fileUpdateTime:(new Date).getTime()};t?f.stores.localStorage.updateTextFile(u,p[1],function(e,f){e?($fh.forms.log.e(e),n(e)):n(null,d)}):n(null,d)})}else f.utils.fileSystem.readAsFile(i,function(f,o){return f?n(f):(e.value=o,void d.process_file(e,n))})}function o(e){var n=(new Date).getTime()+""+Math.ceil(1e5*Math.random());f.utils.md5(n,e)}function d(e,f){if(0===e.length)f(null,e);else for(var n=e.length,o=0;o<e.length;o++){var d=e[o];i(d,function(e,o){n--,0===n&&f(null,[o])})}}function i(e,n){if(e){if(e.localURI)return n(null,e);var o=e.hashName;"base64"===e.contentType?f.stores.localStorage.readFileText(o,function(f,o){f&&$fh.forms.log.e(f),e.data=o,n(f,e)}):"binary"===e.contentType?f.stores.localStorage.readFile(o,function(f,d){f&&$fh.forms.log.e("Error reading file "+o,f),d&&d.localURL?e.data=d.localURL:e.data="file-not-found",n(f,e)}):$fh.forms.log.e("Error load image with invalid meta"+e.contentType)}else n(null,e)}return e.prototype.process_signature=n,e.prototype.convert_signature=d,e.prototype.process_photo=n,e.prototype.convert_photo=d,e}(f.models.Field||{}),f.models=function(e){function n(e,f){if("undefined"==typeof e||"undefined"==typeof f)throw"Page initialise failed: new Page(pageDefinitionJSON, parentFormModel)";o.call(this,{_type:"page"}),this.fromJSON(e),this.form=f,this.initialise()}var o=f.models.Model;return f.utils.extend(n,o),n.prototype.initialise=function(){var e=this.getFieldDef();this.fieldsIds=[];for(var f=0;f<e.length;f++)this.fieldsIds.push(e[f]._id)},n.prototype.setVisible=function(e){this.set("visible",e),e?this.emit("visible"):this.emit("hidden")},n.prototype.getFieldDef=function(){return this.get("fields",[])},n.prototype.getFieldModelList=function(){for(var e=[],f=0;f<this.fieldsIds.length;f++)e.push(this.form.getFieldModelById(this.fieldsIds[f]));return e},n.prototype.checkForSectionBreaks=function(){for(var e=0;e<this.fieldsIds.length;e++){var f=this.form.getFieldModelById(this.fieldsIds[e]);if(f&&"sectionBreak"===f.getType())return!0}return!1},n.prototype.getSections=function(){var e={},f=null,n=this.checkForSectionBreaks(),o=!1,d=this.get("_id");if(!n)return null;var i=this.form.getFieldModelById(this.fieldsIds[0]);"sectionBreak"!==i.getType()&&(o=!0);for(var t=0;t<this.fieldsIds.length;t++){var l=this.form.getFieldModelById(this.fieldsIds[t]);o&&0===t&&(f="sectionBreak"+d+"0",e[f]=e[f]?e[f]:{fields:[]},e[f].title="Section "+(t+1)),null!==f&&"sectionBreak"!==l.getType()&&e[f].fields.push(l),"sectionBreak"===l.getType()&&(f=l.get("_id"),e[f]=e[f]?e[f]:{fields:[]},e[f].title=l.get("name","Section "+(t+1)),e[f].description=l.get("helpText","Section "+(t+1)),e[f].repeating=l.isRepeating(),e[f].minRepeat=l.getMinRepeat(),e[f].maxRepeat=l.getMaxRepeat())}return e},n.prototype.getFieldModelById=function(e){return this.form.getFieldModelById(e)},n.prototype.getPageId=function(){return this.get("_id","")},n.prototype.getName=function(){return this.get("name","")},n.prototype.getDescription=function(){
return this.get("description","")},n.prototype.getFieldDef=function(){return this.get("fields",[])},n.prototype.getFieldModelList=function(){for(var e=[],f=0;f<this.fieldsIds.length;f++)e.push(this.form.getFieldModelById(this.fieldsIds[f]));return e},e.Page=n,e}(f.models||{}),f.models=function(e){function n(){var e=this;o.call(e,{_type:"uploadManager",_ludid:"uploadManager_queue"}),e.set("taskQueue",[]),e.sending=!1,e.timerInterval=200,e.sendingStart=f.utils.getTime()}var o=f.models.Model;return f.utils.extend(n,o),n.prototype.queueSubmission=function(e,n){$fh.forms.log.d("Queueing Submission for uploadManager");var o,d=null,i=this;i.checkOnlineStatus(function(){return $fh.forms.config.isOnline()?(e.getUploadTaskId()?o=e.getUploadTaskId():(d=f.models.uploadTask.newInstance(e),o=d.getLocalId()),i.push(o),i.timer||($fh.forms.log.d("Starting timer for uploadManager"),i.start()),d?d.saveLocal(function(e){e&&$fh.forms.log.e(e),i.saveLocal(function(e){e&&$fh.forms.log.e("Error saving upload manager: "+e),n(null,d)})}):i.saveLocal(function(e){e&&$fh.forms.log.e("Error saving upload manager: "+e),i.getTaskById(o,n)}),void 0):n("Working offline cannot submit form.")})},n.prototype.cancelSubmission=function(e,f){var n=e.getUploadTaskId(),o=this.get("taskQueue");if(n){var d=o.indexOf(n);d>-1&&o.splice(d,1),this.getTaskById(n,function(e,n){e?($fh.forms.log.e(e),f(e,n)):n?n.clearLocal(f):f(null,null)}),this.saveLocal(function(e){e&&$fh.forms.log.e(e)})}else f(null,null)},n.prototype.getTaskQueue=function(){return this.get("taskQueue",[])},n.prototype.start=function(){var e=this;e.stop(),e.timer=setInterval(function(){e.tick()},this.timerInterval)},n.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},n.prototype.push=function(e){this.get("taskQueue").push(e),this.saveLocal(function(e){e&&$fh.forms.log.e("Error saving local Upload manager",e)})},n.prototype.shift=function(){var e=this.get("taskQueue").shift();return this.saveLocal(function(e){e&&$fh.forms.log.e(e)}),e},n.prototype.rollTask=function(){this.push(this.shift())},n.prototype.tick=function(){var e=this;if(e.sending){var n=f.utils.getTime(),o=n.getTime()-e.sendingStart.getTime();o>1e3*$fh.forms.config.get("timeout")&&($fh.forms.log.e("Uploading content timeout. it will try to reupload."),e.sending=!1,e.rollTask())}else e.hasTask()?(e.sending=!0,e.sendingStart=f.utils.getTime(),e.getCurrentTask(function(f,n){f||!n?($fh.forms.log.e(f),e.sending=!1):n.isCompleted()||n.isError()?(e.shift(),e.sending=!1,e.saveLocal(function(e){e&&$fh.forms.log.e("Error saving upload manager: ",e)})):e.checkOnlineStatus(function(){$fh.forms.config.isOnline()?n.uploadTick(function(f){f&&$fh.forms.log.e("Error on upload tick: ",f,n),e.sending=!1}):$fh.forms.log.d("Upload Manager: Tick: Not online.")})})):e.stop()},n.prototype.hasTask=function(){return this.get("taskQueue").length>0},n.prototype.getCurrentTask=function(e){var f=this.getTaskQueue()[0];f?this.getTaskById(f,e):e(null,null)},n.prototype.checkOnlineStatus=function(e){f.stores.dataAgent.checkOnlineStatus(e)},n.prototype.getTaskById=function(e,n){f.models.uploadTask.fromLocal(e,n)},e.uploadManager=new n,e}(f.models||{}),f.models=function(e){function n(e){o.call(this,{_type:"rule"}),this.fromJSON(e)}var o=f.models.Model;return f.utils.extend(n,o),n.prototype.getRelatedFieldId=function(){for(var e=this.getDefinition(),f=e.ruleConditionalStatements,n=[],o=0;o<f.length;o++){var d=f[o];n.push(d.sourceField)}return n},n.prototype.test=function(e){for(var f=this.getRelatedFieldId(),n=this.getLogic(),o="or"===n?!1:!0,d=0;d<f.length;d++){var i=f[d],t=e[i];if(t){var l=this.testField(i,t);if("or"===n){if(o=o||l,o===!0)return!0}else if(o=o&&l,o===!1)return!1}else{if("or"!==n)return!1;o=o||!1}}return o},n.prototype.testField=function(e,n){var o=this.getRuleConditionStatement(e),d=o.restriction,i=o.sourceValue;return f.models.checkRule(d,i,n)},n.prototype.getRuleConditionStatement=function(e){for(var f=this.getDefinition().ruleConditionalStatements,n=0;n<f.length;n++){var o=f[n];if(o.sourceField===e)return o}return null},n.prototype.getLogic=function(){var e=this.getDefinition();return e.ruleConditionalOperator.toLowerCase()},n.prototype.getDefinition=function(){return this.get("definition")},n.prototype.getAction=function(){var e=this.getDefinition(),f={action:e.type,targetId:"page"===this.get("type")?e.targetPage:e.targetField,targetType:this.get("type")};return f},e.Rule=n,e}(f.models||{}),f.models=function(e){function n(e){if(e){var f=new d;return f.init(e),i[f.getLocalId()]=f,f}return{}}function o(e,f){if(i[e])return f(null,i[e]);var n=new d;n.setLocalId(e),i[e]=n,n.loadLocal(f)}function d(){t.call(this,{_type:"uploadTask"})}e.uploadTask={newInstance:n,fromLocal:o};var i={},t=f.models.Model;return f.utils.extend(d,t),d.prototype.init=function(e){function f(){var f=e.getProps();o.set("jsonTask",f),o.set("formId",e.get("formId"))}function n(){o.set("submissionId",e.getRemoteSubmissionId()),o.set("jsonTask",{}),o.set("submissionTransferType","download")}var o=this,d=e.getLocalId();o.setLocalId(d+"_uploadTask"),o.set("submissionLocalId",d),o.set("fileTasks",[]),o.set("currentTask",null),o.set("completed",!1),o.set("retryAttempts",0),o.set("retryNeeded",!1),o.set("mbaasCompleted",!1),o.set("submissionTransferType","upload"),e.setUploadTaskId(o.getLocalId()),e.isDownloadSubmission()?n():f()},d.prototype.getTotalSize=function(){for(var e,f=this,n=JSON.stringify(f.get("jsonTask")).length,o=f.get("fileTasks"),d=0,i=0;i<o.length;i++)e=o[i],d+=e.fileSize;return n+d},d.prototype.getUploadedSize=function(){var e=this.getCurrentTask();if(null===e)return 0;for(var f,n=JSON.stringify(this.get("jsonTask")).length,o=this.get("fileTasks"),d=0,i=0;(f=o[i])&&e>i;i++)d+=f.fileSize;return n+d},d.prototype.getRemoteStore=function(){return f.stores.dataAgent.remoteStore},d.prototype.addFileTasks=function(e,f){var n=this;e.getFileInputValues(function(e,o){if(e)return $fh.forms.log.e("Error getting file Input values: "+e),f(e);for(var d=0;d<o.length;d++){var i=o[d];n.addFileTask(i)}f()})},d.prototype.addFileTask=function(e){this.get("fileTasks").push(e)},d.prototype.getCurrentTask=function(){return this.get("currentTask",null)},d.prototype.getRetryAttempts=function(){return this.get("retryAttempts")},d.prototype.increRetryAttempts=function(){this.set("retryAttempts",this.get("retryAttempts")+1)},d.prototype.resetRetryAttempts=function(){this.set("retryAttempts",0)},d.prototype.isStarted=function(){return null===this.getCurrentTask()?!1:!0},d.prototype.setSubmissionQueued=function(e){var f=this;f.submissionModel(function(n,o){return n?e(n):(f.get("submissionId")&&o.setRemoteSubmissionId(f.get("submissionId")),void o.queued(e))})},d.prototype.uploadForm=function(e){function n(n){$fh.forms.log.d("In processUploadDataResult");var o=t.get("jsonTask");if(n.error)return $fh.forms.log.e("Error submitting form "+n.error),e("Error submitting form "+n.error);var d=n.submissionId;o.lastUpdate=f.utils.getTime(),t.set("submissionId",d),t.setSubmissionQueued(function(f){return t.increProgress(),t.saveLocal(function(e){e&&$fh.forms.log.e("Error saving uploadTask to local storage"+e)}),t.emit("progress",t.getProgress()),e(null)})}function o(f,n){return $fh.forms.log.d("In processDownloadDataResult"),f?($fh.forms.log.e("Error downloading submission data"+f),e(f)):void t.submissionModel(function(f,o){if($fh.forms.log.d("Got SubmissionModel",f,o),f)return e(f);var d={};if("string"==typeof n)try{d=JSON.parse(n)}catch(i){return $fh.forms.log.e("processDownloadDataResult Invalid JSON Object Returned",n),e("Invalid JSON Object Returned")}else d=n;d.status&&delete d.status,o.fromJSON(d),t.set("jsonTask",n),o.saveLocal(function(f){$fh.forms.log.d("Saved SubmissionModel",f,o),f&&$fh.forms.log.e("Error saving updated submission from download submission: "+f),t.addFileTasks(o,function(f){return $fh.forms.log.d("addFileTasks called",f,o),f?e(f):(t.increProgress(),void t.saveLocal(function(f){return f&&$fh.forms.log.e("Error saving downloadTask to local storage"+f),t.emit("progress",t.getProgress()),e()}))})})})}function d(){$fh.forms.log.d("In uploadSubmissionJSON");var o=t.get("jsonTask");t.submissionModel(function(d,i){return d?e(d):void t.addFileTasks(i,function(d){if(d)return $fh.forms.log.e("Error adding file tasks for submission upload"),e(d);var i=new f.models.FormSubmission(o);t.getRemoteStore().create(i,function(f,o){if(f)return e(f);var d=o.updatedFormDefinition;d?t.refreshForm(d,function(e){$fh.forms.log.d("Form Updated, refreshed"),e&&$fh.forms.log.e(e),n(o)}):n(o)})})})}function i(){var e=new f.models.FormSubmissionDownload(t);t.getRemoteStore().read(e,o)}var t=this;t.isDownloadTask()?i():d()},d.prototype.handleCompletionError=function(e,f,n){$fh.forms.log.d("handleCompletionError Called");var o=e;o="pending"===f.status?"Submission Still Pending.":"error"===f.status?"Error completing submission":"Invalid return type from complete submission",n(o)},d.prototype.handleIncompleteSubmission=function(e){function n(){var n=d.getRemoteStore(),o=new f.models.FormSubmissionStatus(d);n.submissionStatus(o,function(f,n){var o="";if(f)e(f);else if("error"===n.status)o="Error submitting form.",e(o);else if("complete"===n.status)d.increProgress(),e();else if("pending"===n.status){var i=n.pendingFiles||[];i.length>0?d.resetUploadTask(i,function(){e()}):(d.increProgress(),e())}else o="Invalid submission status response.",e(o)})}function o(){e()}var d=this;d.isDownloadTask()?o():n()},d.prototype.resetUploadTask=function(e,f){var n,o=this.get("fileTasks"),d=[];for(n=0;n<o.length;n++)e.indexOf(o[n].hashName)<0&&d.push(o[n]);for(n=0;n<o.length;n++)e.indexOf(o[n].hashName)>-1&&d.push(o[n]);var i=o.length-e.length-1,t=0;i>0&&(t=i),this.set("currentTask",t),this.set("fileTasks",d),this.saveLocal(f)},d.prototype.uploadFile=function(e){function n(){$fh.forms.log.d("processUploadFile for submissionId: "),t="base64"===l.contentType?new f.models.Base64FileSubmission(l):new f.models.FileSubmission(l),t.setSubmissionId(u),t.loadFile(function(n){return n?($fh.forms.log.e("Error loading file for upload: "+n),e(n)):void d.getRemoteStore().create(t,function(n,o){if(n)e(n);else if("ok"===o.status||200===o.status||"200"===o.status)l.updateDate=f.utils.getTime(),d.increProgress(),d.saveLocal(function(e){e&&$fh.forms.log.e("Error saving upload task"+e)}),d.emit("progress",d.getProgress()),e(null);else{var i="File upload failed for file: "+l.fileName;e(i)}})})}function o(){$fh.forms.log.d("processDownloadFile called"),t=new f.models.FileSubmissionDownload(l),t.setSubmissionId(u),d.getRemoteStore().read(t,function(f,n){return f?($fh.forms.log.e("Error downloading a file from remote: "+f),e(f)):($fh.forms.log.d("processDownloadFile called. Local File Path: "+n),void d.submissionModel(function(f,o){return f?($fh.forms.log.e("Error Loading submission model for processDownloadFile "+f),e(f)):void o.updateFileLocalURI(l,n,function(f){return f?($fh.forms.log.e("Error updating file local url for fileTask "+JSON.stringify(l)),e(f)):(d.increProgress(),d.saveLocal(function(e){e&&$fh.forms.log.e("Error saving download task")}),d.emit("progress",d.getProgress()),e())})}))})}var d=this,i=d.getCurrentTask();null===i&&(i=0,d.set("currentTask",i));var t,l=d.get("fileTasks",[])[i],u=d.get("submissionId");return l?u?void(d.isDownloadTask()?o():n()):($fh.forms.log.e("No submission id found when trying to transfer a file."),e("No submission Id found")):($fh.forms.log.e("No file task found when trying to transfer a file."),e("cannot find file task"))},d.prototype.isDownloadTask=function(){return"download"===this.get("submissionTransferType")},d.prototype.setRetryNeeded=function(e){null!=this.get("submissionId",null)?this.set("retryNeeded",e):(this.set("retryNeeded",!1),this.set("currentTask",null))},d.prototype.retryNeeded=function(){return this.get("retryNeeded")},d.prototype.uploadTick=function(e){function f(f){f?($fh.forms.log.d("Err, retrying transfer: "+n.getLocalId()),n.increRetryAttempts(),n.getRetryAttempts()<=$fh.forms.config.get("max_retries")?(n.setRetryNeeded(!0),n.saveLocal(function(f){f&&$fh.forms.log.e("Error saving upload taskL "+f),e()})):(n.setRetryNeeded(!0),n.resetRetryAttempts(),n.error(f,function(){e(f)}))):(n.setRetryNeeded(!1),n.saveLocal(function(e){e&&$fh.forms.log.e("Error saving upload task to local memory"+e)}),n.submissionModel(function(f,n){if(f)e(f);else{var o=n.get("status");"inprogress"!==o&&"submitted"!==o&&"downloaded"!==o&&"queued"!==o?($fh.forms.log.e("Submission status is incorrect. Upload task should be started by submission object's upload method."+o),e("Submission status is incorrect. Upload task should be started by submission object's upload method.")):e()}}))}var n=this;this.isFormCompleted()?this.retryNeeded()?this.handleIncompleteSubmission(f):this.isFileCompleted()?this.isMBaaSCompleted()?this.isCompleted()?f(null,null):this.success(f):this.uploadComplete(f):this.uploadFile(f):this.uploadForm(f)},d.prototype.increProgress=function(){var e=this.getCurrentTask();null===e?e=0:e++,this.set("currentTask",e)},d.prototype.uploadComplete=function(e){function n(){$fh.forms.log.d("processDownloadComplete Called"),d.increProgress(),e(null)}function o(){$fh.forms.log.d("processUploadComplete Called");var n=d.getRemoteStore(),o=new f.models.FormSubmissionComplete(d);n.create(o,function(f,n){return n=n||{},"complete"!==n.status?d.handleCompletionError(f,n,e):(d.increProgress(),void e(null))})}$fh.forms.log.d("UploadComplete Called");var d=this,i=d.get("submissionId",null);return null===i?e("Failed to complete submission. Submission Id not found."):void(d.isDownloadTask()?n():o())},d.prototype.success=function(e){function f(e){$fh.forms.log.d("processUploadSuccess Called"),o.submissionModel(function(f,n){return f?e(f):(n.setRemoteSubmissionId(d),void n.submitted(e))})}function n(e){$fh.forms.log.d("processDownloadSuccess Called"),o.submissionModel(function(f,n){return f?e(f):(n.populateFilesInSubmission(),void n.downloaded(e))})}$fh.forms.log.d("Transfer Sucessful. Success Called.");var o=this,d=o.get("submissionId",null);o.set("completed",!0),o.saveLocal(function(d){d&&$fh.forms.log.e("Error Clearing Upload Task"),o.isDownloadTask()?n(function(f){o.clearLocal(e)}):f(function(f){o.clearLocal(e)})})},d.prototype.error=function(e,f){var n=this;$fh.forms.log.e("Error uploading submission: ",e),n.set("error",e),n.saveLocal(function(o){o&&$fh.forms.log.e("Upload task save failed: "+o),n.submissionModel(function(o,d){o?f(o):(d.setUploadTaskId(null),d.error(e,function(e){e&&$fh.forms.log.e("Error updating submission model to error status ",e),n.clearLocal(function(e){e&&$fh.forms.log.e("Error clearing upload task local storage: ",e),f(e)})}))})})},d.prototype.isFormCompleted=function(){var e=this.getCurrentTask();return null===e?!1:!0},d.prototype.isFileCompleted=function(){var e=this.getCurrentTask();return null===e?!1:e<this.get("fileTasks",[]).length?!1:!0},d.prototype.isError=function(){var e=this.get("error",null);return e?!0:!1},d.prototype.isCompleted=function(){return this.get("completed",!1)},d.prototype.isMBaaSCompleted=function(){var e=this;if(e.isFileCompleted()){var f=e.getCurrentTask();return f>e.get("fileTasks",[]).length?(e.set("mbaasCompleted",!0),e.saveLocal(function(e){e&&$fh.forms.log.e("Error saving upload task: ",e)}),!0):!1}return!1},d.prototype.getProgress=function(){var e=this,f={formJSON:!1,currentFileIndex:0,totalFiles:e.get("fileTasks").length,totalSize:e.getTotalSize(),uploaded:e.getUploadedSize(),retryAttempts:e.getRetryAttempts(),submissionTransferType:e.get("submissionTransferType"),submissionRemoteId:e.get("submissionId"),submissionLocalId:e.get("submissionLocalId")},n=e.getCurrentTask();return null===n?f:(f.formJSON=!0,f.currentFileIndex=n,f)},d.prototype.refreshForm=function(e,n){var o=this.get("formId");new f.models.Form({formId:o,rawMode:!0,rawData:e},function(f,o){f&&$fh.forms.log.e(f),$fh.forms.log.l("successfully updated form the form with id "+e._id),n()})},d.prototype.submissionModel=function(e){f.models.submission.fromLocal(this.get("submissionLocalId"),function(f,n){f&&$fh.forms.log.e("Error getting submission model from local memory "+f),e(f,n)})},e}(f.models||{}),f.models=function(e){function n(){o.call(this,{_type:"theme",_ludid:"theme_object"})}var o=f.models.Model;return n.prototype.getCSS=function(){return this.get("css","")},f.utils.extend(n,o),e.theme=new n,e}(f.models||{}),f.models=function(e){function n(){o.call(this,{_type:"log",_ludid:"log"}),this.set("logs",[]),this.isWriting=!1,this.moreToWrite=!1}var o=f.models.Model;return f.utils.extend(n,o),n.prototype.info=function(e,f){if($fh.forms.config.get("logger")===!0){var n="",o=$fh.forms.config.get("log_level"),d=$fh.forms.config.get("log_levels"),i=this;if("string"==typeof e?(n=e,e=d.indexOf(e.toLowerCase())):e=0,o=isNaN(parseInt(o,10))?o:parseInt(o,10),e=isNaN(parseInt(e,10))?e:parseInt(e,10),e>o)return;var t=Array.prototype.splice.call(arguments,0),l=i.get("logs");t.shift();for(var u="";t.length>0;)u+=JSON.stringify(t.shift())+" ";if(l.push(i.wrap(u,n)),l.length>$fh.forms.config.get("log_line_limit")&&l.shift(),i.isWriting)i.moreToWrite=!0;else{var p=function(){i.moreToWrite&&(i.moreToWrite=!1,i.write(p))};i.write(p)}}},n.prototype.wrap=function(e,f){var n=new Date,o=n.toISOString();"object"==typeof e&&(e=JSON.stringify(e));var d=o+" "+f.toUpperCase()+" "+e;return d},n.prototype.write=function(e){var f=this;f.isWriting=!0,f.saveLocal(function(){f.isWriting=!1,e()})},n.prototype.e=function(){var e=Array.prototype.splice.call(arguments,0);e.unshift("error"),this.info.apply(this,e)},n.prototype.w=function(){var e=Array.prototype.splice.call(arguments,0);e.unshift("warning"),this.info.apply(this,e)},n.prototype.l=function(){var e=Array.prototype.splice.call(arguments,0);e.unshift("log"),this.info.apply(this,e)},n.prototype.d=function(){var e=Array.prototype.splice.call(arguments,0);e.unshift("debug"),this.info.apply(this,e)},n.prototype.getLogs=function(){return this.get("logs")},n.prototype.clearLogs=function(e){this.set("logs",[]),this.saveLocal(function(){e&&e()})},n.prototype.sendLogs=function(e){var n=$fh.forms.config.get("log_email"),o=f.config.getProps(),d=this.getLogs(),i={type:"email",to:n,subject:"App Forms App Logs",body:"Configuration:\n"+JSON.stringify(o)+"\n\nApp Logs:\n"+d.join("\n")};f.utils.send(i,e)},e.log=new n,f.log=e.log,e}(f.models||{}),f.api=function(e){function n(e,n){"function"==typeof e&&(n=e,e={}),e=e?e:{},n=n?n:y;var o=e.fromRemote;void 0===o&&(o=!1),f.models.forms.refresh(o,n)}function o(e,n){"function"==typeof e&&(n=e,e={}),e=e?e:{},n=n?n:y,new f.models.Form(e,n)}function d(e,n){"function"==typeof e&&(n=e,e={}),e=e?e:{},n=n?n:y;var o=f.models.theme;e.fromRemote||(e.fromRemote=!1),o.refresh(e.fromRemote,function(f,d){return f?n(f):null===d?n(new Error("No theme defined for this app")):e.css===!0?n(null,o.getCSS()):n(null,o)})}function i(e,n){"function"==typeof e&&(n=e,e={}),e=e?e:{},n=n?n:y;f.models.submissions;null===u?f.models.submissions.loadLocal(function(e){e?($fh.forms.log.e(e),n(e)):(u=f.models.submissions,n(null,u))}):n(null,u)}function t(e,f){return e?void e.submit(function(n){return n?f(n):void e.upload(f)}):f("Invalid submission object.")}function l(e,n){function o(e){e="string"==typeof e&&24===e.length?null:e,$fh.forms.log.d("finishSubmissionDownload ",e,d);var f=d.getRemoteSubmissionId(),o=p[f];if(!o)return d.clearEvents(),n(e,d);for(var i=o.pop();"function"==typeof i;)i(e,d),i=o.pop();d.clearEvents&&d.clearEvents()}$fh.forms.log.d("downloadSubmission called",e),e=e?e:{};if(n="function"==typeof n?n:function(){},!e.submissionId)return $fh.forms.log.e("No submissionId passed to download a submission"),n("No submissionId passed to download a submission");var d=null;$fh.forms.log.d("downloadSubmission SubmissionId exists"+e.submissionId);var i=f.models.submissions.findMetaByRemoteId(e.submissionId);null===i?($fh.forms.log.d("downloadSubmission submission does not exist, downloading",e),d=new f.models.submission.newInstance(null,{submissionId:e.submissionId}),d.on("error",o),d.on("downloaded",o),"function"==typeof e.updateFunction&&d.on("progress",e.updateFunction),"function"==typeof n&&(p[e.submissionId]?p[e.submissionId].push(n):(p[e.submissionId]=[],p[e.submissionId].push(n))),d.download(function(e){return e?($fh.forms.log.e("Error queueing submission for download "+e),n(e)):void 0})):($fh.forms.log.d("downloadSubmission submission exists",e),"downloaded"!==i.status&&"submitted"!==i.status?"function"==typeof n&&(p[e.submissionId]?p[e.submissionId].push(n):(p[e.submissionId]=[],p[e.submissionId].push(n))):f.models.submissions.getSubmissionByMeta(i,function(e,f){return e?n(e):(f.emit("downloaded",f.getRemoteSubmissionId()),n(void 0,f))}))}e.getForms=n,e.getForm=o,e.getTheme=d,e.submitForm=t,e.getSubmissions=i,e.downloadSubmission=l,e.init=f.init,e.log=f.models.log,e._events={},e.on=function(f,n,o){e._events[f]||(e._events[f]=[]),e._events[f].indexOf(n)<0&&e._events[f].push({callOnce:o,func:n})},e.once=function(f,n){e.on(f,n,!0)},e.emit=function(){var f=Array.prototype.slice.call(arguments,0),n=f.shift(),o=e._events[n];if(o&&o.length>0)for(var d=0;d<o.length;d++){var i=o[d],t=o[d].func;i.called&&i.callOnce||(i.called=!0,t.apply(this,f))}};var u=null,p={},s=f.models.config,y=function(e){e=e?e:"",$fh.forms.log.w("Default Function Called "+e)},c={editAllowed:function(){var e=s.get("defaultConfigValues",{});return e.config_admin_user===!0},get:function(e){if(e){var f=s.get("userConfigValues",{}),n=s.get("defaultConfigValues",{});return f[e]?f[e]:n[e]}},getDeviceId:function(){return s.get("deviceId","Not Set")},set:function(e,f){var n=this;if("string"==typeof e&&"undefined"!=typeof f&&null!==f&&(n.editAllowed()||"max_sent_saved"===e)){var o=s.get("userConfigValues",{});o[e]=f,s.set("userConfigValues",o)}},getConfig:function(){var e=this,f=s.get("defaultConfigValues",{}),n=s.get("userConfigValues",{}),o={};if(e.editAllowed()){for(var d in f)n[d]?o[d]=n[d]:o[d]=f[d];return o}return f},saveConfig:function(e){s.saveLocal(function(f,n){f?$fh.forms.log.e("Error saving a form config: ",f):$fh.forms.log.l("Form config saved sucessfully."),"function"==typeof e&&e()})},offline:function(){s.setOffline()},online:function(){s.setOnline()},mbaasOnline:function(e){"function"==typeof e&&s.on("online",e)},mbaasOffline:function(e){"function"==typeof e&&s.on("offline",e)},isOnline:function(){return s.isOnline()},isStudioMode:function(){return s.isStudioMode()},refresh:function(e){s.refresh(!0,e)}};return e.config=c,e}(f.api||{}),"undefined"==typeof $fh&&($fh={}),void 0===$fh.forms&&($fh.forms=f.api),function n(e,f,o){function d(t,l){if(!f[t]){if(!e[t]){var u="function"==typeof require&&require;if(!l&&u)return u(t,!0);if(i)return i(t,!0);var p=new Error("Cannot find module '"+t+"'");throw p.code="MODULE_NOT_FOUND",p}var s=f[t]={exports:{}};e[t][0].call(s.exports,function(f){var n=e[t][1][f];return d(n?n:f)},s,s.exports,n,e,f,o)}return f[t].exports}for(var i="function"==typeof require&&require,t=0;t<o.length;t++)d(o[t]);return d}({1:[function(e,n,o){!function(){var o=e("async"),d=e("underscore"),i=e("moment"),t="date",l="time",u="datetime",p=function(e){function f(){d.each(pe.pages,function(e){d.each(e.fields,function(f){return f.pageId=e._id,f.adminOnly?void(ye[f._id]=f):(f.fieldOptions=f.fieldOptions?f.fieldOptions:{},f.fieldOptions.definition=f.fieldOptions.definition?f.fieldOptions.definition:{},f.fieldOptions.validation=f.fieldOptions.validation?f.fieldOptions.validation:{},se[f._id]=f,void(f.required&&"sectionBreak"!==f.type&&"pageBreak"!==f.type&&(ce[f._id]={field:f,sections:{},validated:!1,valueRequired:f.required})))})})}function n(){d.each(pe.fieldRules,function(e){d.each(e.ruleConditionalStatements,function(f){var n=f.sourceField;ae[n]=ae[n]||[],ae[n].push(e)}),d.isArray(e.targetField)?d.each(e.targetField,function(f){we[f]=we[f]||[],we[f].push(e)}):(we[e.targetField]=we[e.targetField]||[],we[e.targetField].push(e))})}function p(){d.each(pe.pageRules,function(e){d.each(e.ruleConditionalStatements,function(f){var n=f.sourceField;be[n]=be[n]||[],be[n].push(e)}),d.isArray(e.targetPage)?d.each(e.targetPage,function(f){ge[f]=ge[f]||[],ge[f].push(e)}):(ge[e.targetPage]=ge[e.targetPage]||[],ge[e.targetPage].push(e))})}function s(){re=JSON.parse(JSON.stringify(ce)),me={};var e;return d.each(ue.formFields,function(f){return f.fieldId?(f.sectionIndex=f.sectionIndex||0,ye[f.fieldId]?void(e="Submission "+f.fieldId+" is an admin field. Admin fields cannot be passed to the rules engine."):(me[f.fieldId]=me[f.fieldId]||{},void(me[f.fieldId][f.sectionIndex]=f))):void(e=new Error("No fieldId in this submission entry: "+JSON.stringify(f)))}),e}function y(){le||(m(),f(),n(),p(),le=!0)}function c(e){return y(),ue=e,s()}function r(e){var f=d.map(xe,function(f,n){return e===f?se[n]:null});return d.compact(f)}function a(e,f){var n=j();d.each(n,function(f){var n=v(f._id),o=r(f._id);d.each(o,function(o){var i=d.filter(me[o._id],function(e,f){return parseInt(f)>=n});return d.each(i,function(o){var d={};d.fieldId=o.fieldId,d.valid=!1,d.fieldErrorMessage=["Expected a maximum of "+n+" sections but got "+(o.sectionIndex+1)+"."],d.sectionId=xe[o.fieldId],d.sectionIndex=o.sectionIndex,x(f._id,o.sectionIndex,e.validation,d),e.validation.valid=!1})})}),f(void 0,e)}function w(e,f,n){return f&&f.formFields?void o.filter(f.formFields,function(f,n){return n(f.fieldId.toString()===e.fieldId.toString())},function(e){var f=null;return e&&e[0]&&e[0].fieldValues&&(f=e[0].fieldValues),n(void 0,f)}):n()}function b(e,f,n){"function"==typeof f&&(n=f,f=null),y();var d=c(e);return d?n(d):void o.waterfall([function(e){var n={validation:{valid:!0}};g(n,f,e)},k,a],function(e,f){return e?n(e):n(void 0,f)})}function g(e,f,n){o.each(ue.formFields,function(n,o){var d=n.fieldId,i=se[d],t=n.sectionIndex||0;w(n,f,function(f,l){return f?o(f):void B(n,i,l,function(f,n){return f?o(f):(n.valid||(e.validation.valid=!1,x(d,t,e.validation,n)),o())})})},function(f){return n(f,e)})}function m(){var e=null;d.each(pe.pages,function(f){e=null,d.each(f.fields,function(f){"sectionBreak"===f.type?e=f._id:"pageBreak"!==f.type&&(xe[f._id]=e)})})}function x(e,f,n,o){n[e]=n[e]||{sections:{}},n[e].sections[f]=o,0===f&&d.defaults(n[e],n[e].sections[0])}function h(e){var f=xe[e],n=f?se[f]:null;return n&&n.repeating&&n.fieldOptions.definition.minRepeat?n.fieldOptions.definition.minRepeat:1}function j(){return d.filter(se,function(e){return"sectionBreak"===e.type&&e.fieldOptions&&e.fieldOptions.definition&&e.fieldOptions.definition.maxRepeat})}function v(e){var f=se[e];return f&&f.repeating&&f.fieldOptions.definition.maxRepeat?f.fieldOptions.definition.maxRepeat:1}function k(e,f){o.each(Object.keys(re),function(f,n){var i=re[f],t=h(f);o.each(d.range(t),function(n,o){var d=i&&i.sections&&i.sections[n]&&i.sections[n].submitted;return d?o():void oe(f,!0,n,function(d,t){var l={};return d?o(d):(t&&i.valueRequired&&(l.fieldId=f,l.valid=!1,l.fieldErrorMessage=["Required Field Not Submitted"],l.sectionId=xe[f],l.sectionIndex=n,x(f,n,e.validation,l),e.validation.valid=!1),o())})},n)},function(n){return f(n,e)})}function q(e,f,n,o){y(),d.isFunction(n)&&(o=n,n=0);var i=c(f);if(i)return o(i);var t=me[e][n],l=se[e];B(t,l,null,function(f,d){if(f)return o(f);var i={validation:{}};return x(e,n,i.validation,d),o(void 0,i)})}function z(e,f,n,o,i){function t(f,n){var d={errorMessages:[]};return f&&d.errorMessages.push(f),A(e,d,o,function(f,d){if(f)return n(f);var i={validation:{}};return x(e,o,i.validation,d),n(void 0,i)})}"function"==typeof n&&(i=n,n=0,o=0),d.isFunction(o)&&(i=o,o=0),y();var l=se[e],u=!1;u=l.repeating&&l.fieldOptions&&l.fieldOptions.definition&&l.fieldOptions.definition.minRepeat?n<l.fieldOptions.definition.minRepeat:l.required;var p=l.fieldOptions&&l.fieldOptions.validation?l.fieldOptions.validation:void 0;if(p&&!1===p.validateImmediately){var s={validation:{valid:!0}};return x(e,o,s.validation,{valid:!0}),i(void 0,s)}var c=ce[l._id]||{valueRequired:u};return F(f)?u&&c.valueRequired?t("No value specified for required input",i):t(void 0,i):void E(l.type,function(e,n){return e?i(e):void n(f,l,void 0,function(e){var f;e&&(f=e.message?e.message:"Unknown error message"),t(f,i)})})}function A(e,f,n,d){var i={};i.fieldId=e,i.sectionIndex=n,i.errorMessages=f.errorMessages||[],i.fieldErrorMessage=f.fieldErrorMessage||[],o.some(i.errorMessages,function(e,f){return f(null!==e)},function(e){return i.valid=!e&&i.fieldErrorMessage.length<1,d(void 0,i)})}function B(e,f,n,o){var d=e.sectionIndex||0;oe(f._id,!0,d,function(i,t){return i?o(i):void G(e,f,n,t,function(f,n){return f?o(f):void A(e.fieldId,n,d,o)})})}function C(e,f,n){var o=f[e];return o?n(void 0,o):n(new Error("Invalid Field Type "+e))}function D(e,f){return C(e,he,f)}function E(e,f){return C(e,je,f)}function F(e){return"undefined"==typeof e||null===e||""===e}function G(e,f,n,d,i){function t(e,f,n,o){if(!f.required)return o(void 0,null);var d=e&&e.fieldValues&&e.fieldValues.length>0,i=ce[f._id]&&ce[f._id].valueRequired;return!d&&n&&i?o(void 0,"No value submitted for field "+f.name):o(void 0,null)}function l(e,f){var n=0;if(e&&e.fieldValues&&e.fieldValues.length>0)for(var o=0;o<e.fieldValues.length;o+=1)e.fieldValues[o]&&(n+=1);return f(void 0,n)}function u(e,f,n,o){if(!n)return o(void 0,null);if(f.repeating&&f.fieldOptions&&f.fieldOptions.definition){if(f.fieldOptions.definition.minRepeat&&f.required&&e<f.fieldOptions.definition.minRepeat)return o(void 0,"Expected min of "+f.fieldOptions.definition.minRepeat+" values for field "+f.name+" but got "+e);if(f.fieldOptions.definition.maxRepeat&&e>f.fieldOptions.definition.maxRepeat)return o(void 0,"Expected max of "+f.fieldOptions.definition.maxRepeat+" values for field "+f.name+" but got "+e)}else if(e>1)return o(void 0,"Should not have multiple values for non-repeating field");return o(void 0,null)}function p(e,f,n,d){var i=e.sectionIndex||0;D(f.type,function(t,l){return t?d(t):void o.map(e.fieldValues,function(e,o){return F(e)?o(void 0,null):void l(e,f,n,function(e){var n;n=e?e.message||"Error during validation of field":null,re[f._id]=re[f._id]||{sections:{}},re[f._id].sections[i]=re[f._id].sections[i]||{};var d=re[f._id].sections[i];return d&&(d.submitted=!0),o(void 0,n)})},function(e,f){return e?d(e):d(void 0,f)})})}n=n||null,l(e,function(l,s){return l?i(l):(f.visible=d,void o.series({valuesSubmitted:o.apply(t,e,f,d),repeats:o.apply(u,s,f,d),values:o.apply(p,e,f,n)},function(e,f){if(e)return i(e);var n=[];return f.valuesSubmitted&&n.push(f.valuesSubmitted),f.repeats&&n.push(f.repeats),i(void 0,{fieldErrorMessage:n,errorMessages:f.values})}))})}function H(e){var f,n,o,d="^",i="c".charCodeAt(0),t="n".charCodeAt(0),l=e.length;for(f=0;l>f;f+=1){switch(n=e.charCodeAt(f)){case i:o="[a-zA-Z0-9]";break;case t:o="[0-9]";break;default:var u=n.toString(16).toUpperCase();o="\\u"+("0000"+u).substr(-4)}d+=o}return d+"$"}function I(e,f){var n=new RegExp(f);return n.test(e)}function J(e,f,n){var o;return o="simple"===f?H(n):"regex"===f?n:H(n),I(e,o)}function K(e,f,n,o){if("string"!=typeof e)return o(new Error("Expected string but got "+typeof e));var d={};f&&f.fieldOptions&&f.fieldOptions.validation&&(d=f.fieldOptions.validation);var i=d.field_format_mode||"";i=i.trim();var t=d.field_format_string||"";return t=t.trim(),t&&t.length>0&&i&&i.length>0&&!J(e,i,t)?o(new Error("field value in incorrect format, expected format: "+t+" but submission value is: "+e)):f.fieldOptions&&f.fieldOptions.validation&&f.fieldOptions.validation.min&&e.length<f.fieldOptions.validation.min?o(new Error("Expected minimum string length of "+f.fieldOptions.validation.min+" but submission is "+e.length+". Submitted val: "+e)):f.fieldOptions&&f.fieldOptions.validation&&f.fieldOptions.validation.max&&e.length>f.fieldOptions.validation.max?o(new Error("Expected maximum string length of "+f.fieldOptions.validation.max+" but submission is "+e.length+". Submitted val: "+e)):o();
}function L(e,f,n,o){var d=e-0,i=d==e;return i?M(d,f,n,o):o(new Error("Expected numeric but got: "+e))}function M(e,f,n,o){return"number"!=typeof e?o(new Error("Expected number but got "+typeof e)):f.fieldOptions&&f.fieldOptions.validation&&f.fieldOptions.validation.min&&e<f.fieldOptions.validation.min?o(new Error("Expected minimum Number "+f.fieldOptions.validation.min+" but submission is "+e+". Submitted number: "+e)):f.fieldOptions.validation.max&&e>f.fieldOptions.validation.max?o(new Error("Expected maximum Number "+f.fieldOptions.validation.max+" but submission is "+e+". Submitted number: "+e)):o()}function N(e,f,n,o){return"string"!=typeof e?o(new Error("Expected string but got "+typeof e)):null===e.match(/[-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4}/g)?o(new Error("Invalid email address format: "+e)):o()}function O(e){var f=["&amp;","&lt;","&gt;","&quot;","&#x27;","&#96;"];return"string"!=typeof e||f.some(function(f){return e.indexOf(f)>=0})?!0:void 0}function P(e,f,n,o){if("string"!=typeof e)return o(new Error("Expected submission to be string but got "+typeof e));if(f.fieldOptions=f.fieldOptions||{},f.fieldOptions.definition=f.fieldOptions.definition||{},!f.fieldOptions.definition.options)return o(new Error("No options exist for field "+f.name));var i=d.find(f.fieldOptions.definition.options,function(f){return O(e)?null:e=d.escape(e),O(f.label)?null:f.label=d.escape(f.label),f.label===e});return i?o():o(""===i&&f.required&&f.fieldOptions.definition.include_blank_option?new Error("The Blank Option is not valid. Please select a value."):new Error("Invalid option specified: "+e))}function Q(e,f,n,i){return"string"!=typeof e?i(new Error("Expected submission to be string but got "+typeof e)):f.fieldOptions.definition.options?void o.some(f.fieldOptions.definition.options,function(f,n){return O(e)?null:e=d.escape(e),O(f.label)?null:f.label=d.escape(f.label),n(f.label===e)},function(f){return f?i():i(new Error("Invalid option specified: "+e))}):i(new Error("No options exist for field "+f.name))}function R(e,f,n,i){var t;f&&f.fieldOptions&&f.fieldOptions.validation&&(t=f.fieldOptions.validation.min);var l;if(f&&f.fieldOptions&&f.fieldOptions.validation&&(l=f.fieldOptions.validation.max),t&&(null===e.selections||void 0===e.selections||e.selections.length<t&&f.visible)){var u;return e.selections&&(u=e.selections.length),i(new Error("Expected a minimum number of selections "+t+" but got "+u))}if(l&&e.selections&&e.selections.length>l)return i(new Error("Expected a maximum number of selections "+l+" but got "+e.selections.length));var p=[];o.eachSeries(f.fieldOptions.definition.options,function(e,f){for(var n in e)p.push(e[n]);return f()},function(){o.eachSeries(e.selections,function(e,f){if("string"!=typeof e)return f(new Error("Expected checkbox submission to be string but got "+typeof e));e=d.escape(e);for(var n=0;n<p.length;n++)O(p[n])?null:p[n]=d.escape(p[n]);return-1===p.indexOf(e)?f(new Error("Checkbox Option "+e+" does not exist in the field.")):f()},i)})}function S(e,f,n,o){return e.lat&&e["long"]?isNaN(parseFloat(e.lat))||isNaN(parseFloat(e["long"]))?o(new Error("Invalid latitude and longitude values")):o():o(new Error("Invalid object for locationMap submission"))}function T(e,f,n,o){function d(e,f){if("string"!=typeof e.zone||0===e.zone.length)return f(new Error("Invalid zone definition for northings and eastings location. "+e.zone));var n=parseInt(e.eastings,10);if(isNaN(n))return f(new Error("Invalid eastings definition for northings and eastings location. "+e.eastings));var o=parseInt(e.northings,10);return isNaN(o)?f(new Error("Invalid northings definition for northings and eastings location. "+e.northings)):f()}return"latlong"===f.fieldOptions.definition.locationUnit?e.lat&&e["long"]?isNaN(parseFloat(e.lat))||isNaN(parseFloat(e["long"]))?o(new Error("Invalid latitude and longitude values")):o():o(new Error("Invalid object for latitude longitude submission")):e.zone&&e.eastings&&e.northings?d(e,o):o(new Error("Invalid object for northings easting submission. Zone, Eastings and Northings elements are required"))}function U(e,f,n,o){Z(e,f,n,function(d){return d?void X(e,f,n,function(d){return d?void Y(e,f,n,function(e){return e?o(e):o()}):o()}):o()})}function V(e,f,n,o){return"object"!=typeof e||null===e?o(new Error("Expected object but got "+typeof e)):"string"!=typeof e.text||0===e.text.length?o(new Error("Expected text parameter.")):"string"!=typeof e.format||0===e.format.length?o(new Error("Expected format parameter.")):o()}function W(e,f,n,o){e=e||{};var d=e.fieldOptions||{},i=d.definition||{},t=i.file_size||null;if(null!==t){var l=f[n],u=1;return l>1e3&&(u=l/1e3),l>1e3*t?o(new Error("File size is too large. File can be a maximum of "+t+"KB. Size of file selected: "+u+"KB")):o()}return o()}function X(e,f,n,d){if("object"!=typeof e)return d(new Error("Expected object but got "+typeof e));var i=[{keyName:"fileName",valueType:"string"},{keyName:"fileSize",valueType:"number"},{keyName:"fileType",valueType:"string"},{keyName:"fileUpdateTime",valueType:"number"},{keyName:"hashName",valueType:"string"}];o.each(i,function(f,n){var o=typeof e[f.keyName];return o!==f.valueType?n(new Error("Expected "+f.valueType+" but got "+o)):"fileName"===f.keyName&&e[f.keyName].length<=0?n(new Error("Expected value for "+f.keyName)):n()},function(o){return o?d(o):void W(f,e,"fileSize",function(f){return f?d(f):e.hashName.indexOf("filePlaceHolder")>-1?d():n&&n.hashName&&n.hashName.indexOf(e.hashName)>-1?d():d(new Error("Invalid file placeholder text"+e.hashName))})})}function Y(e,f,n,d){if("function"!=typeof File)return d(new Error("Expected File object but got "+typeof e));var i=[{keyName:"name",valueType:"string"},{keyName:"size",valueType:"number"}];o.each(i,function(f,n){var o=typeof e[f.keyName];return o!==f.valueType?n(new Error("Expected "+f.valueType+" but got "+o)):"string"===o&&e[f.keyName].length<=0?n(new Error("Expected value for "+f.keyName)):"number"===o&&e[f.keyName]<=0?n(new Error("Expected > 0 value for "+f.keyName)):n()},function(n){return n?d(n):void W(f,e,"size",function(e){return e?d(e):d()})})}function Z(e,f,n,o){return"string"!=typeof e?o(new Error("Expected base64 string but got "+typeof e)):e.length<=0?o(new Error("Expected base64 string but was empty")):o()}function $(e,f,n,o){var p=!1;if("string"!=typeof e)return o(new Error("Expected string but got "+typeof e));switch(f.fieldOptions.definition.datetimeUnit){case t:var s=["YYYY/MM/DD","YYYY/MM/DD","YYYY-MM-DD","YYYY-MM-DD"];return p=d.find(s,function(f){return i(e,f,!0).isValid()}),p?o():o(new Error("Invalid date value "+e+". Date format is YYYY/MM/DD"));case l:return p=i(e,"HH:mm:ss",!0).isValid()||i(e,"HH:mm",!0).isValid(),p?o():o(new Error("Invalid time value "+e+". Time format is HH:mm:ss or HH:mm"));case u:var y=f.fieldOptions.definition.dateTimeFormat?[f.fieldOptions.definition.dateTimeFormat]:["YYYY/MM/DD HH:mm:ss","YYYY/MM/DD HH:mm","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD HH:mm"];return p=d.find(y,function(f){return i(e,f,!0).isValid()}),p?o():o(new Error("Invalid dateTime string "+e+". dateTime format is "+y.join(" or ")));default:return o(new Error("Invalid dateTime fieldtype "+f.fieldOptions.definition.datetimeUnit))}}function _(e,f,n,o){return o(new Error("Should not submit section field: "+f.name))}function ee(e,f,n,o,d,i){var t,l,u,p=se[d.sourceField],s=!1,y=[],c=xe[e],r=xe[d.sourceField],a=c===r,w=me[d.sourceField];return u=a?w&&w[f]?w[f]:null:w&&w[0]?w[0]:null,u&&u.fieldValues&&(y=u.fieldValues,t=d.restriction,l=d.sourceValue,s=ie(p,y[0],l,t)),n.push({field:p,sectionIndex:f,submissionValues:y,condition:t,testValue:l,passed:s}),s&&o.push(p),i()}function fe(e,f,n,d){var i=!0;o.each(f,function(f,d){var t=[],l=[];o.each(f.ruleConditionalStatements,o.apply(ee,e,n,t,l),function(e){function n(e,f,n){return"and"===e&&f.length===n.length||"or"===e&&f.length>0}return e&&d(e),i=n(f.ruleConditionalOperator,l,t)?"show"===f.type&&i:"show"!==f.type&&i,d()})},function(e){return d(e,i)})}function ne(e,f){return y(),qe(e)?fe(null,ge[e],0,f):f(void 0,!0)}function oe(e,f,n,i){d.isFunction(n)&&(i=n,n=0),y();var t=se[e];return ye[e]?i(new Error("Submission "+e+" is an admin field. Admin fields cannot be passed to the rules engine.")):t?void o.waterfall([function(e){return f?void ne(t.pageId,e):e(void 0,!0)},function(f,o){return f?ke(e)?fe(e,we[e],n,o):o(void 0,!0):o(void 0,!1)}],i):i(new Error("Field does not exist in form"))}function de(e,f){y();var n=c(e);if(n)return f(n);var i={};o.parallel([function(e){i.fields={},o.eachSeries(Object.keys(we),function(e,f){var n=xe[e],t=v(n);o.each(d.range(t),function(n,o){oe(e,!1,n,function(d,t){return d?f(d):(i.fields[e+"_"+n]={targetId:e,sectionIndex:n,action:t?"show":"hide"},o())})},f)},e)},function(e){i.pages={},o.eachSeries(Object.keys(ge),function(e,f){ne(e,function(n,o){return n?f(n):(i.pages[e]={targetId:e,action:o?"show":"hide"},f())})},e)}],function(e){return e?f(e):f(void 0,{actions:i})})}function ie(e,f,n,o){var d=e.type,i=e.fieldOptions?e.fieldOptions:{};return"undefined"==typeof f||null===f?!1:"function"==typeof ve[d]?ve[d](f,n,o,i):!1}function te(e,f,n){var o=parseInt(e,10);return!isNaN(o)&&o>=f&&n>=o}var le,ue,pe=e,se={},ye={},ce={},re={},ae={},we={},be={},ge={},me={},xe={},he={text:K,textarea:K,number:L,emailAddress:N,dropdown:P,radio:Q,checkboxes:R,location:T,locationMap:S,photo:X,signature:X,file:X,dateTime:$,url:K,sectionBreak:_,barcode:V,sliderNumber:L,readOnly:function(){return!0}},je={text:K,textarea:K,number:L,emailAddress:N,dropdown:P,radio:Q,checkboxes:R,location:T,locationMap:S,photo:U,signature:U,file:U,dateTime:$,url:K,sectionBreak:_,barcode:V,sliderNumber:L,readOnly:function(){return!0}},ve={text:function(e,f,n){return this.comparisonString(e,f,n)},textarea:function(e,f,n){return this.comparisonString(e,f,n)},number:function(e,f,n){return this.numericalComparison(e,f,n)},emailAddress:function(e,f,n){return this.comparisonString(e,f,n)},dropdown:function(e,f,n){return this.comparisonString(e,f,n)},radio:function(e,f,n){return this.comparisonString(e,f,n)},checkboxes:function(e,f,n){e=e||{};var o=!1;if(!(e.selections instanceof Array))return!1;for(var d=0;d<e.selections.length;d++){var i=e.selections[d];this.comparisonString(i,f,"is")&&(o=!0)}return"is"===n?o:!o},dateTime:function(e,f,n,o){var d=!1;o=o||{definition:{}};var i=null,p=null;switch(o.definition.datetimeUnit){case t:try{i=new Date(new Date(e).toDateString()).getTime(),p=new Date(new Date(f).toDateString()).getTime(),d=!0}catch(s){i=null,p=null,d=!1}break;case l:var y=this.cvtTimeToSeconds(e),c=this.cvtTimeToSeconds(f);i=y.seconds,p=c.seconds,d=y.valid&&c.valid;break;case u:try{i=new Date(e).getTime(),p=new Date(f).getTime(),d=!0}catch(s){d=!1}break;default:d=!1}return d?d="is at"===n?i===p:"is before"===n?p>i:"is after"===n?i>p:!1:!1},url:function(e,f,n){return this.comparisonString(e,f,n)},barcode:function(e,f,n){return e=e||{},"string"!=typeof e.text?!1:this.comparisonString(e.text,f,n)},sliderNumber:function(e,f,n){return this.numericalComparison(e,f,n)},comparisonString:function(e,f,n){var o=!0;return o="is"===n?e===f:"is not"===n?e!==f:"contains"===n?-1!==e.indexOf(f):"does not contain"===n?-1===e.indexOf(f):"begins with"===n?e.substring(0,f.length)===f:"ends with"===n?e.substring(Math.max(0,e.length-f.length),e.length)===f:!1},numericalComparison:function(e,f,n){var o=parseInt(e,10),d=parseInt(f,10);return isNaN(o)||isNaN(d)?!1:"is equal to"===n?o===d:"is less than"===n?d>o:"is greater than"===n?o>d:!1},cvtTimeToSeconds:function(e){var f=!1,n=0;if("string"==typeof e){var o=e.split(":");f=2===o.length||3===o.length,f&&(f=te(o[0],0,23),n+=60*parseInt(o[0],10)*60),f&&(f=te(o[1],0,59),n+=60*parseInt(o[1],10)),f&&3===o.length&&(f=te(o[2],0,59),n+=parseInt(o[2],10))}return{valid:f,seconds:n}}},ke=function(e){return!!we[e]},qe=function(e){return!!ge[e]};return{validateForm:b,validateField:q,validateFieldValue:z,checkRules:de,validateFieldInternal:G,initSubmission:c,isFieldVisible:oe,isConditionActive:ie}};"undefined"!=typeof n&&n.exports&&(n.exports=p),"undefined"!=typeof f&&(f.RulesEngine=p)}()},{async:2,moment:4,underscore:5}],2:[function(e,f,n){(function(e){!function(){function n(e){var f=!1;return function(){if(f)throw new Error("Callback was already called.");f=!0,e.apply(o,arguments)}}var o,d,i={};o=this,null!=o&&(d=o.async),i.noConflict=function(){return o.async=d,i};var t=function(e,f){if(e.forEach)return e.forEach(f);for(var n=0;n<e.length;n+=1)f(e[n],n,e)},l=function(e,f){if(e.map)return e.map(f);var n=[];return t(e,function(e,o,d){n.push(f(e,o,d))}),n},u=function(e,f,n){return e.reduce?e.reduce(f,n):(t(e,function(e,o,d){n=f(n,e,o,d)}),n)},p=function(e){if(Object.keys)return Object.keys(e);var f=[];for(var n in e)e.hasOwnProperty(n)&&f.push(n);return f};"undefined"!=typeof e&&e.nextTick?(i.nextTick=e.nextTick,"undefined"!=typeof setImmediate?i.setImmediate=setImmediate:i.setImmediate=i.nextTick):"function"==typeof setImmediate?(i.nextTick=function(e){setImmediate(e)},i.setImmediate=i.nextTick):(i.nextTick=function(e){setTimeout(e,0)},i.setImmediate=i.nextTick),i.each=function(e,f,o){if(o=o||function(){},!e.length)return o();var d=0;t(e,function(i){f(i,n(function(f){f?(o(f),o=function(){}):(d+=1,d>=e.length&&o(null))}))})},i.forEach=i.each,i.eachSeries=function(e,f,n){if(n=n||function(){},!e.length)return n();var o=0,d=function(){f(e[o],function(f){f?(n(f),n=function(){}):(o+=1,o>=e.length?n(null):d())})};d()},i.forEachSeries=i.eachSeries,i.eachLimit=function(e,f,n,o){var d=s(f);d.apply(null,[e,n,o])},i.forEachLimit=i.eachLimit;var s=function(e){return function(f,n,o){if(o=o||function(){},!f.length||0>=e)return o();var d=0,i=0,t=0;!function l(){if(d>=f.length)return o();for(;e>t&&i<f.length;)i+=1,t+=1,n(f[i-1],function(e){e?(o(e),o=function(){}):(d+=1,t-=1,d>=f.length?o():l())})}()}},y=function(e){return function(){var f=Array.prototype.slice.call(arguments);return e.apply(null,[i.each].concat(f))}},c=function(e,f){return function(){var n=Array.prototype.slice.call(arguments);return f.apply(null,[s(e)].concat(n))}},r=function(e){return function(){var f=Array.prototype.slice.call(arguments);return e.apply(null,[i.eachSeries].concat(f))}},a=function(e,f,n,o){var d=[];f=l(f,function(e,f){return{index:f,value:e}}),e(f,function(e,f){n(e.value,function(n,o){d[e.index]=o,f(n)})},function(e){o(e,d)})};i.map=y(a),i.mapSeries=r(a),i.mapLimit=function(e,f,n,o){return w(f)(e,n,o)};var w=function(e){return c(e,a)};i.reduce=function(e,f,n,o){i.eachSeries(e,function(e,o){n(f,e,function(e,n){f=n,o(e)})},function(e){o(e,f)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(e,f,n,o){var d=l(e,function(e){return e}).reverse();i.reduce(d,f,n,o)},i.foldr=i.reduceRight;var b=function(e,f,n,o){var d=[];f=l(f,function(e,f){return{index:f,value:e}}),e(f,function(e,f){n(e.value,function(n){n&&d.push(e),f()})},function(e){o(l(d.sort(function(e,f){return e.index-f.index}),function(e){return e.value}))})};i.filter=y(b),i.filterSeries=r(b),i.select=i.filter,i.selectSeries=i.filterSeries;var g=function(e,f,n,o){var d=[];f=l(f,function(e,f){return{index:f,value:e}}),e(f,function(e,f){n(e.value,function(n){n||d.push(e),f()})},function(e){o(l(d.sort(function(e,f){return e.index-f.index}),function(e){return e.value}))})};i.reject=y(g),i.rejectSeries=r(g);var m=function(e,f,n,o){e(f,function(e,f){n(e,function(n){n?(o(e),o=function(){}):f()})},function(e){o()})};i.detect=y(m),i.detectSeries=r(m),i.some=function(e,f,n){i.each(e,function(e,o){f(e,function(e){e&&(n(!0),n=function(){}),o()})},function(e){n(!1)})},i.any=i.some,i.every=function(e,f,n){i.each(e,function(e,o){f(e,function(e){e||(n(!1),n=function(){}),o()})},function(e){n(!0)})},i.all=i.every,i.sortBy=function(e,f,n){i.map(e,function(e,n){f(e,function(f,o){f?n(f):n(null,{value:e,criteria:o})})},function(e,f){if(e)return n(e);var o=function(e,f){var n=e.criteria,o=f.criteria;return o>n?-1:n>o?1:0};n(null,l(f.sort(o),function(e){return e.value}))})},i.auto=function(e,f){f=f||function(){};var n=p(e);if(!n.length)return f(null);var o={},d=[],l=function(e){d.unshift(e)},s=function(e){for(var f=0;f<d.length;f+=1)if(d[f]===e)return void d.splice(f,1)},y=function(){t(d.slice(0),function(e){e()})};l(function(){p(o).length===n.length&&(f(null,o),f=function(){})}),t(n,function(n){var d=e[n]instanceof Function?[e[n]]:e[n],c=function(e){var d=Array.prototype.slice.call(arguments,1);if(d.length<=1&&(d=d[0]),e){var l={};t(p(o),function(e){l[e]=o[e]}),l[n]=d,f(e,l),f=function(){}}else o[n]=d,i.setImmediate(y)},r=d.slice(0,Math.abs(d.length-1))||[],a=function(){return u(r,function(e,f){return e&&o.hasOwnProperty(f)},!0)&&!o.hasOwnProperty(n)};if(a())d[d.length-1](c,o);else{var w=function(){a()&&(s(w),d[d.length-1](c,o))};l(w)}})},i.waterfall=function(e,f){if(f=f||function(){},e.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return f(n)}if(!e.length)return f();var o=function(e){return function(n){if(n)f.apply(null,arguments),f=function(){};else{var d=Array.prototype.slice.call(arguments,1),t=e.next();t?d.push(o(t)):d.push(f),i.setImmediate(function(){e.apply(null,d)})}}};o(i.iterator(e))()};var x=function(e,f,n){if(n=n||function(){},f.constructor===Array)e.map(f,function(e,f){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),f.call(null,e,n)})},n);else{var o={};e.each(p(f),function(e,n){f[e](function(f){var d=Array.prototype.slice.call(arguments,1);d.length<=1&&(d=d[0]),o[e]=d,n(f)})},function(e){n(e,o)})}};i.parallel=function(e,f){x({map:i.map,each:i.each},e,f)},i.parallelLimit=function(e,f,n){x({map:w(f),each:s(f)},e,n)},i.series=function(e,f){if(f=f||function(){},e.constructor===Array)i.mapSeries(e,function(e,f){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),f.call(null,e,n)})},f);else{var n={};i.eachSeries(p(e),function(f,o){e[f](function(e){var d=Array.prototype.slice.call(arguments,1);d.length<=1&&(d=d[0]),n[f]=d,o(e)})},function(e){f(e,n)})}},i.iterator=function(e){var f=function(n){var o=function(){return e.length&&e[n].apply(null,arguments),o.next()};return o.next=function(){return n<e.length-1?f(n+1):null},o};return f(0)},i.apply=function(e){var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,f.concat(Array.prototype.slice.call(arguments)))}};var h=function(e,f,n,o){var d=[];e(f,function(e,f){n(e,function(e,n){d=d.concat(n||[]),f(e)})},function(e){o(e,d)})};i.concat=y(h),i.concatSeries=r(h),i.whilst=function(e,f,n){e()?f(function(o){return o?n(o):void i.whilst(e,f,n)}):n()},i.doWhilst=function(e,f,n){e(function(o){return o?n(o):void(f()?i.doWhilst(e,f,n):n())})},i.until=function(e,f,n){e()?n():f(function(o){return o?n(o):void i.until(e,f,n)})},i.doUntil=function(e,f,n){e(function(o){return o?n(o):void(f()?n():i.doUntil(e,f,n))})},i.queue=function(e,f){function o(e,n,o,d){n.constructor!==Array&&(n=[n]),t(n,function(n){var t={data:n,callback:"function"==typeof d?d:null};o?e.tasks.unshift(t):e.tasks.push(t),e.saturated&&e.tasks.length===f&&e.saturated(),i.setImmediate(e.process)})}void 0===f&&(f=1);var d=0,l={tasks:[],concurrency:f,saturated:null,empty:null,drain:null,push:function(e,f){o(l,e,!1,f)},unshift:function(e,f){o(l,e,!0,f)},process:function(){if(d<l.concurrency&&l.tasks.length){var f=l.tasks.shift();l.empty&&0===l.tasks.length&&l.empty(),d+=1;var o=function(){d-=1,f.callback&&f.callback.apply(f,arguments),l.drain&&l.tasks.length+d===0&&l.drain(),l.process()},i=n(o);e(f.data,i)}},length:function(){return l.tasks.length},running:function(){return d}};return l},i.cargo=function(e,f){var n=!1,o=[],d={tasks:o,payload:f,saturated:null,empty:null,drain:null,push:function(e,n){e.constructor!==Array&&(e=[e]),t(e,function(e){o.push({data:e,callback:"function"==typeof n?n:null}),d.saturated&&o.length===f&&d.saturated()}),i.setImmediate(d.process)},process:function u(){if(!n){if(0===o.length)return void(d.drain&&d.drain());var i="number"==typeof f?o.splice(0,f):o.splice(0),p=l(i,function(e){return e.data});d.empty&&d.empty(),n=!0,e(p,function(){n=!1;var e=arguments;t(i,function(f){f.callback&&f.callback.apply(null,e)}),u()})}},length:function(){return o.length},running:function(){return n}};return d};var j=function(e){return function(f){var n=Array.prototype.slice.call(arguments,1);f.apply(null,n.concat([function(f){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(f?console.error&&console.error(f):console[e]&&t(n,function(f){console[e](f)}))}]))}};i.log=j("log"),i.dir=j("dir"),i.memoize=function(e,f){var n={},o={};f=f||function(e){return e};var d=function(){var d=Array.prototype.slice.call(arguments),i=d.pop(),t=f.apply(null,d);t in n?i.apply(null,n[t]):t in o?o[t].push(i):(o[t]=[i],e.apply(null,d.concat([function(){n[t]=arguments;var e=o[t];delete o[t];for(var f=0,d=e.length;d>f;f++)e[f].apply(null,arguments)}])))};return d.memo=n,d.unmemoized=e,d},i.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},i.times=function(e,f,n){for(var o=[],d=0;e>d;d++)o.push(d);return i.map(o,f,n)},i.timesSeries=function(e,f,n){for(var o=[],d=0;e>d;d++)o.push(d);return i.mapSeries(o,f,n)},i.compose=function(){var e=Array.prototype.reverse.call(arguments);return function(){var f=this,n=Array.prototype.slice.call(arguments),o=n.pop();i.reduce(e,n,function(e,n,o){n.apply(f,e.concat([function(){var e=arguments[0],f=Array.prototype.slice.call(arguments,1);o(e,f)}]))},function(e,n){o.apply(f,[e].concat(n))})}};var v=function(e,f){var n=function(){var n=this,o=Array.prototype.slice.call(arguments),d=o.pop();return e(f,function(e,f){e.apply(n,o.concat([f]))},d)};if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return n.apply(this,o)}return n};i.applyEach=y(v),i.applyEachSeries=r(v),i.forever=function(e,f){function n(o){if(o){if(f)return f(o);throw o}e(n)}n()},"undefined"!=typeof define&&define.amd?define([],function(){return i}):"undefined"!=typeof f&&f.exports?f.exports=i:o.async=i}()}).call(this,e("_process"))},{_process:3}],3:[function(e,f,n){function o(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function i(e){if(y===setTimeout)return setTimeout(e,0);if((y===o||!y)&&setTimeout)return y=setTimeout,setTimeout(e,0);try{return y(e,0)}catch(f){try{return y.call(null,e,0)}catch(f){return y.call(this,e,0)}}}function t(e){if(c===clearTimeout)return clearTimeout(e);if((c===d||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(f){try{return c.call(null,e)}catch(f){return c.call(this,e)}}}function l(){b&&a&&(b=!1,a.length?w=a.concat(w):g=-1,w.length&&u())}function u(){if(!b){var e=i(l);b=!0;for(var f=w.length;f;){for(a=w,w=[];++g<f;)a&&a[g].run();g=-1,f=w.length}a=null,b=!1,t(e)}}function p(e,f){this.fun=e,this.array=f}function s(){}var y,c,r=f.exports={};!function(){try{y="function"==typeof setTimeout?setTimeout:o}catch(e){y=o}try{c="function"==typeof clearTimeout?clearTimeout:d}catch(e){c=d}}();var a,w=[],b=!1,g=-1;r.nextTick=function(e){var f=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)f[n-1]=arguments[n];w.push(new p(e,f)),1!==w.length||b||i(u)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=s,r.addListener=s,r.once=s,r.off=s,r.removeListener=s,r.removeAllListeners=s,r.emit=s,r.prependListener=s,r.prependOnceListener=s,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],4:[function(e,f,n){!function(e,o){"object"==typeof n&&"undefined"!=typeof f?f.exports=o():"function"==typeof define&&define.amd?define(o):e.moment=o()}(this,function(){"use strict";function n(){return go.apply(null,arguments)}function o(e){go=e}function d(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function t(e){var f;for(f in e)return!1;return!0}function l(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function u(e,f){var n,o=[];for(n=0;n<e.length;++n)o.push(f(e[n],n));return o}function p(e,f){return Object.prototype.hasOwnProperty.call(e,f)}function s(e,f){for(var n in f)p(f,n)&&(e[n]=f[n]);return p(f,"toString")&&(e.toString=f.toString),p(f,"valueOf")&&(e.valueOf=f.valueOf),e}function y(e,f,n,o){return xf(e,f,n,o,!0).utc()}function c(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null}}function r(e){return null==e._pf&&(e._pf=c()),e._pf}function a(e){if(null==e._isValid){var f=r(e),n=mo.call(f.parsedDateParts,function(e){return null!=e});e._isValid=!isNaN(e._d.getTime())&&f.overflow<0&&!f.empty&&!f.invalidMonth&&!f.invalidWeekday&&!f.nullInput&&!f.invalidFormat&&!f.userInvalidated&&(!f.meridiem||f.meridiem&&n),e._strict&&(e._isValid=e._isValid&&0===f.charsLeftOver&&0===f.unusedTokens.length&&void 0===f.bigHour)}return e._isValid}function w(e){var f=y(NaN);return null!=e?s(r(f),e):r(f).userInvalidated=!0,f}function b(e){return void 0===e}function g(e,f){var n,o,d;if(b(f._isAMomentObject)||(e._isAMomentObject=f._isAMomentObject),b(f._i)||(e._i=f._i),b(f._f)||(e._f=f._f),b(f._l)||(e._l=f._l),b(f._strict)||(e._strict=f._strict),b(f._tzm)||(e._tzm=f._tzm),b(f._isUTC)||(e._isUTC=f._isUTC),b(f._offset)||(e._offset=f._offset),b(f._pf)||(e._pf=r(f)),b(f._locale)||(e._locale=f._locale),xo.length>0)for(n in xo)o=xo[n],d=f[o],b(d)||(e[o]=d);return e}function m(e){g(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),ho===!1&&(ho=!0,n.updateOffset(this),ho=!1)}function x(e){return e instanceof m||null!=e&&null!=e._isAMomentObject}function h(e){return 0>e?Math.ceil(e)||0:Math.floor(e)}function j(e){var f=+e,n=0;return 0!==f&&isFinite(f)&&(n=h(f)),n}function v(e,f,n){var o,d=Math.min(e.length,f.length),i=Math.abs(e.length-f.length),t=0;for(o=0;d>o;o++)(n&&e[o]!==f[o]||!n&&j(e[o])!==j(f[o]))&&t++;return t+i}function k(e){n.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function q(e,f){var o=!0;return s(function(){return null!=n.deprecationHandler&&n.deprecationHandler(null,e),o&&(k(e+"\nArguments: "+Array.prototype.slice.call(arguments).join(", ")+"\n"+(new Error).stack),o=!1),f.apply(this,arguments)},f)}function z(e,f){null!=n.deprecationHandler&&n.deprecationHandler(e,f),jo[e]||(k(f),jo[e]=!0)}function A(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function B(e){var f,n;for(n in e)f=e[n],A(f)?this[n]=f:this["_"+n]=f;this._config=e,this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function C(e,f){var n,o=s({},e);for(n in f)p(f,n)&&(i(e[n])&&i(f[n])?(o[n]={},s(o[n],e[n]),s(o[n],f[n])):null!=f[n]?o[n]=f[n]:delete o[n]);for(n in e)p(e,n)&&!p(f,n)&&i(e[n])&&(o[n]=s({},o[n]));return o}function D(e){null!=e&&this.set(e)}function E(e,f,n){var o=this._calendar[e]||this._calendar.sameElse;return A(o)?o.call(f,n):o}function F(e){var f=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return f||!n?f:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])}function G(){return this._invalidDate}function H(e){return this._ordinal.replace("%d",e)}function I(e,f,n,o){var d=this._relativeTime[n];return A(d)?d(e,f,n,o):d.replace(/%d/i,e)}function J(e,f){var n=this._relativeTime[e>0?"future":"past"];return A(n)?n(f):n.replace(/%s/i,f)}function K(e,f){var n=e.toLowerCase();Eo[n]=Eo[n+"s"]=Eo[f]=e}function L(e){return"string"==typeof e?Eo[e]||Eo[e.toLowerCase()]:void 0}function M(e){var f,n,o={};for(n in e)p(e,n)&&(f=L(n),f&&(o[f]=e[n]));return o}function N(e,f){Fo[e]=f}function O(e){var f=[];for(var n in e)f.push({unit:n,priority:Fo[n]});return f.sort(function(e,f){return e.priority-f.priority}),f}function P(e,f){return function(o){return null!=o?(R(this,e,o),n.updateOffset(this,f),this):Q(this,e)}}function Q(e,f){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+f]():NaN}function R(e,f,n){e.isValid()&&e._d["set"+(e._isUTC?"UTC":"")+f](n)}function S(e){return e=L(e),A(this[e])?this[e]():this}function T(e,f){if("object"==typeof e){e=M(e);for(var n=O(e),o=0;o<n.length;o++)this[n[o].unit](e[n[o].unit])}else if(e=L(e),A(this[e]))return this[e](f);return this}function U(e,f,n){var o=""+Math.abs(e),d=f-o.length,i=e>=0;return(i?n?"+":"":"-")+Math.pow(10,Math.max(0,d)).toString().substr(1)+o}function V(e,f,n,o){var d=o;"string"==typeof o&&(d=function(){return this[o]()}),e&&(Jo[e]=d),f&&(Jo[f[0]]=function(){return U(d.apply(this,arguments),f[1],f[2])}),n&&(Jo[n]=function(){return this.localeData().ordinal(d.apply(this,arguments),e)})}function W(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function X(e){var f,n,o=e.match(Go);for(f=0,n=o.length;n>f;f++)Jo[o[f]]?o[f]=Jo[o[f]]:o[f]=W(o[f]);return function(f){var d,i="";for(d=0;n>d;d++)i+=o[d]instanceof Function?o[d].call(f,e):o[d];return i}}function Y(e,f){return e.isValid()?(f=Z(f,e.localeData()),Io[f]=Io[f]||X(f),Io[f](e)):e.localeData().invalidDate()}function Z(e,f){function n(e){return f.longDateFormat(e)||e}var o=5;for(Ho.lastIndex=0;o>=0&&Ho.test(e);)e=e.replace(Ho,n),Ho.lastIndex=0,o-=1;return e}function $(e,f,n){_o[e]=A(f)?f:function(e,o){return e&&n?n:f}}function _(e,f){return p(_o,e)?_o[e](f._strict,f._locale):new RegExp(ee(e))}function ee(e){return fe(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,f,n,o,d){return f||n||o||d}))}function fe(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function ne(e,f){var n,o=f;for("string"==typeof e&&(e=[e]),"number"==typeof f&&(o=function(e,n){n[f]=j(e)}),n=0;n<e.length;n++)ed[e[n]]=o}function oe(e,f){ne(e,function(e,n,o,d){o._w=o._w||{},f(e,o._w,o,d)})}function de(e,f,n){null!=f&&p(ed,e)&&ed[e](f,n._a,n,e)}function ie(e,f){return new Date(Date.UTC(e,f+1,0)).getUTCDate()}function te(e,f){return d(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||sd).test(f)?"format":"standalone"][e.month()]}function le(e,f){return d(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[sd.test(f)?"format":"standalone"][e.month()]}function ue(e,f,n){var o,d,i,t=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],o=0;12>o;++o)i=y([2e3,o]),this._shortMonthsParse[o]=this.monthsShort(i,"").toLocaleLowerCase(),this._longMonthsParse[o]=this.months(i,"").toLocaleLowerCase();return n?"MMM"===f?(d=ko.call(this._shortMonthsParse,t),-1!==d?d:null):(d=ko.call(this._longMonthsParse,t),-1!==d?d:null):"MMM"===f?(d=ko.call(this._shortMonthsParse,t),-1!==d?d:(d=ko.call(this._longMonthsParse,t),-1!==d?d:null)):(d=ko.call(this._longMonthsParse,t),-1!==d?d:(d=ko.call(this._shortMonthsParse,t),-1!==d?d:null))}function pe(e,f,n){var o,d,i;if(this._monthsParseExact)return ue.call(this,e,f,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),o=0;12>o;o++){if(d=y([2e3,o]),n&&!this._longMonthsParse[o]&&(this._longMonthsParse[o]=new RegExp("^"+this.months(d,"").replace(".","")+"$","i"),this._shortMonthsParse[o]=new RegExp("^"+this.monthsShort(d,"").replace(".","")+"$","i")),n||this._monthsParse[o]||(i="^"+this.months(d,"")+"|^"+this.monthsShort(d,""),this._monthsParse[o]=new RegExp(i.replace(".",""),"i")),n&&"MMMM"===f&&this._longMonthsParse[o].test(e))return o;if(n&&"MMM"===f&&this._shortMonthsParse[o].test(e))return o;if(!n&&this._monthsParse[o].test(e))return o}}function se(e,f){var n;if(!e.isValid())return e;if("string"==typeof f)if(/^\d+$/.test(f))f=j(f);else if(f=e.localeData().monthsParse(f),
"number"!=typeof f)return e;return n=Math.min(e.date(),ie(e.year(),f)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](f,n),e}function ye(e){return null!=e?(se(this,e),n.updateOffset(this,!0),this):Q(this,"Month")}function ce(){return ie(this.year(),this.month())}function re(e){return this._monthsParseExact?(p(this,"_monthsRegex")||we.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(p(this,"_monthsShortRegex")||(this._monthsShortRegex=rd),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)}function ae(e){return this._monthsParseExact?(p(this,"_monthsRegex")||we.call(this),e?this._monthsStrictRegex:this._monthsRegex):(p(this,"_monthsRegex")||(this._monthsRegex=ad),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)}function we(){function e(e,f){return f.length-e.length}var f,n,o=[],d=[],i=[];for(f=0;12>f;f++)n=y([2e3,f]),o.push(this.monthsShort(n,"")),d.push(this.months(n,"")),i.push(this.months(n,"")),i.push(this.monthsShort(n,""));for(o.sort(e),d.sort(e),i.sort(e),f=0;12>f;f++)o[f]=fe(o[f]),d[f]=fe(d[f]);for(f=0;24>f;f++)i[f]=fe(i[f]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+d.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+o.join("|")+")","i")}function be(e){return ge(e)?366:365}function ge(e){return e%4===0&&e%100!==0||e%400===0}function me(){return ge(this.year())}function xe(e,f,n,o,d,i,t){var l=new Date(e,f,n,o,d,i,t);return 100>e&&e>=0&&isFinite(l.getFullYear())&&l.setFullYear(e),l}function he(e){var f=new Date(Date.UTC.apply(null,arguments));return 100>e&&e>=0&&isFinite(f.getUTCFullYear())&&f.setUTCFullYear(e),f}function je(e,f,n){var o=7+f-n,d=(7+he(e,0,o).getUTCDay()-f)%7;return-d+o-1}function ve(e,f,n,o,d){var i,t,l=(7+n-o)%7,u=je(e,o,d),p=1+7*(f-1)+l+u;return 0>=p?(i=e-1,t=be(i)+p):p>be(e)?(i=e+1,t=p-be(e)):(i=e,t=p),{year:i,dayOfYear:t}}function ke(e,f,n){var o,d,i=je(e.year(),f,n),t=Math.floor((e.dayOfYear()-i-1)/7)+1;return 1>t?(d=e.year()-1,o=t+qe(d,f,n)):t>qe(e.year(),f,n)?(o=t-qe(e.year(),f,n),d=e.year()+1):(d=e.year(),o=t),{week:o,year:d}}function qe(e,f,n){var o=je(e,f,n),d=je(e+1,f,n);return(be(e)-o+d)/7}function ze(e){return ke(e,this._week.dow,this._week.doy).week}function Ae(){return this._week.dow}function Be(){return this._week.doy}function Ce(e){var f=this.localeData().week(this);return null==e?f:this.add(7*(e-f),"d")}function De(e){var f=ke(this,1,4).week;return null==e?f:this.add(7*(e-f),"d")}function Ee(e,f){return"string"!=typeof e?e:isNaN(e)?(e=f.weekdaysParse(e),"number"==typeof e?e:null):parseInt(e,10)}function Fe(e,f){return"string"==typeof e?f.weekdaysParse(e)%7||7:isNaN(e)?null:e}function Ge(e,f){return d(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(f)?"format":"standalone"][e.day()]}function He(e){return this._weekdaysShort[e.day()]}function Ie(e){return this._weekdaysMin[e.day()]}function Je(e,f,n){var o,d,i,t=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],o=0;7>o;++o)i=y([2e3,1]).day(o),this._minWeekdaysParse[o]=this.weekdaysMin(i,"").toLocaleLowerCase(),this._shortWeekdaysParse[o]=this.weekdaysShort(i,"").toLocaleLowerCase(),this._weekdaysParse[o]=this.weekdays(i,"").toLocaleLowerCase();return n?"dddd"===f?(d=ko.call(this._weekdaysParse,t),-1!==d?d:null):"ddd"===f?(d=ko.call(this._shortWeekdaysParse,t),-1!==d?d:null):(d=ko.call(this._minWeekdaysParse,t),-1!==d?d:null):"dddd"===f?(d=ko.call(this._weekdaysParse,t),-1!==d?d:(d=ko.call(this._shortWeekdaysParse,t),-1!==d?d:(d=ko.call(this._minWeekdaysParse,t),-1!==d?d:null))):"ddd"===f?(d=ko.call(this._shortWeekdaysParse,t),-1!==d?d:(d=ko.call(this._weekdaysParse,t),-1!==d?d:(d=ko.call(this._minWeekdaysParse,t),-1!==d?d:null))):(d=ko.call(this._minWeekdaysParse,t),-1!==d?d:(d=ko.call(this._weekdaysParse,t),-1!==d?d:(d=ko.call(this._shortWeekdaysParse,t),-1!==d?d:null)))}function Ke(e,f,n){var o,d,i;if(this._weekdaysParseExact)return Je.call(this,e,f,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),o=0;7>o;o++){if(d=y([2e3,1]).day(o),n&&!this._fullWeekdaysParse[o]&&(this._fullWeekdaysParse[o]=new RegExp("^"+this.weekdays(d,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[o]=new RegExp("^"+this.weekdaysShort(d,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[o]=new RegExp("^"+this.weekdaysMin(d,"").replace(".",".?")+"$","i")),this._weekdaysParse[o]||(i="^"+this.weekdays(d,"")+"|^"+this.weekdaysShort(d,"")+"|^"+this.weekdaysMin(d,""),this._weekdaysParse[o]=new RegExp(i.replace(".",""),"i")),n&&"dddd"===f&&this._fullWeekdaysParse[o].test(e))return o;if(n&&"ddd"===f&&this._shortWeekdaysParse[o].test(e))return o;if(n&&"dd"===f&&this._minWeekdaysParse[o].test(e))return o;if(!n&&this._weekdaysParse[o].test(e))return o}}function Le(e){if(!this.isValid())return null!=e?this:NaN;var f=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=Ee(e,this.localeData()),this.add(e-f,"d")):f}function Me(e){if(!this.isValid())return null!=e?this:NaN;var f=(this.day()+7-this.localeData()._week.dow)%7;return null==e?f:this.add(e-f,"d")}function Ne(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var f=Fe(e,this.localeData());return this.day(this.day()%7?f:f-7)}return this.day()||7}function Oe(e){return this._weekdaysParseExact?(p(this,"_weekdaysRegex")||Re.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(p(this,"_weekdaysRegex")||(this._weekdaysRegex=hd),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)}function Pe(e){return this._weekdaysParseExact?(p(this,"_weekdaysRegex")||Re.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(p(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=jd),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Qe(e){return this._weekdaysParseExact?(p(this,"_weekdaysRegex")||Re.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(p(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=vd),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Re(){function e(e,f){return f.length-e.length}var f,n,o,d,i,t=[],l=[],u=[],p=[];for(f=0;7>f;f++)n=y([2e3,1]).day(f),o=this.weekdaysMin(n,""),d=this.weekdaysShort(n,""),i=this.weekdays(n,""),t.push(o),l.push(d),u.push(i),p.push(o),p.push(d),p.push(i);for(t.sort(e),l.sort(e),u.sort(e),p.sort(e),f=0;7>f;f++)l[f]=fe(l[f]),u[f]=fe(u[f]),p[f]=fe(p[f]);this._weekdaysRegex=new RegExp("^("+p.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function Se(){return this.hours()%12||12}function Te(){return this.hours()||24}function Ue(e,f){V(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),f)})}function Ve(e,f){return f._meridiemParse}function We(e){return"p"===(e+"").toLowerCase().charAt(0)}function Xe(e,f,n){return e>11?n?"pm":"PM":n?"am":"AM"}function Ye(e){return e?e.toLowerCase().replace("_","-"):e}function Ze(e){for(var f,n,o,d,i=0;i<e.length;){for(d=Ye(e[i]).split("-"),f=d.length,n=Ye(e[i+1]),n=n?n.split("-"):null;f>0;){if(o=$e(d.slice(0,f).join("-")))return o;if(n&&n.length>=f&&v(d,n,!0)>=f-1)break;f--}i++}return null}function $e(n){var o=null;if(!Bd[n]&&"undefined"!=typeof f&&f&&f.exports)try{o=kd._abbr,e("./locale/"+n),_e(o)}catch(d){}return Bd[n]}function _e(e,f){var n;return e&&(n=b(f)?nf(e):ef(e,f),n&&(kd=n)),kd._abbr}function ef(e,f){if(null!==f){var n=Ad;return f.abbr=e,null!=Bd[e]?(z("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),n=Bd[e]._config):null!=f.parentLocale&&(null!=Bd[f.parentLocale]?n=Bd[f.parentLocale]._config:z("parentLocaleUndefined","specified parentLocale is not defined yet. See http://momentjs.com/guides/#/warnings/parent-locale/")),Bd[e]=new D(C(n,f)),_e(e),Bd[e]}return delete Bd[e],null}function ff(e,f){if(null!=f){var n,o=Ad;null!=Bd[e]&&(o=Bd[e]._config),f=C(o,f),n=new D(f),n.parentLocale=Bd[e],Bd[e]=n,_e(e)}else null!=Bd[e]&&(null!=Bd[e].parentLocale?Bd[e]=Bd[e].parentLocale:null!=Bd[e]&&delete Bd[e]);return Bd[e]}function nf(e){var f;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return kd;if(!d(e)){if(f=$e(e))return f;e=[e]}return Ze(e)}function of(){return vo(Bd)}function df(e){var f,n=e._a;return n&&-2===r(e).overflow&&(f=n[nd]<0||n[nd]>11?nd:n[od]<1||n[od]>ie(n[fd],n[nd])?od:n[dd]<0||n[dd]>24||24===n[dd]&&(0!==n[id]||0!==n[td]||0!==n[ld])?dd:n[id]<0||n[id]>59?id:n[td]<0||n[td]>59?td:n[ld]<0||n[ld]>999?ld:-1,r(e)._overflowDayOfYear&&(fd>f||f>od)&&(f=od),r(e)._overflowWeeks&&-1===f&&(f=ud),r(e)._overflowWeekday&&-1===f&&(f=pd),r(e).overflow=f),e}function tf(e){var f,n,o,d,i,t,l=e._i,u=Cd.exec(l)||Dd.exec(l);if(u){for(r(e).iso=!0,f=0,n=Fd.length;n>f;f++)if(Fd[f][1].exec(u[1])){d=Fd[f][0],o=Fd[f][2]!==!1;break}if(null==d)return void(e._isValid=!1);if(u[3]){for(f=0,n=Gd.length;n>f;f++)if(Gd[f][1].exec(u[3])){i=(u[2]||" ")+Gd[f][0];break}if(null==i)return void(e._isValid=!1)}if(!o&&null!=i)return void(e._isValid=!1);if(u[4]){if(!Ed.exec(u[4]))return void(e._isValid=!1);t="Z"}e._f=d+(i||"")+(t||""),cf(e)}else e._isValid=!1}function lf(e){var f=Hd.exec(e._i);return null!==f?void(e._d=new Date(+f[1])):(tf(e),void(e._isValid===!1&&(delete e._isValid,n.createFromInputFallback(e))))}function uf(e,f,n){return null!=e?e:null!=f?f:n}function pf(e){var f=new Date(n.now());return e._useUTC?[f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate()]:[f.getFullYear(),f.getMonth(),f.getDate()]}function sf(e){var f,n,o,d,i=[];if(!e._d){for(o=pf(e),e._w&&null==e._a[od]&&null==e._a[nd]&&yf(e),e._dayOfYear&&(d=uf(e._a[fd],o[fd]),e._dayOfYear>be(d)&&(r(e)._overflowDayOfYear=!0),n=he(d,0,e._dayOfYear),e._a[nd]=n.getUTCMonth(),e._a[od]=n.getUTCDate()),f=0;3>f&&null==e._a[f];++f)e._a[f]=i[f]=o[f];for(;7>f;f++)e._a[f]=i[f]=null==e._a[f]?2===f?1:0:e._a[f];24===e._a[dd]&&0===e._a[id]&&0===e._a[td]&&0===e._a[ld]&&(e._nextDay=!0,e._a[dd]=0),e._d=(e._useUTC?he:xe).apply(null,i),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[dd]=24)}}function yf(e){var f,n,o,d,i,t,l,u;f=e._w,null!=f.GG||null!=f.W||null!=f.E?(i=1,t=4,n=uf(f.GG,e._a[fd],ke(hf(),1,4).year),o=uf(f.W,1),d=uf(f.E,1),(1>d||d>7)&&(u=!0)):(i=e._locale._week.dow,t=e._locale._week.doy,n=uf(f.gg,e._a[fd],ke(hf(),i,t).year),o=uf(f.w,1),null!=f.d?(d=f.d,(0>d||d>6)&&(u=!0)):null!=f.e?(d=f.e+i,(f.e<0||f.e>6)&&(u=!0)):d=i),1>o||o>qe(n,i,t)?r(e)._overflowWeeks=!0:null!=u?r(e)._overflowWeekday=!0:(l=ve(n,o,d,i,t),e._a[fd]=l.year,e._dayOfYear=l.dayOfYear)}function cf(e){if(e._f===n.ISO_8601)return void tf(e);e._a=[],r(e).empty=!0;var f,o,d,i,t,l=""+e._i,u=l.length,p=0;for(d=Z(e._f,e._locale).match(Go)||[],f=0;f<d.length;f++)i=d[f],o=(l.match(_(i,e))||[])[0],o&&(t=l.substr(0,l.indexOf(o)),t.length>0&&r(e).unusedInput.push(t),l=l.slice(l.indexOf(o)+o.length),p+=o.length),Jo[i]?(o?r(e).empty=!1:r(e).unusedTokens.push(i),de(i,o,e)):e._strict&&!o&&r(e).unusedTokens.push(i);r(e).charsLeftOver=u-p,l.length>0&&r(e).unusedInput.push(l),e._a[dd]<=12&&r(e).bigHour===!0&&e._a[dd]>0&&(r(e).bigHour=void 0),r(e).parsedDateParts=e._a.slice(0),r(e).meridiem=e._meridiem,e._a[dd]=rf(e._locale,e._a[dd],e._meridiem),sf(e),df(e)}function rf(e,f,n){var o;return null==n?f:null!=e.meridiemHour?e.meridiemHour(f,n):null!=e.isPM?(o=e.isPM(n),o&&12>f&&(f+=12),o||12!==f||(f=0),f):f}function af(e){var f,n,o,d,i;if(0===e._f.length)return r(e).invalidFormat=!0,void(e._d=new Date(NaN));for(d=0;d<e._f.length;d++)i=0,f=g({},e),null!=e._useUTC&&(f._useUTC=e._useUTC),f._f=e._f[d],cf(f),a(f)&&(i+=r(f).charsLeftOver,i+=10*r(f).unusedTokens.length,r(f).score=i,(null==o||o>i)&&(o=i,n=f));s(e,n||f)}function wf(e){if(!e._d){var f=M(e._i);e._a=u([f.year,f.month,f.day||f.date,f.hour,f.minute,f.second,f.millisecond],function(e){return e&&parseInt(e,10)}),sf(e)}}function bf(e){var f=new m(df(gf(e)));return f._nextDay&&(f.add(1,"d"),f._nextDay=void 0),f}function gf(e){var f=e._i,n=e._f;return e._locale=e._locale||nf(e._l),null===f||void 0===n&&""===f?w({nullInput:!0}):("string"==typeof f&&(e._i=f=e._locale.preparse(f)),x(f)?new m(df(f)):(d(n)?af(e):l(f)?e._d=f:n?cf(e):mf(e),a(e)||(e._d=null),e))}function mf(e){var f=e._i;void 0===f?e._d=new Date(n.now()):l(f)?e._d=new Date(f.valueOf()):"string"==typeof f?lf(e):d(f)?(e._a=u(f.slice(0),function(e){return parseInt(e,10)}),sf(e)):"object"==typeof f?wf(e):"number"==typeof f?e._d=new Date(f):n.createFromInputFallback(e)}function xf(e,f,n,o,l){var u={};return"boolean"==typeof n&&(o=n,n=void 0),(i(e)&&t(e)||d(e)&&0===e.length)&&(e=void 0),u._isAMomentObject=!0,u._useUTC=u._isUTC=l,u._l=n,u._i=e,u._f=f,u._strict=o,bf(u)}function hf(e,f,n,o){return xf(e,f,n,o,!1)}function jf(e,f){var n,o;if(1===f.length&&d(f[0])&&(f=f[0]),!f.length)return hf();for(n=f[0],o=1;o<f.length;++o)(!f[o].isValid()||f[o][e](n))&&(n=f[o]);return n}function vf(){var e=[].slice.call(arguments,0);return jf("isBefore",e)}function kf(){var e=[].slice.call(arguments,0);return jf("isAfter",e)}function qf(e){var f=M(e),n=f.year||0,o=f.quarter||0,d=f.month||0,i=f.week||0,t=f.day||0,l=f.hour||0,u=f.minute||0,p=f.second||0,s=f.millisecond||0;this._milliseconds=+s+1e3*p+6e4*u+1e3*l*60*60,this._days=+t+7*i,this._months=+d+3*o+12*n,this._data={},this._locale=nf(),this._bubble()}function zf(e){return e instanceof qf}function Af(e,f){V(e,0,0,function(){var e=this.utcOffset(),n="+";return 0>e&&(e=-e,n="-"),n+U(~~(e/60),2)+f+U(~~e%60,2)})}function Bf(e,f){var n=(f||"").match(e)||[],o=n[n.length-1]||[],d=(o+"").match(Ld)||["-",0,0],i=+(60*d[1])+j(d[2]);return"+"===d[0]?i:-i}function Cf(e,f){var o,d;return f._isUTC?(o=f.clone(),d=(x(e)||l(e)?e.valueOf():hf(e).valueOf())-o.valueOf(),o._d.setTime(o._d.valueOf()+d),n.updateOffset(o,!1),o):hf(e).local()}function Df(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Ef(e,f){var o,d=this._offset||0;return this.isValid()?null!=e?("string"==typeof e?e=Bf(Yo,e):Math.abs(e)<16&&(e=60*e),!this._isUTC&&f&&(o=Df(this)),this._offset=e,this._isUTC=!0,null!=o&&this.add(o,"m"),d!==e&&(!f||this._changeInProgress?Vf(this,Pf(e-d,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,n.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?d:Df(this):null!=e?this:NaN}function Ff(e,f){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,f),this):-this.utcOffset()}function Gf(e){return this.utcOffset(0,e)}function Hf(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Df(this),"m")),this}function If(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Bf(Xo,this._i)),this}function Jf(e){return this.isValid()?(e=e?hf(e).utcOffset():0,(this.utcOffset()-e)%60===0):!1}function Kf(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Lf(){if(!b(this._isDSTShifted))return this._isDSTShifted;var e={};if(g(e,this),e=gf(e),e._a){var f=e._isUTC?y(e._a):hf(e._a);this._isDSTShifted=this.isValid()&&v(e._a,f.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Mf(){return this.isValid()?!this._isUTC:!1}function Nf(){return this.isValid()?this._isUTC:!1}function Of(){return this.isValid()?this._isUTC&&0===this._offset:!1}function Pf(e,f){var n,o,d,i=e,t=null;return zf(e)?i={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(i={},f?i[f]=e:i.milliseconds=e):(t=Md.exec(e))?(n="-"===t[1]?-1:1,i={y:0,d:j(t[od])*n,h:j(t[dd])*n,m:j(t[id])*n,s:j(t[td])*n,ms:j(t[ld])*n}):(t=Nd.exec(e))?(n="-"===t[1]?-1:1,i={y:Qf(t[2],n),M:Qf(t[3],n),w:Qf(t[4],n),d:Qf(t[5],n),h:Qf(t[6],n),m:Qf(t[7],n),s:Qf(t[8],n)}):null==i?i={}:"object"==typeof i&&("from"in i||"to"in i)&&(d=Sf(hf(i.from),hf(i.to)),i={},i.ms=d.milliseconds,i.M=d.months),o=new qf(i),zf(e)&&p(e,"_locale")&&(o._locale=e._locale),o}function Qf(e,f){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*f}function Rf(e,f){var n={milliseconds:0,months:0};return n.months=f.month()-e.month()+12*(f.year()-e.year()),e.clone().add(n.months,"M").isAfter(f)&&--n.months,n.milliseconds=+f-+e.clone().add(n.months,"M"),n}function Sf(e,f){var n;return e.isValid()&&f.isValid()?(f=Cf(f,e),e.isBefore(f)?n=Rf(e,f):(n=Rf(f,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n):{milliseconds:0,months:0}}function Tf(e){return 0>e?-1*Math.round(-1*e):Math.round(e)}function Uf(e,f){return function(n,o){var d,i;return null===o||isNaN(+o)||(z(f,"moment()."+f+"(period, number) is deprecated. Please use moment()."+f+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=n,n=o,o=i),n="string"==typeof n?+n:n,d=Pf(n,o),Vf(this,d,e),this}}function Vf(e,f,o,d){var i=f._milliseconds,t=Tf(f._days),l=Tf(f._months);e.isValid()&&(d=null==d?!0:d,i&&e._d.setTime(e._d.valueOf()+i*o),t&&R(e,"Date",Q(e,"Date")+t*o),l&&se(e,Q(e,"Month")+l*o),d&&n.updateOffset(e,t||l))}function Wf(e,f){var n=e.diff(f,"days",!0);return-6>n?"sameElse":-1>n?"lastWeek":0>n?"lastDay":1>n?"sameDay":2>n?"nextDay":7>n?"nextWeek":"sameElse"}function Xf(e,f){var o=e||hf(),d=Cf(o,this).startOf("day"),i=n.calendarFormat(this,d)||"sameElse",t=f&&(A(f[i])?f[i].call(this,o):f[i]);return this.format(t||this.localeData().calendar(i,this,hf(o)))}function Yf(){return new m(this)}function Zf(e,f){var n=x(e)?e:hf(e);return this.isValid()&&n.isValid()?(f=L(b(f)?"millisecond":f),"millisecond"===f?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(f).valueOf()):!1}function $f(e,f){var n=x(e)?e:hf(e);return this.isValid()&&n.isValid()?(f=L(b(f)?"millisecond":f),"millisecond"===f?this.valueOf()<n.valueOf():this.clone().endOf(f).valueOf()<n.valueOf()):!1}function _f(e,f,n,o){return o=o||"()",("("===o[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===o[1]?this.isBefore(f,n):!this.isAfter(f,n))}function en(e,f){var n,o=x(e)?e:hf(e);return this.isValid()&&o.isValid()?(f=L(f||"millisecond"),"millisecond"===f?this.valueOf()===o.valueOf():(n=o.valueOf(),this.clone().startOf(f).valueOf()<=n&&n<=this.clone().endOf(f).valueOf())):!1}function fn(e,f){return this.isSame(e,f)||this.isAfter(e,f)}function nn(e,f){return this.isSame(e,f)||this.isBefore(e,f)}function on(e,f,n){var o,d,i,t;return this.isValid()?(o=Cf(e,this),o.isValid()?(d=6e4*(o.utcOffset()-this.utcOffset()),f=L(f),"year"===f||"month"===f||"quarter"===f?(t=dn(this,o),"quarter"===f?t/=3:"year"===f&&(t/=12)):(i=this-o,t="second"===f?i/1e3:"minute"===f?i/6e4:"hour"===f?i/36e5:"day"===f?(i-d)/864e5:"week"===f?(i-d)/6048e5:i),n?t:h(t)):NaN):NaN}function dn(e,f){var n,o,d=12*(f.year()-e.year())+(f.month()-e.month()),i=e.clone().add(d,"months");return 0>f-i?(n=e.clone().add(d-1,"months"),o=(f-i)/(i-n)):(n=e.clone().add(d+1,"months"),o=(f-i)/(n-i)),-(d+o)||0}function tn(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ln(){var e=this.clone().utc();return 0<e.year()&&e.year()<=9999?A(Date.prototype.toISOString)?this.toDate().toISOString():Y(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):Y(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function un(e){e||(e=this.isUtc()?n.defaultFormatUtc:n.defaultFormat);var f=Y(this,e);return this.localeData().postformat(f)}function pn(e,f){return this.isValid()&&(x(e)&&e.isValid()||hf(e).isValid())?Pf({to:this,from:e}).locale(this.locale()).humanize(!f):this.localeData().invalidDate()}function sn(e){return this.from(hf(),e)}function yn(e,f){return this.isValid()&&(x(e)&&e.isValid()||hf(e).isValid())?Pf({from:this,to:e}).locale(this.locale()).humanize(!f):this.localeData().invalidDate()}function cn(e){return this.to(hf(),e)}function rn(e){var f;return void 0===e?this._locale._abbr:(f=nf(e),null!=f&&(this._locale=f),this)}function an(){return this._locale}function wn(e){switch(e=L(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this}function bn(e){return e=L(e),void 0===e||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))}function gn(){return this._d.valueOf()-6e4*(this._offset||0)}function mn(){return Math.floor(this.valueOf()/1e3)}function xn(){return new Date(this.valueOf())}function hn(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function jn(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function vn(){return this.isValid()?this.toISOString():null}function kn(){return a(this)}function qn(){return s({},r(this))}function zn(){return r(this).overflow}function An(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Bn(e,f){V(0,[e,e.length],0,f)}function Cn(e){return Gn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function Dn(e){return Gn.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function En(){return qe(this.year(),1,4)}function Fn(){var e=this.localeData()._week;return qe(this.year(),e.dow,e.doy)}function Gn(e,f,n,o,d){var i;return null==e?ke(this,o,d).year:(i=qe(e,o,d),f>i&&(f=i),Hn.call(this,e,f,n,o,d))}function Hn(e,f,n,o,d){var i=ve(e,f,n,o,d),t=he(i.year,0,i.dayOfYear);return this.year(t.getUTCFullYear()),this.month(t.getUTCMonth()),this.date(t.getUTCDate()),this}function In(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)}function Jn(e){var f=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?f:this.add(e-f,"d")}function Kn(e,f){f[ld]=j(1e3*("0."+e))}function Ln(){return this._isUTC?"UTC":""}function Mn(){return this._isUTC?"Coordinated Universal Time":""}function Nn(e){return hf(1e3*e)}function On(){return hf.apply(null,arguments).parseZone()}function Pn(e){return e}function Qn(e,f,n,o){var d=nf(),i=y().set(o,f);return d[n](i,e)}function Rn(e,f,n){if("number"==typeof e&&(f=e,e=void 0),e=e||"",null!=f)return Qn(e,f,n,"month");var o,d=[];for(o=0;12>o;o++)d[o]=Qn(e,o,n,"month");return d}function Sn(e,f,n,o){"boolean"==typeof e?("number"==typeof f&&(n=f,f=void 0),f=f||""):(f=e,n=f,e=!1,"number"==typeof f&&(n=f,f=void 0),f=f||"");var d=nf(),i=e?d._week.dow:0;if(null!=n)return Qn(f,(n+i)%7,o,"day");var t,l=[];for(t=0;7>t;t++)l[t]=Qn(f,(t+i)%7,o,"day");return l}function Tn(e,f){return Rn(e,f,"months")}function Un(e,f){return Rn(e,f,"monthsShort")}function Vn(e,f,n){return Sn(e,f,n,"weekdays")}function Wn(e,f,n){return Sn(e,f,n,"weekdaysShort")}function Xn(e,f,n){return Sn(e,f,n,"weekdaysMin")}function Yn(){var e=this._data;return this._milliseconds=Zd(this._milliseconds),this._days=Zd(this._days),this._months=Zd(this._months),e.milliseconds=Zd(e.milliseconds),e.seconds=Zd(e.seconds),e.minutes=Zd(e.minutes),e.hours=Zd(e.hours),e.months=Zd(e.months),e.years=Zd(e.years),this}function Zn(e,f,n,o){var d=Pf(f,n);return e._milliseconds+=o*d._milliseconds,e._days+=o*d._days,e._months+=o*d._months,e._bubble()}function $n(e,f){return Zn(this,e,f,1)}function _n(e,f){return Zn(this,e,f,-1)}function eo(e){return 0>e?Math.floor(e):Math.ceil(e)}function fo(){var e,f,n,o,d,i=this._milliseconds,t=this._days,l=this._months,u=this._data;return i>=0&&t>=0&&l>=0||0>=i&&0>=t&&0>=l||(i+=864e5*eo(oo(l)+t),t=0,l=0),u.milliseconds=i%1e3,e=h(i/1e3),u.seconds=e%60,f=h(e/60),u.minutes=f%60,n=h(f/60),u.hours=n%24,t+=h(n/24),d=h(no(t)),l+=d,t-=eo(oo(d)),o=h(l/12),l%=12,u.days=t,u.months=l,u.years=o,this}function no(e){return 4800*e/146097}function oo(e){return 146097*e/4800}function io(e){var f,n,o=this._milliseconds;if(e=L(e),"month"===e||"year"===e)return f=this._days+o/864e5,n=this._months+no(f),"month"===e?n:n/12;switch(f=this._days+Math.round(oo(this._months)),e){case"week":return f/7+o/6048e5;case"day":return f+o/864e5;case"hour":return 24*f+o/36e5;case"minute":return 1440*f+o/6e4;case"second":return 86400*f+o/1e3;case"millisecond":return Math.floor(864e5*f)+o;default:throw new Error("Unknown unit "+e)}}function to(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*j(this._months/12)}function lo(e){return function(){return this.as(e)}}function uo(e){return e=L(e),this[e+"s"]()}function po(e){return function(){return this._data[e]}}function so(){return h(this.days()/7)}function yo(e,f,n,o,d){return d.relativeTime(f||1,!!n,e,o)}function co(e,f,n){var o=Pf(e).abs(),d=ri(o.as("s")),i=ri(o.as("m")),t=ri(o.as("h")),l=ri(o.as("d")),u=ri(o.as("M")),p=ri(o.as("y")),s=d<ai.s&&["s",d]||1>=i&&["m"]||i<ai.m&&["mm",i]||1>=t&&["h"]||t<ai.h&&["hh",t]||1>=l&&["d"]||l<ai.d&&["dd",l]||1>=u&&["M"]||u<ai.M&&["MM",u]||1>=p&&["y"]||["yy",p];return s[2]=f,s[3]=+e>0,s[4]=n,yo.apply(null,s)}function ro(e){return void 0===e?ri:"function"==typeof e?(ri=e,!0):!1}function ao(e,f){return void 0===ai[e]?!1:void 0===f?ai[e]:(ai[e]=f,!0)}function wo(e){var f=this.localeData(),n=co(this,!e,f);return e&&(n=f.pastFuture(+this,n)),f.postformat(n)}function bo(){var e,f,n,o=wi(this._milliseconds)/1e3,d=wi(this._days),i=wi(this._months);e=h(o/60),f=h(e/60),o%=60,e%=60,n=h(i/12),i%=12;var t=n,l=i,u=d,p=f,s=e,y=o,c=this.asSeconds();return c?(0>c?"-":"")+"P"+(t?t+"Y":"")+(l?l+"M":"")+(u?u+"D":"")+(p||s||y?"T":"")+(p?p+"H":"")+(s?s+"M":"")+(y?y+"S":""):"P0D"}var go,mo;mo=Array.prototype.some?Array.prototype.some:function(e){for(var f=Object(this),n=f.length>>>0,o=0;n>o;o++)if(o in f&&e.call(this,f[o],o,f))return!0;return!1};var xo=n.momentProperties=[],ho=!1,jo={};n.suppressDeprecationWarnings=!1,n.deprecationHandler=null;var vo;vo=Object.keys?Object.keys:function(e){var f,n=[];for(f in e)p(e,f)&&n.push(f);return n};var ko,qo={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},zo={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Ao="Invalid date",Bo="%d",Co=/\d{1,2}/,Do={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Eo={},Fo={},Go=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Ho=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Io={},Jo={},Ko=/\d/,Lo=/\d\d/,Mo=/\d{3}/,No=/\d{4}/,Oo=/[+-]?\d{6}/,Po=/\d\d?/,Qo=/\d\d\d\d?/,Ro=/\d\d\d\d\d\d?/,So=/\d{1,3}/,To=/\d{1,4}/,Uo=/[+-]?\d{1,6}/,Vo=/\d+/,Wo=/[+-]?\d+/,Xo=/Z|[+-]\d\d:?\d\d/gi,Yo=/Z|[+-]\d\d(?::?\d\d)?/gi,Zo=/[+-]?\d+(\.\d{1,3})?/,$o=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,_o={},ed={},fd=0,nd=1,od=2,dd=3,id=4,td=5,ld=6,ud=7,pd=8;ko=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var f;for(f=0;f<this.length;++f)if(this[f]===e)return f;return-1},V("M",["MM",2],"Mo",function(){return this.month()+1}),V("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),V("MMMM",0,0,function(e){return this.localeData().months(this,e)}),K("month","M"),N("month",8),$("M",Po),$("MM",Po,Lo),$("MMM",function(e,f){return f.monthsShortRegex(e)}),$("MMMM",function(e,f){return f.monthsRegex(e)}),ne(["M","MM"],function(e,f){f[nd]=j(e)-1}),ne(["MMM","MMMM"],function(e,f,n,o){var d=n._locale.monthsParse(e,o,n._strict);null!=d?f[nd]=d:r(n).invalidMonth=e});var sd=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/,yd="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),cd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),rd=$o,ad=$o;V("Y",0,0,function(){var e=this.year();return 9999>=e?""+e:"+"+e}),V(0,["YY",2],0,function(){return this.year()%100}),V(0,["YYYY",4],0,"year"),V(0,["YYYYY",5],0,"year"),V(0,["YYYYYY",6,!0],0,"year"),K("year","y"),N("year",1),$("Y",Wo),$("YY",Po,Lo),$("YYYY",To,No),$("YYYYY",Uo,Oo),$("YYYYYY",Uo,Oo),ne(["YYYYY","YYYYYY"],fd),ne("YYYY",function(e,f){f[fd]=2===e.length?n.parseTwoDigitYear(e):j(e)}),ne("YY",function(e,f){f[fd]=n.parseTwoDigitYear(e)}),ne("Y",function(e,f){f[fd]=parseInt(e,10)}),n.parseTwoDigitYear=function(e){return j(e)+(j(e)>68?1900:2e3)};var wd=P("FullYear",!0);V("w",["ww",2],"wo","week"),V("W",["WW",2],"Wo","isoWeek"),K("week","w"),K("isoWeek","W"),N("week",5),N("isoWeek",5),$("w",Po),$("ww",Po,Lo),$("W",Po),$("WW",Po,Lo),oe(["w","ww","W","WW"],function(e,f,n,o){f[o.substr(0,1)]=j(e)});var bd={dow:0,doy:6};V("d",0,"do","day"),V("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),V("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),V("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),V("e",0,0,"weekday"),V("E",0,0,"isoWeekday"),K("day","d"),K("weekday","e"),K("isoWeekday","E"),N("day",11),N("weekday",11),N("isoWeekday",11),$("d",Po),$("e",Po),$("E",Po),$("dd",function(e,f){return f.weekdaysMinRegex(e)}),$("ddd",function(e,f){return f.weekdaysShortRegex(e)}),$("dddd",function(e,f){return f.weekdaysRegex(e)}),oe(["dd","ddd","dddd"],function(e,f,n,o){var d=n._locale.weekdaysParse(e,o,n._strict);null!=d?f.d=d:r(n).invalidWeekday=e}),oe(["d","e","E"],function(e,f,n,o){f[o]=j(e)});var gd="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),md="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),xd="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),hd=$o,jd=$o,vd=$o;V("H",["HH",2],0,"hour"),V("h",["hh",2],0,Se),V("k",["kk",2],0,Te),V("hmm",0,0,function(){return""+Se.apply(this)+U(this.minutes(),2)}),V("hmmss",0,0,function(){return""+Se.apply(this)+U(this.minutes(),2)+U(this.seconds(),2)}),V("Hmm",0,0,function(){return""+this.hours()+U(this.minutes(),2)}),V("Hmmss",0,0,function(){return""+this.hours()+U(this.minutes(),2)+U(this.seconds(),2)}),Ue("a",!0),Ue("A",!1),K("hour","h"),N("hour",13),$("a",Ve),$("A",Ve),$("H",Po),$("h",Po),$("HH",Po,Lo),$("hh",Po,Lo),$("hmm",Qo),$("hmmss",Ro),$("Hmm",Qo),$("Hmmss",Ro),ne(["H","HH"],dd),ne(["a","A"],function(e,f,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ne(["h","hh"],function(e,f,n){f[dd]=j(e),r(n).bigHour=!0}),ne("hmm",function(e,f,n){var o=e.length-2;f[dd]=j(e.substr(0,o)),f[id]=j(e.substr(o)),r(n).bigHour=!0}),ne("hmmss",function(e,f,n){var o=e.length-4,d=e.length-2;f[dd]=j(e.substr(0,o)),f[id]=j(e.substr(o,2)),f[td]=j(e.substr(d)),r(n).bigHour=!0}),ne("Hmm",function(e,f,n){var o=e.length-2;f[dd]=j(e.substr(0,o)),f[id]=j(e.substr(o))}),ne("Hmmss",function(e,f,n){var o=e.length-4,d=e.length-2;f[dd]=j(e.substr(0,o)),f[id]=j(e.substr(o,2)),f[td]=j(e.substr(d))});var kd,qd=/[ap]\.?m?\.?/i,zd=P("Hours",!0),Ad={calendar:qo,longDateFormat:zo,invalidDate:Ao,ordinal:Bo,ordinalParse:Co,relativeTime:Do,months:yd,monthsShort:cd,week:bd,weekdays:gd,weekdaysMin:xd,weekdaysShort:md,meridiemParse:qd},Bd={},Cd=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,Dd=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,Ed=/Z|[+-]\d\d(?::?\d\d)?/,Fd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Gd=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Hd=/^\/?Date\((\-?\d+)/i;
n.createFromInputFallback=q("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),n.ISO_8601=function(){};var Id=q("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=hf.apply(null,arguments);return this.isValid()&&e.isValid()?this>e?this:e:w()}),Jd=q("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=hf.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:w()}),Kd=function(){return Date.now?Date.now():+new Date};Af("Z",":"),Af("ZZ",""),$("Z",Yo),$("ZZ",Yo),ne(["Z","ZZ"],function(e,f,n){n._useUTC=!0,n._tzm=Bf(Yo,e)});var Ld=/([\+\-]|\d\d)/gi;n.updateOffset=function(){};var Md=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?\d*)?$/,Nd=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;Pf.fn=qf.prototype;var Od=Uf(1,"add"),Pd=Uf(-1,"subtract");n.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",n.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Qd=q("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});V(0,["gg",2],0,function(){return this.weekYear()%100}),V(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Bn("gggg","weekYear"),Bn("ggggg","weekYear"),Bn("GGGG","isoWeekYear"),Bn("GGGGG","isoWeekYear"),K("weekYear","gg"),K("isoWeekYear","GG"),N("weekYear",1),N("isoWeekYear",1),$("G",Wo),$("g",Wo),$("GG",Po,Lo),$("gg",Po,Lo),$("GGGG",To,No),$("gggg",To,No),$("GGGGG",Uo,Oo),$("ggggg",Uo,Oo),oe(["gggg","ggggg","GGGG","GGGGG"],function(e,f,n,o){f[o.substr(0,2)]=j(e)}),oe(["gg","GG"],function(e,f,o,d){f[d]=n.parseTwoDigitYear(e)}),V("Q",0,"Qo","quarter"),K("quarter","Q"),N("quarter",7),$("Q",Ko),ne("Q",function(e,f){f[nd]=3*(j(e)-1)}),V("D",["DD",2],"Do","date"),K("date","D"),N("date",9),$("D",Po),$("DD",Po,Lo),$("Do",function(e,f){return e?f._ordinalParse:f._ordinalParseLenient}),ne(["D","DD"],od),ne("Do",function(e,f){f[od]=j(e.match(Po)[0],10)});var Rd=P("Date",!0);V("DDD",["DDDD",3],"DDDo","dayOfYear"),K("dayOfYear","DDD"),N("dayOfYear",4),$("DDD",So),$("DDDD",Mo),ne(["DDD","DDDD"],function(e,f,n){n._dayOfYear=j(e)}),V("m",["mm",2],0,"minute"),K("minute","m"),N("minute",14),$("m",Po),$("mm",Po,Lo),ne(["m","mm"],id);var Sd=P("Minutes",!1);V("s",["ss",2],0,"second"),K("second","s"),N("second",15),$("s",Po),$("ss",Po,Lo),ne(["s","ss"],td);var Td=P("Seconds",!1);V("S",0,0,function(){return~~(this.millisecond()/100)}),V(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),V(0,["SSS",3],0,"millisecond"),V(0,["SSSS",4],0,function(){return 10*this.millisecond()}),V(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),V(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),V(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),V(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),V(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),K("millisecond","ms"),N("millisecond",16),$("S",So,Ko),$("SS",So,Lo),$("SSS",So,Mo);var Ud;for(Ud="SSSS";Ud.length<=9;Ud+="S")$(Ud,Vo);for(Ud="S";Ud.length<=9;Ud+="S")ne(Ud,Kn);var Vd=P("Milliseconds",!1);V("z",0,0,"zoneAbbr"),V("zz",0,0,"zoneName");var Wd=m.prototype;Wd.add=Od,Wd.calendar=Xf,Wd.clone=Yf,Wd.diff=on,Wd.endOf=bn,Wd.format=un,Wd.from=pn,Wd.fromNow=sn,Wd.to=yn,Wd.toNow=cn,Wd.get=S,Wd.invalidAt=zn,Wd.isAfter=Zf,Wd.isBefore=$f,Wd.isBetween=_f,Wd.isSame=en,Wd.isSameOrAfter=fn,Wd.isSameOrBefore=nn,Wd.isValid=kn,Wd.lang=Qd,Wd.locale=rn,Wd.localeData=an,Wd.max=Jd,Wd.min=Id,Wd.parsingFlags=qn,Wd.set=T,Wd.startOf=wn,Wd.subtract=Pd,Wd.toArray=hn,Wd.toObject=jn,Wd.toDate=xn,Wd.toISOString=ln,Wd.toJSON=vn,Wd.toString=tn,Wd.unix=mn,Wd.valueOf=gn,Wd.creationData=An,Wd.year=wd,Wd.isLeapYear=me,Wd.weekYear=Cn,Wd.isoWeekYear=Dn,Wd.quarter=Wd.quarters=In,Wd.month=ye,Wd.daysInMonth=ce,Wd.week=Wd.weeks=Ce,Wd.isoWeek=Wd.isoWeeks=De,Wd.weeksInYear=Fn,Wd.isoWeeksInYear=En,Wd.date=Rd,Wd.day=Wd.days=Le,Wd.weekday=Me,Wd.isoWeekday=Ne,Wd.dayOfYear=Jn,Wd.hour=Wd.hours=zd,Wd.minute=Wd.minutes=Sd,Wd.second=Wd.seconds=Td,Wd.millisecond=Wd.milliseconds=Vd,Wd.utcOffset=Ef,Wd.utc=Gf,Wd.local=Hf,Wd.parseZone=If,Wd.hasAlignedHourOffset=Jf,Wd.isDST=Kf,Wd.isLocal=Mf,Wd.isUtcOffset=Nf,Wd.isUtc=Of,Wd.isUTC=Of,Wd.zoneAbbr=Ln,Wd.zoneName=Mn,Wd.dates=q("dates accessor is deprecated. Use date instead.",Rd),Wd.months=q("months accessor is deprecated. Use month instead",ye),Wd.years=q("years accessor is deprecated. Use year instead",wd),Wd.zone=q("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",Ff),Wd.isDSTShifted=q("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Lf);var Xd=Wd,Yd=D.prototype;Yd.calendar=E,Yd.longDateFormat=F,Yd.invalidDate=G,Yd.ordinal=H,Yd.preparse=Pn,Yd.postformat=Pn,Yd.relativeTime=I,Yd.pastFuture=J,Yd.set=B,Yd.months=te,Yd.monthsShort=le,Yd.monthsParse=pe,Yd.monthsRegex=ae,Yd.monthsShortRegex=re,Yd.week=ze,Yd.firstDayOfYear=Be,Yd.firstDayOfWeek=Ae,Yd.weekdays=Ge,Yd.weekdaysMin=Ie,Yd.weekdaysShort=He,Yd.weekdaysParse=Ke,Yd.weekdaysRegex=Oe,Yd.weekdaysShortRegex=Pe,Yd.weekdaysMinRegex=Qe,Yd.isPM=We,Yd.meridiem=Xe,_e("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var f=e%10,n=1===j(e%100/10)?"th":1===f?"st":2===f?"nd":3===f?"rd":"th";return e+n}}),n.lang=q("moment.lang is deprecated. Use moment.locale instead.",_e),n.langData=q("moment.langData is deprecated. Use moment.localeData instead.",nf);var Zd=Math.abs,$d=lo("ms"),_d=lo("s"),ei=lo("m"),fi=lo("h"),ni=lo("d"),oi=lo("w"),di=lo("M"),ii=lo("y"),ti=po("milliseconds"),li=po("seconds"),ui=po("minutes"),pi=po("hours"),si=po("days"),yi=po("months"),ci=po("years"),ri=Math.round,ai={s:45,m:45,h:22,d:26,M:11},wi=Math.abs,bi=qf.prototype;bi.abs=Yn,bi.add=$n,bi.subtract=_n,bi.as=io,bi.asMilliseconds=$d,bi.asSeconds=_d,bi.asMinutes=ei,bi.asHours=fi,bi.asDays=ni,bi.asWeeks=oi,bi.asMonths=di,bi.asYears=ii,bi.valueOf=to,bi._bubble=fo,bi.get=uo,bi.milliseconds=ti,bi.seconds=li,bi.minutes=ui,bi.hours=pi,bi.days=si,bi.weeks=so,bi.months=yi,bi.years=ci,bi.humanize=wo,bi.toISOString=bo,bi.toString=bo,bi.toJSON=bo,bi.locale=rn,bi.localeData=an,bi.toIsoString=q("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",bo),bi.lang=Qd,V("X",0,0,"unix"),V("x",0,0,"valueOf"),$("x",Wo),$("X",Zo),ne("X",function(e,f,n){n._d=new Date(1e3*parseFloat(e,10))}),ne("x",function(e,f,n){n._d=new Date(j(e))}),n.version="2.14.1",o(hf),n.fn=Xd,n.min=vf,n.max=kf,n.now=Kd,n.utc=y,n.unix=Nn,n.months=Tn,n.isDate=l,n.locale=_e,n.invalid=w,n.duration=Pf,n.isMoment=x,n.weekdays=Vn,n.parseZone=On,n.localeData=nf,n.isDuration=zf,n.monthsShort=Un,n.weekdaysMin=Xn,n.defineLocale=ef,n.updateLocale=ff,n.locales=of,n.weekdaysShort=Wn,n.normalizeUnits=L,n.relativeTimeRounding=ro,n.relativeTimeThreshold=ao,n.calendarFormat=Wf,n.prototype=Xd;var gi=n;return gi})},{}],5:[function(e,f,n){(function(){function e(e){function f(f,n,o,d,i,t){for(;i>=0&&t>i;i+=e){var l=d?d[i]:i;o=n(o,f[l],l,f)}return o}return function(n,o,d,i){o=h(o,i,4);var t=!z(n)&&x.keys(n),l=(t||n).length,u=e>0?0:l-1;return arguments.length<3&&(d=n[t?t[u]:u],u+=e),f(n,o,d,t,u,l)}}function o(e){return function(f,n,o){n=j(n,o);for(var d=null!=f&&f.length,i=e>0?0:d-1;i>=0&&d>i;i+=e)if(n(f[i],i,f))return i;return-1}}function d(e,f){for(var n=E.length,o="function"==typeof e.constructor?p:u;n--;){var d=E[n];("constructor"===d?x.has(e,d):d in e&&e[d]!==o[d]&&!x.contains(f,d))&&f.push(d)}}var i=this,t=i._,l=Array.prototype,u=Object.prototype,p=Function.prototype,s=l.push,y=l.slice,c=u.toString,r=u.hasOwnProperty,a=Array.isArray,w=Object.keys,b=p.bind,g=Object.create,m=function(){},x=function(e){return e instanceof x?e:this instanceof x?void(this._wrapped=e):new x(e)};"undefined"!=typeof n?("undefined"!=typeof f&&f.exports&&(n=f.exports=x),n._=x):i._=x,x.VERSION="1.8.0";var h=function(e,f,n){if(void 0===f)return e;switch(null==n?3:n){case 1:return function(n){return e.call(f,n)};case 2:return function(n,o){return e.call(f,n,o)};case 3:return function(n,o,d){return e.call(f,n,o,d)};case 4:return function(n,o,d,i){return e.call(f,n,o,d,i)}}return function(){return e.apply(f,arguments)}},j=function(e,f,n){return null==e?x.identity:x.isFunction(e)?h(e,f,n):x.isObject(e)?x.matcher(e):x.property(e)};x.iteratee=function(e,f){return j(e,f,1/0)};var v=function(e,f){return function(n){var o=arguments.length;if(2>o||null==n)return n;for(var d=1;o>d;d++)for(var i=arguments[d],t=e(i),l=t.length,u=0;l>u;u++){var p=t[u];f&&void 0!==n[p]||(n[p]=i[p])}return n}},k=function(e){if(!x.isObject(e))return{};if(g)return g(e);m.prototype=e;var f=new m;return m.prototype=null,f},q=Math.pow(2,53)-1,z=function(e){var f=e&&e.length;return"number"==typeof f&&f>=0&&q>=f};x.each=x.forEach=function(e,f,n){f=h(f,n);var o,d;if(z(e))for(o=0,d=e.length;d>o;o++)f(e[o],o,e);else{var i=x.keys(e);for(o=0,d=i.length;d>o;o++)f(e[i[o]],i[o],e)}return e},x.map=x.collect=function(e,f,n){f=j(f,n);for(var o=!z(e)&&x.keys(e),d=(o||e).length,i=Array(d),t=0;d>t;t++){var l=o?o[t]:t;i[t]=f(e[l],l,e)}return i},x.reduce=x.foldl=x.inject=e(1),x.reduceRight=x.foldr=e(-1),x.find=x.detect=function(e,f,n){var o;return o=z(e)?x.findIndex(e,f,n):x.findKey(e,f,n),void 0!==o&&-1!==o?e[o]:void 0},x.filter=x.select=function(e,f,n){var o=[];return f=j(f,n),x.each(e,function(e,n,d){f(e,n,d)&&o.push(e)}),o},x.reject=function(e,f,n){return x.filter(e,x.negate(j(f)),n)},x.every=x.all=function(e,f,n){f=j(f,n);for(var o=!z(e)&&x.keys(e),d=(o||e).length,i=0;d>i;i++){var t=o?o[i]:i;if(!f(e[t],t,e))return!1}return!0},x.some=x.any=function(e,f,n){f=j(f,n);for(var o=!z(e)&&x.keys(e),d=(o||e).length,i=0;d>i;i++){var t=o?o[i]:i;if(f(e[t],t,e))return!0}return!1},x.contains=x.includes=x.include=function(e,f){return z(e)||(e=x.values(e)),x.indexOf(e,f)>=0},x.invoke=function(e,f){var n=y.call(arguments,2),o=x.isFunction(f);return x.map(e,function(e){var d=o?f:e[f];return null==d?d:d.apply(e,n)})},x.pluck=function(e,f){return x.map(e,x.property(f))},x.where=function(e,f){return x.filter(e,x.matcher(f))},x.findWhere=function(e,f){return x.find(e,x.matcher(f))},x.max=function(e,f,n){var o,d,i=-(1/0),t=-(1/0);if(null==f&&null!=e){e=z(e)?e:x.values(e);for(var l=0,u=e.length;u>l;l++)o=e[l],o>i&&(i=o)}else f=j(f,n),x.each(e,function(e,n,o){d=f(e,n,o),(d>t||d===-(1/0)&&i===-(1/0))&&(i=e,t=d)});return i},x.min=function(e,f,n){var o,d,i=1/0,t=1/0;if(null==f&&null!=e){e=z(e)?e:x.values(e);for(var l=0,u=e.length;u>l;l++)o=e[l],i>o&&(i=o)}else f=j(f,n),x.each(e,function(e,n,o){d=f(e,n,o),(t>d||d===1/0&&i===1/0)&&(i=e,t=d)});return i},x.shuffle=function(e){for(var f,n=z(e)?e:x.values(e),o=n.length,d=Array(o),i=0;o>i;i++)f=x.random(0,i),f!==i&&(d[i]=d[f]),d[f]=n[i];return d},x.sample=function(e,f,n){return null==f||n?(z(e)||(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,f))},x.sortBy=function(e,f,n){return f=j(f,n),x.pluck(x.map(e,function(e,n,o){return{value:e,index:n,criteria:f(e,n,o)}}).sort(function(e,f){var n=e.criteria,o=f.criteria;if(n!==o){if(n>o||void 0===n)return 1;if(o>n||void 0===o)return-1}return e.index-f.index}),"value")};var A=function(e){return function(f,n,o){var d={};return n=j(n,o),x.each(f,function(o,i){var t=n(o,i,f);e(d,o,t)}),d}};x.groupBy=A(function(e,f,n){x.has(e,n)?e[n].push(f):e[n]=[f]}),x.indexBy=A(function(e,f,n){e[n]=f}),x.countBy=A(function(e,f,n){x.has(e,n)?e[n]++:e[n]=1}),x.toArray=function(e){return e?x.isArray(e)?y.call(e):z(e)?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:z(e)?e.length:x.keys(e).length},x.partition=function(e,f,n){f=j(f,n);var o=[],d=[];return x.each(e,function(e,n,i){(f(e,n,i)?o:d).push(e)}),[o,d]},x.first=x.head=x.take=function(e,f,n){return null==e?void 0:null==f||n?e[0]:x.initial(e,e.length-f)},x.initial=function(e,f,n){return y.call(e,0,Math.max(0,e.length-(null==f||n?1:f)))},x.last=function(e,f,n){return null==e?void 0:null==f||n?e[e.length-1]:x.rest(e,Math.max(0,e.length-f))},x.rest=x.tail=x.drop=function(e,f,n){return y.call(e,null==f||n?1:f)},x.compact=function(e){return x.filter(e,x.identity)};var B=function(e,f,n,o){for(var d=[],i=0,t=o||0,l=e&&e.length;l>t;t++){var u=e[t];if(z(u)&&(x.isArray(u)||x.isArguments(u))){f||(u=B(u,f,n));var p=0,s=u.length;for(d.length+=s;s>p;)d[i++]=u[p++]}else n||(d[i++]=u)}return d};x.flatten=function(e,f){return B(e,f,!1)},x.without=function(e){return x.difference(e,y.call(arguments,1))},x.uniq=x.unique=function(e,f,n,o){if(null==e)return[];x.isBoolean(f)||(o=n,n=f,f=!1),null!=n&&(n=j(n,o));for(var d=[],i=[],t=0,l=e.length;l>t;t++){var u=e[t],p=n?n(u,t,e):u;f?(t&&i===p||d.push(u),i=p):n?x.contains(i,p)||(i.push(p),d.push(u)):x.contains(d,u)||d.push(u)}return d},x.union=function(){return x.uniq(B(arguments,!0,!0))},x.intersection=function(e){if(null==e)return[];for(var f=[],n=arguments.length,o=0,d=e.length;d>o;o++){var i=e[o];if(!x.contains(f,i)){for(var t=1;n>t&&x.contains(arguments[t],i);t++);t===n&&f.push(i)}}return f},x.difference=function(e){var f=B(arguments,!0,!0,1);return x.filter(e,function(e){return!x.contains(f,e)})},x.zip=function(){return x.unzip(arguments)},x.unzip=function(e){for(var f=e&&x.max(e,"length").length||0,n=Array(f),o=0;f>o;o++)n[o]=x.pluck(e,o);return n},x.object=function(e,f){for(var n={},o=0,d=e&&e.length;d>o;o++)f?n[e[o]]=f[o]:n[e[o][0]]=e[o][1];return n},x.indexOf=function(e,f,n){var o=0,d=e&&e.length;if("number"==typeof n)o=0>n?Math.max(0,d+n):n;else if(n&&d)return o=x.sortedIndex(e,f),e[o]===f?o:-1;if(f!==f)return x.findIndex(y.call(e,o),x.isNaN);for(;d>o;o++)if(e[o]===f)return o;return-1},x.lastIndexOf=function(e,f,n){var o=e?e.length:0;if("number"==typeof n&&(o=0>n?o+n+1:Math.min(o,n+1)),f!==f)return x.findLastIndex(y.call(e,0,o),x.isNaN);for(;--o>=0;)if(e[o]===f)return o;return-1},x.findIndex=o(1),x.findLastIndex=o(-1),x.sortedIndex=function(e,f,n,o){n=j(n,o,1);for(var d=n(f),i=0,t=e.length;t>i;){var l=Math.floor((i+t)/2);n(e[l])<d?i=l+1:t=l}return i},x.range=function(e,f,n){arguments.length<=1&&(f=e||0,e=0),n=n||1;for(var o=Math.max(Math.ceil((f-e)/n),0),d=Array(o),i=0;o>i;i++,e+=n)d[i]=e;return d};var C=function(e,f,n,o,d){if(!(o instanceof f))return e.apply(n,d);var i=k(e.prototype),t=e.apply(i,d);return x.isObject(t)?t:i};x.bind=function(e,f){if(b&&e.bind===b)return b.apply(e,y.call(arguments,1));if(!x.isFunction(e))throw new TypeError("Bind must be called on a function");var n=y.call(arguments,2);return function o(){return C(e,o,f,this,n.concat(y.call(arguments)))}},x.partial=function(e){var f=y.call(arguments,1);return function n(){for(var o=0,d=f.length,i=Array(d),t=0;d>t;t++)i[t]=f[t]===x?arguments[o++]:f[t];for(;o<arguments.length;)i.push(arguments[o++]);return C(e,n,this,this,i)}},x.bindAll=function(e){var f,n,o=arguments.length;if(1>=o)throw new Error("bindAll must be passed function names");for(f=1;o>f;f++)n=arguments[f],e[n]=x.bind(e[n],e);return e},x.memoize=function(e,f){var n=function(o){var d=n.cache,i=""+(f?f.apply(this,arguments):o);return x.has(d,i)||(d[i]=e.apply(this,arguments)),d[i]};return n.cache={},n},x.delay=function(e,f){var n=y.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},f)},x.defer=x.partial(x.delay,x,1),x.throttle=function(e,f,n){var o,d,i,t=null,l=0;n||(n={});var u=function(){l=n.leading===!1?0:x.now(),t=null,i=e.apply(o,d),t||(o=d=null)};return function(){var p=x.now();l||n.leading!==!1||(l=p);var s=f-(p-l);return o=this,d=arguments,0>=s||s>f?(t&&(clearTimeout(t),t=null),l=p,i=e.apply(o,d),t||(o=d=null)):t||n.trailing===!1||(t=setTimeout(u,s)),i}},x.debounce=function(e,f,n){var o,d,i,t,l,u=function(){var p=x.now()-t;f>p&&p>=0?o=setTimeout(u,f-p):(o=null,n||(l=e.apply(i,d),o||(i=d=null)))};return function(){i=this,d=arguments,t=x.now();var p=n&&!o;return o||(o=setTimeout(u,f)),p&&(l=e.apply(i,d),i=d=null),l}},x.wrap=function(e,f){return x.partial(f,e)},x.negate=function(e){return function(){return!e.apply(this,arguments)}},x.compose=function(){var e=arguments,f=e.length-1;return function(){for(var n=f,o=e[f].apply(this,arguments);n--;)o=e[n].call(this,o);return o}},x.after=function(e,f){return function(){return--e<1?f.apply(this,arguments):void 0}},x.before=function(e,f){var n;return function(){return--e>0&&(n=f.apply(this,arguments)),1>=e&&(f=null),n}},x.once=x.partial(x.before,2);var D=!{toString:null}.propertyIsEnumerable("toString"),E=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];x.keys=function(e){if(!x.isObject(e))return[];if(w)return w(e);var f=[];for(var n in e)x.has(e,n)&&f.push(n);return D&&d(e,f),f},x.allKeys=function(e){if(!x.isObject(e))return[];var f=[];for(var n in e)f.push(n);return D&&d(e,f),f},x.values=function(e){for(var f=x.keys(e),n=f.length,o=Array(n),d=0;n>d;d++)o[d]=e[f[d]];return o},x.mapObject=function(e,f,n){f=j(f,n);for(var o,d=x.keys(e),i=d.length,t={},l=0;i>l;l++)o=d[l],t[o]=f(e[o],o,e);return t},x.pairs=function(e){for(var f=x.keys(e),n=f.length,o=Array(n),d=0;n>d;d++)o[d]=[f[d],e[f[d]]];return o},x.invert=function(e){for(var f={},n=x.keys(e),o=0,d=n.length;d>o;o++)f[e[n[o]]]=n[o];return f},x.functions=x.methods=function(e){var f=[];for(var n in e)x.isFunction(e[n])&&f.push(n);return f.sort()},x.extend=v(x.allKeys),x.extendOwn=v(x.keys),x.findKey=function(e,f,n){f=j(f,n);for(var o,d=x.keys(e),i=0,t=d.length;t>i;i++)if(o=d[i],f(e[o],o,e))return o},x.pick=function(e,f,n){var o,d={};if(null==e)return d;if(x.isFunction(f)){f=h(f,n);for(o in e){var i=e[o];f(i,o,e)&&(d[o]=i)}}else{var t=B(arguments,!1,!1,1);e=new Object(e);for(var l=0,u=t.length;u>l;l++)o=t[l],o in e&&(d[o]=e[o])}return d},x.omit=function(e,f,n){if(x.isFunction(f))f=x.negate(f);else{var o=x.map(B(arguments,!1,!1,1),String);f=function(e,f){return!x.contains(o,f)}}return x.pick(e,f,n)},x.defaults=v(x.allKeys,!0),x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,f){return f(e),e},x.isMatch=function(e,f){var n=x.keys(f),o=n.length;if(null==e)return!o;for(var d=Object(e),i=0;o>i;i++){var t=n[i];if(f[t]!==d[t]||!(t in d))return!1}return!0};var F=function(e,f,n,o){if(e===f)return 0!==e||1/e===1/f;if(null==e||null==f)return e===f;e instanceof x&&(e=e._wrapped),f instanceof x&&(f=f._wrapped);var d=c.call(e);if(d!==c.call(f))return!1;switch(d){case"[object RegExp]":case"[object String]":return""+e==""+f;case"[object Number]":return+e!==+e?+f!==+f:0===+e?1/+e===1/f:+e===+f;case"[object Date]":case"[object Boolean]":return+e===+f}var i="[object Array]"===d;if(!i){if("object"!=typeof e||"object"!=typeof f)return!1;var t=e.constructor,l=f.constructor;if(t!==l&&!(x.isFunction(t)&&t instanceof t&&x.isFunction(l)&&l instanceof l)&&"constructor"in e&&"constructor"in f)return!1}n=n||[],o=o||[];for(var u=n.length;u--;)if(n[u]===e)return o[u]===f;if(n.push(e),o.push(f),i){if(u=e.length,u!==f.length)return!1;for(;u--;)if(!F(e[u],f[u],n,o))return!1}else{var p,s=x.keys(e);if(u=s.length,x.keys(f).length!==u)return!1;for(;u--;)if(p=s[u],!x.has(f,p)||!F(e[p],f[p],n,o))return!1}return n.pop(),o.pop(),!0};x.isEqual=function(e,f){return F(e,f)},x.isEmpty=function(e){return null==e?!0:z(e)&&(x.isArray(e)||x.isString(e)||x.isArguments(e))?0===e.length:0===x.keys(e).length},x.isElement=function(e){return!(!e||1!==e.nodeType)},x.isArray=a||function(e){return"[object Array]"===c.call(e)},x.isObject=function(e){var f=typeof e;return"function"===f||"object"===f&&!!e},x.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){x["is"+e]=function(f){return c.call(f)==="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return x.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(x.isFunction=function(e){return"function"==typeof e||!1}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!==+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===c.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,f){return null!=e&&r.call(e,f)},x.noConflict=function(){return i._=t,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.noop=function(){},x.property=function(e){return function(f){return null==f?void 0:f[e]}},x.propertyOf=function(e){return null==e?function(){}:function(f){return e[f]}},x.matcher=x.matches=function(e){return e=x.extendOwn({},e),function(f){return x.isMatch(f,e)}},x.times=function(e,f,n){var o=Array(Math.max(0,e));f=h(f,n,1);for(var d=0;e>d;d++)o[d]=f(d);return o},x.random=function(e,f){return null==f&&(f=e,e=0),e+Math.floor(Math.random()*(f-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},H=x.invert(G),I=function(e){var f=function(f){return e[f]},n="(?:"+x.keys(e).join("|")+")",o=RegExp(n),d=RegExp(n,"g");return function(e){return e=null==e?"":""+e,o.test(e)?e.replace(d,f):e}};x.escape=I(G),x.unescape=I(H),x.result=function(e,f,n){var o=null==e?void 0:e[f];return void 0===o&&(o=n),x.isFunction(o)?o.call(e):o};var J=0;x.uniqueId=function(e){var f=++J+"";return e?e+f:f},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\u2028|\u2029/g,N=function(e){return"\\"+L[e]};x.template=function(e,f,n){!f&&n&&(f=n),f=x.defaults({},f,x.templateSettings);var o=RegExp([(f.escape||K).source,(f.interpolate||K).source,(f.evaluate||K).source].join("|")+"|$","g"),d=0,i="__p+='";e.replace(o,function(f,n,o,t,l){return i+=e.slice(d,l).replace(M,N),d=l+f.length,n?i+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":o?i+="'+\n((__t=("+o+"))==null?'':__t)+\n'":t&&(i+="';\n"+t+"\n__p+='"),f}),i+="';\n",f.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var t=new Function(f.variable||"obj","_",i)}catch(l){throw l.source=i,l}var u=function(e){return t.call(this,e,x)},p=f.variable||"obj";return u.source="function("+p+"){\n"+i+"}",u},x.chain=function(e){var f=x(e);return f._chain=!0,f};var O=function(e,f){return e._chain?x(f).chain():f};x.mixin=function(e){x.each(x.functions(e),function(f){var n=x[f]=e[f];x.prototype[f]=function(){var e=[this._wrapped];return s.apply(e,arguments),O(this,n.apply(x,e))}})},x.mixin(x),x.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var f=l[e];x.prototype[e]=function(){var n=this._wrapped;return f.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],O(this,n)}}),x.each(["concat","join","slice"],function(e){var f=l[e];x.prototype[e]=function(){return O(this,f.apply(this._wrapped,arguments))}}),x.prototype.value=function(){return this._wrapped},x.prototype.valueOf=x.prototype.toJSON=x.prototype.value,x.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this)},{}]},{},[1])}(window||module.exports);